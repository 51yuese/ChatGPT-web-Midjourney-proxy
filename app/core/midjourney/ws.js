'use strict';const _0x17bea2=_0xaac2;function _0xaac2(_0x266b07,_0x302eac){const _0xfd0c66=_0xfd0c();return _0xaac2=function(_0xaac211,_0x3a86dc){_0xaac211=_0xaac211-0x194;let _0x237fe2=_0xfd0c66[_0xaac211];return _0x237fe2;},_0xaac2(_0x266b07,_0x302eac);}(function(_0x2876f7,_0x10868f){const _0x3b5059=_0xaac2,_0x3ae786=_0x2876f7();while(!![]){try{const _0x3bc887=-parseInt(_0x3b5059(0x1cc))/0x1+parseInt(_0x3b5059(0x1ad))/0x2*(parseInt(_0x3b5059(0x1e8))/0x3)+parseInt(_0x3b5059(0x1a2))/0x4+parseInt(_0x3b5059(0x1ba))/0x5+-parseInt(_0x3b5059(0x1c6))/0x6+parseInt(_0x3b5059(0x1ca))/0x7+-parseInt(_0x3b5059(0x1c4))/0x8;if(_0x3bc887===_0x10868f)break;else _0x3ae786['push'](_0x3ae786['shift']());}catch(_0x315e74){_0x3ae786['push'](_0x3ae786['shift']());}}}(_0xfd0c,0xb2394));function _0xfd0c(){const _0x18d53f=['nonce','length','/inpaint/api/get-image-info/0/0/','2642940RZhXnM','session_id','handleMessageDelete','user','eventemitter3','assign','embed','once','replace','heartbeat_interval','8181752UDBuRj','isomorphic-ws','6377148oKXAcp','defineProperty','match',',\x20error\x20reason:\x20','7443408ffTSDe','WS_OPEN','150348LufnCy','INTERACTION_MODAL_CREATE','random','split','prompt','discord\x20heartbeat\x20ack!','arrayBuffer','WS_ERROR','https://cdn.discordapp.com','getMsgByContent','getMsgByOriginId','MidjourneyWs','getMsgById','INTERACTION_IFRAME_MODAL_CREATE','handleMessageUpdate','send','describe','formatComponents','wsBaseUrl','stringify','then','emitEmbed','wsClient\x20is\x20open!','MESSAGE_UPDATE','timestamp','json','heartbeat','matchRegionNonce','168270doAeDa','MESSAGE_CREATE','msgMap','off','processingImage','discord\x20wsClient\x20occurred\x20an\x20error:\x20','emit','handleMessageCreate','MESSAGE_DELETE','waitReady','nonce\x20is\x20none','wsBaseUrl\x20can\x27t\x20be\x20empty','number','connect','lastSequence','getMsgByparentId','close','debug','emitNonce','toString','error','discord\x20wsClient\x20was\x20close,\x20error\x20code:\x20','parseInt','handleMessage','__esModule','reconnectionTask','1906228gQpUrZ','wsClient','wsProxyUrl','discordsaysUrl','message','opts','get','EventEmitter','wsClient\x20connect\x20successfully!','readyState','heartbeatTask','32xYfFwf','url','auth','updateMsgByNonce','READY','discord\x20wsClient\x20reconnect...','parse','channel_id','addEventListener','image'];_0xfd0c=function(){return _0x18d53f;};return _0xfd0c();}Object[_0x17bea2(0x1c7)](exports,_0x17bea2(0x1a0),{'value':!![]}),exports[_0x17bea2(0x1d7)]=void 0x0;const eventemitter3_1=require(_0x17bea2(0x1be)),{WebSocket}=require(_0x17bea2(0x1c5)),msgMap_1=require('./msgMap'),utils_1=require('./utils');class MidjourneyWs extends eventemitter3_1[_0x17bea2(0x1a9)]{constructor(_0x3556e9){const _0x23bdaa=_0x17bea2;super(),this[_0x23bdaa(0x1a7)]=_0x3556e9,this[_0x23bdaa(0x196)]=null,this[_0x23bdaa(0x1ac)]=null,this[_0x23bdaa(0x1a1)]=null,this[_0x23bdaa(0x1ea)]=new msgMap_1['MidjourneyMsgMap'](),this['wsClient']=this[_0x23bdaa(0x195)]();}[_0x17bea2(0x195)](){const _0x5ef680=_0x17bea2;if(!this['opts'][_0x5ef680(0x1de)])throw new Error(_0x5ef680(0x1f3));let _0x5d7181;!this[_0x5ef680(0x1a7)][_0x5ef680(0x1a4)]&&this[_0x5ef680(0x1a7)]['wsBaseUrl']&&(_0x5d7181=new WebSocket(this['opts'][_0x5ef680(0x1de)]));if(!_0x5d7181)throw'ws创建失败';return _0x5d7181['addEventListener']('open',()=>{const _0x57206a=_0x5ef680;this['emit'](_0x57206a(0x1cb)),this[_0x57206a(0x1a7)]['debug']?.(_0x57206a(0x1d7),_0x57206a(0x195))(_0x57206a(0x1e2)),this['reconnectionTask']&&(clearTimeout(this[_0x57206a(0x1a1)]),this[_0x57206a(0x1a1)]=null);}),_0x5d7181['addEventListener'](_0x5ef680(0x1a6),this[_0x5ef680(0x1a6)]['bind'](this)),_0x5d7181[_0x5ef680(0x1b5)](_0x5ef680(0x19c),_0x22e3fb=>{const _0x3d5088=_0x5ef680;this[_0x3d5088(0x1ee)](_0x3d5088(0x1d3),_0x22e3fb[_0x3d5088(0x1a6)]),this[_0x3d5088(0x1a7)][_0x3d5088(0x199)]?.(_0x3d5088(0x1d7),_0x3d5088(0x195))(_0x3d5088(0x1ed)+_0x22e3fb['message']),this[_0x3d5088(0x1a3)][_0x3d5088(0x198)]();}),_0x5d7181['addEventListener'](_0x5ef680(0x198),({code:_0x1ab5de,reason:_0x2f5226})=>{const _0x19abbd=_0x5ef680;this[_0x19abbd(0x1ee)]('WS_CLOSE'),this[_0x19abbd(0x1a7)][_0x19abbd(0x199)]?.('MidjourneyWs',_0x19abbd(0x195))(_0x19abbd(0x19d)+_0x1ab5de+_0x19abbd(0x1c9)+_0x2f5226),_0x1ab5de===0xfa4?this[_0x19abbd(0x1ee)](_0x19abbd(0x1b1),new Error(_0x2f5226)):this[_0x19abbd(0x1a1)]=setTimeout(()=>{const _0x205f78=_0x19abbd;this[_0x205f78(0x1a7)]['debug']?.('MidjourneyWs',_0x205f78(0x195))(_0x205f78(0x1b2)),this['heartbeatTask']&&typeof this[_0x205f78(0x1ac)]===_0x205f78(0x194)&&(clearInterval(this[_0x205f78(0x1ac)]),this[_0x205f78(0x1ac)]=null),this[_0x205f78(0x1a3)]=this[_0x205f78(0x195)]['call'](this);},0xfa0);}),_0x5d7181;}[_0x17bea2(0x1af)](){const _0x31334b=_0x17bea2;this['wsClient'][_0x31334b(0x1db)](JSON[_0x31334b(0x1df)]({'op':0x2,'d':{'token':this['opts']['token'],'capabilities':0x3ffd,'properties':{'os':'Mac\x20OS\x20X','browser':'Chrome','device':''},'compress':![]}}));}['heartbeat'](_0x288ff4){const _0x15b500=_0x17bea2,_0x5bf8d2=_0x288ff4*Math[_0x15b500(0x1ce)]();this['heartbeatTask']=setTimeout(()=>{const _0x343b06=_0x15b500;this['wsClient'][_0x343b06(0x1ab)]===WebSocket['OPEN']&&(this[_0x343b06(0x1a3)][_0x343b06(0x1db)](JSON[_0x343b06(0x1df)]({'op':0x1,'d':this[_0x343b06(0x196)]})),this[_0x343b06(0x1e6)](_0x288ff4));},_0x5bf8d2);}[_0x17bea2(0x1a6)](_0xa7cd7a){const _0x5da52d=_0x17bea2,_0x15aba5=JSON['parse'](_0xa7cd7a['data']),_0x1ca5a6=_0x15aba5['d'],_0x5b6b96=_0x15aba5['t'],_0x2cd7e8=_0x15aba5['s'],_0x185d32=_0x15aba5['op'];_0x2cd7e8&&(this[_0x5da52d(0x196)]=_0x2cd7e8);_0x185d32===0xa&&(this[_0x5da52d(0x1e6)](_0x1ca5a6[_0x5da52d(0x1c3)]),this[_0x5da52d(0x1af)]());_0x5b6b96==='READY'&&(this['opts']['session_id']=_0x1ca5a6[_0x5da52d(0x1bb)],this['opts']['user']=_0x1ca5a6[_0x5da52d(0x1bd)],this[_0x5da52d(0x1a7)]['debug']?.(_0x5da52d(0x1d7),_0x5da52d(0x1a6))(_0x5da52d(0x1aa)),this[_0x5da52d(0x1ee)](_0x5da52d(0x1b1),_0x1ca5a6[_0x5da52d(0x1bd)]));if(_0x5b6b96===_0x5da52d(0x1e9)||_0x5b6b96===_0x5da52d(0x1e3)||_0x5b6b96===_0x5da52d(0x1f0)||_0x5b6b96==='INTERACTION_IFRAME_MODAL_CREATE'||_0x5b6b96===_0x5da52d(0x1cd))this[_0x5da52d(0x19f)](_0x5b6b96,_0x1ca5a6);_0x185d32===0xb&&(!this['opts']['skipHeartbeat']&&this[_0x5da52d(0x1a7)]['debug']?.(_0x5da52d(0x1d7),_0x5da52d(0x1a6))(_0x5da52d(0x1d1)));}[_0x17bea2(0x19f)](_0x1adc84,_0x2c0297){const _0x2c3a1b=_0x17bea2;if(_0x2c0297['channel_id']!==this[_0x2c3a1b(0x1a7)][_0x2c3a1b(0x1b4)])return;if(_0x1adc84===_0x2c3a1b(0x1e9)||_0x1adc84===_0x2c3a1b(0x1d9)||_0x1adc84===_0x2c3a1b(0x1cd))this[_0x2c3a1b(0x1ef)](_0x1adc84,_0x2c0297);else{if(_0x1adc84===_0x2c3a1b(0x1e3))this[_0x2c3a1b(0x1da)](_0x2c3a1b(0x1e3),_0x2c0297);else this['handleMessageDelete'](_0x2c0297);}}[_0x17bea2(0x1ef)](_0x3cec53,_0x379be4){const _0x432b37=_0x17bea2;let {nonce:_0x47e0c6,id:_0x2ae120,embeds:embeds=[],custom_id:_0x1511bb,content:_0x421f88,attachments:attachments=[],components:_0xe39ded}=_0x379be4;_0x47e0c6=_0x47e0c6||(0x0,utils_1[_0x432b37(0x1e7)])(_0x421f88);if(_0x47e0c6&&!attachments[_0x432b37(0x1b8)]){this['msgMap'][_0x432b37(0x1b0)](_0x2ae120,_0x47e0c6);if(embeds[0x0]){const {color:_0x28e655}=embeds[0x0];switch(_0x28e655){case 0xff0000:this[_0x432b37(0x1e1)](_0x2ae120,_0x432b37(0x1e9),embeds[0x0]);break;default:break;}}if(_0x3cec53===_0x432b37(0x1d9)&&_0x1511bb){_0x1511bb=_0x1511bb[_0x432b37(0x1cf)]('::')[0x2];let _0x4e3ead='';return fetch(this['opts'][_0x432b37(0x1a5)]+_0x432b37(0x1b9)+_0x1511bb)['then'](async _0x18f502=>{const _0x467b53=_0x432b37;if(_0x18f502['ok']){const _0x2bef0c=await _0x18f502[_0x467b53(0x1e5)]();_0x4e3ead=_0x2bef0c[_0x467b53(0x1d0)];const _0x3d02e9=await fetch(this[_0x467b53(0x1a7)][_0x467b53(0x1a5)]+'/inpaint'+_0x2bef0c['image_url']?.[_0x467b53(0x1c2)](/^\./,''))[_0x467b53(0x1e0)](_0x508751=>_0x508751[_0x467b53(0x1d2)]())['then'](_0x435a19=>Buffer['from'](_0x435a19)[_0x467b53(0x19b)]('base64'));this[_0x467b53(0x19a)](_0x47e0c6,_0x3cec53,{'custom_id':_0x1511bb,'varyRegionPrompt':_0x4e3ead,'varyRegionImgBase64':_0x3d02e9});}});}_0x3cec53===_0x432b37(0x1cd)&&_0x1511bb&&_0xe39ded[_0x432b37(0x1b8)]&&this['emitNonce'](_0x47e0c6,_0x3cec53,{'id':_0x2ae120,'custom_id':_0x1511bb,'components':_0xe39ded});}this['handleMessageUpdate']('MESSAGE_CREATE',_0x379be4);}[_0x17bea2(0x1da)](_0x25a383,_0x177105){const _0x563ac8=_0x17bea2,{content:_0x57dab0,interaction:interaction={},nonce:_0x294c7f,flags:_0x4c4081,attachments:_0x2f776e,components:components=[],embeds:embeds=[],id:_0x5ca8e8}=_0x177105;if(!_0x294c7f){const {name:_0x6100c7}=interaction,_0x41baba=this[_0x563ac8(0x1ea)][_0x563ac8(0x1d8)](_0x5ca8e8);if(_0x41baba&&_0x41baba['nonce'])switch(_0x6100c7){case'settings':this[_0x563ac8(0x19a)](_0x41baba[_0x563ac8(0x1b7)],_0x25a383,{'id':_0x5ca8e8,'flags':_0x4c4081,'components':(0x0,utils_1[_0x563ac8(0x1dd)])(components),'progress':0x64});return;case'info':embeds['at'](0x0)&&this[_0x563ac8(0x19a)](_0x41baba['nonce'],_0x25a383,{'id':_0x5ca8e8,'embed':embeds[0x0],'progress':0x64});return;case _0x563ac8(0x1dc):embeds['at'](0x0)&&this['emitNonce'](_0x41baba[_0x563ac8(0x1b7)],_0x25a383,{'flags':_0x4c4081,'url':embeds[0x0][_0x563ac8(0x1b6)][_0x563ac8(0x1ae)],'timestamp':_0x177105[_0x563ac8(0x1e4)],'components':(0x0,utils_1['formatComponents'])(components),'id':_0x5ca8e8,'embed':embeds[0x0],'progress':0x64});return;}}_0x57dab0&&this[_0x563ac8(0x1ec)](_0x25a383,_0x177105);}[_0x17bea2(0x1bc)]({id:_0x786382}){const _0xd74b67=_0x17bea2;this[_0xd74b67(0x19a)](_0x786382,_0xd74b67(0x1f0),{'id':_0x786382},!![]);}[_0x17bea2(0x1ec)](_0x24c615,_0x589e8b){const _0x3a3e15=_0x17bea2,{content:_0x5bd37b,id:_0xcb9760,attachments:attachments=[],flags:_0x1d2652,components:components=[],nonce:_0x43f681,timestamp:_0x564587,message_reference:message_reference={}}=_0x589e8b,{message_id:_0x28bc8d}=message_reference,_0xdfef4a=this[_0x3a3e15(0x1ea)]['getMsgById'](_0xcb9760)||this[_0x3a3e15(0x1ea)][_0x3a3e15(0x197)](_0x28bc8d)||this[_0x3a3e15(0x1ea)][_0x3a3e15(0x1d5)](_0x5bd37b);if(!_0xdfef4a?.[_0x3a3e15(0x1b7)]){console[_0x3a3e15(0x19c)](_0x3a3e15(0x1f2));return;}let _0x466118=attachments['at'](0x0)?.[_0x3a3e15(0x1ae)];if(_0x466118&&this[_0x3a3e15(0x1a7)]['imgBaseUrl'])_0x466118=_0x466118[_0x3a3e15(0x1c2)](_0x3a3e15(0x1d4),this[_0x3a3e15(0x1a7)]['imgBaseUrl']);const _0x349ced=_0x5bd37b?.[_0x3a3e15(0x1c8)](/\((\d+?)%\)\s\(\w+?\)/)?.[0x1],_0x403782=!_0x43f681&&attachments[_0x3a3e15(0x1b8)]&&components[_0x3a3e15(0x1b8)]&&_0x24c615===_0x3a3e15(0x1e9),_0x565801=_0x403782?0x64:_0x349ced?Number[_0x3a3e15(0x19e)](_0x349ced):0x0,_0x58ab83=_0xdfef4a?.['id']!==_0xcb9760?_0xdfef4a?.['id']:undefined,_0x708de5=JSON[_0x3a3e15(0x1b3)](JSON[_0x3a3e15(0x1df)]({'id':_0xcb9760,'url':_0x466118,'originId':_0x58ab83,'attachments':attachments,'content':_0x5bd37b['replace'](/^\*\*regionNonce:\s\d+?,\s/,'**'),'parentId':_0x28bc8d,'flags':_0x1d2652,'components':(0x0,utils_1[_0x3a3e15(0x1dd)])(components),'progress':_0x565801,'timestamp':_0x564587}));this[_0x3a3e15(0x19a)](_0xdfef4a[_0x3a3e15(0x1b7)],_0x24c615,_0x708de5);}['emitNonce'](_0x450231,_0x156585,_0x1223f0,_0x540ae7=![]){const _0x2152ae=_0x17bea2,_0x13eb32=this[_0x2152ae(0x1ea)][_0x2152ae(0x1a8)](_0x450231)||this[_0x2152ae(0x1ea)]['getMsgById'](_0x450231)||this[_0x2152ae(0x1ea)][_0x2152ae(0x1d6)](_0x450231);_0x13eb32&&_0x13eb32['nonce']&&this[_0x2152ae(0x1ee)](_0x13eb32[_0x2152ae(0x1b7)],_0x156585,_0x540ae7?_0x1223f0:Object[_0x2152ae(0x1bf)]({},_0x13eb32,_0x1223f0));}[_0x17bea2(0x1e1)](_0x3c6adc,_0x1484ea,_0x42bd37){const _0x143825=_0x17bea2,_0x5768b0=this[_0x143825(0x1ea)][_0x143825(0x1d8)](_0x3c6adc);if(!_0x5768b0||!_0x5768b0[_0x143825(0x1b7)])return;_0x5768b0[_0x143825(0x1c0)]=_0x42bd37,this[_0x143825(0x19a)](_0x5768b0[_0x143825(0x1b7)],_0x1484ea,_0x5768b0);}[_0x17bea2(0x1f1)](){return new Promise((_0x11e77d,_0x46df5c)=>{const _0x114504=_0xaac2;this[_0x114504(0x1c1)](_0x114504(0x1b1),_0x555792=>_0x555792 instanceof Error?_0x46df5c(_0x555792):_0x11e77d(_0x555792));});}['waitMessage']({nonce:_0x1c0511,parentId:_0x207d92,cb:_0x5e026e}){const _0x2d50b8=_0x17bea2;this[_0x2d50b8(0x1ea)]['set'](_0x1c0511,{'id':'','nonce':_0x1c0511});const _0x356769=_0x207d92&&this[_0x2d50b8(0x1ea)][_0x2d50b8(0x1d8)](_0x207d92);return new Promise((_0x26a486,_0x4fc742)=>{const _0x4c40a8=_0x2d50b8;_0x356769&&_0x356769[_0x4c40a8(0x1b7)]&&this[_0x4c40a8(0x1c1)](_0x356769[_0x4c40a8(0x1b7)],(_0x341bfd,_0x5829f6)=>{const _0x29ffb2=_0x4c40a8;_0x5e026e?.(_0x341bfd,_0x5829f6),this[_0x29ffb2(0x1eb)](_0x356769[_0x29ffb2(0x1b7)]);}),this['on'](_0x1c0511,(_0x36c037,_0x2f839e)=>{const _0x544e60=_0x4c40a8;_0x5e026e?.(_0x36c037,_0x2f839e);if(_0x36c037===_0x544e60(0x1f0)&&_0x2f839e['id']){const _0x314f6d=this[_0x544e60(0x1ea)][_0x544e60(0x1d6)](_0x2f839e['id']);_0x314f6d&&this[_0x544e60(0x1eb)](_0x1c0511)&&_0x26a486(_0x314f6d);return;}if(_0x36c037==='INTERACTION_IFRAME_MODAL_CREATE'||_0x36c037===_0x544e60(0x1cd)){this[_0x544e60(0x1eb)](_0x1c0511);return;}this[_0x544e60(0x1ea)]['set'](_0x1c0511,_0x2f839e),_0x2f839e[_0x544e60(0x19c)]&&(this[_0x544e60(0x1eb)](_0x1c0511),_0x4fc742(_0x2f839e[_0x544e60(0x19c)]));});});}}exports[_0x17bea2(0x1d7)]=MidjourneyWs;