'use strict';const _0xbd9463=_0x928e;function _0x1f9c(){const _0x1b57e8=['getMsgByOriginId','skipHeartbeat','readyState','open','140dgCLnL','then','__esModule','wsProxyUrl','message','15206802jUsTIu','437496YTCulx','ws创建失败','imgBaseUrl','debug','READY','wsBaseUrl','4GDkcVF','heartbeat_interval','defineProperty','stringify','parse','timestamp','Chrome','discordsaysUrl','processingImage','describe','discord\x20wsClient\x20reconnect...','parseInt','6vLBvKp','formatComponents','session_id','discord\x20heartbeat\x20ack!','discord\x20wsClient\x20occurred\x20an\x20error:\x20','MESSAGE_DELETE','heartbeatTask','heartbeat','opts','number','INTERACTION_IFRAME_MODAL_CREATE','24270UkwsWL','wsClient','handleMessageUpdate','nonce\x20is\x20none','url','channel_id','306541BdssCp','MidjourneyWs','set','bind','1257935wYFjtv','wsClient\x20connect\x20successfully!','getMsgById','emit','length','getMsgByContent','eventemitter3','auth','user','158024XjkoBv','updateMsgByNonce','MidjourneyMsgMap','prompt','/inpaint/api/get-image-info/0/0/','image','assign','4wriTwe','Mac\x20OS\x20X','connect','match','198nCIhYG','handleMessage','INTERACTION_MODAL_CREATE','random','emitEmbed','off','https://cdn.discordapp.com','270oizlLv','OPEN','EventEmitter','settings','reconnectionTask','split','handleMessageCreate','1568121FuzsAX','data','addEventListener','MESSAGE_CREATE','waitReady','WS_CLOSE','msgMap','nonce','send','info','waitMessage','replace','get','json','handleMessageDelete','base64','lastSequence','MESSAGE_UPDATE','/inpaint','error','wsBaseUrl\x20can\x27t\x20be\x20empty','once','./utils','emitNonce','arrayBuffer',',\x20error\x20reason:\x20','close'];_0x1f9c=function(){return _0x1b57e8;};return _0x1f9c();}(function(_0x4b66f2,_0x3d617d){const _0x454bdc=_0x928e,_0x27a8b6=_0x4b66f2();while(!![]){try{const _0x50fab9=-parseInt(_0x454bdc(0x1fe))/0x1*(-parseInt(_0x454bdc(0x1e1))/0x2)+parseInt(_0x454bdc(0x224))/0x3*(parseInt(_0x454bdc(0x212))/0x4)+parseInt(_0x454bdc(0x202))/0x5*(parseInt(_0x454bdc(0x1ed))/0x6)+-parseInt(_0x454bdc(0x1d5))/0x7*(parseInt(_0x454bdc(0x20b))/0x8)+-parseInt(_0x454bdc(0x21d))/0x9*(parseInt(_0x454bdc(0x1f8))/0xa)+-parseInt(_0x454bdc(0x216))/0xb*(-parseInt(_0x454bdc(0x1db))/0xc)+-parseInt(_0x454bdc(0x1da))/0xd;if(_0x50fab9===_0x3d617d)break;else _0x27a8b6['push'](_0x27a8b6['shift']());}catch(_0x345f08){_0x27a8b6['push'](_0x27a8b6['shift']());}}}(_0x1f9c,0x631ec));function _0x928e(_0x550c10,_0x144d28){const _0x1f9c91=_0x1f9c();return _0x928e=function(_0x928e9e,_0x2c5f6e){_0x928e9e=_0x928e9e-0x1c7;let _0x6d2180=_0x1f9c91[_0x928e9e];return _0x6d2180;},_0x928e(_0x550c10,_0x144d28);}Object[_0xbd9463(0x1e3)](exports,_0xbd9463(0x1d7),{'value':!![]}),exports['MidjourneyWs']=void 0x0;const eventemitter3_1=require(_0xbd9463(0x208)),{WebSocket}=require('isomorphic-ws'),msgMap_1=require('./msgMap'),utils_1=require(_0xbd9463(0x1cc));class MidjourneyWs extends eventemitter3_1[_0xbd9463(0x21f)]{constructor(_0x324abf){const _0x407a81=_0xbd9463;super(),this['opts']=_0x324abf,this['lastSequence']=null,this[_0x407a81(0x1f3)]=null,this['reconnectionTask']=null,this[_0x407a81(0x22a)]=new msgMap_1[(_0x407a81(0x20d))](),this[_0x407a81(0x1f9)]=this[_0x407a81(0x214)]();}[_0xbd9463(0x214)](){const _0x20ba4c=_0xbd9463;if(!this['opts'][_0x20ba4c(0x1e0)])throw new Error(_0x20ba4c(0x1ca));let _0x51e2e9;!this['opts'][_0x20ba4c(0x1d8)]&&this[_0x20ba4c(0x1f5)]['wsBaseUrl']&&(_0x51e2e9=new WebSocket(this[_0x20ba4c(0x1f5)][_0x20ba4c(0x1e0)]));if(!_0x51e2e9)throw _0x20ba4c(0x1dc);return _0x51e2e9[_0x20ba4c(0x226)](_0x20ba4c(0x1d4),()=>{const _0x28a7d4=_0x20ba4c;this['emit']('WS_OPEN'),this[_0x28a7d4(0x1f5)]['debug']?.(_0x28a7d4(0x1ff),_0x28a7d4(0x214))('wsClient\x20is\x20open!'),this[_0x28a7d4(0x221)]&&(clearTimeout(this['reconnectionTask']),this[_0x28a7d4(0x221)]=null);}),_0x51e2e9[_0x20ba4c(0x226)](_0x20ba4c(0x1d9),this['message'][_0x20ba4c(0x201)](this)),_0x51e2e9['addEventListener']('error',_0x36267d=>{const _0x599b61=_0x20ba4c;this['emit']('WS_ERROR',_0x36267d[_0x599b61(0x1d9)]),this[_0x599b61(0x1f5)][_0x599b61(0x1de)]?.(_0x599b61(0x1ff),_0x599b61(0x214))(_0x599b61(0x1f1)+_0x36267d[_0x599b61(0x1d9)]),this[_0x599b61(0x1f9)][_0x599b61(0x1d0)]();}),_0x51e2e9[_0x20ba4c(0x226)](_0x20ba4c(0x1d0),({code:_0x1a3a75,reason:_0x36d1b2})=>{const _0x5cc965=_0x20ba4c;this[_0x5cc965(0x205)](_0x5cc965(0x229)),this[_0x5cc965(0x1f5)][_0x5cc965(0x1de)]?.(_0x5cc965(0x1ff),'connect')('discord\x20wsClient\x20was\x20close,\x20error\x20code:\x20'+_0x1a3a75+_0x5cc965(0x1cf)+_0x36d1b2),_0x1a3a75===0xfa4?this['emit'](_0x5cc965(0x1df),new Error(_0x36d1b2)):this[_0x5cc965(0x221)]=setTimeout(()=>{const _0x102334=_0x5cc965;this[_0x102334(0x1f5)][_0x102334(0x1de)]?.(_0x102334(0x1ff),_0x102334(0x214))(_0x102334(0x1eb)),this[_0x102334(0x1f3)]&&typeof this['heartbeatTask']===_0x102334(0x1f6)&&(clearInterval(this[_0x102334(0x1f3)]),this['heartbeatTask']=null),this[_0x102334(0x1f9)]=this[_0x102334(0x214)]['call'](this);},0xfa0);}),_0x51e2e9;}[_0xbd9463(0x209)](){const _0x2b8582=_0xbd9463;this[_0x2b8582(0x1f9)][_0x2b8582(0x22c)](JSON[_0x2b8582(0x1e4)]({'op':0x2,'d':{'token':this[_0x2b8582(0x1f5)]['token'],'capabilities':0x3ffd,'properties':{'os':_0x2b8582(0x213),'browser':_0x2b8582(0x1e7),'device':''},'compress':![]}}));}[_0xbd9463(0x1f4)](_0x4cf3e6){const _0x1ae441=_0xbd9463,_0x2cd054=_0x4cf3e6*Math[_0x1ae441(0x219)]();this[_0x1ae441(0x1f3)]=setTimeout(()=>{const _0x2689b2=_0x1ae441;this[_0x2689b2(0x1f9)][_0x2689b2(0x1d3)]===WebSocket[_0x2689b2(0x21e)]&&(this[_0x2689b2(0x1f9)][_0x2689b2(0x22c)](JSON[_0x2689b2(0x1e4)]({'op':0x1,'d':this['lastSequence']})),this['heartbeat'](_0x4cf3e6));},_0x2cd054);}[_0xbd9463(0x1d9)](_0x144565){const _0x5b9ca9=_0xbd9463,_0x141330=JSON['parse'](_0x144565[_0x5b9ca9(0x225)]),_0x4a9d54=_0x141330['d'],_0x1bb408=_0x141330['t'],_0x176c08=_0x141330['s'],_0x303658=_0x141330['op'];_0x176c08&&(this[_0x5b9ca9(0x234)]=_0x176c08);_0x303658===0xa&&(this[_0x5b9ca9(0x1f4)](_0x4a9d54[_0x5b9ca9(0x1e2)]),this[_0x5b9ca9(0x209)]());_0x1bb408===_0x5b9ca9(0x1df)&&(this[_0x5b9ca9(0x1f5)][_0x5b9ca9(0x1ef)]=_0x4a9d54['session_id'],this[_0x5b9ca9(0x1f5)][_0x5b9ca9(0x20a)]=_0x4a9d54['user'],this[_0x5b9ca9(0x1f5)]['debug']?.(_0x5b9ca9(0x1ff),_0x5b9ca9(0x1d9))(_0x5b9ca9(0x203)),this[_0x5b9ca9(0x205)](_0x5b9ca9(0x1df),_0x4a9d54[_0x5b9ca9(0x20a)]));if(_0x1bb408===_0x5b9ca9(0x227)||_0x1bb408===_0x5b9ca9(0x1c7)||_0x1bb408===_0x5b9ca9(0x1f2)||_0x1bb408==='INTERACTION_IFRAME_MODAL_CREATE'||_0x1bb408===_0x5b9ca9(0x218))this[_0x5b9ca9(0x217)](_0x1bb408,_0x4a9d54);_0x303658===0xb&&(!this[_0x5b9ca9(0x1f5)][_0x5b9ca9(0x1d2)]&&this['opts'][_0x5b9ca9(0x1de)]?.(_0x5b9ca9(0x1ff),_0x5b9ca9(0x1d9))(_0x5b9ca9(0x1f0)));}[_0xbd9463(0x217)](_0x59c17a,_0x1ea9c0){const _0x308734=_0xbd9463;if(_0x1ea9c0['channel_id']!==this[_0x308734(0x1f5)][_0x308734(0x1fd)])return;if(_0x59c17a===_0x308734(0x227)||_0x59c17a==='INTERACTION_IFRAME_MODAL_CREATE'||_0x59c17a===_0x308734(0x218))this[_0x308734(0x223)](_0x59c17a,_0x1ea9c0);else{if(_0x59c17a===_0x308734(0x1c7))this[_0x308734(0x1fa)](_0x308734(0x1c7),_0x1ea9c0);else this[_0x308734(0x232)](_0x1ea9c0);}}[_0xbd9463(0x223)](_0x1fee48,_0x45350d){const _0x2215b2=_0xbd9463;let {nonce:_0x1d7bc4,id:_0x24877f,embeds:embeds=[],custom_id:_0x314839,content:_0x4f2f00,attachments:attachments=[],components:_0x594586}=_0x45350d;_0x1d7bc4=_0x1d7bc4||(0x0,utils_1['matchRegionNonce'])(_0x4f2f00);if(_0x1d7bc4&&!attachments['length']){this[_0x2215b2(0x22a)][_0x2215b2(0x20c)](_0x24877f,_0x1d7bc4);if(embeds[0x0]){const {color:_0x5e18ce}=embeds[0x0];switch(_0x5e18ce){case 0xff0000:this[_0x2215b2(0x21a)](_0x24877f,_0x2215b2(0x227),embeds[0x0]);break;default:break;}}if(_0x1fee48===_0x2215b2(0x1f7)&&_0x314839){_0x314839=_0x314839[_0x2215b2(0x222)]('::')[0x2];let _0x1323dc='';return fetch(this[_0x2215b2(0x1f5)][_0x2215b2(0x1e8)]+_0x2215b2(0x20f)+_0x314839)[_0x2215b2(0x1d6)](async _0x13948e=>{const _0x4b9b82=_0x2215b2;if(_0x13948e['ok']){const _0x2c7b29=await _0x13948e[_0x4b9b82(0x231)]();_0x1323dc=_0x2c7b29[_0x4b9b82(0x20e)];const _0x57491d=await fetch(this[_0x4b9b82(0x1f5)][_0x4b9b82(0x1e8)]+_0x4b9b82(0x1c8)+_0x2c7b29['image_url']?.[_0x4b9b82(0x22f)](/^\./,''))[_0x4b9b82(0x1d6)](_0x3ecd13=>_0x3ecd13[_0x4b9b82(0x1ce)]())['then'](_0x5fbd8f=>Buffer['from'](_0x5fbd8f)['toString'](_0x4b9b82(0x233)));this[_0x4b9b82(0x1cd)](_0x1d7bc4,_0x1fee48,{'custom_id':_0x314839,'varyRegionPrompt':_0x1323dc,'varyRegionImgBase64':_0x57491d});}});}_0x1fee48===_0x2215b2(0x218)&&_0x314839&&_0x594586[_0x2215b2(0x206)]&&this[_0x2215b2(0x1cd)](_0x1d7bc4,_0x1fee48,{'id':_0x24877f,'custom_id':_0x314839,'components':_0x594586});}this[_0x2215b2(0x1fa)]('MESSAGE_CREATE',_0x45350d);}[_0xbd9463(0x1fa)](_0x5c7728,_0x4bf10f){const _0x177f14=_0xbd9463,{content:_0x140564,interaction:interaction={},nonce:_0x49c827,flags:_0x28e09c,attachments:_0x32164f,components:components=[],embeds:embeds=[],id:_0x86237b}=_0x4bf10f;if(!_0x49c827){const {name:_0x5900c5}=interaction,_0x3f248f=this['msgMap'][_0x177f14(0x204)](_0x86237b);if(_0x3f248f&&_0x3f248f['nonce'])switch(_0x5900c5){case _0x177f14(0x220):this[_0x177f14(0x1cd)](_0x3f248f['nonce'],_0x5c7728,{'id':_0x86237b,'flags':_0x28e09c,'components':(0x0,utils_1[_0x177f14(0x1ee)])(components),'progress':0x64});return;case _0x177f14(0x22d):embeds['at'](0x0)&&this[_0x177f14(0x1cd)](_0x3f248f[_0x177f14(0x22b)],_0x5c7728,{'id':_0x86237b,'embed':embeds[0x0],'progress':0x64});return;case _0x177f14(0x1ea):embeds['at'](0x0)&&this[_0x177f14(0x1cd)](_0x3f248f[_0x177f14(0x22b)],_0x5c7728,{'flags':_0x28e09c,'url':embeds[0x0][_0x177f14(0x210)][_0x177f14(0x1fc)],'timestamp':_0x4bf10f[_0x177f14(0x1e6)],'components':(0x0,utils_1['formatComponents'])(components),'id':_0x86237b,'embed':embeds[0x0],'progress':0x64});return;}}_0x140564&&this['processingImage'](_0x5c7728,_0x4bf10f);}[_0xbd9463(0x232)]({id:_0x30db63}){const _0x2b0080=_0xbd9463;this[_0x2b0080(0x1cd)](_0x30db63,'MESSAGE_DELETE',{'id':_0x30db63},!![]);}[_0xbd9463(0x1e9)](_0x5158ac,_0x473af9){const _0x100d6b=_0xbd9463,{content:_0x114a81,id:_0x3a3170,attachments:attachments=[],flags:_0x341385,components:components=[],nonce:_0x6c711,timestamp:_0xdeb24a,message_reference:message_reference={}}=_0x473af9,{message_id:_0x3fa3fa}=message_reference,_0x5db7b1=this[_0x100d6b(0x22a)]['getMsgById'](_0x3a3170)||this[_0x100d6b(0x22a)]['getMsgByparentId'](_0x3fa3fa)||this[_0x100d6b(0x22a)][_0x100d6b(0x207)](_0x114a81);if(!_0x5db7b1?.[_0x100d6b(0x22b)]){console[_0x100d6b(0x1c9)](_0x100d6b(0x1fb));return;}let _0xfd3e65=attachments['at'](0x0)?.[_0x100d6b(0x1fc)];if(_0xfd3e65&&this['opts'][_0x100d6b(0x1dd)])_0xfd3e65=_0xfd3e65['replace'](_0x100d6b(0x21c),this[_0x100d6b(0x1f5)][_0x100d6b(0x1dd)]);const _0x26813d=_0x114a81?.[_0x100d6b(0x215)](/\((\d+?)%\)\s\(\w+?\)/)?.[0x1],_0x2db5fd=!_0x6c711&&attachments[_0x100d6b(0x206)]&&components[_0x100d6b(0x206)]&&_0x5158ac===_0x100d6b(0x227),_0x182d7d=_0x2db5fd?0x64:_0x26813d?Number[_0x100d6b(0x1ec)](_0x26813d):0x0,_0x26638b=_0x5db7b1?.['id']!==_0x3a3170?_0x5db7b1?.['id']:undefined,_0xb61317=JSON[_0x100d6b(0x1e5)](JSON[_0x100d6b(0x1e4)]({'id':_0x3a3170,'url':_0xfd3e65,'originId':_0x26638b,'attachments':attachments,'content':_0x114a81[_0x100d6b(0x22f)](/^\*\*regionNonce:\s\d+?,\s/,'**'),'parentId':_0x3fa3fa,'flags':_0x341385,'components':(0x0,utils_1[_0x100d6b(0x1ee)])(components),'progress':_0x182d7d,'timestamp':_0xdeb24a}));this[_0x100d6b(0x1cd)](_0x5db7b1['nonce'],_0x5158ac,_0xb61317);}[_0xbd9463(0x1cd)](_0xf2d067,_0xe8caa0,_0x1ff24d,_0x42f79f=![]){const _0x25f9ab=_0xbd9463,_0x2388f2=this[_0x25f9ab(0x22a)][_0x25f9ab(0x230)](_0xf2d067)||this[_0x25f9ab(0x22a)][_0x25f9ab(0x204)](_0xf2d067)||this[_0x25f9ab(0x22a)][_0x25f9ab(0x1d1)](_0xf2d067);_0x2388f2&&_0x2388f2['nonce']&&this[_0x25f9ab(0x205)](_0x2388f2[_0x25f9ab(0x22b)],_0xe8caa0,_0x42f79f?_0x1ff24d:Object[_0x25f9ab(0x211)]({},_0x2388f2,_0x1ff24d));}[_0xbd9463(0x21a)](_0x125a57,_0x2a7515,_0x4b49ff){const _0x22d69f=_0xbd9463,_0x4d4ed1=this['msgMap']['getMsgById'](_0x125a57);if(!_0x4d4ed1||!_0x4d4ed1[_0x22d69f(0x22b)])return;_0x4d4ed1['embed']=_0x4b49ff,this[_0x22d69f(0x1cd)](_0x4d4ed1[_0x22d69f(0x22b)],_0x2a7515,_0x4d4ed1);}[_0xbd9463(0x228)](){return new Promise((_0x5a130c,_0x5b26c5)=>{const _0x470439=_0x928e;this[_0x470439(0x1cb)](_0x470439(0x1df),_0x2208fb=>_0x2208fb instanceof Error?_0x5b26c5(_0x2208fb):_0x5a130c(_0x2208fb));});}[_0xbd9463(0x22e)]({nonce:_0x394477,parentId:_0x32597c,cb:_0x3fb4bd}){const _0x30cd20=_0xbd9463;this[_0x30cd20(0x22a)]['set'](_0x394477,{'id':'','nonce':_0x394477});const _0x17d690=_0x32597c&&this[_0x30cd20(0x22a)][_0x30cd20(0x204)](_0x32597c);return new Promise((_0x3ddfd3,_0x4d5970)=>{const _0x27a6e3=_0x30cd20;_0x17d690&&_0x17d690[_0x27a6e3(0x22b)]&&this[_0x27a6e3(0x1cb)](_0x17d690[_0x27a6e3(0x22b)],(_0x5611a9,_0x4fcb19)=>{const _0x40ccdc=_0x27a6e3;_0x3fb4bd?.(_0x5611a9,_0x4fcb19),this[_0x40ccdc(0x21b)](_0x17d690[_0x40ccdc(0x22b)]);}),this['on'](_0x394477,(_0x31a4a6,_0x138249)=>{const _0x49f469=_0x27a6e3;_0x3fb4bd?.(_0x31a4a6,_0x138249);if(_0x31a4a6===_0x49f469(0x1f2)&&_0x138249['id']){const _0x1b3bbd=this[_0x49f469(0x22a)][_0x49f469(0x1d1)](_0x138249['id']);_0x1b3bbd&&this[_0x49f469(0x21b)](_0x394477)&&_0x3ddfd3(_0x1b3bbd);return;}if(_0x31a4a6===_0x49f469(0x1f7)||_0x31a4a6==='INTERACTION_MODAL_CREATE'){this[_0x49f469(0x21b)](_0x394477);return;}this[_0x49f469(0x22a)][_0x49f469(0x200)](_0x394477,_0x138249),_0x138249[_0x49f469(0x1c9)]&&(this[_0x49f469(0x21b)](_0x394477),_0x4d5970(_0x138249[_0x49f469(0x1c9)]));});});}}exports[_0xbd9463(0x1ff)]=MidjourneyWs;