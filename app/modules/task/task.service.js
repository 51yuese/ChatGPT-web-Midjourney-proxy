'use strict';const _0x2afa54=_0x3baa;(function(_0x4ac49e,_0xfa2aab){const _0x2da6d7=_0x3baa,_0x23558f=_0x4ac49e();while(!![]){try{const _0x4cabcc=-parseInt(_0x2da6d7(0x192))/0x1+-parseInt(_0x2da6d7(0x1bf))/0x2*(parseInt(_0x2da6d7(0x1a3))/0x3)+parseInt(_0x2da6d7(0x191))/0x4*(parseInt(_0x2da6d7(0x1ca))/0x5)+parseInt(_0x2da6d7(0x19d))/0x6*(-parseInt(_0x2da6d7(0x19f))/0x7)+parseInt(_0x2da6d7(0x1be))/0x8*(-parseInt(_0x2da6d7(0x1c6))/0x9)+parseInt(_0x2da6d7(0x1a1))/0xa+-parseInt(_0x2da6d7(0x1ab))/0xb*(-parseInt(_0x2da6d7(0x1b3))/0xc);if(_0x4cabcc===_0xfa2aab)break;else _0x23558f['push'](_0x23558f['shift']());}catch(_0x2fa711){_0x23558f['push'](_0x23558f['shift']());}}}(_0x3789,0xb6a50));function _0x3789(){const _0x418ca6=['length','chatLogService','CronConstant','会员已到期、清空所有余额并移除会员身份！','userBalanceEntity','prototype','1923268KvxRwa','17183yQRUDD','__esModule','__decorate','object','../userBalance/userBalance.entity','handleCron','../../common/constants/cron.constant','metadata','__param','getOwnPropertyDescriptor','syncMjpTask','9318aRvgem','renewMiniAccessToken','6559lqELyy','TaskService','696380cDmStQ','@nestjs/schedule','3amoGyz','syncMjImg','__metadata','pushAuthLogs','goMaxAiAuth','midjourneyService','authService','debug','6438311SBfGhh','design:type','Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','syncMjpAccountAutomatic','EVERY_DAY_AT_MIDNIGHT','CronExpression','then','decorate','48WbYLvR','forEach','@nestjs/common','refreshBaiduAccesstoken','error','./../globalConfig/globalConfig.service','typeorm','WeMiniAKUpdateJob：','Logger','design:paramtypes','ModelsService','86920kaYWdQ','212446YlCmOb','checkAuth','Injectable','globalConfigService','../models/models.service','find','design:returntype','468wIXomm','@nestjs/typeorm','EVERY_HOUR','Cron','5tMpvJW','defineProperty','refreshBaiduAccessToken','modelsService','ChatLogService','LessThanOrEqual','WeMiniAKUpdateJob','MidjourneyService','Repository','checkUserMemerExpire','syncMusic','function'];_0x3789=function(){return _0x418ca6;};return _0x3789();}var __decorate=this&&this[_0x2afa54(0x194)]||function(_0x2f0bc1,_0x7b3891,_0x1c27b8,_0x1e6398){const _0x48aef0=_0x2afa54;var _0x4b0adf=arguments[_0x48aef0(0x18b)],_0x4c83c3=_0x4b0adf<0x3?_0x7b3891:_0x1e6398===null?_0x1e6398=Object[_0x48aef0(0x19b)](_0x7b3891,_0x1c27b8):_0x1e6398,_0x3dd8f2;if(typeof Reflect===_0x48aef0(0x195)&&typeof Reflect[_0x48aef0(0x1b2)]===_0x48aef0(0x1d5))_0x4c83c3=Reflect[_0x48aef0(0x1b2)](_0x2f0bc1,_0x7b3891,_0x1c27b8,_0x1e6398);else{for(var _0x7f753e=_0x2f0bc1['length']-0x1;_0x7f753e>=0x0;_0x7f753e--)if(_0x3dd8f2=_0x2f0bc1[_0x7f753e])_0x4c83c3=(_0x4b0adf<0x3?_0x3dd8f2(_0x4c83c3):_0x4b0adf>0x3?_0x3dd8f2(_0x7b3891,_0x1c27b8,_0x4c83c3):_0x3dd8f2(_0x7b3891,_0x1c27b8))||_0x4c83c3;}return _0x4b0adf>0x3&&_0x4c83c3&&Object[_0x48aef0(0x1cb)](_0x7b3891,_0x1c27b8,_0x4c83c3),_0x4c83c3;},__metadata=this&&this[_0x2afa54(0x1a5)]||function(_0x495ba2,_0xc7f170){const _0x4f5750=_0x2afa54;if(typeof Reflect===_0x4f5750(0x195)&&typeof Reflect[_0x4f5750(0x199)]===_0x4f5750(0x1d5))return Reflect[_0x4f5750(0x199)](_0x495ba2,_0xc7f170);},__param=this&&this[_0x2afa54(0x19a)]||function(_0x531280,_0x460c6b){return function(_0x3b9d84,_0x52ea0c){_0x460c6b(_0x3b9d84,_0x52ea0c,_0x531280);};};Object[_0x2afa54(0x1cb)](exports,_0x2afa54(0x193),{'value':!![]}),exports[_0x2afa54(0x1a0)]=void 0x0;const globalConfig_service_1=require(_0x2afa54(0x1b8)),common_1=require(_0x2afa54(0x1b5)),schedule_1=require(_0x2afa54(0x1a2)),userBalance_entity_1=require(_0x2afa54(0x196)),typeorm_1=require(_0x2afa54(0x1c7)),typeorm_2=require(_0x2afa54(0x1b9)),models_service_1=require(_0x2afa54(0x1c3)),cron_constant_1=require(_0x2afa54(0x198)),auth_service_1=require('../auth/auth.service'),midjourney_service_1=require('../midjourney/midjourney.service'),chatLog_service_1=require('../chatLog/chatLog.service');function _0x3baa(_0x23b6f1,_0x4f7249){const _0x3789bc=_0x3789();return _0x3baa=function(_0x3baab3,_0x3fb507){_0x3baab3=_0x3baab3-0x18b;let _0x4db014=_0x3789bc[_0x3baab3];return _0x4db014;},_0x3baa(_0x23b6f1,_0x4f7249);}let TaskService=class TaskService{constructor(_0x5d39c6,_0x7f3855,_0x27ec4b,_0x373522,_0x58a380,_0x2f89bb){const _0x14a489=_0x2afa54;this['userBalanceEntity']=_0x5d39c6,this['globalConfigService']=_0x7f3855,this[_0x14a489(0x1a8)]=_0x27ec4b,this[_0x14a489(0x18c)]=_0x373522,this[_0x14a489(0x1cd)]=_0x58a380,this['authService']=_0x2f89bb;}['onModuleInit'](){const _0xfbea04=_0x2afa54;this['authService'][_0xfbea04(0x19e)](),this[_0xfbea04(0x1a8)]['syncMjpAccountAutomatic'](),this[_0xfbea04(0x1a8)]['syncMjpTask'](),this[_0xfbea04(0x1a8)][_0xfbea04(0x1a4)](),this[_0xfbea04(0x18c)]['syncMusic']();}[_0x2afa54(0x197)](){const _0x3e6930=_0x2afa54;common_1[_0x3e6930(0x1bb)][_0x3e6930(0x1aa)](_0x3e6930(0x1ad),_0x3e6930(0x1a0)),this[_0x3e6930(0x1c2)]['getWechatAccessToken']();}async['WeMiniAKUpdateJob'](){const _0x3c0842=_0x2afa54;try{await this[_0x3c0842(0x1a9)][_0x3c0842(0x19e)]();}catch(_0x256b9d){common_1['Logger'][_0x3c0842(0x1b7)](_0x3c0842(0x1ba),_0x256b9d);}}async[_0x2afa54(0x1c0)](){const _0x571d53=_0x2afa54;await this[_0x571d53(0x1c2)][_0x571d53(0x1a7)]();}async[_0x2afa54(0x1a6)](){const _0xf6cd67=_0x2afa54;await this[_0xf6cd67(0x1c2)]['pushLog']();}async[_0x2afa54(0x1d3)](){const _0x2f82b9=_0x2afa54,_0x40f064=await this[_0x2f82b9(0x18f)][_0x2f82b9(0x1c4)]({'where':{'expirationTime':(0x0,typeorm_2[_0x2f82b9(0x1cf)])(new Date())}});if(!_0x40f064||!_0x40f064[_0x2f82b9(0x18b)])return;_0x40f064[_0x2f82b9(0x1b4)](_0x350252=>{const _0x368699=_0x2f82b9;this[_0x368699(0x18f)]['update']({'id':_0x350252['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})[_0x368699(0x1b1)](_0x1a22a0=>{const _0x40dca0=_0x368699;common_1[_0x40dca0(0x1bb)]['debug'](_0x350252['id']+_0x40dca0(0x18e),'TaskService');});});}['refreshBaiduAccessToken'](){const _0x2bba25=_0x2afa54;this['modelsService'][_0x2bba25(0x1b6)]();}async[_0x2afa54(0x1ae)](){const _0x484eb9=_0x2afa54;this[_0x484eb9(0x1a8)][_0x484eb9(0x1ae)]();}async['syncMjpTask'](){const _0x1f9ce0=_0x2afa54;this[_0x1f9ce0(0x1a8)][_0x1f9ce0(0x19c)]();}async[_0x2afa54(0x1a4)](){const _0x498377=_0x2afa54;this['midjourneyService'][_0x498377(0x1a4)]();}async[_0x2afa54(0x1d4)](){this['chatLogService']['syncMusic']();}};__decorate([(0x0,schedule_1[_0x2afa54(0x1c9)])(schedule_1[_0x2afa54(0x1b0)][_0x2afa54(0x1c8)]),__metadata(_0x2afa54(0x1ac),Function),__metadata(_0x2afa54(0x1bc),[]),__metadata('design:returntype',void 0x0)],TaskService['prototype'],_0x2afa54(0x197),null),__decorate([(0x0,schedule_1['Cron'])(schedule_1[_0x2afa54(0x1b0)]['EVERY_5_MINUTES']),__metadata(_0x2afa54(0x1ac),Function),__metadata('design:paramtypes',[]),__metadata(_0x2afa54(0x1c5),Promise)],TaskService[_0x2afa54(0x190)],_0x2afa54(0x1d0),null),__decorate([(0x0,schedule_1[_0x2afa54(0x1c9)])(cron_constant_1[_0x2afa54(0x18d)]['EVERY_25_MINUTES']),__metadata(_0x2afa54(0x1ac),Function),__metadata(_0x2afa54(0x1bc),[]),__metadata('design:returntype',Promise)],TaskService[_0x2afa54(0x190)],_0x2afa54(0x1c0),null),__decorate([(0x0,schedule_1[_0x2afa54(0x1c9)])(schedule_1[_0x2afa54(0x1b0)]['EVERY_2_HOURS']),__metadata(_0x2afa54(0x1ac),Function),__metadata(_0x2afa54(0x1bc),[]),__metadata(_0x2afa54(0x1c5),Promise)],TaskService[_0x2afa54(0x190)],_0x2afa54(0x1a6),null),__decorate([(0x0,schedule_1[_0x2afa54(0x1c9)])(schedule_1['CronExpression']['EVERY_10_MINUTES']),__metadata(_0x2afa54(0x1ac),Function),__metadata('design:paramtypes',[]),__metadata(_0x2afa54(0x1c5),Promise)],TaskService['prototype'],_0x2afa54(0x1d3),null),__decorate([(0x0,schedule_1['Cron'])(schedule_1[_0x2afa54(0x1b0)][_0x2afa54(0x1c8)]),__metadata(_0x2afa54(0x1ac),Function),__metadata(_0x2afa54(0x1bc),[]),__metadata(_0x2afa54(0x1c5),void 0x0)],TaskService[_0x2afa54(0x190)],_0x2afa54(0x1cc),null),__decorate([(0x0,schedule_1[_0x2afa54(0x1c9)])(schedule_1[_0x2afa54(0x1b0)][_0x2afa54(0x1af)]),__metadata(_0x2afa54(0x1ac),Function),__metadata(_0x2afa54(0x1bc),[]),__metadata(_0x2afa54(0x1c5),Promise)],TaskService[_0x2afa54(0x190)],_0x2afa54(0x1ae),null),__decorate([(0x0,schedule_1[_0x2afa54(0x1c9)])(schedule_1[_0x2afa54(0x1b0)][_0x2afa54(0x1c8)]),__metadata(_0x2afa54(0x1ac),Function),__metadata(_0x2afa54(0x1bc),[]),__metadata(_0x2afa54(0x1c5),Promise)],TaskService['prototype'],'syncMjpTask',null),__decorate([(0x0,schedule_1[_0x2afa54(0x1c9)])(schedule_1[_0x2afa54(0x1b0)][_0x2afa54(0x1c8)]),__metadata(_0x2afa54(0x1ac),Function),__metadata(_0x2afa54(0x1bc),[]),__metadata('design:returntype',Promise)],TaskService[_0x2afa54(0x190)],_0x2afa54(0x1a4),null),__decorate([(0x0,schedule_1['Cron'])(schedule_1[_0x2afa54(0x1b0)]['EVERY_HOUR']),__metadata(_0x2afa54(0x1ac),Function),__metadata(_0x2afa54(0x1bc),[]),__metadata('design:returntype',Promise)],TaskService[_0x2afa54(0x190)],'syncMusic',null),TaskService=__decorate([(0x0,common_1[_0x2afa54(0x1c1)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(userBalance_entity_1['UserBalanceEntity'])),__metadata('design:paramtypes',[typeorm_2[_0x2afa54(0x1d2)],globalConfig_service_1['GlobalConfigService'],midjourney_service_1[_0x2afa54(0x1d1)],chatLog_service_1[_0x2afa54(0x1ce)],models_service_1[_0x2afa54(0x1bd)],auth_service_1['AuthService']])],TaskService),exports[_0x2afa54(0x1a0)]=TaskService;