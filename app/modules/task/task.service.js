'use strict';const _0x313f3b=_0x1627;(function(_0x58bc9d,_0x395474){const _0x1884c8=_0x1627,_0x5c1afc=_0x58bc9d();while(!![]){try{const _0x2df046=-parseInt(_0x1884c8(0x105))/0x1*(-parseInt(_0x1884c8(0x100))/0x2)+parseInt(_0x1884c8(0xfb))/0x3*(-parseInt(_0x1884c8(0xf3))/0x4)+parseInt(_0x1884c8(0xea))/0x5*(parseInt(_0x1884c8(0x10b))/0x6)+-parseInt(_0x1884c8(0x117))/0x7+-parseInt(_0x1884c8(0x11a))/0x8*(parseInt(_0x1884c8(0x110))/0x9)+parseInt(_0x1884c8(0xd2))/0xa+parseInt(_0x1884c8(0xe3))/0xb;if(_0x2df046===_0x395474)break;else _0x5c1afc['push'](_0x5c1afc['shift']());}catch(_0x24d12a){_0x5c1afc['push'](_0x5c1afc['shift']());}}}(_0xf78d,0xe7f8f));function _0xf78d(){const _0x549052=['4235891pMNrqE','../midjourney/midjourney.service','Repository','authService','debug','../../common/constants/cron.constant','EVERY_10_MINUTES','8045aYLOAn','pushLog','Logger','refreshBaiduAccessToken','ChatLogService','length','checkAuth','Cron','checkUserMemerExpire','357688dChDfQ','refreshBaiduAccesstoken','__metadata','WeMiniAKUpdateJob：','defineProperty','object','globalConfigService','CronExpression','24AFGpUJ','renewMiniAccessToken','prototype','forEach','syncMjpAccountAutomatic','11512MEHuNn','syncMjImg','function','metadata','CronConstant','14cXNnSS','@nestjs/schedule','handleCron','getOwnPropertyDescriptor','InjectRepository','./../globalConfig/globalConfig.service','6198EaLKRU','../models/models.service','会员已到期、清空所有余额并移除会员身份！','Automatically\x20refresh\x20WeChat\x20access\x20every\x20hour\x20Token','EVERY_5_MINUTES','4234239TPGFLP','design:type','LessThanOrEqual','decorate','EVERY_HOUR','@nestjs/common','midjourneyService','617211JxDsQE','UserBalanceEntity','goMaxAiAuth','8tWzxur','design:returntype','@nestjs/typeorm','syncMusic','userBalanceEntity','964170ZhcMko','syncMjpTask','onModuleInit','EVERY_DAY_AT_MIDNIGHT','EVERY_2_HOURS','TaskService','chatLogService','AuthService','EVERY_25_MINUTES','design:paramtypes','modelsService','../auth/auth.service','WeMiniAKUpdateJob','pushAuthLogs','../chatLog/chatLog.service','../userBalance/userBalance.entity','__decorate'];_0xf78d=function(){return _0x549052;};return _0xf78d();}var __decorate=this&&this[_0x313f3b(0xe2)]||function(_0x57a515,_0x43ab79,_0x4942ea,_0x243d1f){const _0x34a94b=_0x313f3b;var _0x3e7bee=arguments[_0x34a94b(0xef)],_0x2f5da6=_0x3e7bee<0x3?_0x43ab79:_0x243d1f===null?_0x243d1f=Object[_0x34a94b(0x108)](_0x43ab79,_0x4942ea):_0x243d1f,_0x59a953;if(typeof Reflect===_0x34a94b(0xf8)&&typeof Reflect[_0x34a94b(0x113)]===_0x34a94b(0x102))_0x2f5da6=Reflect['decorate'](_0x57a515,_0x43ab79,_0x4942ea,_0x243d1f);else{for(var _0xf53915=_0x57a515[_0x34a94b(0xef)]-0x1;_0xf53915>=0x0;_0xf53915--)if(_0x59a953=_0x57a515[_0xf53915])_0x2f5da6=(_0x3e7bee<0x3?_0x59a953(_0x2f5da6):_0x3e7bee>0x3?_0x59a953(_0x43ab79,_0x4942ea,_0x2f5da6):_0x59a953(_0x43ab79,_0x4942ea))||_0x2f5da6;}return _0x3e7bee>0x3&&_0x2f5da6&&Object[_0x34a94b(0xf7)](_0x43ab79,_0x4942ea,_0x2f5da6),_0x2f5da6;},__metadata=this&&this[_0x313f3b(0xf5)]||function(_0x22b93b,_0x4a03a5){const _0x9a447d=_0x313f3b;if(typeof Reflect===_0x9a447d(0xf8)&&typeof Reflect[_0x9a447d(0x103)]===_0x9a447d(0x102))return Reflect[_0x9a447d(0x103)](_0x22b93b,_0x4a03a5);},__param=this&&this['__param']||function(_0x312e85,_0x29e0f0){return function(_0x4c8acd,_0x53bdb9){_0x29e0f0(_0x4c8acd,_0x53bdb9,_0x312e85);};};Object[_0x313f3b(0xf7)](exports,'__esModule',{'value':!![]}),exports[_0x313f3b(0xd7)]=void 0x0;const globalConfig_service_1=require(_0x313f3b(0x10a)),common_1=require(_0x313f3b(0x115)),schedule_1=require(_0x313f3b(0x106)),userBalance_entity_1=require(_0x313f3b(0xe1)),typeorm_1=require(_0x313f3b(0x11c)),typeorm_2=require('typeorm'),models_service_1=require(_0x313f3b(0x10c)),cron_constant_1=require(_0x313f3b(0xe8)),auth_service_1=require(_0x313f3b(0xdd)),midjourney_service_1=require(_0x313f3b(0xe4)),chatLog_service_1=require(_0x313f3b(0xe0));let TaskService=class TaskService{constructor(_0x1a6799,_0x165a9d,_0x4a4ba1,_0x484e97,_0x533744,_0x18d6d1){const _0x4a3bfe=_0x313f3b;this[_0x4a3bfe(0x11e)]=_0x1a6799,this[_0x4a3bfe(0xf9)]=_0x165a9d,this[_0x4a3bfe(0x116)]=_0x4a4ba1,this[_0x4a3bfe(0xd8)]=_0x484e97,this['modelsService']=_0x533744,this[_0x4a3bfe(0xe6)]=_0x18d6d1;}[_0x313f3b(0xd4)](){const _0x25ba70=_0x313f3b;this[_0x25ba70(0xe6)][_0x25ba70(0xfc)](),this[_0x25ba70(0x116)]['syncMjpAccountAutomatic'](),this[_0x25ba70(0x116)][_0x25ba70(0xd3)](),this['midjourneyService'][_0x25ba70(0x101)](),this[_0x25ba70(0xd8)][_0x25ba70(0x11d)]();}[_0x313f3b(0x107)](){const _0x2d9add=_0x313f3b;common_1[_0x2d9add(0xec)][_0x2d9add(0xe7)](_0x2d9add(0x10e),_0x2d9add(0xd7)),this[_0x2d9add(0xf9)]['getWechatAccessToken']();}async[_0x313f3b(0xde)](){const _0x4b6099=_0x313f3b;try{await this['authService'][_0x4b6099(0xfc)]();}catch(_0x6db839){common_1[_0x4b6099(0xec)]['error'](_0x4b6099(0xf6),_0x6db839);}}async[_0x313f3b(0xf0)](){const _0x156130=_0x313f3b;await this[_0x156130(0xf9)][_0x156130(0x119)]();}async[_0x313f3b(0xdf)](){const _0x34709c=_0x313f3b;await this[_0x34709c(0xf9)][_0x34709c(0xeb)]();}async[_0x313f3b(0xf2)](){const _0x5c0ae5=_0x313f3b,_0x4204a7=await this['userBalanceEntity']['find']({'where':{'expirationTime':(0x0,typeorm_2[_0x5c0ae5(0x112)])(new Date())}});if(!_0x4204a7||!_0x4204a7[_0x5c0ae5(0xef)])return;_0x4204a7[_0x5c0ae5(0xfe)](_0x1f24a0=>{const _0x12a1dc=_0x5c0ae5;this[_0x12a1dc(0x11e)]['update']({'id':_0x1f24a0['id']},{'expirationTime':null,'packageId':0x0,'memberModel3Count':0x0,'memberModel4Count':0x0,'memberDrawMjCount':0x0})['then'](_0x377439=>{const _0x3e8be4=_0x12a1dc;common_1[_0x3e8be4(0xec)]['debug'](_0x1f24a0['id']+_0x3e8be4(0x10d),'TaskService');});});}[_0x313f3b(0xed)](){const _0x3cbad8=_0x313f3b;this[_0x3cbad8(0xdc)][_0x3cbad8(0xf4)]();}async[_0x313f3b(0xff)](){const _0x533a12=_0x313f3b;this[_0x533a12(0x116)][_0x533a12(0xff)]();}async[_0x313f3b(0xd3)](){this['midjourneyService']['syncMjpTask']();}async[_0x313f3b(0x101)](){const _0x5bf9fe=_0x313f3b;this[_0x5bf9fe(0x116)][_0x5bf9fe(0x101)]();}async[_0x313f3b(0x11d)](){const _0x155e04=_0x313f3b;this['chatLogService'][_0x155e04(0x11d)]();}};function _0x1627(_0x47a62a,_0x16ae4d){const _0xf78da1=_0xf78d();return _0x1627=function(_0x1627aa,_0xe4d283){_0x1627aa=_0x1627aa-0xd2;let _0x566bec=_0xf78da1[_0x1627aa];return _0x566bec;},_0x1627(_0x47a62a,_0x16ae4d);}__decorate([(0x0,schedule_1[_0x313f3b(0xf1)])(schedule_1['CronExpression'][_0x313f3b(0x114)]),__metadata('design:type',Function),__metadata(_0x313f3b(0xdb),[]),__metadata(_0x313f3b(0x11b),void 0x0)],TaskService['prototype'],_0x313f3b(0x107),null),__decorate([(0x0,schedule_1[_0x313f3b(0xf1)])(schedule_1['CronExpression'][_0x313f3b(0x10f)]),__metadata(_0x313f3b(0x111),Function),__metadata(_0x313f3b(0xdb),[]),__metadata('design:returntype',Promise)],TaskService[_0x313f3b(0xfd)],_0x313f3b(0xde),null),__decorate([(0x0,schedule_1[_0x313f3b(0xf1)])(cron_constant_1[_0x313f3b(0x104)][_0x313f3b(0xda)]),__metadata('design:type',Function),__metadata('design:paramtypes',[]),__metadata(_0x313f3b(0x11b),Promise)],TaskService['prototype'],_0x313f3b(0xf0),null),__decorate([(0x0,schedule_1[_0x313f3b(0xf1)])(schedule_1[_0x313f3b(0xfa)][_0x313f3b(0xd6)]),__metadata(_0x313f3b(0x111),Function),__metadata(_0x313f3b(0xdb),[]),__metadata(_0x313f3b(0x11b),Promise)],TaskService[_0x313f3b(0xfd)],_0x313f3b(0xdf),null),__decorate([(0x0,schedule_1[_0x313f3b(0xf1)])(schedule_1[_0x313f3b(0xfa)][_0x313f3b(0xe9)]),__metadata('design:type',Function),__metadata(_0x313f3b(0xdb),[]),__metadata(_0x313f3b(0x11b),Promise)],TaskService[_0x313f3b(0xfd)],_0x313f3b(0xf2),null),__decorate([(0x0,schedule_1['Cron'])(schedule_1[_0x313f3b(0xfa)][_0x313f3b(0x114)]),__metadata(_0x313f3b(0x111),Function),__metadata('design:paramtypes',[]),__metadata(_0x313f3b(0x11b),void 0x0)],TaskService[_0x313f3b(0xfd)],_0x313f3b(0xed),null),__decorate([(0x0,schedule_1[_0x313f3b(0xf1)])(schedule_1['CronExpression'][_0x313f3b(0xd5)]),__metadata('design:type',Function),__metadata(_0x313f3b(0xdb),[]),__metadata(_0x313f3b(0x11b),Promise)],TaskService[_0x313f3b(0xfd)],_0x313f3b(0xff),null),__decorate([(0x0,schedule_1[_0x313f3b(0xf1)])(schedule_1[_0x313f3b(0xfa)][_0x313f3b(0x114)]),__metadata(_0x313f3b(0x111),Function),__metadata(_0x313f3b(0xdb),[]),__metadata(_0x313f3b(0x11b),Promise)],TaskService[_0x313f3b(0xfd)],'syncMjpTask',null),__decorate([(0x0,schedule_1[_0x313f3b(0xf1)])(schedule_1['CronExpression'][_0x313f3b(0x114)]),__metadata(_0x313f3b(0x111),Function),__metadata(_0x313f3b(0xdb),[]),__metadata(_0x313f3b(0x11b),Promise)],TaskService[_0x313f3b(0xfd)],'syncMjImg',null),__decorate([(0x0,schedule_1[_0x313f3b(0xf1)])(schedule_1['CronExpression'][_0x313f3b(0x114)]),__metadata('design:type',Function),__metadata('design:paramtypes',[]),__metadata('design:returntype',Promise)],TaskService[_0x313f3b(0xfd)],_0x313f3b(0x11d),null),TaskService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x313f3b(0x109)])(userBalance_entity_1[_0x313f3b(0x118)])),__metadata('design:paramtypes',[typeorm_2[_0x313f3b(0xe5)],globalConfig_service_1['GlobalConfigService'],midjourney_service_1['MidjourneyService'],chatLog_service_1[_0x313f3b(0xee)],models_service_1['ModelsService'],auth_service_1[_0x313f3b(0xd9)]])],TaskService),exports[_0x313f3b(0xd7)]=TaskService;