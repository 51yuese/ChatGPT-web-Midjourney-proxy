'use strict';const _0xee96d4=_0x144d;function _0x144d(_0x2d00b4,_0xd1b363){const _0x11a481=_0x11a4();return _0x144d=function(_0x144db9,_0x50a111){_0x144db9=_0x144db9-0x7f;let _0x4a3568=_0x11a481[_0x144db9];return _0x4a3568;},_0x144d(_0x2d00b4,_0xd1b363);}function _0x11a4(){const _0x7a7d4d=['6456710ftXPfC','typeOriginCn','default','@nestjs/common','word','decorate','checkBadWordsByConfig','837214WHqWRi','badWordsEntity','389717CtStZs','userId','findAndCount','1968lGZQJU','添加敏感词成功','BAD_REQUEST','3820092MlbOyT','百度文本检测出现错误、请查看配置信息:\x20','__metadata','@nestjs/typeorm','forEach','3423258uQFRGk','category','save','username','findOne','where','word_list','98862PaTVRT','length','axios','update','更新敏感词失败','log','baidu','avatar','keyword','violation','getOwnPropertyDescriptor','Like','删除敏感词成功','hideString','敏感词已经存在了、请勿重复添加','onModuleInit','error:\x20','4815eeSctw','find','您提交的内容中包含','loadBadWords','recordUserBadWords','Injectable','checkBadWords','includes','affected','ASC','violationLogEntity','metadata','GlobalConfigService','百度云检测','的信息、我们已对您账号进行标记、请合规使用！','application/json','set','8zWOgta','baiduCheckBadWords','join','violationCount\x20+\x201','UserEntity','DESC','userInfo','data','code','ViolationLogEntity','Repository','delete','baiduTextAccessToken','email','user','function','敏感词已存在,请检查您的提交信息','execute','userEntity','删除敏感词失败','map','status','post','defineProperty','createQueryBuilder','./badwords.entity','customSensitiveWords','HttpException','InjectRepository','stringify','badWords','自定义','globalConfigService','的内容、我们已对您的账户进行标记、请合规使用！','match','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','./../globalConfig/globalConfig.service','NineAi检测','getSensitiveConfig','nineaiCheckBadWords','HttpStatus','../user/user.entity','delBadWords','您提交的信息中包含','typeorm','push','检测失败','addBadWord','***','42uobzdU','../../common/utils','object','id\x20=\x20:userId','BadwordsService','msg','./violationLog.entity'];_0x11a4=function(){return _0x7a7d4d;};return _0x11a4();}(function(_0x2d6279,_0x2e2640){const _0x383a12=_0x144d,_0x2ca51a=_0x2d6279();while(!![]){try{const _0x5f0c3a=parseInt(_0x383a12(0x87))/0x1+parseInt(_0x383a12(0xec))/0x2*(parseInt(_0x383a12(0x99))/0x3)+-parseInt(_0x383a12(0x8d))/0x4+parseInt(_0x383a12(0xaa))/0x5*(parseInt(_0x383a12(0x8a))/0x6)+-parseInt(_0x383a12(0x85))/0x7+-parseInt(_0x383a12(0xbb))/0x8*(parseInt(_0x383a12(0x92))/0x9)+parseInt(_0x383a12(0xf3))/0xa;if(_0x5f0c3a===_0x2e2640)break;else _0x2ca51a['push'](_0x2ca51a['shift']());}catch(_0x4cd349){_0x2ca51a['push'](_0x2ca51a['shift']());}}}(_0x11a4,0x8fa0b));var __decorate=this&&this['__decorate']||function(_0x36f7c0,_0x46620c,_0x3e850c,_0x9e2f10){const _0x5315e3=_0x144d;var _0x3f2c54=arguments['length'],_0x4f317b=_0x3f2c54<0x3?_0x46620c:_0x9e2f10===null?_0x9e2f10=Object[_0x5315e3(0xa3)](_0x46620c,_0x3e850c):_0x9e2f10,_0x4f5326;if(typeof Reflect===_0x5315e3(0xee)&&typeof Reflect[_0x5315e3(0x83)]===_0x5315e3(0xca))_0x4f317b=Reflect[_0x5315e3(0x83)](_0x36f7c0,_0x46620c,_0x3e850c,_0x9e2f10);else{for(var _0xab2d2d=_0x36f7c0['length']-0x1;_0xab2d2d>=0x0;_0xab2d2d--)if(_0x4f5326=_0x36f7c0[_0xab2d2d])_0x4f317b=(_0x3f2c54<0x3?_0x4f5326(_0x4f317b):_0x3f2c54>0x3?_0x4f5326(_0x46620c,_0x3e850c,_0x4f317b):_0x4f5326(_0x46620c,_0x3e850c))||_0x4f317b;}return _0x3f2c54>0x3&&_0x4f317b&&Object[_0x5315e3(0xd2)](_0x46620c,_0x3e850c,_0x4f317b),_0x4f317b;},__metadata=this&&this[_0xee96d4(0x8f)]||function(_0x189279,_0x28659e){const _0x432783=_0xee96d4;if(typeof Reflect===_0x432783(0xee)&&typeof Reflect['metadata']===_0x432783(0xca))return Reflect[_0x432783(0xb5)](_0x189279,_0x28659e);},__param=this&&this['__param']||function(_0x5a21fd,_0xbd1223){return function(_0x516854,_0xf00e){_0xbd1223(_0x516854,_0xf00e,_0x5a21fd);};};Object[_0xee96d4(0xd2)](exports,'__esModule',{'value':!![]}),exports[_0xee96d4(0xf0)]=void 0x0;const globalConfig_service_1=require(_0xee96d4(0xdf)),common_1=require(_0xee96d4(0x81)),badwords_entity_1=require(_0xee96d4(0xd4)),typeorm_1=require(_0xee96d4(0xe7)),typeorm_2=require(_0xee96d4(0x90)),axios_1=require(_0xee96d4(0x9b)),violationLog_entity_1=require(_0xee96d4(0xf2)),user_entity_1=require(_0xee96d4(0xe4)),utils_1=require(_0xee96d4(0xed));let BadwordsService=class BadwordsService{constructor(_0x48d197,_0x14fcaf,_0x14f32f,_0x364709){const _0x29e20a=_0xee96d4;this[_0x29e20a(0x86)]=_0x48d197,this[_0x29e20a(0xb4)]=_0x14fcaf,this[_0x29e20a(0xcd)]=_0x14f32f,this[_0x29e20a(0xdb)]=_0x364709,this[_0x29e20a(0xd9)]=[];}async[_0xee96d4(0xa8)](){this['loadBadWords']();}async[_0xee96d4(0xd5)](_0x1d2961,_0x59baa5){const _0x3fcb99=_0xee96d4,_0x5f42f8=[];for(let _0x30ac67=0x0;_0x30ac67<this['badWords']['length'];_0x30ac67++){const _0x59f94b=this[_0x3fcb99(0xd9)][_0x30ac67];_0x1d2961[_0x3fcb99(0xb1)](_0x59f94b)&&_0x5f42f8[_0x3fcb99(0xe8)](_0x59f94b);}if(_0x5f42f8[_0x3fcb99(0x9a)]){await this['recordUserBadWords'](_0x59baa5,_0x1d2961,_0x5f42f8,[_0x3fcb99(0xda)],'自定义检测');const _0x162386='您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1['HttpException'](_0x162386,common_1[_0x3fcb99(0xe3)][_0x3fcb99(0x8c)]);}return!![];}async[_0xee96d4(0xb0)](_0x242afa,_0x1636f1){const _0x1446b4=_0xee96d4,_0x3e9628=await this[_0x1446b4(0xdb)][_0x1446b4(0xe1)]();_0x3e9628&&await this[_0x1446b4(0x84)](_0x242afa,_0x3e9628,_0x1636f1),await this[_0x1446b4(0xd5)](_0x242afa,_0x1636f1);}async['checkBadWordsByConfig'](_0x5e3974,_0x18e8b6,_0x76ef44){const _0x3f67f4=_0xee96d4,{useType:_0x64ccd3}=_0x18e8b6;_0x64ccd3===_0x3f67f4(0x9f)&&await this[_0x3f67f4(0xbc)](_0x5e3974,_0x18e8b6[_0x3f67f4(0xc7)],_0x76ef44),_0x64ccd3==='nineai'&&await this[_0x3f67f4(0xe2)](_0x5e3974,_0x18e8b6,_0x76ef44);}['extractContent'](_0x5a8315){const _0x1cbb89=_0xee96d4,_0x1ee42a=/存在(.*?)不合规/,_0x5269ce=_0x5a8315[_0x1cbb89(0xdd)](_0x1ee42a);return _0x5269ce?_0x5269ce[0x1]:'';}async[_0xee96d4(0xbc)](_0x121057,_0x177fb9,_0x5b4c0c){const _0x43e965=_0xee96d4;if(!_0x177fb9)return;const _0x39dc1c=_0x43e965(0xde)+_0x177fb9+'}',_0xf7ff40={'Content-Type':'application/x-www-form-urlencoded','Accept':_0x43e965(0xb9)},_0x217e12=await axios_1[_0x43e965(0x80)][_0x43e965(0xd1)](_0x39dc1c,{'text':_0x121057},{'headers':_0xf7ff40}),{conclusion:_0x2a5d68,error_code:_0x2cfe70,error_msg:_0xc66a29,conclusionType:_0xff55f2,data:_0x2cc475}=_0x217e12[_0x43e965(0xc2)];_0x2cfe70&&console['log'](_0x43e965(0x8e),_0xc66a29);if(_0xff55f2!==0x1){const _0x295f20=[...new Set(_0x2cc475[_0x43e965(0xcf)](_0x200e82=>this['extractContent'](_0x200e82[_0x43e965(0xf1)])))];await this[_0x43e965(0xae)](_0x5b4c0c,_0x121057,[_0x43e965(0xeb)],_0x295f20,_0x43e965(0xb7));const _0x1a6b03=_0x43e965(0xe6)+_0x295f20[_0x43e965(0xbd)](',')+_0x43e965(0xdc);throw new common_1[(_0x43e965(0xd6))](_0x1a6b03,common_1['HttpStatus'][_0x43e965(0x8c)]);}}async[_0xee96d4(0xe2)](_0x4bf0b5,_0x3fd9f4,_0x43c018){const _0x2b98ee=_0xee96d4,{nineaiBuiltInSensitiveApiBase:_0x2cc969,nineaiBuiltInSensitiveAuthKey:_0x417f41}=_0x3fd9f4;if(!_0x2cc969||!_0x417f41)return;const _0xa14c97=await axios_1[_0x2b98ee(0x80)]['post'](_0x2cc969,{'content':_0x4bf0b5},{'headers':{'Content-Type':_0x2b98ee(0xb9),'Authorization':_0x417f41}});if(!_0xa14c97[_0x2b98ee(0xc2)])return;if(_0xa14c97['data'][_0x2b98ee(0xc3)]!=='0'){const {msg:msg=_0x2b98ee(0xe9)}=_0xa14c97[_0x2b98ee(0xc2)];throw new common_1[(_0x2b98ee(0xd6))]('敏感词检测\x20|\x20'+msg,common_1[_0x2b98ee(0xe3)][_0x2b98ee(0x8c)]);}if(_0xa14c97[_0x2b98ee(0xc2)][_0x2b98ee(0x98)]&&_0xa14c97[_0x2b98ee(0xc2)][_0x2b98ee(0x98)]?.[_0x2b98ee(0x9a)]){const _0x59de8a=[...new Set(_0xa14c97['data']['word_list'][_0x2b98ee(0xcf)](_0x62c4cb=>_0x62c4cb[_0x2b98ee(0xa1)]))],_0x3f200a=[...new Set(_0xa14c97[_0x2b98ee(0xc2)]['word_list']['map'](_0xf56dbf=>_0xf56dbf[_0x2b98ee(0x93)]))];await this[_0x2b98ee(0xae)](_0x43c018,_0x4bf0b5,_0x59de8a,_0x3f200a,_0x2b98ee(0xe0));const _0x39bb6c=this['formarTips'](_0xa14c97[_0x2b98ee(0xc2)][_0x2b98ee(0x98)]);throw new common_1[(_0x2b98ee(0xd6))](_0x39bb6c,common_1[_0x2b98ee(0xe3)][_0x2b98ee(0x8c)]);}}['formarTips'](_0x2f27be){const _0x442662=_0xee96d4,_0xd1a139=_0x2f27be[_0x442662(0xcf)](_0x2a757d=>_0x2a757d[_0x442662(0x93)]),_0xaafbdc=[...new Set(_0xd1a139)];return _0x442662(0xac)+_0xaafbdc[_0x442662(0xbd)](',')+_0x442662(0xb8);}async[_0xee96d4(0xad)](){const _0x62a149=_0xee96d4,_0x1e0b13=await this['badWordsEntity'][_0x62a149(0xab)]({'where':{'status':0x1},'select':[_0x62a149(0x82)]});this[_0x62a149(0xd9)]=_0x1e0b13['map'](_0x25fe09=>_0x25fe09[_0x62a149(0x82)]);}async['queryBadWords'](_0xaaadde){const _0x560035=_0xee96d4,{page:page=0x1,size:size=0x1f4,word:_0x54d43b,status:_0x24cdcc}=_0xaaadde,_0x2b1787={};[0x0,0x1,'0','1'][_0x560035(0xb1)](_0x24cdcc)&&(_0x2b1787[_0x560035(0xd0)]=_0x24cdcc),_0x54d43b&&(_0x2b1787[_0x560035(0x82)]=(0x0,typeorm_1[_0x560035(0xa4)])('%'+_0x54d43b+'%'));const [_0x8538f1,_0x1d21d3]=await this[_0x560035(0x86)][_0x560035(0x89)]({'where':_0x2b1787,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x560035(0xb3)}});return{'rows':_0x8538f1,'count':_0x1d21d3};}async[_0xee96d4(0xe5)](_0x5d635b){const _0x4b5ee=_0xee96d4,_0x15d710=await this['badWordsEntity'][_0x4b5ee(0x96)]({'where':{'id':_0x5d635b['id']}});if(!_0x15d710)throw new common_1[(_0x4b5ee(0xd6))]('敏感词不存在,请检查您的提交信息',common_1['HttpStatus'][_0x4b5ee(0x8c)]);const _0x38bd6a=await this[_0x4b5ee(0x86)][_0x4b5ee(0xc6)]({'id':_0x5d635b['id']});if(_0x38bd6a[_0x4b5ee(0xb2)]>0x0)return await this[_0x4b5ee(0xad)](),_0x4b5ee(0xa5);else throw new common_1[(_0x4b5ee(0xd6))](_0x4b5ee(0xce),common_1[_0x4b5ee(0xe3)]['BAD_REQUEST']);}async['updateBadWords'](_0x3d4380){const _0x798bf3=_0xee96d4,{id:_0x53b5d5,word:_0x55f2d5,status:_0x12e2cf}=_0x3d4380,_0x5d2db2=await this[_0x798bf3(0x86)][_0x798bf3(0x96)]({'where':{'word':_0x55f2d5}});if(_0x5d2db2)throw new common_1[(_0x798bf3(0xd6))](_0x798bf3(0xa7),common_1['HttpStatus'][_0x798bf3(0x8c)]);const _0x3c8405=await this[_0x798bf3(0x86)][_0x798bf3(0x9c)]({'id':_0x53b5d5},{'word':_0x55f2d5,'status':_0x12e2cf});if(_0x3c8405[_0x798bf3(0xb2)]>0x0)return await this[_0x798bf3(0xad)](),'更新敏感词成功';else throw new common_1[(_0x798bf3(0xd6))](_0x798bf3(0x9d),common_1[_0x798bf3(0xe3)][_0x798bf3(0x8c)]);}async[_0xee96d4(0xea)](_0x15feb8){const _0x3c6204=_0xee96d4,{word:_0x3ad604}=_0x15feb8,_0x514598=await this[_0x3c6204(0x86)][_0x3c6204(0x96)]({'where':{'word':_0x3ad604}});if(_0x514598)throw new common_1[(_0x3c6204(0xd6))](_0x3c6204(0xcb),common_1[_0x3c6204(0xe3)][_0x3c6204(0x8c)]);return await this['badWordsEntity'][_0x3c6204(0x94)]({'word':_0x3ad604}),await this['loadBadWords'](),_0x3c6204(0x8b);}async['recordUserBadWords'](_0x17fe5f,_0x47cc4e,_0x5e049d,_0x4ad839,_0x2e6ea5){const _0x35cb29=_0xee96d4,_0x5eb93c={'userId':_0x17fe5f,'content':_0x47cc4e,'words':JSON['stringify'](_0x5e049d),'typeCn':JSON[_0x35cb29(0xd8)](_0x4ad839),'typeOriginCn':_0x2e6ea5};try{await this[_0x35cb29(0xcd)][_0x35cb29(0xd3)]()[_0x35cb29(0x9c)](user_entity_1['UserEntity'])[_0x35cb29(0xba)]({'violationCount':()=>_0x35cb29(0xbe)})[_0x35cb29(0x97)](_0x35cb29(0xef),{'userId':_0x17fe5f})[_0x35cb29(0xcc)](),await this['violationLogEntity'][_0x35cb29(0x94)](_0x5eb93c);}catch(_0x37cc3d){console[_0x35cb29(0x9e)](_0x35cb29(0xa9),_0x37cc3d);}}async[_0xee96d4(0xa2)](_0xaa1f07,_0x58ee43){const _0x64b473=_0xee96d4,{role:_0x206ffd}=_0xaa1f07[_0x64b473(0xc9)],{page:page=0x1,size:size=0xa,userId:_0x1bc1c6,typeOriginCn:_0x541553}=_0x58ee43,_0xb1c112={};_0x1bc1c6&&(_0xb1c112['userId']=_0x1bc1c6),_0x541553&&(_0xb1c112[_0x64b473(0x7f)]=_0x541553);const [_0x13ca43,_0x467796]=await this[_0x64b473(0xb4)]['findAndCount']({'where':_0xb1c112,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x64b473(0xc0)}}),_0xd9da1f=[...new Set(_0x13ca43[_0x64b473(0xcf)](_0x1f2f0b=>_0x1f2f0b['userId']))],_0x162e87=await this[_0x64b473(0xcd)][_0x64b473(0xab)]({'where':{'id':(0x0,typeorm_1['In'])(_0xd9da1f)},'select':['id',_0x64b473(0xa0),_0x64b473(0x95),'email','violationCount',_0x64b473(0xd0)]});return _0x13ca43[_0x64b473(0x91)](_0xed0a45=>{const _0x2067dd=_0x64b473,_0x1659fd=_0x162e87[_0x2067dd(0xab)](_0x256948=>_0x256948['id']===_0xed0a45[_0x2067dd(0x88)]);_0x206ffd!=='super'&&(_0x1659fd[_0x2067dd(0xc8)]=(0x0,utils_1[_0x2067dd(0xa6)])(_0x1659fd[_0x2067dd(0xc8)])),_0xed0a45[_0x2067dd(0xc1)]=_0x1659fd;}),{'rows':_0x13ca43,'count':_0x467796};}};BadwordsService=__decorate([(0x0,common_1[_0xee96d4(0xaf)])(),__param(0x0,(0x0,typeorm_2[_0xee96d4(0xd7)])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2[_0xee96d4(0xd7)])(violationLog_entity_1[_0xee96d4(0xc4)])),__param(0x2,(0x0,typeorm_2['InjectRepository'])(user_entity_1[_0xee96d4(0xbf)])),__metadata('design:paramtypes',[typeorm_1['Repository'],typeorm_1[_0xee96d4(0xc5)],typeorm_1[_0xee96d4(0xc5)],globalConfig_service_1[_0xee96d4(0xb6)]])],BadwordsService),exports[_0xee96d4(0xf0)]=BadwordsService;