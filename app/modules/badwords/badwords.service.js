'use strict';const _0x22bcc8=_0x5ea4;(function(_0x1ba1de,_0xb22845){const _0x5af0e9=_0x5ea4,_0x394035=_0x1ba1de();while(!![]){try{const _0x1725ea=parseInt(_0x5af0e9(0x11b))/0x1*(parseInt(_0x5af0e9(0x111))/0x2)+parseInt(_0x5af0e9(0xc1))/0x3+-parseInt(_0x5af0e9(0xd6))/0x4*(-parseInt(_0x5af0e9(0x115))/0x5)+parseInt(_0x5af0e9(0xe0))/0x6+parseInt(_0x5af0e9(0xc3))/0x7*(-parseInt(_0x5af0e9(0xf0))/0x8)+-parseInt(_0x5af0e9(0x10a))/0x9+-parseInt(_0x5af0e9(0xba))/0xa*(parseInt(_0x5af0e9(0xff))/0xb);if(_0x1725ea===_0xb22845)break;else _0x394035['push'](_0x394035['shift']());}catch(_0x3aa17d){_0x394035['push'](_0x394035['shift']());}}}(_0x3100,0xcc2b7));var __decorate=this&&this[_0x22bcc8(0x121)]||function(_0x5c100c,_0x1ac860,_0x1ece62,_0x5a5fe6){const _0x1a7db9=_0x22bcc8;var _0x406f20=arguments[_0x1a7db9(0xea)],_0xe37b95=_0x406f20<0x3?_0x1ac860:_0x5a5fe6===null?_0x5a5fe6=Object[_0x1a7db9(0xe5)](_0x1ac860,_0x1ece62):_0x5a5fe6,_0xa74f41;if(typeof Reflect===_0x1a7db9(0xec)&&typeof Reflect[_0x1a7db9(0x10e)]==='function')_0xe37b95=Reflect['decorate'](_0x5c100c,_0x1ac860,_0x1ece62,_0x5a5fe6);else{for(var _0x1b7cfe=_0x5c100c[_0x1a7db9(0xea)]-0x1;_0x1b7cfe>=0x0;_0x1b7cfe--)if(_0xa74f41=_0x5c100c[_0x1b7cfe])_0xe37b95=(_0x406f20<0x3?_0xa74f41(_0xe37b95):_0x406f20>0x3?_0xa74f41(_0x1ac860,_0x1ece62,_0xe37b95):_0xa74f41(_0x1ac860,_0x1ece62))||_0xe37b95;}return _0x406f20>0x3&&_0xe37b95&&Object[_0x1a7db9(0xd7)](_0x1ac860,_0x1ece62,_0xe37b95),_0xe37b95;},__metadata=this&&this[_0x22bcc8(0xbc)]||function(_0x10b9c8,_0xbeea66){const _0x5d6c2e=_0x22bcc8;if(typeof Reflect===_0x5d6c2e(0xec)&&typeof Reflect[_0x5d6c2e(0xc4)]===_0x5d6c2e(0xde))return Reflect[_0x5d6c2e(0xc4)](_0x10b9c8,_0xbeea66);},__param=this&&this['__param']||function(_0x5552cb,_0x489857){return function(_0x26d88a,_0x50ce40){_0x489857(_0x26d88a,_0x50ce40,_0x5552cb);};};function _0x5ea4(_0xfad05d,_0x213af5){const _0x3100f5=_0x3100();return _0x5ea4=function(_0x5ea4a6,_0x1cc7fd){_0x5ea4a6=_0x5ea4a6-0xb0;let _0x406f09=_0x3100f5[_0x5ea4a6];return _0x406f09;},_0x5ea4(_0xfad05d,_0x213af5);}Object['defineProperty'](exports,_0x22bcc8(0x107),{'value':!![]}),exports[_0x22bcc8(0xb3)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require(_0x22bcc8(0xf2)),badwords_entity_1=require('./badwords.entity'),typeorm_1=require(_0x22bcc8(0x113)),typeorm_2=require(_0x22bcc8(0xb1)),axios_1=require(_0x22bcc8(0xc5)),violationLog_entity_1=require(_0x22bcc8(0x102)),user_entity_1=require(_0x22bcc8(0x116)),utils_1=require(_0x22bcc8(0xb9));function _0x3100(){const _0x2c6b61=['checkBadWords','./violationLog.entity','Repository','BAD_REQUEST','forEach','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','__esModule','id\x20=\x20:userId','nineaiCheckBadWords','840591qEpuAW','map','globalConfigService','更新敏感词成功','decorate','敏感词不存在,请检查您的提交信息','recordUserBadWords','2luIlhr','自定义','typeorm','match','370zdaPPU','../user/user.entity','***','Injectable','word_list','badWordsEntity','1301347Zbtwqx','set','ViolationLogEntity','update','push','violationLogEntity','__decorate','username','@nestjs/typeorm','createQueryBuilder','BadwordsService','formarTips','updateBadWords','error:\x20','delete','application/x-www-form-urlencoded','../../common/utils','32570eYqXnX','stringify','__metadata','InjectRepository','badWords','affected','百度云检测','3888333ecgyhH','code','753151mjpVHc','metadata','axios','Like','join','customSensitiveWords','添加敏感词成功','msg','userId','save','findAndCount','violationCount','百度文本检测出现错误、请查看配置信息:\x20','where','find','super','DESC','baiduTextAccessToken','data','26748vPxsAz','defineProperty','email','baidu','user','violationCount\x20+\x201','post','findOne','function','typeOriginCn','6456432LAcLbX','HttpStatus','word','onModuleInit','删除敏感词失败','getOwnPropertyDescriptor','的信息、我们已对您账号进行标记、请合规使用！','hideString','敏感词已经存在了、请勿重复添加','avatar','length','HttpException','object','的内容、我们已对您的账户进行标记、请合规使用！','userInfo','ASC','88BgzwKd','queryBadWords','@nestjs/common','checkBadWordsByConfig','execute','extractContent','BadWordsEntity','status','userEntity','violation','baiduCheckBadWords','UserEntity','loadBadWords','自定义检测','delBadWords','6941IzTTHT','includes'];_0x3100=function(){return _0x2c6b61;};return _0x3100();}let BadwordsService=class BadwordsService{constructor(_0x4d4f87,_0x595073,_0x3c1ba2,_0x1b8d26){const _0xd0acb9=_0x22bcc8;this[_0xd0acb9(0x11a)]=_0x4d4f87,this[_0xd0acb9(0x120)]=_0x595073,this[_0xd0acb9(0xf8)]=_0x3c1ba2,this[_0xd0acb9(0x10c)]=_0x1b8d26,this[_0xd0acb9(0xbe)]=[];}async[_0x22bcc8(0xe3)](){const _0x44f9c9=_0x22bcc8;this[_0x44f9c9(0xfc)]();}async['customSensitiveWords'](_0x5c7ece,_0x24403b){const _0x2454fc=_0x22bcc8,_0x5acd3a=[];for(let _0xc6a8d=0x0;_0xc6a8d<this[_0x2454fc(0xbe)][_0x2454fc(0xea)];_0xc6a8d++){const _0x17fe8b=this[_0x2454fc(0xbe)][_0xc6a8d];_0x5c7ece[_0x2454fc(0x100)](_0x17fe8b)&&_0x5acd3a[_0x2454fc(0x11f)](_0x17fe8b);}if(_0x5acd3a[_0x2454fc(0xea)]){await this[_0x2454fc(0x110)](_0x24403b,_0x5c7ece,_0x5acd3a,[_0x2454fc(0x112)],_0x2454fc(0xfd));const _0x5c5c74=_0x2454fc(0x106);throw new common_1[(_0x2454fc(0xeb))](_0x5c5c74,common_1[_0x2454fc(0xe1)][_0x2454fc(0x104)]);}}async[_0x22bcc8(0x101)](_0x3ae4cd,_0x541f60){const _0x4f3245=_0x22bcc8,_0xe295b4=await this[_0x4f3245(0x10c)]['getSensitiveConfig']();_0xe295b4&&await this[_0x4f3245(0xf3)](_0x3ae4cd,_0xe295b4,_0x541f60),await this[_0x4f3245(0xc8)](_0x3ae4cd,_0x541f60);}async['checkBadWordsByConfig'](_0x4d2df0,_0x3be3b0,_0x4efd80){const _0x3cbcb9=_0x22bcc8,{useType:_0x83eb6e}=_0x3be3b0;_0x83eb6e===_0x3cbcb9(0xd9)&&await this['baiduCheckBadWords'](_0x4d2df0,_0x3be3b0[_0x3cbcb9(0xd4)],_0x4efd80),_0x83eb6e==='nineai'&&await this[_0x3cbcb9(0x109)](_0x4d2df0,_0x3be3b0,_0x4efd80);}[_0x22bcc8(0xf5)](_0x5e0df2){const _0x41f9a0=_0x22bcc8,_0x17d523=/存在(.*?)不合规/,_0x3f0f0a=_0x5e0df2[_0x41f9a0(0x114)](_0x17d523);return _0x3f0f0a?_0x3f0f0a[0x1]:'';}async[_0x22bcc8(0xfa)](_0x5c89c1,_0x551ef7,_0x2fe915){const _0xa94105=_0x22bcc8;if(!_0x551ef7)return;const _0x920632='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x551ef7+'}',_0x253d14={'Content-Type':_0xa94105(0xb8),'Accept':'application/json'},_0x383f03=await axios_1['default'][_0xa94105(0xdc)](_0x920632,{'text':_0x5c89c1},{'headers':_0x253d14}),{conclusion:_0x3204f7,error_code:_0x4049f2,error_msg:_0x4dcd40,conclusionType:_0x3e2953,data:_0x5997e5}=_0x383f03['data'];_0x4049f2&&console['log'](_0xa94105(0xcf),_0x4dcd40);if(_0x3e2953!==0x1){const _0x124eef=[...new Set(_0x5997e5[_0xa94105(0x10b)](_0x4c9544=>this[_0xa94105(0xf5)](_0x4c9544[_0xa94105(0xca)])))];await this[_0xa94105(0x110)](_0x2fe915,_0x5c89c1,[_0xa94105(0x117)],_0x124eef,_0xa94105(0xc0));const _0x44582d='您提交的信息中包含'+_0x124eef[_0xa94105(0xc7)](',')+_0xa94105(0xed);throw new common_1[(_0xa94105(0xeb))](_0x44582d,common_1['HttpStatus'][_0xa94105(0x104)]);}}async[_0x22bcc8(0x109)](_0x512a32,_0x14906d,_0x2676eb){const _0x512308=_0x22bcc8;var _0xbb9692;const {nineaiBuiltInSensitiveApiBase:_0x5d37ee,nineaiBuiltInSensitiveAuthKey:_0x56323f}=_0x14906d;if(!_0x5d37ee||!_0x56323f)return;const _0x130ffe=await axios_1['default'][_0x512308(0xdc)](_0x5d37ee,{'content':_0x512a32},{'headers':{'Content-Type':'application/json','Authorization':_0x56323f}});if(!_0x130ffe['data'])return;if(_0x130ffe[_0x512308(0xd5)][_0x512308(0xc2)]!=='0'){const {msg:msg='检测失败'}=_0x130ffe['data'];throw new common_1['HttpException']('敏感词检测\x20|\x20'+msg,common_1[_0x512308(0xe1)][_0x512308(0x104)]);}if(_0x130ffe[_0x512308(0xd5)][_0x512308(0x119)]&&((_0xbb9692=_0x130ffe[_0x512308(0xd5)][_0x512308(0x119)])===null||_0xbb9692===void 0x0?void 0x0:_0xbb9692[_0x512308(0xea)])){const _0x13f6c5=[...new Set(_0x130ffe[_0x512308(0xd5)][_0x512308(0x119)][_0x512308(0x10b)](_0x364f89=>_0x364f89['keyword']))],_0xc988ff=[...new Set(_0x130ffe[_0x512308(0xd5)][_0x512308(0x119)][_0x512308(0x10b)](_0x20fcef=>_0x20fcef['category']))];await this[_0x512308(0x110)](_0x2676eb,_0x512a32,_0x13f6c5,_0xc988ff,'NineAi检测');const _0x8d7f4c=this[_0x512308(0xb4)](_0x130ffe['data'][_0x512308(0x119)]);throw new common_1[(_0x512308(0xeb))](_0x8d7f4c,common_1[_0x512308(0xe1)]['BAD_REQUEST']);}}['formarTips'](_0x41c11b){const _0xe5a537=_0x22bcc8,_0x223f26=_0x41c11b[_0xe5a537(0x10b)](_0x524f17=>_0x524f17['category']),_0x48be41=[...new Set(_0x223f26)];return'您提交的内容中包含'+_0x48be41[_0xe5a537(0xc7)](',')+_0xe5a537(0xe6);}async[_0x22bcc8(0xfc)](){const _0xf2ac61=_0x22bcc8,_0x57867f=await this[_0xf2ac61(0x11a)][_0xf2ac61(0xd1)]({'where':{'status':0x1},'select':[_0xf2ac61(0xe2)]});this['badWords']=_0x57867f[_0xf2ac61(0x10b)](_0x393386=>_0x393386[_0xf2ac61(0xe2)]);}async[_0x22bcc8(0xf1)](_0xe55427){const _0x29ce96=_0x22bcc8,{page:page=0x1,size:size=0x1f4,word:_0x44998d,status:_0x5e3c41}=_0xe55427,_0x46dc54={};[0x0,0x1,'0','1'][_0x29ce96(0x100)](_0x5e3c41)&&(_0x46dc54[_0x29ce96(0xf7)]=_0x5e3c41),_0x44998d&&(_0x46dc54[_0x29ce96(0xe2)]=(0x0,typeorm_1[_0x29ce96(0xc6)])('%'+_0x44998d+'%'));const [_0x1a2896,_0x396e93]=await this[_0x29ce96(0x11a)]['findAndCount']({'where':_0x46dc54,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x29ce96(0xef)}});return{'rows':_0x1a2896,'count':_0x396e93};}async[_0x22bcc8(0xfe)](_0x130b9d){const _0x5f330f=_0x22bcc8,_0x4e0e3f=await this[_0x5f330f(0x11a)]['findOne']({'where':{'id':_0x130b9d['id']}});if(!_0x4e0e3f)throw new common_1['HttpException'](_0x5f330f(0x10f),common_1[_0x5f330f(0xe1)][_0x5f330f(0x104)]);const _0x5c4e90=await this[_0x5f330f(0x11a)][_0x5f330f(0xb7)]({'id':_0x130b9d['id']});if(_0x5c4e90[_0x5f330f(0xbf)]>0x0)return await this[_0x5f330f(0xfc)](),'删除敏感词成功';else throw new common_1[(_0x5f330f(0xeb))](_0x5f330f(0xe4),common_1[_0x5f330f(0xe1)][_0x5f330f(0x104)]);}async[_0x22bcc8(0xb5)](_0x461a7f){const _0x2eff6d=_0x22bcc8,{id:_0x4e8531,word:_0x58e719,status:_0x19a8ee}=_0x461a7f,_0x23bb1b=await this[_0x2eff6d(0x11a)][_0x2eff6d(0xdd)]({'where':{'word':_0x58e719}});if(_0x23bb1b)throw new common_1['HttpException'](_0x2eff6d(0xe8),common_1[_0x2eff6d(0xe1)][_0x2eff6d(0x104)]);const _0x3d04fc=await this[_0x2eff6d(0x11a)][_0x2eff6d(0x11e)]({'id':_0x4e8531},{'word':_0x58e719,'status':_0x19a8ee});if(_0x3d04fc[_0x2eff6d(0xbf)]>0x0)return await this['loadBadWords'](),_0x2eff6d(0x10d);else throw new common_1[(_0x2eff6d(0xeb))]('更新敏感词失败',common_1[_0x2eff6d(0xe1)][_0x2eff6d(0x104)]);}async['addBadWord'](_0x4e6648){const _0x6fee2a=_0x22bcc8,{word:_0x4b69d5}=_0x4e6648,_0x2db42b=await this[_0x6fee2a(0x11a)][_0x6fee2a(0xdd)]({'where':{'word':_0x4b69d5}});if(_0x2db42b)throw new common_1[(_0x6fee2a(0xeb))]('敏感词已存在,请检查您的提交信息',common_1[_0x6fee2a(0xe1)][_0x6fee2a(0x104)]);return await this['badWordsEntity'][_0x6fee2a(0xcc)]({'word':_0x4b69d5}),await this['loadBadWords'](),_0x6fee2a(0xc9);}async[_0x22bcc8(0x110)](_0x43bcfd,_0x2e3d38,_0xf059c7,_0x4703df,_0x57d7d4){const _0x2205bb=_0x22bcc8,_0x2913f0={'userId':_0x43bcfd,'content':_0x2e3d38,'words':JSON[_0x2205bb(0xbb)](_0xf059c7),'typeCn':JSON['stringify'](_0x4703df),'typeOriginCn':_0x57d7d4};try{await this[_0x2205bb(0xf8)][_0x2205bb(0xb2)]()[_0x2205bb(0x11e)](user_entity_1[_0x2205bb(0xfb)])[_0x2205bb(0x11c)]({'violationCount':()=>_0x2205bb(0xdb)})[_0x2205bb(0xd0)](_0x2205bb(0x108),{'userId':_0x43bcfd})[_0x2205bb(0xf4)](),await this[_0x2205bb(0x120)][_0x2205bb(0xcc)](_0x2913f0);}catch(_0x4c2439){console['log'](_0x2205bb(0xb6),_0x4c2439);}}async[_0x22bcc8(0xf9)](_0x4069b7,_0x54ed87){const _0x1e35c2=_0x22bcc8,{role:_0x778e38}=_0x4069b7[_0x1e35c2(0xda)],{page:page=0x1,size:size=0xa,userId:_0x401f48,typeOriginCn:_0x2bc567}=_0x54ed87,_0x2cd9c4={};_0x401f48&&(_0x2cd9c4[_0x1e35c2(0xcb)]=_0x401f48),_0x2bc567&&(_0x2cd9c4[_0x1e35c2(0xdf)]=_0x2bc567);const [_0x57a374,_0x1f3eec]=await this['violationLogEntity'][_0x1e35c2(0xcd)]({'where':_0x2cd9c4,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x1e35c2(0xd3)}}),_0x515988=[...new Set(_0x57a374['map'](_0x4d38af=>_0x4d38af[_0x1e35c2(0xcb)]))],_0xd730bc=await this[_0x1e35c2(0xf8)][_0x1e35c2(0xd1)]({'where':{'id':(0x0,typeorm_1['In'])(_0x515988)},'select':['id',_0x1e35c2(0xe9),_0x1e35c2(0xb0),_0x1e35c2(0xd8),_0x1e35c2(0xce),'status']});return _0x57a374[_0x1e35c2(0x105)](_0x514237=>{const _0xe02880=_0x1e35c2,_0x6beed0=_0xd730bc[_0xe02880(0xd1)](_0xce123a=>_0xce123a['id']===_0x514237[_0xe02880(0xcb)]);_0x778e38!==_0xe02880(0xd2)&&(_0x6beed0['email']=(0x0,utils_1[_0xe02880(0xe7)])(_0x6beed0['email'])),_0x514237[_0xe02880(0xee)]=_0x6beed0;}),{'rows':_0x57a374,'count':_0x1f3eec};}};BadwordsService=__decorate([(0x0,common_1[_0x22bcc8(0x118)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1[_0x22bcc8(0xf6)])),__param(0x1,(0x0,typeorm_2[_0x22bcc8(0xbd)])(violationLog_entity_1[_0x22bcc8(0x11d)])),__param(0x2,(0x0,typeorm_2[_0x22bcc8(0xbd)])(user_entity_1[_0x22bcc8(0xfb)])),__metadata('design:paramtypes',[typeorm_1[_0x22bcc8(0x103)],typeorm_1['Repository'],typeorm_1[_0x22bcc8(0x103)],globalConfig_service_1['GlobalConfigService']])],BadwordsService),exports['BadwordsService']=BadwordsService;