'use strict';function _0x1e07(){const _0x182e54=['hideString','4653744kIpeuA','default','findOne','checkBadWordsByConfig','getSensitiveConfig','./../globalConfig/globalConfig.service','userEntity','NineAi检测','formarTips','badWordsEntity','自定义检测','百度云检测','200007hDZJqe','__decorate','loadBadWords','您提交的信息中包含','affected','nineaiCheckBadWords','includes','forEach','violationCount','where','__param','自定义','super','百度文本检测出现错误、请查看配置信息:\x20','@nestjs/common','***','Injectable','violationLogEntity','更新敏感词成功','15974snThOG','UserEntity','3926970LGsxwD','HttpException','decorate','__esModule','find','stringify','删除敏感词成功','userInfo','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','baiduCheckBadWords','queryBadWords','2669565WWspkQ','update','ASC','object','BAD_REQUEST','username','Like','DESC','badWords','28HcSNFe','删除敏感词失败','./badwords.entity','post','BadWordsEntity','delBadWords','BadwordsService','18740sZWYSL','createQueryBuilder','userId','nineai','category','extractContent','keyword','1234432iuMuZH','Repository','__metadata','../../common/utils','data','join','InjectRepository','map','updateBadWords','HttpStatus','defineProperty','baiduTextAccessToken','1096JuzuUp','typeorm','@nestjs/typeorm','function','code','length','match','typeOriginCn','axios','email','addBadWord','error:\x20','push','的信息、我们已对您账号进行标记、请合规使用！','save','./violationLog.entity','ViolationLogEntity','word','msg','../user/user.entity','recordUserBadWords','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','metadata','的内容、我们已对您的账户进行标记、请合规使用！','findAndCount','您提交的内容中包含','检测失败','application/json','word_list','globalConfigService','id\x20=\x20:userId','design:paramtypes','status','customSensitiveWords','execute','log'];_0x1e07=function(){return _0x182e54;};return _0x1e07();}const _0x209cb9=_0x3023;(function(_0x1e8a69,_0x5f415f){const _0x109717=_0x3023,_0x33f739=_0x1e8a69();while(!![]){try{const _0x16e17a=-parseInt(_0x109717(0x160))/0x1*(-parseInt(_0x109717(0x167))/0x2)+-parseInt(_0x109717(0x137))/0x3+-parseInt(_0x109717(0x16e))/0x4+parseInt(_0x109717(0x157))/0x5+-parseInt(_0x109717(0x12b))/0x6+-parseInt(_0x109717(0x14a))/0x7*(-parseInt(_0x109717(0x17a))/0x8)+parseInt(_0x109717(0x14c))/0x9;if(_0x16e17a===_0x5f415f)break;else _0x33f739['push'](_0x33f739['shift']());}catch(_0x11e88b){_0x33f739['push'](_0x33f739['shift']());}}}(_0x1e07,0x60460));var __decorate=this&&this[_0x209cb9(0x138)]||function(_0x56180b,_0x3a350f,_0x20f1c8,_0xeb8145){const _0x48e87f=_0x209cb9;var _0x1e9d67=arguments[_0x48e87f(0x17f)],_0x197379=_0x1e9d67<0x3?_0x3a350f:_0xeb8145===null?_0xeb8145=Object['getOwnPropertyDescriptor'](_0x3a350f,_0x20f1c8):_0xeb8145,_0x1ed592;if(typeof Reflect==='object'&&typeof Reflect[_0x48e87f(0x14e)]===_0x48e87f(0x17d))_0x197379=Reflect['decorate'](_0x56180b,_0x3a350f,_0x20f1c8,_0xeb8145);else{for(var _0x130d64=_0x56180b[_0x48e87f(0x17f)]-0x1;_0x130d64>=0x0;_0x130d64--)if(_0x1ed592=_0x56180b[_0x130d64])_0x197379=(_0x1e9d67<0x3?_0x1ed592(_0x197379):_0x1e9d67>0x3?_0x1ed592(_0x3a350f,_0x20f1c8,_0x197379):_0x1ed592(_0x3a350f,_0x20f1c8))||_0x197379;}return _0x1e9d67>0x3&&_0x197379&&Object[_0x48e87f(0x178)](_0x3a350f,_0x20f1c8,_0x197379),_0x197379;},__metadata=this&&this[_0x209cb9(0x170)]||function(_0x12ee41,_0x2d1c43){const _0x14a831=_0x209cb9;if(typeof Reflect===_0x14a831(0x15a)&&typeof Reflect[_0x14a831(0x190)]===_0x14a831(0x17d))return Reflect['metadata'](_0x12ee41,_0x2d1c43);},__param=this&&this[_0x209cb9(0x141)]||function(_0x2e93cd,_0x12c3ef){return function(_0x46a277,_0x10acad){_0x12c3ef(_0x46a277,_0x10acad,_0x2e93cd);};};Object[_0x209cb9(0x178)](exports,_0x209cb9(0x14f),{'value':!![]}),exports[_0x209cb9(0x166)]=void 0x0;const globalConfig_service_1=require(_0x209cb9(0x130)),common_1=require(_0x209cb9(0x145)),badwords_entity_1=require(_0x209cb9(0x162)),typeorm_1=require(_0x209cb9(0x17b)),typeorm_2=require(_0x209cb9(0x17c)),axios_1=require(_0x209cb9(0x182)),violationLog_entity_1=require(_0x209cb9(0x189)),user_entity_1=require(_0x209cb9(0x18d)),utils_1=require(_0x209cb9(0x171));let BadwordsService=class BadwordsService{constructor(_0x4b5cd6,_0x11add7,_0x255c56,_0x2d6565){const _0x5c64cf=_0x209cb9;this[_0x5c64cf(0x134)]=_0x4b5cd6,this[_0x5c64cf(0x148)]=_0x11add7,this['userEntity']=_0x255c56,this[_0x5c64cf(0x123)]=_0x2d6565,this[_0x5c64cf(0x15f)]=[];}async['onModuleInit'](){const _0x33fe2c=_0x209cb9;this[_0x33fe2c(0x139)]();}async[_0x209cb9(0x127)](_0xd186bc,_0x215e6a){const _0x11ebe7=_0x209cb9,_0x339689=[];for(let _0x1417ee=0x0;_0x1417ee<this[_0x11ebe7(0x15f)][_0x11ebe7(0x17f)];_0x1417ee++){const _0x3667c8=this['badWords'][_0x1417ee];_0xd186bc[_0x11ebe7(0x13d)](_0x3667c8)&&_0x339689[_0x11ebe7(0x186)](_0x3667c8);}if(_0x339689[_0x11ebe7(0x17f)]){await this['recordUserBadWords'](_0x215e6a,_0xd186bc,_0x339689,[_0x11ebe7(0x142)],_0x11ebe7(0x135));const _0x2c26be=_0x11ebe7(0x154);throw new common_1['HttpException'](_0x2c26be,common_1['HttpStatus'][_0x11ebe7(0x15b)]);}return!![];}async['checkBadWords'](_0x3664d6,_0x406b24){const _0x3dc009=_0x209cb9,_0x399999=await this['globalConfigService'][_0x3dc009(0x12f)]();_0x399999&&await this[_0x3dc009(0x12e)](_0x3664d6,_0x399999,_0x406b24),await this[_0x3dc009(0x127)](_0x3664d6,_0x406b24);}async[_0x209cb9(0x12e)](_0x41e4c9,_0x3b938b,_0x231314){const _0x39e3eb=_0x209cb9,{useType:_0x34347b}=_0x3b938b;_0x34347b==='baidu'&&await this['baiduCheckBadWords'](_0x41e4c9,_0x3b938b[_0x39e3eb(0x179)],_0x231314),_0x34347b===_0x39e3eb(0x16a)&&await this[_0x39e3eb(0x13c)](_0x41e4c9,_0x3b938b,_0x231314);}['extractContent'](_0x575224){const _0x447141=_0x209cb9,_0x3b0324=/存在(.*?)不合规/,_0x5837ea=_0x575224[_0x447141(0x180)](_0x3b0324);return _0x5837ea?_0x5837ea[0x1]:'';}async[_0x209cb9(0x155)](_0x49a4e6,_0x43626c,_0x6475a9){const _0x1b7d37=_0x209cb9;if(!_0x43626c)return;const _0x1f8dce=_0x1b7d37(0x18f)+_0x43626c+'}',_0x4b5c6f={'Content-Type':'application/x-www-form-urlencoded','Accept':_0x1b7d37(0x195)},_0x268cf8=await axios_1[_0x1b7d37(0x12c)][_0x1b7d37(0x163)](_0x1f8dce,{'text':_0x49a4e6},{'headers':_0x4b5c6f}),{conclusion:_0x47a030,error_code:_0x274acc,error_msg:_0x3c144c,conclusionType:_0x16a381,data:_0x100b05}=_0x268cf8[_0x1b7d37(0x172)];_0x274acc&&console[_0x1b7d37(0x129)](_0x1b7d37(0x144),_0x3c144c);if(_0x16a381!==0x1){const _0x209b63=[...new Set(_0x100b05['map'](_0x5c0de8=>this[_0x1b7d37(0x16c)](_0x5c0de8[_0x1b7d37(0x18c)])))];await this[_0x1b7d37(0x18e)](_0x6475a9,_0x49a4e6,[_0x1b7d37(0x146)],_0x209b63,_0x1b7d37(0x136));const _0x5eadd6=_0x1b7d37(0x13a)+_0x209b63['join'](',')+_0x1b7d37(0x191);throw new common_1[(_0x1b7d37(0x14d))](_0x5eadd6,common_1[_0x1b7d37(0x177)][_0x1b7d37(0x15b)]);}}async[_0x209cb9(0x13c)](_0x25fa81,_0x3efd6c,_0x5d73d5){const _0x2879d8=_0x209cb9,{nineaiBuiltInSensitiveApiBase:_0x49ef88,nineaiBuiltInSensitiveAuthKey:_0x1afab2}=_0x3efd6c;if(!_0x49ef88||!_0x1afab2)return;const _0x5701ad=await axios_1[_0x2879d8(0x12c)][_0x2879d8(0x163)](_0x49ef88,{'content':_0x25fa81},{'headers':{'Content-Type':_0x2879d8(0x195),'Authorization':_0x1afab2}});if(!_0x5701ad[_0x2879d8(0x172)])return;if(_0x5701ad[_0x2879d8(0x172)][_0x2879d8(0x17e)]!=='0'){const {msg:msg=_0x2879d8(0x194)}=_0x5701ad[_0x2879d8(0x172)];throw new common_1['HttpException']('敏感词检测\x20|\x20'+msg,common_1[_0x2879d8(0x177)][_0x2879d8(0x15b)]);}if(_0x5701ad['data']['word_list']&&_0x5701ad[_0x2879d8(0x172)]['word_list']?.[_0x2879d8(0x17f)]){const _0x2fe1b5=[...new Set(_0x5701ad[_0x2879d8(0x172)]['word_list']['map'](_0x3fceba=>_0x3fceba[_0x2879d8(0x16d)]))],_0x1de06c=[...new Set(_0x5701ad[_0x2879d8(0x172)][_0x2879d8(0x122)][_0x2879d8(0x175)](_0x1c7a58=>_0x1c7a58['category']))];await this['recordUserBadWords'](_0x5d73d5,_0x25fa81,_0x2fe1b5,_0x1de06c,_0x2879d8(0x132));const _0x3a2b2a=this[_0x2879d8(0x133)](_0x5701ad['data'][_0x2879d8(0x122)]);throw new common_1[(_0x2879d8(0x14d))](_0x3a2b2a,common_1[_0x2879d8(0x177)][_0x2879d8(0x15b)]);}}[_0x209cb9(0x133)](_0x2ba3d3){const _0x1cae9e=_0x209cb9,_0xccde84=_0x2ba3d3['map'](_0x2b36fc=>_0x2b36fc[_0x1cae9e(0x16b)]),_0x15f3d2=[...new Set(_0xccde84)];return _0x1cae9e(0x193)+_0x15f3d2[_0x1cae9e(0x173)](',')+_0x1cae9e(0x187);}async[_0x209cb9(0x139)](){const _0x5529ad=_0x209cb9,_0x402b12=await this['badWordsEntity'][_0x5529ad(0x150)]({'where':{'status':0x1},'select':[_0x5529ad(0x18b)]});this[_0x5529ad(0x15f)]=_0x402b12[_0x5529ad(0x175)](_0x22d583=>_0x22d583[_0x5529ad(0x18b)]);}async[_0x209cb9(0x156)](_0x111f13){const _0x433a58=_0x209cb9,{page:page=0x1,size:size=0x1f4,word:_0x3fce85,status:_0x412610}=_0x111f13,_0x429ec7={};[0x0,0x1,'0','1'][_0x433a58(0x13d)](_0x412610)&&(_0x429ec7[_0x433a58(0x126)]=_0x412610),_0x3fce85&&(_0x429ec7[_0x433a58(0x18b)]=(0x0,typeorm_1[_0x433a58(0x15d)])('%'+_0x3fce85+'%'));const [_0x24604e,_0x3c698a]=await this[_0x433a58(0x134)][_0x433a58(0x192)]({'where':_0x429ec7,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x433a58(0x159)}});return{'rows':_0x24604e,'count':_0x3c698a};}async[_0x209cb9(0x165)](_0x135ed7){const _0x40edd9=_0x209cb9,_0x564212=await this[_0x40edd9(0x134)][_0x40edd9(0x12d)]({'where':{'id':_0x135ed7['id']}});if(!_0x564212)throw new common_1['HttpException']('敏感词不存在,请检查您的提交信息',common_1[_0x40edd9(0x177)][_0x40edd9(0x15b)]);const _0x13bb73=await this[_0x40edd9(0x134)]['delete']({'id':_0x135ed7['id']});if(_0x13bb73[_0x40edd9(0x13b)]>0x0)return await this[_0x40edd9(0x139)](),_0x40edd9(0x152);else throw new common_1[(_0x40edd9(0x14d))](_0x40edd9(0x161),common_1[_0x40edd9(0x177)][_0x40edd9(0x15b)]);}async[_0x209cb9(0x176)](_0x1ee6a1){const _0x12ef05=_0x209cb9,{id:_0x191d63,word:_0x5163f3,status:_0x49989d}=_0x1ee6a1,_0x3be866=await this[_0x12ef05(0x134)][_0x12ef05(0x12d)]({'where':{'word':_0x5163f3}});if(_0x3be866)throw new common_1[(_0x12ef05(0x14d))]('敏感词已经存在了、请勿重复添加',common_1['HttpStatus'][_0x12ef05(0x15b)]);const _0x18d2b5=await this[_0x12ef05(0x134)]['update']({'id':_0x191d63},{'word':_0x5163f3,'status':_0x49989d});if(_0x18d2b5['affected']>0x0)return await this[_0x12ef05(0x139)](),_0x12ef05(0x149);else throw new common_1['HttpException']('更新敏感词失败',common_1['HttpStatus']['BAD_REQUEST']);}async[_0x209cb9(0x184)](_0x1a3f9c){const _0x429c0b=_0x209cb9,{word:_0x5dcd09}=_0x1a3f9c,_0x3023b8=await this[_0x429c0b(0x134)][_0x429c0b(0x12d)]({'where':{'word':_0x5dcd09}});if(_0x3023b8)throw new common_1[(_0x429c0b(0x14d))]('敏感词已存在,请检查您的提交信息',common_1['HttpStatus']['BAD_REQUEST']);return await this[_0x429c0b(0x134)]['save']({'word':_0x5dcd09}),await this[_0x429c0b(0x139)](),'添加敏感词成功';}async['recordUserBadWords'](_0x9cce32,_0x4a5239,_0x33eb93,_0x484f30,_0x215578){const _0x281dd2=_0x209cb9,_0x8abe0e={'userId':_0x9cce32,'content':_0x4a5239,'words':JSON[_0x281dd2(0x151)](_0x33eb93),'typeCn':JSON[_0x281dd2(0x151)](_0x484f30),'typeOriginCn':_0x215578};try{await this[_0x281dd2(0x131)][_0x281dd2(0x168)]()[_0x281dd2(0x158)](user_entity_1[_0x281dd2(0x14b)])['set']({'violationCount':()=>'violationCount\x20+\x201'})[_0x281dd2(0x140)](_0x281dd2(0x124),{'userId':_0x9cce32})[_0x281dd2(0x128)](),await this[_0x281dd2(0x148)][_0x281dd2(0x188)](_0x8abe0e);}catch(_0x4a73b4){console[_0x281dd2(0x129)](_0x281dd2(0x185),_0x4a73b4);}}async['violation'](_0x3fc29a,_0x1214b7){const _0x110f3a=_0x209cb9,{role:_0x2f406f}=_0x3fc29a['user'],{page:page=0x1,size:size=0xa,userId:_0x24e0cf,typeOriginCn:_0x40c521}=_0x1214b7,_0x8bf28e={};_0x24e0cf&&(_0x8bf28e[_0x110f3a(0x169)]=_0x24e0cf),_0x40c521&&(_0x8bf28e[_0x110f3a(0x181)]=_0x40c521);const [_0x1c7530,_0x5b842d]=await this[_0x110f3a(0x148)][_0x110f3a(0x192)]({'where':_0x8bf28e,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x110f3a(0x15e)}}),_0x38f7d5=[...new Set(_0x1c7530['map'](_0x851822=>_0x851822[_0x110f3a(0x169)]))],_0x3a6207=await this[_0x110f3a(0x131)][_0x110f3a(0x150)]({'where':{'id':(0x0,typeorm_1['In'])(_0x38f7d5)},'select':['id','avatar',_0x110f3a(0x15c),_0x110f3a(0x183),_0x110f3a(0x13f),_0x110f3a(0x126)]});return _0x1c7530[_0x110f3a(0x13e)](_0x54fbd3=>{const _0x11e653=_0x110f3a,_0x5743dc=_0x3a6207[_0x11e653(0x150)](_0x4c70e7=>_0x4c70e7['id']===_0x54fbd3[_0x11e653(0x169)]);_0x2f406f!==_0x11e653(0x143)&&(_0x5743dc[_0x11e653(0x183)]=(0x0,utils_1[_0x11e653(0x12a)])(_0x5743dc['email'])),_0x54fbd3[_0x11e653(0x153)]=_0x5743dc;}),{'rows':_0x1c7530,'count':_0x5b842d};}};function _0x3023(_0xb5cb0,_0x18e0b0){const _0x1e0706=_0x1e07();return _0x3023=function(_0x3023a5,_0x5ae39f){_0x3023a5=_0x3023a5-0x122;let _0x426466=_0x1e0706[_0x3023a5];return _0x426466;},_0x3023(_0xb5cb0,_0x18e0b0);}BadwordsService=__decorate([(0x0,common_1[_0x209cb9(0x147)])(),__param(0x0,(0x0,typeorm_2[_0x209cb9(0x174)])(badwords_entity_1[_0x209cb9(0x164)])),__param(0x1,(0x0,typeorm_2[_0x209cb9(0x174)])(violationLog_entity_1[_0x209cb9(0x18a)])),__param(0x2,(0x0,typeorm_2[_0x209cb9(0x174)])(user_entity_1[_0x209cb9(0x14b)])),__metadata(_0x209cb9(0x125),[typeorm_1[_0x209cb9(0x16f)],typeorm_1[_0x209cb9(0x16f)],typeorm_1[_0x209cb9(0x16f)],globalConfig_service_1['GlobalConfigService']])],BadwordsService),exports[_0x209cb9(0x166)]=BadwordsService;