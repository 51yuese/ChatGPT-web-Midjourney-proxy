'use strict';function _0x28e3(){const _0x390468=['fromusername','38234yYKpPw','loginByCode','&redirect_uri=','scanedSceneStrMap','getRedirectUrl','axios','log','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','&noncestr=','split','getUserOpenId','getQRSceneStrByBind','jsapi_ticket=','join','createRandomNonceStr','6084120aFfCkd','jsapiTicket:\x20','./../auth/auth.service','sceneStrMap','checkAutoReply','./../globalConfig/globalConfig.service','HttpException','getConfigs','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','&secret=','4172495UkpjGb','getOwnPropertyDescriptor','getQRCodeTicket','2612184kwCZKJ','HttpStatus','createHash','__esModule','Injectable','hex','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','length','tousername','digest','&url=','bindWx','@nestjs/common','wechatOfficialToken','user','genXmlMsg','autoreplyService','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','wechatOfficialAppId','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','metadata','4xxSpXI','update','sha1','getUserFromOpenId','get','./../user/user.service',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','now','fetchQRCodeTicket','default','GlobalConfigService','appId:\x20','decorate','OfficialService','wechatJsapiTicket','AuthService','回跳跳转地址:\x20','__decorate','./../autoreply/autoreply.service','loginBySceneStr','verify','BAD_REQUEST','genXmlMsgByConfig','loginByOpenId','非法参数','bindWxBySceneStr','254910qDdnIr','getJsapiTicket','object','defineProperty','userService','aotoPlay','authService','8103915ShCgDP','wechatAccessToken','toFixed','post','&grant_type=authorization_code','130448ZkWliu','globalConfigService','876EOqYuW'];_0x28e3=function(){return _0x390468;};return _0x28e3();}const _0x164d4a=_0xdeeb;(function(_0x4b7761,_0x3c4849){const _0x5c81aa=_0xdeeb,_0x4d6b63=_0x4b7761();while(!![]){try{const _0x40945c=parseInt(_0x5c81aa(0x18b))/0x1*(-parseInt(_0x5c81aa(0x1c0))/0x2)+-parseInt(_0x5c81aa(0x1da))/0x3+parseInt(_0x5c81aa(0x1ab))/0x4+parseInt(_0x5c81aa(0x1a8))/0x5+-parseInt(_0x5c81aa(0x18d))/0x6*(parseInt(_0x5c81aa(0x18f))/0x7)+-parseInt(_0x5c81aa(0x19e))/0x8+parseInt(_0x5c81aa(0x186))/0x9;if(_0x40945c===_0x3c4849)break;else _0x4d6b63['push'](_0x4d6b63['shift']());}catch(_0x197727){_0x4d6b63['push'](_0x4d6b63['shift']());}}}(_0x28e3,0x76333));var __decorate=this&&this[_0x164d4a(0x1d1)]||function(_0x3814e4,_0x245c68,_0x133a86,_0x16ff02){const _0x52630d=_0x164d4a;var _0x8fe4b7=arguments[_0x52630d(0x1b2)],_0x477416=_0x8fe4b7<0x3?_0x245c68:_0x16ff02===null?_0x16ff02=Object[_0x52630d(0x1a9)](_0x245c68,_0x133a86):_0x16ff02,_0xe1a839;if(typeof Reflect===_0x52630d(0x1dc)&&typeof Reflect[_0x52630d(0x1cc)]==='function')_0x477416=Reflect['decorate'](_0x3814e4,_0x245c68,_0x133a86,_0x16ff02);else{for(var _0x5a8068=_0x3814e4[_0x52630d(0x1b2)]-0x1;_0x5a8068>=0x0;_0x5a8068--)if(_0xe1a839=_0x3814e4[_0x5a8068])_0x477416=(_0x8fe4b7<0x3?_0xe1a839(_0x477416):_0x8fe4b7>0x3?_0xe1a839(_0x245c68,_0x133a86,_0x477416):_0xe1a839(_0x245c68,_0x133a86))||_0x477416;}return _0x8fe4b7>0x3&&_0x477416&&Object[_0x52630d(0x1dd)](_0x245c68,_0x133a86,_0x477416),_0x477416;},__metadata=this&&this['__metadata']||function(_0x10a484,_0xc348aa){const _0x24fa58=_0x164d4a;if(typeof Reflect===_0x24fa58(0x1dc)&&typeof Reflect[_0x24fa58(0x1bf)]==='function')return Reflect['metadata'](_0x10a484,_0xc348aa);};Object[_0x164d4a(0x1dd)](exports,_0x164d4a(0x1ae),{'value':!![]}),exports[_0x164d4a(0x1cd)]=void 0x0;const globalConfig_service_1=require(_0x164d4a(0x1a3)),auth_service_1=require(_0x164d4a(0x1a0)),user_service_1=require(_0x164d4a(0x1c5)),autoreply_service_1=require(_0x164d4a(0x1d2)),common_1=require(_0x164d4a(0x1b7)),crypto=require('crypto'),axios_1=require(_0x164d4a(0x194)),utils_1=require('../../common/utils');function _0xdeeb(_0xe9287,_0x3b6fa5){const _0x28e3ed=_0x28e3();return _0xdeeb=function(_0xdeebb0,_0x35e4f7){_0xdeebb0=_0xdeebb0-0x184;let _0x2d41bb=_0x28e3ed[_0xdeebb0];return _0x2d41bb;},_0xdeeb(_0xe9287,_0x3b6fa5);}let OfficialService=class OfficialService{constructor(_0x231cb5,_0x51df87,_0x8fb446,_0x580e29){const _0x34d193=_0x164d4a;this[_0x34d193(0x1bb)]=_0x231cb5,this[_0x34d193(0x1de)]=_0x51df87,this['authService']=_0x8fb446,this['globalConfigService']=_0x580e29,this[_0x34d193(0x1a1)]={},this[_0x34d193(0x192)]={};}async['onModuleInit'](){const _0x57929a=_0x164d4a;await this[_0x57929a(0x18c)]['getWechatAccessToken'](!![]);}async['getQRSceneStr'](_0x330d6a){const _0x280687=_0x164d4a,{invitedBy:_0x3319ac}=_0x330d6a;let _0x1d98ea=(0x0,utils_1[_0x280687(0x19d)])(0x20);return _0x3319ac&&(_0x1d98ea+=':'+_0x3319ac),this[_0x280687(0x1a1)][_0x1d98ea]=!![],_0x1d98ea;}async[_0x164d4a(0x19a)](_0xa8d9f6){const _0x675563=_0x164d4a,{id:_0x3fb6dd}=_0xa8d9f6['user'],_0x58d675=(0x0,utils_1['createRandomNonceStr'])(0x20)+'/'+_0x3fb6dd;return this[_0x675563(0x1a1)][_0x58d675]=!![],_0x58d675;}async[_0x164d4a(0x1aa)](_0x362e6e){const _0x55ee33=_0x164d4a;return this[_0x55ee33(0x1c8)](_0x362e6e);}async[_0x164d4a(0x193)](_0x22ca53){const _0xbc7ff4=_0x164d4a,_0x40ad50=await this[_0xbc7ff4(0x18c)][_0xbc7ff4(0x1a5)](['wechatOfficialAppId']),_0x2ee07f='https://open.weixin.qq.com/connect/oauth2/authorize?appid='+_0x40ad50+_0xbc7ff4(0x191)+encodeURIComponent(_0x22ca53)+_0xbc7ff4(0x1a6);return console[_0xbc7ff4(0x195)](_0xbc7ff4(0x1d0),_0x2ee07f),_0x2ee07f;}async[_0x164d4a(0x1db)](_0x57d6cd){const _0x3b53b4=_0x164d4a,_0x17fea2=(0x0,utils_1[_0x3b53b4(0x19d)])(0x20),_0x4ecfb1=(Date[_0x3b53b4(0x1c7)]()/0x3e8)[_0x3b53b4(0x188)](0x0),_0x5c95d4=await this[_0x3b53b4(0x18c)][_0x3b53b4(0x1a5)]([_0x3b53b4(0x1ce)]);console[_0x3b53b4(0x195)](_0x3b53b4(0x19f),_0x5c95d4);const _0x250d20=await this[_0x3b53b4(0x18c)]['getConfigs']([_0x3b53b4(0x1bd)]);console['log'](_0x3b53b4(0x1cb),_0x250d20);const _0x2dc0c0=_0x3b53b4(0x19b)+_0x5c95d4+_0x3b53b4(0x197)+_0x17fea2+'&timestamp='+_0x4ecfb1+_0x3b53b4(0x1b5)+_0x57d6cd;console[_0x3b53b4(0x195)]('str:\x20',_0x2dc0c0);const _0x276329=this[_0x3b53b4(0x1c2)](_0x2dc0c0);return{'appId':_0x250d20,'nonceStr':_0x17fea2,'timestamp':_0x4ecfb1,'signature':_0x276329};}async[_0x164d4a(0x1c8)](_0x8daaf1){const _0x1a7c6d=_0x164d4a,_0x261492=await this[_0x1a7c6d(0x18c)][_0x1a7c6d(0x1a5)]([_0x1a7c6d(0x187)]),_0x3c2364={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x8daaf1}}},_0x539e27=await axios_1[_0x1a7c6d(0x1c9)][_0x1a7c6d(0x189)](_0x1a7c6d(0x1be)+_0x261492,_0x3c2364),{data:{errmsg:_0x1b11cf,ticket:_0x3cd8f4}}=_0x539e27;if(_0x1b11cf)throw new common_1[(_0x1a7c6d(0x1a4))](_0x1b11cf,common_1['HttpStatus'][_0x1a7c6d(0x1d5)]);return _0x3cd8f4;}async[_0x164d4a(0x190)](_0x464712,_0x4f28aa){const _0x759108=_0x164d4a,_0x211756=await this[_0x759108(0x18c)][_0x759108(0x1a5)](['wechatOfficialAppId']),_0x1efcb2=await this[_0x759108(0x18c)][_0x759108(0x1a5)](['wechatOfficialAppSecret']),_0x965ae7=await axios_1[_0x759108(0x1c9)][_0x759108(0x1c4)](_0x759108(0x196)+_0x211756+_0x759108(0x1a7)+_0x1efcb2+'&code='+_0x4f28aa+_0x759108(0x18a)),{data:{errmsg:_0x13e9ee,openid:_0x25283c}}=_0x965ae7;if(_0x13e9ee)throw new common_1[(_0x759108(0x1a4))](_0x13e9ee,common_1['HttpStatus'][_0x759108(0x1d5)]);let _0x1fbb82;return _0x1fbb82=await this[_0x759108(0x1de)][_0x759108(0x199)](_0x25283c),!_0x1fbb82&&(_0x1fbb82=await this[_0x759108(0x1de)][_0x759108(0x1c3)](_0x25283c)),this[_0x759108(0x185)][_0x759108(0x1d7)](_0x1fbb82,_0x464712);}async['scan'](_0x81dad1,_0x2a46fe){const _0x2ab701=_0x164d4a;if(!this[_0x2ab701(0x1a1)][_0x2a46fe])throw new common_1[(_0x2ab701(0x1a4))](_0x2ab701(0x1d8),common_1['HttpStatus']['BAD_REQUEST']);const _0x44f7b3=await this[_0x2ab701(0x1de)][_0x2ab701(0x1c3)](_0x81dad1,_0x2a46fe);this[_0x2ab701(0x192)][_0x2a46fe]=_0x44f7b3['id'];}async[_0x164d4a(0x1d3)](_0x20bb14,_0x537248){const _0x4dd602=_0x164d4a;if(!this['sceneStrMap'][_0x537248])return;const _0xce6877=this[_0x4dd602(0x192)][_0x537248];if(!_0xce6877)return'';const _0x45c72e=await this[_0x4dd602(0x1de)]['getUserById'](_0xce6877);return delete this[_0x4dd602(0x192)][_0x537248],this['authService']['loginByOpenId'](_0x45c72e,_0x20bb14);}async['scanBindWx'](_0x32a60c,_0x5ba756){const _0x46ae97=_0x164d4a;if(!this[_0x46ae97(0x1a1)][_0x5ba756])throw new common_1[(_0x46ae97(0x1a4))](_0x46ae97(0x1d8),common_1[_0x46ae97(0x1ac)][_0x46ae97(0x1d5)]);const _0x1a35b2=_0x5ba756[_0x46ae97(0x198)]('/')[0x1],_0x2d7f79=await this['userService'][_0x46ae97(0x1b6)](_0x32a60c,_0x1a35b2);this[_0x46ae97(0x192)][_0x5ba756]=_0x2d7f79;}async[_0x164d4a(0x1d9)](_0x2c2fcf,_0xe01b7c){const _0x59f06c=_0x164d4a;if(!this[_0x59f06c(0x1a1)][_0xe01b7c])throw new common_1['HttpException'](_0x59f06c(0x1d8),common_1['HttpStatus']['BAD_REQUEST']);const {id:_0x528f42}=_0x2c2fcf[_0x59f06c(0x1b9)],_0x3e5026=this['scanedSceneStrMap'][_0xe01b7c];if(!_0x3e5026)return'';return delete this[_0x59f06c(0x192)][_0xe01b7c],_0x3e5026;}async[_0x164d4a(0x1d4)](_0xb65b04,_0x4a453c,_0x1cd79a){const _0x5a504b=_0x164d4a,_0x5a785b=await this['globalConfigService'][_0x5a504b(0x1a5)]([_0x5a504b(0x1b8)])||'jiangly';return await this[_0x5a504b(0x1c2)]([_0x5a785b,_0x4a453c,_0x1cd79a]['sort']()[_0x5a504b(0x19c)](''))==_0xb65b04;}[_0x164d4a(0x1c2)](_0x1531c5){const _0x58e63e=_0x164d4a;return crypto[_0x58e63e(0x1ad)]('sha1')[_0x58e63e(0x1c1)](_0x1531c5)[_0x58e63e(0x1b4)](_0x58e63e(0x1b0));}async[_0x164d4a(0x1d6)](_0x16afe0,_0x4bd30f){const _0x2314eb=_0x164d4a,_0x1318fe=await this[_0x2314eb(0x18c)]['getConfigs']([_0x4bd30f]);return this[_0x2314eb(0x1ba)](_0x16afe0,_0x1318fe);}async[_0x164d4a(0x1ba)](_0x3a8065,_0x425e2c){const _0x1f2606=_0x164d4a;return _0x1f2606(0x1b1)+_0x3a8065[_0x1f2606(0x18e)][0x0]+_0x1f2606(0x1c6)+_0x3a8065[_0x1f2606(0x1b3)][0x0]+']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>'+new Date()['getTime']()+_0x1f2606(0x1bc)+_0x425e2c+']]></Content>\x0a\x20\x20\x20\x20</xml>';}async[_0x164d4a(0x184)](_0x4f3161){const _0x40ada7=_0x164d4a;let _0x3bfdbb=await this['autoreplyService'][_0x40ada7(0x1a2)](_0x4f3161);if(!_0x3bfdbb){const _0x1c2787=await this['globalConfigService'][_0x40ada7(0x1a5)](['officialAutoReplyText']);_0x3bfdbb=_0x1c2787;}return _0x3bfdbb;}};OfficialService=__decorate([(0x0,common_1[_0x164d4a(0x1af)])(),__metadata('design:paramtypes',[autoreply_service_1['AutoreplyService'],user_service_1['UserService'],auth_service_1[_0x164d4a(0x1cf)],globalConfig_service_1[_0x164d4a(0x1ca)]])],OfficialService),exports[_0x164d4a(0x1cd)]=OfficialService;