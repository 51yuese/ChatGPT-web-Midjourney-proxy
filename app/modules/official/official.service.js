'use strict';const _0x37f37c=_0x319c;(function(_0x3264f8,_0x8f80eb){const _0x9d5b53=_0x319c,_0x4deaf4=_0x3264f8();while(!![]){try{const _0x1c2e11=-parseInt(_0x9d5b53(0x186))/0x1*(parseInt(_0x9d5b53(0x198))/0x2)+-parseInt(_0x9d5b53(0x19e))/0x3+-parseInt(_0x9d5b53(0x171))/0x4*(-parseInt(_0x9d5b53(0x162))/0x5)+-parseInt(_0x9d5b53(0x165))/0x6*(-parseInt(_0x9d5b53(0x174))/0x7)+-parseInt(_0x9d5b53(0x145))/0x8+-parseInt(_0x9d5b53(0x181))/0x9*(parseInt(_0x9d5b53(0x159))/0xa)+-parseInt(_0x9d5b53(0x16a))/0xb*(-parseInt(_0x9d5b53(0x144))/0xc);if(_0x1c2e11===_0x8f80eb)break;else _0x4deaf4['push'](_0x4deaf4['shift']());}catch(_0x13f3f1){_0x4deaf4['push'](_0x4deaf4['shift']());}}}(_0x545a,0x62260));var __decorate=this&&this[_0x37f37c(0x14f)]||function(_0xd7f84e,_0x20e57a,_0x4887ed,_0x1c5918){const _0xa6a808=_0x37f37c;var _0x5e0963=arguments[_0xa6a808(0x188)],_0x5358b0=_0x5e0963<0x3?_0x20e57a:_0x1c5918===null?_0x1c5918=Object[_0xa6a808(0x184)](_0x20e57a,_0x4887ed):_0x1c5918,_0x31397c;if(typeof Reflect===_0xa6a808(0x18f)&&typeof Reflect[_0xa6a808(0x16c)]===_0xa6a808(0x1ab))_0x5358b0=Reflect[_0xa6a808(0x16c)](_0xd7f84e,_0x20e57a,_0x4887ed,_0x1c5918);else{for(var _0x535f91=_0xd7f84e[_0xa6a808(0x188)]-0x1;_0x535f91>=0x0;_0x535f91--)if(_0x31397c=_0xd7f84e[_0x535f91])_0x5358b0=(_0x5e0963<0x3?_0x31397c(_0x5358b0):_0x5e0963>0x3?_0x31397c(_0x20e57a,_0x4887ed,_0x5358b0):_0x31397c(_0x20e57a,_0x4887ed))||_0x5358b0;}return _0x5e0963>0x3&&_0x5358b0&&Object[_0xa6a808(0x160)](_0x20e57a,_0x4887ed,_0x5358b0),_0x5358b0;},__metadata=this&&this[_0x37f37c(0x199)]||function(_0x572dd0,_0x236ec0){const _0x1bab8a=_0x37f37c;if(typeof Reflect===_0x1bab8a(0x18f)&&typeof Reflect[_0x1bab8a(0x1a9)]==='function')return Reflect[_0x1bab8a(0x1a9)](_0x572dd0,_0x236ec0);};Object[_0x37f37c(0x160)](exports,'__esModule',{'value':!![]}),exports['OfficialService']=void 0x0;const globalConfig_service_1=require(_0x37f37c(0x189)),auth_service_1=require('./../auth/auth.service'),user_service_1=require(_0x37f37c(0x179)),autoreply_service_1=require(_0x37f37c(0x16d)),common_1=require(_0x37f37c(0x153)),crypto=require(_0x37f37c(0x1a6)),axios_1=require(_0x37f37c(0x141)),utils_1=require('../../common/utils'),Login_vo_1=require(_0x37f37c(0x16e)),redisKey_constant_1=require(_0x37f37c(0x151)),redisCache_service_1=require(_0x37f37c(0x1a0));let OfficialService=class OfficialService{constructor(_0x14f94d,_0x592277,_0x40b443,_0x549540,_0x2d8717){const _0x5ccbea=_0x37f37c;this[_0x5ccbea(0x14c)]=_0x14f94d,this[_0x5ccbea(0x19c)]=_0x592277,this['authService']=_0x40b443,this[_0x5ccbea(0x13e)]=_0x549540,this[_0x5ccbea(0x15f)]=_0x2d8717,this['sceneStrMap']={},this[_0x5ccbea(0x176)]={};}async[_0x37f37c(0x13d)](){const _0x251f25=_0x37f37c;await this[_0x251f25(0x13e)][_0x251f25(0x17b)](!![]);}async[_0x37f37c(0x1a3)](_0x2e14c7){const _0x5c28a1=_0x37f37c,{invitedBy:_0x4bd522}=_0x2e14c7;let _0x15af12=(0x0,utils_1[_0x5c28a1(0x17d)])(0x20);return _0x4bd522&&(_0x15af12+=':'+_0x4bd522),this[_0x5c28a1(0x169)][_0x15af12]=!![],_0x15af12;}async[_0x37f37c(0x173)](_0xbbf075){const _0x45a215=_0x37f37c,{id:_0x22f42d}=_0xbbf075[_0x45a215(0x17f)],_0x1a9bd0=(0x0,utils_1[_0x45a215(0x17d)])(0x20)+'/'+_0x22f42d;return this[_0x45a215(0x169)][_0x1a9bd0]=!![],_0x1a9bd0;}async[_0x37f37c(0x166)](_0x62a4c5){const _0x355627=_0x37f37c;return this[_0x355627(0x18c)](_0x62a4c5);}async[_0x37f37c(0x195)](_0x508ff9){const _0x48b484=_0x37f37c,_0xf09b1d=await this[_0x48b484(0x13e)][_0x48b484(0x150)]([_0x48b484(0x18e)]),_0x4463f5=_0x48b484(0x172)+_0xf09b1d+_0x48b484(0x177)+encodeURIComponent(_0x508ff9)+_0x48b484(0x13b);return console['log']('回跳跳转地址:\x20',_0x4463f5),_0x4463f5;}async[_0x37f37c(0x13f)](_0x45afde){const _0x3db49c=_0x37f37c,_0xeaa771=(0x0,utils_1['createRandomNonceStr'])(0x20),_0x45430d=(Date[_0x3db49c(0x1aa)]()/0x3e8)[_0x3db49c(0x1a8)](0x0),_0x4d0dc=await this[_0x3db49c(0x13e)]['getConfigs']([_0x3db49c(0x182)]);console[_0x3db49c(0x1a2)](_0x3db49c(0x140),_0x4d0dc);const _0xccf59=await this[_0x3db49c(0x13e)][_0x3db49c(0x150)]([_0x3db49c(0x18e)]);console['log']('appId:\x20',_0xccf59);const _0x4a03e5=_0x3db49c(0x15a)+_0x4d0dc+_0x3db49c(0x191)+_0xeaa771+'&timestamp='+_0x45430d+_0x3db49c(0x170)+_0x45afde;console[_0x3db49c(0x1a2)](_0x3db49c(0x1a1),_0x4a03e5);const _0x5836ea=this[_0x3db49c(0x194)](_0x4a03e5);return{'appId':_0xccf59,'nonceStr':_0xeaa771,'timestamp':_0x45430d,'signature':_0x5836ea};}async[_0x37f37c(0x18c)](_0x1ee2b9){const _0x2fa182=_0x37f37c,_0x4ba8cb=await this[_0x2fa182(0x13e)][_0x2fa182(0x150)]([_0x2fa182(0x14e)]),_0x2daecd={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x1ee2b9}}},_0x4b2165=await axios_1['default'][_0x2fa182(0x19a)](_0x2fa182(0x17c)+_0x4ba8cb,_0x2daecd),{data:{errmsg:_0x498ad0,ticket:_0x5c27f4}}=_0x4b2165;if(_0x498ad0)throw new common_1[(_0x2fa182(0x18b))](_0x498ad0,common_1[_0x2fa182(0x156)]['BAD_REQUEST']);return _0x5c27f4;}async[_0x37f37c(0x147)](_0x17333d,_0x4cc165){const _0x41aab4=_0x37f37c,_0x582980=await this['globalConfigService'][_0x41aab4(0x150)]([_0x41aab4(0x18e)]),_0xebb7bd=await this[_0x41aab4(0x13e)][_0x41aab4(0x150)]([_0x41aab4(0x15c)]),_0x536890=await axios_1[_0x41aab4(0x19d)][_0x41aab4(0x19f)](_0x41aab4(0x187)+_0x582980+_0x41aab4(0x18d)+_0xebb7bd+_0x41aab4(0x168)+_0x4cc165+_0x41aab4(0x15d)),{data:{errmsg:_0x3a11fa,openid:_0x5e1584}}=_0x536890;if(_0x3a11fa)throw new common_1[(_0x41aab4(0x18b))](_0x3a11fa,common_1[_0x41aab4(0x156)][_0x41aab4(0x16f)]);let _0x426494,_0xe9ce2b=new Login_vo_1[(_0x41aab4(0x183))]();return _0xe9ce2b[_0x41aab4(0x197)]=_0x5e1584,_0x426494=await this['userService'][_0x41aab4(0x163)](_0x5e1584),_0x426494&&(_0xe9ce2b[_0x41aab4(0x161)]=await this[_0x41aab4(0x155)][_0x41aab4(0x193)](_0x426494,_0x17333d)),_0xe9ce2b;}async['scan'](_0x1e44c8,_0x159c41){const _0x1a2f11=_0x37f37c;if(!this[_0x1a2f11(0x169)][_0x159c41])throw new common_1[(_0x1a2f11(0x18b))](_0x1a2f11(0x158),common_1[_0x1a2f11(0x156)][_0x1a2f11(0x16f)]);this[_0x1a2f11(0x176)][_0x159c41]=_0x1e44c8;}async[_0x37f37c(0x152)](_0x32e512,_0x580593){const _0x1f1b66=_0x37f37c;if(!this[_0x1f1b66(0x169)][_0x580593])return;const _0x24c920=this['scanedSceneStrMap'][_0x580593];if(!_0x24c920)return new Login_vo_1[(_0x1f1b66(0x183))]();let _0x32c336,_0x2fe33c=new Login_vo_1[(_0x1f1b66(0x183))]();return _0x2fe33c[_0x1f1b66(0x197)]=_0x24c920,_0x32c336=await this[_0x1f1b66(0x19c)][_0x1f1b66(0x163)](_0x24c920),_0x32c336&&(_0x2fe33c[_0x1f1b66(0x161)]=await this[_0x1f1b66(0x155)]['getJwtToken'](_0x32c336,_0x32e512)),delete this[_0x1f1b66(0x176)][_0x580593],_0x2fe33c;}async[_0x37f37c(0x185)](_0x13032a,_0x9cb3c8){const _0x37b408=_0x37f37c;if(!this[_0x37b408(0x169)][_0x9cb3c8])throw new common_1[(_0x37b408(0x18b))]('非法参数',common_1[_0x37b408(0x156)]['BAD_REQUEST']);const _0x2e2b54=_0x9cb3c8[_0x37b408(0x1a5)]('/')[0x1],_0x20ab99=await this['userService']['bindWx'](_0x13032a,_0x2e2b54);this[_0x37b408(0x176)][_0x9cb3c8]=_0x20ab99;}async[_0x37f37c(0x175)](_0x555ded,_0xd819b){const _0x8c59ef=_0x37f37c;if(!this[_0x8c59ef(0x169)][_0xd819b])throw new common_1['HttpException'](_0x8c59ef(0x158),common_1[_0x8c59ef(0x156)][_0x8c59ef(0x16f)]);const {id:_0x5513f7}=_0x555ded['user'],_0x440471=this[_0x8c59ef(0x176)][_0xd819b];if(!_0x440471)return'';return delete this['scanedSceneStrMap'][_0xd819b],_0x440471;}async[_0x37f37c(0x13a)](_0x12ca89,_0x13bdbc,_0x587f4b){const _0x3fe047=_0x37f37c,_0x2ef853=await this['globalConfigService']['getConfigs'](['wechatOfficialToken'])||_0x3fe047(0x143);return await this[_0x3fe047(0x194)]([_0x2ef853,_0x13bdbc,_0x587f4b][_0x3fe047(0x178)]()[_0x3fe047(0x157)](''))==_0x12ca89;}['sha1'](_0x1efd27){const _0x3706cf=_0x37f37c;return crypto['createHash']('sha1')[_0x3706cf(0x14a)](_0x1efd27)[_0x3706cf(0x146)](_0x3706cf(0x15e));}async['genXmlMsgByConfig'](_0x33e656,_0x5735c6){const _0x2f73e4=_0x37f37c,_0x22a638=await this['globalConfigService'][_0x2f73e4(0x150)]([_0x5735c6]);return this[_0x2f73e4(0x149)](_0x33e656,_0x22a638);}async[_0x37f37c(0x149)](_0x323342,_0x586664){const _0x54ecf3=_0x37f37c;return _0x54ecf3(0x13c)+_0x323342[_0x54ecf3(0x18a)][0x0]+_0x54ecf3(0x14d)+_0x323342['tousername'][0x0]+_0x54ecf3(0x164)+new Date()[_0x54ecf3(0x1a7)]()+_0x54ecf3(0x142)+_0x586664+_0x54ecf3(0x180);}async[_0x37f37c(0x17e)](_0x4a78d8){const _0x51d234=_0x37f37c;let _0x851d6b=await this[_0x51d234(0x14c)][_0x51d234(0x17a)](_0x4a78d8);if(!_0x851d6b){const _0x47ac57=await this[_0x51d234(0x13e)][_0x51d234(0x150)]([_0x51d234(0x192)]);_0x851d6b=_0x47ac57;}return _0x851d6b;}async[_0x37f37c(0x15b)](_0x3f78a9,_0x24f2c6){const _0x4b6784=_0x37f37c;console[_0x4b6784(0x1a2)](_0x3f78a9['ip']);if(_0x24f2c6===_0x4b6784(0x167)){const _0x16f9de=await this[_0x4b6784(0x13e)][_0x4b6784(0x150)]([_0x4b6784(0x14e)]);return _0x16f9de;}else{if(_0x24f2c6===_0x4b6784(0x19b)){const _0x43c897=await this[_0x4b6784(0x15f)][_0x4b6784(0x19f)]({'key':redisKey_constant_1[_0x4b6784(0x14b)]});return _0x43c897;}else throw new common_1['HttpException'](null,common_1[_0x4b6784(0x156)][_0x4b6784(0x16f)]);}}};OfficialService=__decorate([(0x0,common_1[_0x37f37c(0x190)])(),__metadata(_0x37f37c(0x1a4),[autoreply_service_1[_0x37f37c(0x196)],user_service_1[_0x37f37c(0x148)],auth_service_1[_0x37f37c(0x16b)],globalConfig_service_1['GlobalConfigService'],redisCache_service_1[_0x37f37c(0x154)]])],OfficialService),exports['OfficialService']=OfficialService;function _0x319c(_0x52645e,_0x2206bf){const _0x545aa8=_0x545a();return _0x319c=function(_0x319c74,_0x3b2c5b){_0x319c74=_0x319c74-0x13a;let _0x3c8f4f=_0x545aa8[_0x319c74];return _0x3c8f4f;},_0x319c(_0x52645e,_0x2206bf);}function _0x545a(){const _0x1c67e5=[']]></Content>\x0a\x20\x20\x20\x20</xml>','9gfkapS','wechatJsapiTicket','OfficialLoginVO','getOwnPropertyDescriptor','scanBindWx','1BNFjQo','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','length','./../globalConfig/globalConfig.service','fromusername','HttpException','fetchQRCodeTicket','&secret=','wechatOfficialAppId','object','Injectable','&noncestr=','officialAutoReplyText','getJwtToken','sha1','getRedirectUrl','AutoreplyService','openId','1457674BBGFwL','__metadata','post','mini','userService','default','138825IoIGgY','get','../redisCache/redisCache.service','str:\x20','log','getQRSceneStr','design:paramtypes','split','crypto','getTime','toFixed','metadata','now','function','verify','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','onModuleInit','globalConfigService','getJsapiTicket','jsapiTicket:\x20','axios','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','jiangly','4212tnUJQt','4977760rZWhWw','digest','loginByCode','UserService','genXmlMsg','update','WE_MINI_ACCESS_KEY','autoreplyService',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','wechatAccessToken','__decorate','getConfigs','../../common/constants/redisKey.constant','loginBySceneStr','@nestjs/common','RedisCacheService','authService','HttpStatus','join','非法参数','7068970zFGygn','jsapi_ticket=','getAccessToken','wechatOfficialAppSecret','&grant_type=authorization_code','hex','redisCacheService','defineProperty','authToken','50ZuOreH','getUserOpenId',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','4314umReqe','getQRCodeTicket','official','&code=','sceneStrMap','58179VzAQyr','AuthService','decorate','./../autoreply/autoreply.service','./vo/Login.vo','BAD_REQUEST','&url=','169616jLTLUr','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','getQRSceneStrByBind','2198jShEHe','bindWxBySceneStr','scanedSceneStrMap','&redirect_uri=','sort','./../user/user.service','checkAutoReply','getWechatAccessToken','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','createRandomNonceStr','aotoPlay','user'];_0x545a=function(){return _0x1c67e5;};return _0x545a();}