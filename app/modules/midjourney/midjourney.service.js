'use strict';const _0x12df21=_0xe190;(function(_0x3642ed,_0x1ae307){const _0x3c5605=_0xe190,_0x4246ff=_0x3642ed();while(!![]){try{const _0x791b2a=-parseInt(_0x3c5605(0x2b3))/0x1+-parseInt(_0x3c5605(0x12d))/0x2*(parseInt(_0x3c5605(0x180))/0x3)+parseInt(_0x3c5605(0x18e))/0x4*(parseInt(_0x3c5605(0x29a))/0x5)+parseInt(_0x3c5605(0x124))/0x6+parseInt(_0x3c5605(0x1e5))/0x7*(parseInt(_0x3c5605(0x1a4))/0x8)+-parseInt(_0x3c5605(0x254))/0x9*(-parseInt(_0x3c5605(0x21b))/0xa)+-parseInt(_0x3c5605(0x18f))/0xb*(parseInt(_0x3c5605(0x29f))/0xc);if(_0x791b2a===_0x1ae307)break;else _0x4246ff['push'](_0x4246ff['shift']());}catch(_0x7bcd54){_0x4246ff['push'](_0x4246ff['shift']());}}}(_0x1e97,0x6e363));var __decorate=this&&this['__decorate']||function(_0xf64035,_0x2e1a0d,_0x13ddcc,_0x4e33d6){const _0x441d9a=_0xe190;var _0x3605d0=arguments[_0x441d9a(0x126)],_0x1e95db=_0x3605d0<0x3?_0x2e1a0d:_0x4e33d6===null?_0x4e33d6=Object['getOwnPropertyDescriptor'](_0x2e1a0d,_0x13ddcc):_0x4e33d6,_0x4ca8a4;if(typeof Reflect===_0x441d9a(0x2a8)&&typeof Reflect[_0x441d9a(0x289)]==='function')_0x1e95db=Reflect[_0x441d9a(0x289)](_0xf64035,_0x2e1a0d,_0x13ddcc,_0x4e33d6);else{for(var _0x546235=_0xf64035[_0x441d9a(0x126)]-0x1;_0x546235>=0x0;_0x546235--)if(_0x4ca8a4=_0xf64035[_0x546235])_0x1e95db=(_0x3605d0<0x3?_0x4ca8a4(_0x1e95db):_0x3605d0>0x3?_0x4ca8a4(_0x2e1a0d,_0x13ddcc,_0x1e95db):_0x4ca8a4(_0x2e1a0d,_0x13ddcc))||_0x1e95db;}return _0x3605d0>0x3&&_0x1e95db&&Object[_0x441d9a(0x1a9)](_0x2e1a0d,_0x13ddcc,_0x1e95db),_0x1e95db;},__metadata=this&&this[_0x12df21(0x2ec)]||function(_0x25fa76,_0x41c989){const _0x5e812f=_0x12df21;if(typeof Reflect===_0x5e812f(0x2a8)&&typeof Reflect['metadata']===_0x5e812f(0x2ca))return Reflect[_0x5e812f(0x214)](_0x25fa76,_0x41c989);},__param=this&&this[_0x12df21(0x1e1)]||function(_0x27fc8b,_0x1b731c){return function(_0x1548fb,_0x9ac674){_0x1b731c(_0x1548fb,_0x9ac674,_0x27fc8b);};};function _0xe190(_0x2f0290,_0x837c7f){const _0x1e97a4=_0x1e97();return _0xe190=function(_0xe190d4,_0xab162e){_0xe190d4=_0xe190d4-0xf5;let _0x59ec75=_0x1e97a4[_0xe190d4];return _0x59ec75;},_0xe190(_0x2f0290,_0x837c7f);}Object[_0x12df21(0x1a9)](exports,_0x12df21(0x29c),{'value':!![]}),exports['MidjourneyService']=void 0x0;function _0x1e97(){const _0x4a0d2d=['1277868JZtvot','2200OinrZH','label','name','runMjDescribeTask','heartbeatTask','getMjIncantationClassify','cos','put','当前图片不存在！','上传文件失败...','deductFromBalance','RedisCacheService','connected','setting','attachments','UserBalanceService','摄影拍照','socket-open','socket断开成功','flags','guildId','815032SOJIpA','上传文件失败...,\x20\x20no\x20attachment','syncMjpAccountAutomatic','创建图混图任务失败','../../common/constants/relate.contant','defineProperty','replace','Not','Modal\x20状态\x20手动同步任务信息','配置不存图片','/api/mj/setting_get','操作失败！','HttpException','listByCondition','save','default','runMjActionTask','TEXT_TO_IMAGE','getSettingInfo','FaceSwap','./mjSuggestWord.entity','polling','transaction','推荐关键词不存在','syncInfo','同步信息失败！','handleUpdateMjSetting','runAction','findBy','MID_JOURNEY','getTime','Imagine\x20all','headers','message','queryMjIncantationByClassify','hideString','action\x20MESSAGE_UPDATE','Like','Connection','socketWs','concat','mjpId','result','mjInspireClassifyEntity','code','openaiBaseUrl','setMjAccountEnable','getAdminDrawList','不走代理','个任务','商拍摄影','getDetailByIds','progress','queryTopMjIncantationClassify','cancel','./dto/addDrawQueue.dto','error','\x20--cw\x20','/api/mj/setting','initSocket','startTime','__param','Custom\x20Zoom','queryMjIncantationClassify','初始化灵感广场分类成功','35jwSRHB','gomaxai','IMAGE_TO_TEXT','badwordsService','初始化灵感广场分类失败','getAgreeByRelateId','GlobalConfigService','upload_url','parse','mjDraw','version','../../core/midjourney','finally\x20remixSubmit','close','HttpStatus','removeMjAccount','base64','queryMjAccountList','getConfigs','image/png','connection','createRandomId','绘画制作','runImageJobByProxy','content','findOneBy','保存到redis','configVal','buttons','是否翻译\x20','addMjInspireClassify','MjIncantationClassifyEntity','走保存','createdAt','setPrompt','varyRegion','recDraw','getAccountInfo','addMjIncantationClassify','blend','messageFlags','UserService','未指定','mjSuggestWordEntity','active','mjSocketProxyUrl','mjVersion','metadata','ali','del','账号信息配置不存在！','AiLogService','toLowerCase','DRAWED','10mFoORe','删除记录失败！','mjpTaskService','email','changeVersion','data:image/png;base64,','执行图生文任务失败，attachments\x20参数为空','save\x20db\x20drawInfo\x20','relaxedUsage','UserEntity','midJourney','getMjInspireClassify','getModelProxyUrl','MoreThan','totalTime','图混图上传图片完成','queryMjIncantationAll','形象设计','/api/attachment','.md.png','visitNum','syncMjpTask','socket.active','getDrawList','艺术设计','./mjInspireClassify.entity','syncTaskInfo','getMjDefaultParams','socket已连接，不需要重连','MESSAGE_CREATE','saveToRedis','/api/mj/blend','无绘图记录','connect','wsBaseUrl','updateAllUnfinishedTaskStatus','要使用MJ绘画功能，至少需要配置一个MJ账号,并且启用该账号','get','isSaveImg','查询失败！','MjPromptsEntity','不需要灵感广场分类','DESC','round','查询推荐关键词失败','extraParam','BAD_REQUEST','setAttachment','runMjBlendTask\x20type,\x20runMjBlendTaskmsg\x20','filter','increaseVisit','美女形象','@nestjs/common','runVaryRegionDrawJob','value','count','describe','2006217DObSLg','now','队列已满，请稍后尝试','findAndCount','runMjDescribeProxy','forEach','MjpStateMap','自动同步账号信息失败：','MidjourneyService','map','updateDrawStatus','/h/','保存推荐关键词','当前图片已经执行过相同指令！','MJ\x20通知内容：','channelId','unauthorized','MjSuggestWordEntity','finally','imagine|variation|outpaint|pan|blend|inpaint|picreader|reroll','stringify','FAST','subscribePlan','绘制中的图片任务、禁止删除！','renewDate','上传文件失败...,\x20\x20upload\x20message\x20fail','handleGetIsRemix','创建图生文任务失败','oss','cleanQueue','isGroup','../mjp/mjpTask.service','syncMjpAccount','env','resolve','cosUrl','handleSubmitRemix','mjPromptsEntity','setImageFavorite','addMjIncantation','REGION_ACTION','MESSAGE_UPDATE','createRandomUid','头像制作','getSyncAccountInfo','delPrompt','壁纸绘画','../mjp/mjpAccount.service','未查询到咒语一级分类','region','enable','fileInfo','orderPlan','decorate','userId','timestamp','SUCCESS','fastTimeRemaining','?x-oss-process=image/resize,w_','relax','DrawSpeed','botType','getMjAccount','mjModel','getRandomItemFromArray','runImageMixImageJob','当前管理员限制单用户同时最多能执行','../redisCache/redisCache.service','userEntity','isChinese','5AipLEM','drawFailed','__esModule','Subscription','removeMjIncantation','20184rUnTMa','IsNull','initMidJourney','IMAGE_TO_TEXT_ACTION','remix','imageSeed','emoji','MidjourneySdk','MODAL','object','任务不存在！','INTERACTION_MODAL_CREATE','syncMjpAccountManual','api','MidjourneyActionEnum','classifyName','https://discord.com','checkBadWords','socket.connected','split','247765RjzTsd','fetch','imagine','lock','Modal已处理，无需更新','initInspireData','查询咒语分类失败','affected','Mj\x20Modal\x20通知','MidJourneyDrawEnum','convertMode4Transfer','../fanyi/fanyi.service','MjParamEntity','notify','then','无可用MJ账号，请后台添加或启用MJ账号','mjpTaskId','username','formatCreateOrUpdateDate','账户不存在','任务类型错误','mjTaskUpdateJob:\x20','mjNotSaveImg','function','chevereto','------>\x20开始上传图片！！！','\x20--sw\x20','extend','syncMjAccount','wss://gateway.discord.gg/?encoding=json&v=9','删除成功！','mjProxy','runMjDescribeTask\x20type,\x20msg\x20','components','info','/api/mj/describe','isVaryImage','mjIncantationClassifyEntity','prompt包含敏感词','ELogRelateType','type,\x20msg\x20','response\x20result','data','/api/mj/region_redraw','fullPrompt','mjParamEntity','region\x20proxy\x20line','../globalConfig/globalConfig.service','find','checkLimit','apiBaseUrl','MjIncantationEntity','midjourneyEntity','account','/api/pipe?url=','design:paramtypes','checkUserStatus','__metadata','initHasAccount','delLog','TODO->error:\x20','uploadService','getAccountInfoByProxy','INTERACTION_SUCCESS','查询灵感分类失败','redisCacheService','Repository','update','socketUrl','runImageToTextJob','../../common/utils/createRandomId','pid','fast','formatFileInfo','findOne','uploadByProxy','typeorm','runActionJobByProxy','fanyiService','agreeNum','jobIds','添加绘图任务失败','RELAX','Relaxed\x20Usage','catch\x20runMjRegionTask\x20error\x20','\x20--iw\x20','jobId','description','https://discord.com/api/v9/channels/','../user/user.service','DESCRIBE','status','Lifetime\x20Usage','mjIncantationEntity','PRO','getOneDraw','runGetSettingByProxy','mjProxyImgUrl','runMjBlendProxy','push','mjProxyUrl','InjectRepository','UploadService','../badwords/badwords.service','非法操作！','originPrompt','IMAGE_ACTION','delete','aiLogService','删除推荐关键词失败','copyAccountInfo','DRAWING','reject','getRandomKey','timeout','../../common/constants/redisKey.constant','updateSettingByProxy','推荐关键词已存在，不可重复添加','modal','trim','账号不存在','../../config/MjConfig','$1****$2','runImageJob','hasAccount','rec','mjpAccountService','addDrawQueue','\x20--sref\x20','@nestjs/typeorm','distributeAccount','remixSubmit','post','saveSuggestWords','动漫漫画','getList','queryAllPrompt','addMjAccount','initMj','includes','执行图混图','versionSelector','4930950OdHyHQ','axios','length','upsample|upscale|describe|picread::retry|faceSwap|shorten','TODO->存储图片失败','url','onModuleInit','Logger','durationSpent','3708zHtAKh','MjInspireClassifyEntity','relax_mjDeduction','BadwordsService','https://api.openai.com','favorite','deleteDraw','模式账号，请前往后台配置！','runMjRegionTask','authorization','refundMjBalance','getUploadType','application/json','catch','Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_15_7)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/112.0.0.0\x20Safari/537.36','jsonwebtoken','role','runMjBlendTask\x20finalResult','swap','getMjIncantation','MidjourneyStatusEnum','calcCost','Injectable','走到解析','style','图混图代理执行','level','buffer','../../common/utils','log','assign','reconnectionTask','本次图片上传耗时为','图混图上传图片','embed','convertToEnglish','response\x20cosUrl','userBalanceService','./mjIncantationClassify.entity','提交图片:\x20','fastRemainTime','incantationCn','squareType','super','exist','queryPromptByPage','nickname','modifyMjAccount','originalname','./midjourney.entity','上传文件失败...,\x20\x20upload\x20fail','名称不能重复','uploadImage','modifyMjInspireClassify','modifyMjIncantationClassify','updateDrawData','userInfo','queryMjInspireClassify','globalConfigService','删除失败！','IMAGE_MIX_IMAGE','getRegionInfoByProxy','prompt','Fast\x20Time\x20Remaining','imageUrl','insightFace','test','turbo','error:\x20','JWT_SECRET','mjNotSaveImg:\x20','finishTime','transferImg','翻译后的\x20','按钮操作','tencent','分页参数错误','type','validateBalance','userService','join','socketClient','https://cdn.discordapp.com','1356jeFoje','set','user','mode','lifetimeUsage','checkIsActionDone','action','查询咒语失败','../../common/constants/midjourney.constant','avatar','failReason','toString','DRAWFAIL','绘制的任务不存在！'];_0x1e97=function(){return _0x4a0d2d;};return _0x1e97();}const user_entity_1=require('./../user/user.entity'),common_1=require(_0x12df21(0x24f)),typeorm_1=require(_0x12df21(0x117)),midjourney_entity_1=require(_0x12df21(0x15e)),typeorm_2=require(_0x12df21(0x2ff)),axios_1=require(_0x12df21(0x125)),globalConfig_service_1=require(_0x12df21(0x2e2)),midjourney_constant_1=require(_0x12df21(0x188)),upload_service_1=require('../upload/upload.service'),badwords_service_1=require(_0x12df21(0xfd)),userBalance_service_1=require('../userBalance/userBalance.service'),utils_1=require(_0x12df21(0x149)),mjPrompts_entity_1=require('./mjPrompts.entity'),mjParam_entity_1=require('./mjParam.entity'),mjIncantationClassify_entity_1=require(_0x12df21(0x153)),mjInspireClassify_entity_1=require(_0x12df21(0x234)),mjIncantation_entity_1=require('./mjIncantation.entity'),createRandomId_1=require(_0x12df21(0x2f9)),fanyi_service_1=require(_0x12df21(0x2be)),mjSuggestWord_entity_1=require(_0x12df21(0x1b8)),user_service_1=require(_0x12df21(0x30c)),midjourney_1=require(_0x12df21(0x1f0)),redisCache_service_1=require(_0x12df21(0x297)),socket_io_client_1=require('socket.io-client'),mjpAccount_service_1=require(_0x12df21(0x283)),mjpTask_service_1=require(_0x12df21(0x273)),addDrawQueue_dto_1=require(_0x12df21(0x1db)),MjConfig_1=require(_0x12df21(0x10f)),redisKey_constant_1=require(_0x12df21(0x109)),aiLog_service_1=require('../aiLog/aiLog.service'),relate_contant_1=require(_0x12df21(0x1a8)),jwt=require(_0x12df21(0x13c));let MidjourneyService=class MidjourneyService{constructor(_0x3d9f98,_0x4f59b0,_0x3a555c,_0x3d5596,_0x66824,_0x2c6662,_0x146186,_0x59b174,_0x1f5340,_0x475483,_0x3b0118,_0x482e7a,_0x1d6c9f,_0xc219db,_0x4c0d64,_0xd32205,_0x8a48ce,_0x1b2fb9,_0x17cb63){const _0x413037=_0x12df21;this['midjourneyEntity']=_0x3d9f98,this['userEntity']=_0x4f59b0,this[_0x413037(0x279)]=_0x3a555c,this['mjParamEntity']=_0x3d5596,this[_0x413037(0x2d8)]=_0x66824,this[_0x413037(0x1cf)]=_0x2c6662,this[_0x413037(0x210)]=_0x146186,this[_0x413037(0x310)]=_0x59b174,this['globalConfigService']=_0x1f5340,this[_0x413037(0x2f0)]=_0x475483,this['badwordsService']=_0x3b0118,this[_0x413037(0x152)]=_0x482e7a,this[_0x413037(0x301)]=_0x1d6c9f,this['userService']=_0xc219db,this[_0x413037(0x2f4)]=_0x4c0d64,this[_0x413037(0x114)]=_0xd32205,this['mjpTaskService']=_0x8a48ce,this[_0x413037(0x102)]=_0x1b2fb9,this[_0x413037(0x1f9)]=_0x17cb63,this[_0x413037(0x23d)]=_0x413037(0x2d0),this['apiBaseUrl']=_0x413037(0x2af),this[_0x413037(0x225)]={},this[_0x413037(0x193)]=null,this['reconnectionTask']=null,this[_0x413037(0x280)]=async _0x49518f=>{const _0x4c3908=_0x413037,{authorization:_0x183cbe,guildId:_0x399126,channelId:_0x45cf20,mode:_0x35a721}=_0x49518f,_0x45c73c=this[_0x4c3908(0x23d)],_0x5a9ae7=this[_0x4c3908(0x2e5)];!this[_0x4c3908(0x225)][_0x35a721]&&await this[_0x4c3908(0x2a1)]({'channel_id':_0x45cf20,'guild_id':_0x399126,'token':_0x183cbe,'wsBaseUrl':_0x45c73c,'apiBaseUrl':_0x5a9ae7},_0x35a721);const _0x17e1d2=await this[_0x4c3908(0x20a)](_0x35a721),_0x3e90e0=await this[_0x4c3908(0x1b6)](_0x35a721),_0x2e69f6=_0x17e1d2[_0x4c3908(0x14f)][_0x4c3908(0x30a)],_0x404b11=_0x2e69f6[_0x4c3908(0x2b2)]('\x0a')[_0x4c3908(0x24c)](_0xd0700f=>_0xd0700f)['map'](_0x100755=>_0x100755['replace'](/\*/g,''));let _0x46b471={};_0x404b11[_0x4c3908(0x259)](_0x6c127e=>{const _0x4fb152=_0x6c127e['split'](':');!_0x46b471[_0x4fb152[0x0]]&&(_0x46b471[_0x4fb152[0x0]]=_0x4fb152[0x1]);});const _0x3c5cba=_0x46b471[_0x4c3908(0x16c)]||'',_0x44df5a=_0x46b471[_0x4c3908(0x30f)]||'',_0x58d6b8=_0x46b471[_0x4c3908(0x306)]||'',_0x3fa3d7=_0x46b471[_0x4c3908(0x29d)]||'',_0x24af95=_0x3fa3d7?.[_0x4c3908(0x2b2)]('\x20')[0x0]==='Standard'?0x1:0x2;return{'settingInfo':_0x3e90e0,'fastRemainTime':_0x3c5cba,'lifetimeUsage':_0x44df5a,'relaxedUsage':_0x58d6b8,'orderPlan':_0x24af95,'subscription':_0x3fa3d7,'info':_0x2e69f6};};}async[_0x12df21(0x12a)](){const _0x45f4b6=_0x12df21;await this['initInspireData'](),await this[_0x45f4b6(0x2ed)](),await this[_0x45f4b6(0x23e)]();}async['initSocket'](_0x478dc3){const _0x270002=_0x12df21;if(!this[_0x270002(0x17e)]||!this['socketClient']['active']){const _0x5032d3=_0x478dc3||'';common_1[_0x270002(0x12b)][_0x270002(0x14a)](_0x5032d3,_0x270002(0x2f7));if(!_0x5032d3)throw new common_1[(_0x270002(0x1b0))]('socket协议地址错误',common_1['HttpStatus'][_0x270002(0x249)]);return common_1['Logger'][_0x270002(0x14a)](_0x5032d3,_0x270002(0x1cb)),this[_0x270002(0x17e)]=(0x0,socket_io_client_1['io'])(_0x5032d3,{'transports':[_0x270002(0x1b9),'websocket'],'reconnection':!![],'autoConnect':!![],'query':{'token':_0x270002(0x1e6)}}),this[_0x270002(0x17e)]['on'](_0x270002(0x264),_0x61a899=>{const _0xcb0ddb=_0x270002;console[_0xcb0ddb(0x14a)](_0x61a899);}),this[_0x270002(0x17e)]['on']('open',_0x3fc2d5=>{const _0x52f638=_0x270002;console['log'](_0x52f638(0x1a0)),_0x3fc2d5['emit'](_0x52f638(0x1a0)),this['reconnectionTask']&&(clearTimeout(this[_0x52f638(0x14c)]),this['reconnectionTask']=null);}),this[_0x270002(0x17e)]['on'](_0x270002(0x1f2),()=>{const _0x181d0c=_0x270002;console[_0x181d0c(0x14a)](_0x181d0c(0x1f2)),this[_0x181d0c(0x14c)]=setTimeout(()=>{const _0xf73b13=_0x181d0c;this[_0xf73b13(0x193)]&&typeof this[_0xf73b13(0x193)]==='number'&&(clearInterval(this['heartbeatTask']),this['heartbeatTask']=null),this[_0xf73b13(0x17e)]=this[_0xf73b13(0x1df)]['call'](this);},0xfa0);}),this[_0x270002(0x17e)]['on'](_0x270002(0x23c),async()=>{const _0x229fb4=_0x270002;common_1[_0x229fb4(0x12b)][_0x229fb4(0x14a)]('socket连接成功');}),this['socketClient']['on']('disconnect',async(_0x3f8e5c,_0xdc3338)=>{const _0x4e5010=_0x270002;console['log'](_0x3f8e5c,_0xdc3338),common_1[_0x4e5010(0x12b)][_0x4e5010(0x14a)](_0x4e5010(0x1a1));}),this['socketClient'];}return common_1[_0x270002(0x12b)]['log'](_0x270002(0x237)),this['socketClient'];}async[_0x12df21(0x2ed)](){const _0x25b162=_0x12df21,_0x1fc613=await this[_0x25b162(0x2e0)][_0x25b162(0x252)]({'where':{'enable':0x1},'order':{'weight':_0x25b162(0x245)}});_0x1fc613===0x0&&common_1['Logger'][_0x25b162(0x1dc)](_0x25b162(0x23f));}async[_0x12df21(0x2b8)](){const _0x321c31=_0x12df21,_0x53084a=await this[_0x321c31(0x1cf)][_0x321c31(0x252)]();if(_0x53084a===0x0){const _0x19c7d7=[{'name':_0x321c31(0x1fb),'value':0x1},{'name':_0x321c31(0x19f),'value':0x2},{'name':_0x321c31(0x27f),'value':0x3},{'name':_0x321c31(0x24e),'value':0x4},{'name':_0x321c31(0x11c),'value':0x5},{'name':_0x321c31(0x282),'value':0x6},{'name':_0x321c31(0x233),'value':0x7},{'name':_0x321c31(0x1d6),'value':0x8},{'name':_0x321c31(0x22c),'value':0x9},{'name':'精选分享','value':0xa}][_0x321c31(0x25d)](_0x4d3e93=>{const _0x3108f2=_0x321c31;return{'name':_0x4d3e93[_0x3108f2(0x191)],'value':_0x4d3e93[_0x3108f2(0x251)]+'','inner':0x1};});await this['mjInspireClassifyEntity'][_0x321c31(0x1b2)](_0x19c7d7)[_0x321c31(0x13a)](_0x18a0a3=>{const _0x5d1699=_0x321c31;common_1[_0x5d1699(0x12b)][_0x5d1699(0x1dc)](_0x5d1699(0x1e9));}),common_1[_0x321c31(0x12b)][_0x321c31(0x14a)](_0x321c31(0x1e4));}common_1[_0x321c31(0x12b)][_0x321c31(0x14a)](_0x321c31(0x244));}async[_0x12df21(0x23e)](){const _0x559816=_0x12df21,_0x575003=await this[_0x559816(0x2e7)]['find']({'where':{'status':(0x0,typeorm_2['In'])([midjourney_constant_1['MidjourneyStatusEnum'][_0x559816(0x105)]])}})[_0x559816(0x2c1)](_0x36e672=>_0x36e672['filter'](_0x4482bc=>Date['now']()-_0x4482bc['createdAt'][_0x559816(0x1c2)]()>0x5*0x3c*0x3e8))[_0x559816(0x2c1)](_0x1d12b9=>_0x1d12b9['map'](_0x3b3ab5=>_0x3b3ab5['id']))[_0x559816(0x13a)](_0x3069fd=>{const _0x4ae5df=_0x559816;common_1['Logger'][_0x4ae5df(0x1dc)](_0x3069fd);});if(!_0x575003||_0x575003['length']===0x0)return;await this['midjourneyEntity'][_0x559816(0x2f6)](_0x575003,{'status':midjourney_constant_1[_0x559816(0x141)][_0x559816(0x18c)]})['then'](_0x567067=>_0x567067[_0x559816(0x2ba)]>0x0)[_0x559816(0x13a)](_0x4c82bc=>{const _0xfe56d=_0x559816;common_1[_0xfe56d(0x12b)][_0xfe56d(0x1dc)](_0x4c82bc);});}async[_0x12df21(0x120)](_0x346207){const _0xd05546=_0x12df21,_0x1ac18c=this['wsBaseUrl'],_0x5b6c36=this['apiBaseUrl'];if(!this[_0xd05546(0x225)][_0x346207]){const {guild_id:_0x43bf57,channel_id:_0x5c6770,authorization:_0x150f72}=await this[_0xd05546(0x236)](_0x346207)[_0xd05546(0x13a)](_0x1a8af7=>{const _0x376394=_0xd05546;return Promise[_0x376394(0x106)](_0x1a8af7);});return await this[_0xd05546(0x2a1)]({'channel_id':_0x5c6770,'guild_id':_0x43bf57,'token':_0x150f72,'wsBaseUrl':_0x1ac18c,'apiBaseUrl':_0x5b6c36},_0x346207),!![];}return!![];}async[_0x12df21(0x2a1)](_0x248236,_0x4d8b08){const _0xb6ffd7=_0x12df21,{token:_0xd942d1,channel_id:_0x2a0b61,guild_id:_0x1a9ce3,apiBaseUrl:_0x344e98,wsBaseUrl:_0x11279d}=_0x248236;this[_0xb6ffd7(0x225)][_0x4d8b08]=new midjourney_1[(_0xb6ffd7(0x2a6))]({'token':_0xd942d1,'guild_id':_0x1a9ce3,'channel_id':_0x2a0b61,'apiBaseUrl':_0x344e98,'wsBaseUrl':_0x11279d,'skipHeartbeat':!![]}),await this[_0xb6ffd7(0x225)][_0x4d8b08]['init']();}async[_0x12df21(0x115)](_0x560fd9){const _0x384446=_0x12df21,_0x4814c9=new addDrawQueue_dto_1['AddDrawQueueDto'](_0x560fd9);await this[_0x384446(0x1e8)][_0x384446(0x2b0)](_0x4814c9[_0x384446(0x2df)],_0x4814c9['userId']);const _0x1a6a67=await this[_0x384446(0x2e7)][_0x384446(0x1b2)](_0x4814c9);return _0x1a6a67;}async['handleAddDrawTask'](_0x1a1b65,_0x499d86){const _0x1ed06d=_0x12df21;let _0x269166,_0x44c19f;try{const {type:_0x142f4f,params:_0x186323}=_0x1a1b65;await this[_0x1ed06d(0x17c)]['checkUserStatus'](_0x499d86['user']);if(_0x142f4f===midjourney_constant_1['MidJourneyDrawEnum'][_0x1ed06d(0x1b5)]){let {botType:_0x5e6372,prompt:_0x4ca5e6,extend:_0x1b2e4f,action:_0x5d4ff1,mode:_0x140a33,translate:_0x2fd03d,base64Array:_0x4a1f0a,mats:mats=[],iw:_0x3a2614,roles:roles=[],cw:_0x4bd626,styles:styles=[],sw:_0x264db0}=_0x186323,_0x22a3dd=await this[_0x1ed06d(0x142)]('Imagine',_0x140a33);await this[_0x1ed06d(0x152)][_0x1ed06d(0x17b)](_0x499d86,_0x1ed06d(0x1ee),_0x22a3dd);const _0x23027b=_0x4ca5e6,_0x41c801=await this['distributeAccount'](_0x140a33);_0x4ca5e6&&await this[_0x1ed06d(0x1e8)][_0x1ed06d(0x2b0)](_0x4ca5e6,_0x499d86[_0x1ed06d(0x182)]['id']),_0x4ca5e6=_0x2fd03d===0x1&&(0x0,utils_1[_0x1ed06d(0x299)])(_0x4ca5e6)?await this[_0x1ed06d(0x301)]['convertToEnglish'](_0x4ca5e6):_0x4ca5e6;let _0x115dfe=_0x4ca5e6;mats[_0x1ed06d(0x126)]&&(_0x115dfe=mats[_0x1ed06d(0x17d)]('\x20')+'\x20'+_0x115dfe);_0x3a2614&&(_0x115dfe=_0x115dfe+_0x1ed06d(0x308)+_0x3a2614);styles[_0x1ed06d(0x126)]&&(_0x115dfe=_0x115dfe+_0x1ed06d(0x116)+styles[_0x1ed06d(0x17d)]('\x20'));roles[_0x1ed06d(0x126)]&&(_0x115dfe=_0x115dfe+'\x20--cref\x20'+roles[_0x1ed06d(0x17d)]('\x20'));_0x4bd626&&(_0x115dfe=_0x115dfe+_0x1ed06d(0x1dd)+_0x4bd626);_0x264db0&&(_0x115dfe=_0x115dfe+_0x1ed06d(0x2cd)+_0x264db0);_0x1b2e4f&&(_0x115dfe=_0x115dfe+'\x20'+_0x1b2e4f);const _0x1e5d42=await this[_0x1ed06d(0x21d)][_0x1ed06d(0x2b5)]({'data':{'mode':this[_0x1ed06d(0x2bd)](_0x140a33),'prompt':_0x115dfe,'botType':_0x5e6372||'MID_JOURNEY','base64Array':_0x4a1f0a,'accountFilter':{'instanceId':_0x41c801[_0x1ed06d(0x1cd)]}}});if(_0x1e5d42[_0x1ed06d(0x1d0)]===0x17)throw new Error(_0x1ed06d(0x256));if(_0x1e5d42[_0x1ed06d(0x1d0)]===0x18)throw new Error(_0x1ed06d(0x2d9));if(_0x1e5d42[_0x1ed06d(0x1d0)]!==0x1&&_0x1e5d42['code']!==0x16)throw new Error(_0x1e5d42[_0x1ed06d(0x30a)]);_0x44c19f=_0x1e5d42[_0x1ed06d(0x1ce)],_0x269166=await this[_0x1ed06d(0x1f9)]['transaction'](async _0x2b60a7=>{const _0x135c38=_0x1ed06d,_0xdd7950={'mode':_0x140a33,'prompt':_0x4ca5e6,'action':_0x5d4ff1,'translate':_0x2fd03d,'fullPrompt':_0x115dfe,'originPrompt':_0x23027b,'extraParam':_0x1b2e4f,'userId':_0x499d86[_0x135c38(0x182)]['id'],'mjpId':_0x41c801['mjpId'],'mjpTaskId':_0x1e5d42[_0x135c38(0x1ce)],'botType':_0x5e6372||'MID_JOURNEY'},_0x33698c=await this[_0x135c38(0x115)](_0xdd7950);if(!_0x33698c)throw new Error('添加绘图任务失败');return await this['userBalanceService'][_0x135c38(0x199)](_0x499d86[_0x135c38(0x182)]['id'],_0x135c38(0x1ee),_0x22a3dd,_0x22a3dd),_0x33698c[_0x135c38(0x309)];});}else{if(_0x142f4f===midjourney_constant_1[_0x1ed06d(0x2bc)][_0x1ed06d(0x27c)]){let {taskId:_0x49517c,prompt:_0x1455dd,mask:_0x4042e2,action:_0x1caa54,customId:_0x416c76}=_0x186323;const _0x38ff28=await this[_0x1ed06d(0x2e7)][_0x1ed06d(0x2fd)]({'where':{'id':_0x49517c}});if(!_0x38ff28)throw new Error(_0x1ed06d(0x23b));const _0x34c4bc=_0x1455dd;_0x1455dd&&await this[_0x1ed06d(0x1e8)]['checkBadWords'](_0x1455dd,_0x499d86[_0x1ed06d(0x182)]['id']),_0x1455dd=(0x0,utils_1[_0x1ed06d(0x299)])(_0x1455dd)?await this[_0x1ed06d(0x301)][_0x1ed06d(0x150)](_0x1455dd):_0x1455dd;const _0x124275=await this[_0x1ed06d(0x21d)][_0x1ed06d(0x10c)]({'data':{'prompt':_0x1455dd,'maskBase64':_0x4042e2,'taskId':_0x38ff28[_0x1ed06d(0x2c3)]}});if(_0x124275[_0x1ed06d(0x1d0)]!==0x1&&_0x124275[_0x1ed06d(0x1d0)]!==0x16)throw new Error(_0x124275[_0x1ed06d(0x30a)]);return this['midjourneyEntity'][_0x1ed06d(0x1b2)]({'id':_0x49517c,'prompt':_0x1455dd,'status':0x1,'originPrompt':_0x34c4bc,'messageFlags':0x1}),_0x38ff28['jobId'];}else{if(_0x142f4f===midjourney_constant_1[_0x1ed06d(0x2bc)][_0x1ed06d(0x100)]){const {action:_0x374681,taskId:_0x37a1c6,customId:_0x35bec8}=_0x186323;await this[_0x1ed06d(0x185)](_0x37a1c6,_0x35bec8);const _0x281d90=await this[_0x1ed06d(0x2e7)][_0x1ed06d(0x2fd)]({'where':{'id':_0x37a1c6}});if(!_0x281d90)throw new Error(_0x1ed06d(0x23b));let _0x25a93=await this[_0x1ed06d(0x142)](_0x35bec8,_0x281d90[_0x1ed06d(0x183)]);await this[_0x1ed06d(0x152)][_0x1ed06d(0x17b)](_0x499d86,_0x1ed06d(0x1ee),_0x25a93);const _0x22f075=await this['mjpTaskService'][_0x1ed06d(0x186)]({'data':{'customId':_0x35bec8,'taskId':_0x281d90[_0x1ed06d(0x2c3)],'accountFilter':{'instanceId':_0x281d90[_0x1ed06d(0x1cd)]},'mode':this[_0x1ed06d(0x2bd)](_0x281d90['mode'])}});if(_0x22f075[_0x1ed06d(0x1d0)]===0x17)throw new Error(_0x1ed06d(0x256));else{if(_0x22f075['code']===0x18)throw new Error(_0x1ed06d(0x2d9));else{if(_0x22f075[_0x1ed06d(0x1d0)]===0x15)setTimeout(()=>this['syncTaskInfo'](_0x22f075[_0x1ed06d(0x1ce)]));else{if(_0x22f075[_0x1ed06d(0x1d0)]!==0x1&&_0x22f075['code']!==0x16)throw new Error(_0x22f075[_0x1ed06d(0x30a)]);}}}_0x44c19f=_0x22f075['result'],_0x269166=await this[_0x1ed06d(0x1f9)][_0x1ed06d(0x1ba)](async _0x4ff8e9=>{const _0x645aaa=_0x1ed06d,_0x3b300a={'action':_0x374681,'customId':_0x35bec8,'userId':_0x499d86[_0x645aaa(0x182)]['id'],'mjpTaskId':_0x22f075['result'],'originTaskId':String(_0x37a1c6),'mode':_0x281d90[_0x645aaa(0x183)],'mjpId':_0x281d90[_0x645aaa(0x1cd)],'prompt':_0x281d90['prompt'],'botType':_0x281d90[_0x645aaa(0x291)],'extraParam':_0x281d90[_0x645aaa(0x248)],'fullPrompt':_0x281d90['fullPrompt'],'originPrompt':_0x281d90[_0x645aaa(0xff)]},_0xae4f8d=await this[_0x645aaa(0x115)](_0x3b300a);if(!_0xae4f8d)throw new Error('提交动作失败');return await this[_0x645aaa(0x152)][_0x645aaa(0x199)](_0x499d86[_0x645aaa(0x182)]['id'],_0x645aaa(0x1ee),_0x25a93,_0x25a93),_0xae4f8d[_0x645aaa(0x309)];});}else return new common_1['HttpException'](_0x1ed06d(0x2c7),common_1['HttpStatus']['BAD_REQUEST']);}}return _0x269166;}catch(_0x259b16){if(_0x259b16 instanceof common_1[_0x1ed06d(0x1b0)])throw _0x259b16;else{_0x44c19f&&await this[_0x1ed06d(0x21d)][_0x1ed06d(0x1da)]({},_0x44c19f);throw new common_1[(_0x1ed06d(0x1b0))](_0x259b16[_0x1ed06d(0x1c5)],common_1[_0x1ed06d(0x1f3)][_0x1ed06d(0x249)]);}}}async['handleImagesUploadTask'](_0x596eed,_0x3e9afb){const _0x156c94=_0x12df21;let _0x25ebfd,_0x332cc3;try{const {type:_0x1691a9,botType:_0x45ecaf,files:_0x30e4b8,mode:_0xd89226,action:_0x200a3e,size:_0x42298f,base64Array:base64Array=[]}=_0x596eed;await this[_0x156c94(0x17c)][_0x156c94(0x2eb)](_0x3e9afb[_0x156c94(0x182)]);let _0x1fa66f='';if(Number(_0x1691a9)===midjourney_constant_1[_0x156c94(0x2bc)][_0x156c94(0x169)])_0x1fa66f='Blend';else Number(_0x1691a9)===midjourney_constant_1[_0x156c94(0x2bc)][_0x156c94(0x1e7)]&&(_0x1fa66f='Describe');let _0x251248=await this[_0x156c94(0x142)](_0x1fa66f,_0x596eed[_0x156c94(0x183)]);await this[_0x156c94(0x152)][_0x156c94(0x17b)](_0x3e9afb,_0x156c94(0x1ee),_0x251248);const _0x392395=await this[_0x156c94(0x118)](_0xd89226);if(!base64Array[_0x156c94(0x126)])for(let _0x5e5710=0x0;_0x5e5710<_0x30e4b8[_0x156c94(0x126)];_0x5e5710++){base64Array[_0x156c94(0xf9)](_0x156c94(0x220)+_0x30e4b8[_0x5e5710][_0x156c94(0x148)][_0x156c94(0x18b)]('base64'));}if(Number(_0x1691a9)===midjourney_constant_1[_0x156c94(0x2bc)][_0x156c94(0x169)]){if(base64Array[_0x156c94(0x126)]<0x2)throw new Error('图混图任务至少需要两张图片');const _0x293355=await this[_0x156c94(0x21d)][_0x156c94(0x20c)]({'data':{'mode':this[_0x156c94(0x2bd)](_0xd89226),'dimensions':_0x42298f,'botType':_0x156c94(0x1c1),'base64Array':base64Array,'accountFilter':{'instanceId':_0x392395[_0x156c94(0x1cd)]}}});if(_0x293355['code']===0x17)throw new Error(_0x156c94(0x256));if(_0x293355[_0x156c94(0x1d0)]!==0x1&&_0x293355[_0x156c94(0x1d0)]!==0x16)throw new Error(_0x293355['description']);_0x332cc3=_0x293355[_0x156c94(0x1ce)],_0x25ebfd=await this[_0x156c94(0x1f9)][_0x156c94(0x1ba)](async _0x3f2214=>{const _0x4770af=_0x156c94,_0x46b061={'mode':_0xd89226,'action':_0x200a3e,'imgUrl':'','userId':_0x3e9afb[_0x4770af(0x182)]['id'],'jobId':(0x0,utils_1[_0x4770af(0x27e)])(),'botType':_0x45ecaf||_0x4770af(0x1c1),'extraParam':JSON[_0x4770af(0x268)]({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x293355['result']},_0x41e509=await this[_0x4770af(0x115)](_0x46b061);if(!_0x41e509)throw new Error(_0x4770af(0x1a7));return await this[_0x4770af(0x152)][_0x4770af(0x199)](_0x3e9afb[_0x4770af(0x182)]['id'],'mjDraw',_0x251248,_0x251248),_0x41e509['jobId'];});}else{if(Number(_0x1691a9)===midjourney_constant_1[_0x156c94(0x2bc)]['IMAGE_TO_TEXT']){const _0x2bad51=await this[_0x156c94(0x21d)][_0x156c94(0x253)]({'data':{'mode':this['convertMode4Transfer'](_0xd89226),'botType':_0x156c94(0x1c1),'base64':base64Array[0x0],'accountFilter':{'instanceId':_0x392395[_0x156c94(0x1cd)]}}});if(_0x2bad51[_0x156c94(0x1d0)]===0x17)throw new Error(_0x156c94(0x256));if(_0x2bad51[_0x156c94(0x1d0)]!==0x1&&_0x2bad51[_0x156c94(0x1d0)]!==0x16)throw new Error(_0x2bad51[_0x156c94(0x30a)]);_0x332cc3=_0x2bad51[_0x156c94(0x1ce)],_0x25ebfd=await this[_0x156c94(0x1f9)][_0x156c94(0x1ba)](async _0x4e81ba=>{const _0x51d197=_0x156c94,_0x341d62={'mode':_0xd89226,'action':_0x200a3e,'imgUrl':'','userId':_0x3e9afb[_0x51d197(0x182)]['id'],'jobId':(0x0,utils_1['createRandomUid'])(),'botType':_0x45ecaf||_0x51d197(0x1c1),'extraParam':JSON[_0x51d197(0x268)]({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x2bad51[_0x51d197(0x1ce)]},_0x22ad0a=await this['addDrawQueue'](_0x341d62);if(!_0x22ad0a)throw new Error(_0x51d197(0x26f));return await this[_0x51d197(0x152)][_0x51d197(0x199)](_0x3e9afb[_0x51d197(0x182)]['id'],'mjDraw',_0x251248,_0x251248),_0x22ad0a[_0x51d197(0x309)];})[_0x156c94(0x13a)](async _0x273b36=>{const _0x5ae0ce=_0x156c94;await this[_0x5ae0ce(0x21d)][_0x5ae0ce(0x1da)]({},_0x2bad51['result']);throw _0x273b36;});}else return new common_1[(_0x156c94(0x1b0))](_0x156c94(0x2c7),common_1[_0x156c94(0x1f3)][_0x156c94(0x249)]);}return _0x25ebfd;}catch(_0x4a642e){if(_0x4a642e instanceof common_1[_0x156c94(0x1b0)])throw _0x4a642e;else{_0x332cc3&&await this[_0x156c94(0x21d)][_0x156c94(0x1da)]({},_0x332cc3);throw new common_1[(_0x156c94(0x1b0))](_0x4a642e[_0x156c94(0x1c5)],common_1[_0x156c94(0x1f3)]['BAD_REQUEST']);}}}async[_0x12df21(0x16e)](_0x2a9941,_0x4edc44){const _0x18503c=_0x12df21;let _0x41c8c5,_0x132339;try{const {type:_0x58fefb,params:_0x5e7942}=_0x2a9941,{mode:_0x378159,botType:_0x18a3a5,action:_0x3141a6,extend:_0x2f088a,sourceBase64:_0x4a9bf9,targetBase64:_0x8b2345}=_0x5e7942;await this['userService'][_0x18503c(0x2eb)](_0x4edc44[_0x18503c(0x182)]);let _0x327e15=await this[_0x18503c(0x142)](_0x18503c(0x1b7),_0x378159);await this[_0x18503c(0x152)][_0x18503c(0x17b)](_0x4edc44,'mjDraw',_0x327e15);const _0x3b7e71=await this[_0x18503c(0x118)](_0x378159),_0xa526e3=await this[_0x18503c(0x21d)][_0x18503c(0x13f)]({'data':{'sourceBase64':_0x4a9bf9,'targetBase64':_0x8b2345,'state':_0x2f088a,'mode':this[_0x18503c(0x2bd)](_0x378159),'accountFilter':{'instanceId':_0x3b7e71[_0x18503c(0x1cd)]}}});if(_0xa526e3[_0x18503c(0x1d0)]===0x17)throw new Error(_0x18503c(0x256));if(_0xa526e3[_0x18503c(0x1d0)]===0x18)throw new Error(_0x18503c(0x2d9));if(_0xa526e3[_0x18503c(0x1d0)]!==0x1&&_0xa526e3[_0x18503c(0x1d0)]!==0x16)throw new Error(_0xa526e3[_0x18503c(0x30a)]);return _0x132339=_0xa526e3[_0x18503c(0x1ce)],_0x41c8c5=await this[_0x18503c(0x1f9)][_0x18503c(0x1ba)](async _0x3e8edc=>{const _0x39b56d=_0x18503c,_0x53c787={'mode':_0x378159,'action':_0x3141a6,'prompt':null,'extraParam':_0x2f088a,'originPrompt':null,'userId':_0x4edc44[_0x39b56d(0x182)]['id'],'mjpId':_0x3b7e71[_0x39b56d(0x1cd)],'mjpTaskId':_0xa526e3[_0x39b56d(0x1ce)],'botType':_0x18a3a5||_0x39b56d(0x1c1)},_0x957496=new addDrawQueue_dto_1['AddDrawQueueDto'](_0x53c787),_0x592d99=await this[_0x39b56d(0x2e7)][_0x39b56d(0x1b2)](_0x957496);if(!_0x592d99)throw new Error(_0x39b56d(0x304));return await this['userBalanceService']['deductFromBalance'](_0x4edc44[_0x39b56d(0x182)]['id'],_0x39b56d(0x1ee),_0x327e15,_0x327e15),_0x592d99['jobId'];}),_0x41c8c5;}catch(_0x521ede){throw new common_1[(_0x18503c(0x1b0))](_0x521ede[_0x18503c(0x1c5)],common_1['HttpStatus'][_0x18503c(0x249)]);}}async[_0x12df21(0x142)](_0x2bd7fb,_0x1f536d){const _0x135654=_0x12df21;var _0x5098cf=_0x2bd7fb[_0x135654(0x219)](),_0xd2dd0d=new RegExp(_0x135654(0x267)),_0x5c9297=new RegExp(_0x135654(0x127)),_0x129403=new RegExp('fetch|listbyids|modal|seed'),_0x5b13c0='';if(_0x1f536d===midjourney_constant_1['DrawSpeed'][_0x135654(0x2fb)])_0x5b13c0='fast_mjDeduction';else{if(_0x1f536d===midjourney_constant_1[_0x135654(0x290)][_0x135654(0x28f)])_0x5b13c0=_0x135654(0x12f);else _0x1f536d===midjourney_constant_1[_0x135654(0x290)]['turbo']&&(_0x5b13c0='turbo_mjDeduction');}if(_0xd2dd0d[_0x135654(0x16f)](_0x5098cf))_0x5b13c0=_0x5b13c0+0x1;else{if(_0x5c9297['test'](_0x5098cf))_0x5b13c0=_0x5b13c0+0x2;else _0x129403[_0x135654(0x16f)](_0x5098cf)&&(_0x5b13c0=_0x5b13c0+0x3);}const _0x29a9bf=await this[_0x135654(0x167)]['getConfigByKey'](_0x5b13c0);if(!_0x29a9bf)return 0x4;return Number(_0x29a9bf[_0x135654(0x200)])||0x4;}async['saveImageToMixed'](_0x3cc9e5){const _0x33899f=_0x12df21,{files:_0x2696e3,mode:_0x1217af,action:_0x3b752a,jobId:_0x4bac56,userId:_0x35391a}=_0x3cc9e5;let _0x212e64=0x0;const {channel_id:_0x15360d,authorization:_0x3aa84e,mjProxy:_0x2feb7c,mjProxyUrl:_0x360327}=await this[_0x33899f(0x236)](_0x1217af)[_0x33899f(0x13a)](_0x5a0fa4=>{const _0x5205b5=_0x33899f;return Promise[_0x5205b5(0x106)](_0x5a0fa4);});let _0x366407=[];if(_0x2feb7c==0x0)while(_0x212e64<_0x2696e3[_0x33899f(0x126)]){const _0x40074b=_0x2696e3[_0x212e64],_0x41839e=await this['uploadImage']({'channel_id':_0x15360d,'authorization':_0x3aa84e,'filename':(0x0,utils_1[_0x33899f(0x27e)])()+_0x40074b[_0x33899f(0x15d)],'buffer':_0x40074b[_0x33899f(0x148)],'needImage':![]})['catch'](_0xfadd3d=>{const _0x68bfc3=_0x33899f;return common_1[_0x68bfc3(0x12b)][_0x68bfc3(0x1dc)](_0xfadd3d),Promise[_0x68bfc3(0x276)]({'attachments':[]});});_0x366407=_0x366407[_0x33899f(0x1cc)](_0x41839e[_0x33899f(0x19d)]||[]),_0x212e64++;}else common_1['Logger'][_0x33899f(0x14a)](_0x33899f(0x14e)),_0x366407=await this['uploadByProxy']({'proxy':_0x360327,'channel_id':_0x15360d,'authorization':_0x3aa84e,'file':_0x2696e3,'needImage':![]})[_0x33899f(0x2c1)](_0x4b916d=>_0x4b916d[_0x33899f(0x25d)](_0x3ffe09=>_0x3ffe09[_0x33899f(0x19d)]))[_0x33899f(0x2c1)](_0x2321a0=>_0x2321a0['flat']())['catch'](_0x358af9=>{const _0x1c24d4=_0x33899f;return common_1['Logger'][_0x1c24d4(0x1dc)](_0x358af9),Promise[_0x1c24d4(0x276)]({'attachments':[]});});common_1[_0x33899f(0x12b)][_0x33899f(0x14a)](_0x33899f(0x22a));const _0x1083df={'mode':_0x1217af,'action':_0x3b752a,'jobId':_0x4bac56,'userId':_0x35391a,'imgUrl':'','extraParam':JSON['stringify']({'attachments':_0x366407}),'originPrompt':'','mjpTaskId':''},_0x7ce508=await this['addDrawQueue'](_0x1083df)[_0x33899f(0x13a)](_0x56897f=>{common_1['Logger']['error'](_0x56897f);});if(!_0x7ce508)throw new common_1['HttpException'](_0x33899f(0x304),common_1[_0x33899f(0x1f3)][_0x33899f(0x249)]);this['runMjBlendTask']({'jobId':_0x4bac56})[_0x33899f(0x13a)](_0x4b39e2=>{const _0x410684=_0x33899f;common_1['Logger'][_0x410684(0x1dc)](_0x4b39e2);}),await this['userBalanceService'][_0x33899f(0x199)](_0x35391a,_0x33899f(0x1ee),0x4,0x4);return;}async['saveImageToText'](_0x153ec5){const _0x5430bf=_0x12df21,{file:_0x3255bb,mode:_0x3a0bae,action:_0x113b84,jobId:_0x1b1f99,userId:_0x119b0b}=_0x153ec5;console['log'](_0x5430bf(0x309),_0x1b1f99);const {channel_id:_0x15a533,authorization:_0x9512af,mjProxy:_0x461de1,mjProxyUrl:_0x22071d}=await this[_0x5430bf(0x236)](_0x3a0bae)['catch'](_0x5d0b18=>{const _0x29a2c1=_0x5430bf;return Promise[_0x29a2c1(0x106)](_0x5d0b18);});let _0x4f50ca;Number(_0x461de1)==0x1?_0x4f50ca=await this[_0x5430bf(0x2fe)]({'proxy':_0x22071d,'authorization':_0x9512af,'channel_id':_0x15a533,'file':[_0x3255bb],'needImage':!![]})[_0x5430bf(0x2c1)](_0x1f2012=>_0x1f2012[0x0]):_0x4f50ca=await this[_0x5430bf(0x161)]({'authorization':_0x9512af,'channel_id':_0x15a533,'filename':(0x0,utils_1[_0x5430bf(0x27e)])()+_0x3255bb[_0x5430bf(0x15d)],'buffer':_0x3255bb[_0x5430bf(0x148)],'needImage':!![]})[_0x5430bf(0x13a)](_0x323b41=>{const _0x4704f4=_0x5430bf;throw new common_1[(_0x4704f4(0x1b0))](_0x323b41,common_1[_0x4704f4(0x1f3)][_0x4704f4(0x249)]);});if(!_0x4f50ca)throw new common_1[(_0x5430bf(0x1b0))](_0x5430bf(0x1dc),common_1[_0x5430bf(0x1f3)][_0x5430bf(0x249)]);const {image:_0x5b5d19,attachments:_0x1d84b5}=_0x4f50ca,_0x184f69={'mode':_0x3a0bae,'action':_0x113b84,'jobId':_0x1b1f99,'userId':_0x119b0b,'imgUrl':_0x5b5d19?.[_0x5430bf(0x129)]||'','extraParam':JSON[_0x5430bf(0x268)]({'attachments':_0x1d84b5,..._0x5b5d19}),'originPrompt':'','mjpTaskId':''},_0x3bf32e=await this[_0x5430bf(0x115)](_0x184f69)['catch'](_0x435dc8=>{const _0x6e3e5e=_0x5430bf;common_1['Logger'][_0x6e3e5e(0x1dc)](_0x435dc8);});if(!_0x3bf32e)throw new common_1['HttpException'](_0x5430bf(0x304),common_1[_0x5430bf(0x1f3)][_0x5430bf(0x249)]);return this[_0x5430bf(0x192)]({'jobId':_0x1b1f99})['catch'](_0x3ad044=>{const _0x2a55e8=_0x5430bf;common_1[_0x2a55e8(0x12b)]['error'](_0x3ad044);}),await this['userBalanceService'][_0x5430bf(0x199)](_0x119b0b,_0x5430bf(0x1ee),0x4,0x4),_0x1b1f99;}async[_0x12df21(0x2f8)](_0x2ba758,_0x1d9bd3){const _0x702c58=_0x12df21,{attachments:_0x4a65f1,mode:_0x2f7934}=_0x2ba758;return await this[_0x702c58(0x120)](_0x2f7934),await this['midJourney'][_0x2f7934][_0x702c58(0x2ac)][_0x702c58(0x253)](_0x4a65f1,(_0x270d97,_0x21fea7)=>{_0x1d9bd3(_0x270d97,_0x21fea7);});}async[_0x12df21(0x250)](_0x2c5be7,_0x5dbdff){const _0x25349c=_0x12df21,{customId:_0x2795d9,prompt:_0x4fa654,mask:_0x41dfab,mode:_0x539ca9}=_0x2c5be7;return await this[_0x25349c(0x120)](_0x539ca9),await this[_0x25349c(0x225)][_0x539ca9][_0x25349c(0x2ac)][_0x25349c(0x208)](_0x2795d9,_0x4fa654,_0x41dfab,(_0x4ae257,_0x43c2e7)=>{_0x5dbdff(_0x4ae257,_0x43c2e7);});}async[_0x12df21(0x295)](_0x2281d0,_0x135555){const _0x3aa638=_0x12df21,{attachments:_0x32e090,mode:_0x3ef67b}=_0x2281d0;return await this[_0x3aa638(0x120)](_0x3ef67b),await this[_0x3aa638(0x225)][_0x3ef67b]['api'][_0x3aa638(0x20c)](_0x32e090,(_0x452403,_0x46bd61)=>{_0x135555(_0x452403,_0x46bd61);});}async[_0x12df21(0x111)](_0x3eae8d,_0x4ebb86){const _0x32ac90=_0x12df21,{prompt:_0x490b29,mode:_0x4532a6}=_0x3eae8d;return await this[_0x32ac90(0x120)](_0x4532a6),await this[_0x32ac90(0x225)][_0x4532a6][_0x32ac90(0x2ac)][_0x32ac90(0x2b5)](_0x490b29,(_0x194983,_0xc87f1e)=>{_0x4ebb86(_0x194983,_0xc87f1e);});}async[_0x12df21(0x1bf)](_0x8cac92,_0xcd43b1){const _0x5d5ab3=_0x12df21,{messageId:_0x40c577,customId:_0xb1aa56,messageFlags:_0x4d5400,mode:_0x26018d}=_0x8cac92;return await this['initMj'](_0x26018d),await this['midJourney'][_0x26018d][_0x5d5ab3(0x2ac)][_0x5d5ab3(0x186)](_0x40c577,_0xb1aa56,_0x4d5400,_0xcd43b1);}async[_0x12df21(0x1fc)](_0x1a1648){const _0x5d168d=_0x12df21,{proxy:_0x9dd954,guild_id:_0x25d2b8,channel_id:_0x35ae50,authorization:_0x440bb2,prompt:_0xdd5d66}=_0x1a1648;return await axios_1['default'][_0x5d168d(0x11a)](_0x9dd954+'/api/mj/imagine',{'guild_id':_0x25d2b8,'channel_id':_0x35ae50,'token':_0x440bb2,'prompt':_0xdd5d66});}async[_0x12df21(0x300)](_0x4d5b1c){const {proxy:_0x57fb3f,guild_id:_0x4c6476,channel_id:_0x29d512,message_id:_0x57e9ac,custom_id:_0x358d6e,flags:_0x47baf4,authorization:_0x11de78}=_0x4d5b1c;return await axios_1['default']['post'](_0x57fb3f+'/api/mj/action',{'message_id':_0x57e9ac,'custom_id':_0x358d6e,'flags':_0x47baf4,'guild_id':_0x4c6476,'channel_id':_0x29d512,'token':_0x11de78});}async[_0x12df21(0xf6)](_0x2963de){const _0x1427a8=_0x12df21,{proxy:_0x5e0df0,guild_id:_0x582255,channel_id:_0x278e2b,message_id:_0xc69588,custom_id:_0x524d21,flags:_0x337b60,authorization:_0x11ba15}=_0x2963de;return await axios_1['default'][_0x1427a8(0x11a)](_0x5e0df0+_0x1427a8(0x1de),{'message_id':_0xc69588,'custom_id':_0x524d21,'flags':_0x337b60,'guild_id':_0x582255,'channel_id':_0x278e2b,'token':_0x11ba15});}async['runMjDrawTask'](_0x3f0bbf){const _0x2d3c84=_0x12df21,_0x1b84e1=await this[_0x2d3c84(0x2e7)][_0x2d3c84(0x2fd)]({'where':{'jobId':_0x3f0bbf}}),{id:_0x135d38,createdAt:_0xea1cba,mode:_0x2d2ea2,action:_0x313039,imgUrl:_0x1237fb,extraParam:_0x3bfc03,prompt:_0x50b6bc,translate:_0x4c73c3}=_0x1b84e1;await this[_0x2d3c84(0x25e)](_0x3f0bbf,midjourney_constant_1[_0x2d3c84(0x141)][_0x2d3c84(0x105)]);let _0x3c0821=_0x4c73c3===0x1&&(0x0,utils_1['isChinese'])(_0x50b6bc)?await this['fanyiService'][_0x2d3c84(0x150)](_0x50b6bc):_0x50b6bc;common_1[_0x2d3c84(0x12b)][_0x2d3c84(0x14a)](_0x3c0821,_0x2d3c84(0x176)),common_1[_0x2d3c84(0x12b)][_0x2d3c84(0x14a)](_0x4c73c3===0x1&&(0x0,utils_1[_0x2d3c84(0x299)])(_0x50b6bc)?'是':'否',_0x2d3c84(0x202));const _0x4f673b=_0x1237fb?_0x1237fb+'\x20'+_0x3c0821+'\x20'+_0x3bfc03:_0x3c0821+'\x20'+_0x3bfc03;return _0x4c73c3===0x1&&(0x0,utils_1[_0x2d3c84(0x299)])(_0x50b6bc)&&await this[_0x2d3c84(0x2e7)][_0x2d3c84(0x2f6)]({'id':_0x135d38},{'fullPrompt':_0x4f673b,'prompt':_0x3c0821})['catch'](_0xca787a=>{const _0x29ab3f=_0x2d3c84;console['log'](_0xca787a),this[_0x29ab3f(0x29b)]({'id':_0x135d38,'userId':_0x1b84e1['userId'],'action':_0x1b84e1[_0x29ab3f(0x186)]});}),!![];}async[_0x12df21(0x135)](_0x2af520){const _0x23815a=_0x12df21,{jobId:_0x4476cd,customId:_0x85fd37,prompt:_0x865289,mask:_0x51a18f}=_0x2af520,_0x550c8d=await this[_0x23815a(0x2e7)][_0x23815a(0x2fd)]({'where':{'jobId':_0x4476cd}});await this[_0x23815a(0x25e)](_0x4476cd,midjourney_constant_1[_0x23815a(0x141)][_0x23815a(0x105)]);const _0x409c40=await this[_0x23815a(0x167)][_0x23815a(0x1f7)]([_0x23815a(0x2d2)]),{mode:_0x5415c4,id:_0x2b86ef,createdAt:_0x5e61b8}=_0x550c8d;if(Number(_0x409c40)===0x0){const _0x59f9f4=await this[_0x23815a(0x250)]({'customId':_0x85fd37,'prompt':_0x865289,'mask':_0x51a18f,'mode':_0x5415c4},async(_0x55670b,_0x4a7abb)=>{const _0x5e815a=_0x23815a;console[_0x5e815a(0x14a)](_0x5e815a(0x2db),_0x55670b,_0x4a7abb);if(_0x55670b===_0x5e815a(0x27d)||_0x55670b===_0x5e815a(0x238)){const {progress:_0x2cb63d,content:_0x2b90df,url:_0x22eed7,id:_0x9e3082,attachments:_0x5a28e7,flags:_0x3439ed,components:_0x195008}=_0x4a7abb;await this[_0x5e815a(0x239)]({'messageId':_0x9e3082,'messageFlags':_0x3439ed,'id':_0x2b86ef,'jobId':_0x4476cd,'createdAt':_0x5e61b8,'extend':JSON[_0x5e815a(0x268)]({'components':_0x195008,'attachments':_0x5a28e7[0x0]||{}})||'','url':_0x22eed7,'action':_0x550c8d['action'],'progress':_0x2cb63d,'type':'MESSAGE_UPDATE','mode':_0x5415c4,'prompt':_0x2b90df});}})[_0x23815a(0x13a)](_0x2c30cd=>{const _0x2c8ab6=_0x23815a;common_1[_0x2c8ab6(0x12b)][_0x2c8ab6(0x1dc)](_0x2c30cd,_0x2c8ab6(0x307)),this[_0x2c8ab6(0x29b)]({'id':_0x2b86ef,'userId':_0x550c8d['userId'],'action':_0x550c8d[_0x2c8ab6(0x186)]});});if(!_0x59f9f4)return;const _0x5bc29c=(new Date(_0x59f9f4[_0x23815a(0x28b)])['getTime']()-new Date(_0x5e61b8)[_0x23815a(0x1c2)]())/0x3e8,{url:_0x1e3308,progress:_0x506519,components:_0x50c5e4,attachments:_0xcf384f}=_0x59f9f4;await this['updateDrawData'](_0x4476cd,{..._0x59f9f4,'components':_0x50c5e4,'attachments':_0xcf384f[0x0]||{},'messageFlags':_0x59f9f4[_0x23815a(0x1a2)],'messageId':_0x59f9f4['id'],'url':_0x1e3308,'progress':_0x506519,'action':_0x550c8d[_0x23815a(0x186)],'durationSpent':_0x5bc29c,'prompt':_0x59f9f4[_0x23815a(0x1fd)]}),await this[_0x23815a(0x239)]({'durationSpent':_0x5bc29c,'messageId':_0x59f9f4['id'],'messageFlags':_0x59f9f4['flags'],'id':_0x2b86ef,'jobId':_0x4476cd,'createdAt':_0x5e61b8,'extend':JSON[_0x23815a(0x268)]({'components':_0x50c5e4,'attachments':_0xcf384f[0x0]||{}})||'','url':_0x1e3308,'action':_0x550c8d['action'],'progress':_0x506519,'type':_0x23815a(0x2f2),'mode':_0x5415c4,'prompt':_0x59f9f4[_0x23815a(0x1fd)]});}else{console[_0x23815a(0x14a)](_0x23815a(0x2e1));const {guild_id:_0x8784d6,channel_id:_0x19506b,authorization:_0x23d2d0,mjProxyUrl:_0x155449,mjSocketProxyUrl:_0x37dcee}=await this[_0x23815a(0x236)](_0x5415c4)['catch'](_0x44f3bc=>{const _0x5895c2=_0x23815a;return Promise[_0x5895c2(0x106)](_0x44f3bc);}),_0x10d2e4=await this['runVaryRegionJobByProxy']({'guild_id':_0x8784d6,'channel_id':_0x19506b,'authorization':_0x23d2d0,'custom_id':_0x85fd37,'prompt':_0x865289,'mask':_0x51a18f,'proxy':_0x155449});await this[_0x23815a(0x1df)](_0x37dcee)['then'](_0x3bd925=>{const _0x354ba1=_0x23815a;common_1[_0x354ba1(0x12b)][_0x354ba1(0x14a)]('socket.active',_0x3bd925['active']),common_1[_0x354ba1(0x12b)][_0x354ba1(0x14a)]('socket.connected',_0x3bd925[_0x354ba1(0x19b)]),(!_0x3bd925[_0x354ba1(0x211)]||!_0x3bd925[_0x354ba1(0x19b)])&&_0x3bd925[_0x354ba1(0x23c)](),_0x3bd925[_0x354ba1(0x211)]&&!_0x3bd925[_0x354ba1(0x19b)]&&_0x3bd925[_0x354ba1(0x23c)](),_0x3bd925['on'](_0x354ba1(0x285),async _0x56a65f=>{const _0x129b8c=_0x354ba1,{nonceId:_0x4bbfe5,msg:_0x1793dd,type:_0xf25f17}=_0x56a65f;console[_0x129b8c(0x14a)](_0x4bbfe5,_0x1793dd,_0xf25f17);if(_0x10d2e4[_0x129b8c(0x2dd)]===_0x4bbfe5){if(_0xf25f17===_0x129b8c(0x27d)||_0xf25f17===_0x129b8c(0x238)){const {progress:_0x4ef8c4,content:_0x4187f1,url:_0x4075eb,timestamp:_0x3db0e9,id:_0x3d908d,flags:_0xe8b071,components:_0x2f8a81,attachments:_0x8444ca}=_0x1793dd;if(_0x4ef8c4<0x64)await this[_0x129b8c(0x239)]({'id':_0x2b86ef,'messageId':_0x3d908d,'messageFlags':_0xe8b071,'extend':JSON[_0x129b8c(0x268)]({'components':_0x2f8a81,'attachments':_0x8444ca[0x0]})||'','jobId':_0x4476cd,'createdAt':_0x550c8d['createdAt'],'progress':_0x4ef8c4,'action':_0x550c8d[_0x129b8c(0x186)],'url':_0x4075eb||'','type':_0xf25f17,'mode':_0x5415c4,'prompt':_0x4187f1});else{const _0x1356cc=(new Date(_0x3db0e9)[_0x129b8c(0x1c2)]()-new Date(_0x550c8d['createdAt'])[_0x129b8c(0x1c2)]())/0x3e8;await this['updateDrawData'](_0x4476cd,{..._0x1793dd,'components':_0x2f8a81,'attachments':{'width':0x0,'height':0x0},'messageId':_0x3d908d,'messageFlags':_0xe8b071,'url':_0x4075eb||'','action':_0x550c8d[_0x129b8c(0x186)],'prompt':_0x4187f1,'progress':_0x4ef8c4,'durationSpent':_0x1356cc}),await this[_0x129b8c(0x239)]({'durationSpent':_0x1356cc,'id':_0x2b86ef,'messageId':_0x3d908d,'messageFlags':_0xe8b071,'extend':JSON['stringify']({'components':_0x2f8a81,'attachments':_0x8444ca[0x0]})||'','jobId':_0x4476cd,'createdAt':_0x550c8d['createdAt'],'progress':_0x4ef8c4,'action':_0x550c8d['action'],'url':_0x4075eb||'','type':_0xf25f17,'mode':_0x5415c4,'prompt':_0x4187f1});}}}});});}}async['runVaryRegionJobByProxy'](_0x335fc3){const _0x2328a4=_0x12df21,{proxy:_0x27fb81,guild_id:_0x16c393,custom_id:_0x3572fd,prompt:_0x46407e,mask:_0x1610f9,channel_id:_0x5dedc5,authorization:_0x502d99}=_0x335fc3;return await axios_1['default'][_0x2328a4(0x11a)](_0x27fb81+_0x2328a4(0x2de),{'guild_id':_0x16c393,'channel_id':_0x5dedc5,'token':_0x502d99,'prompt':_0x46407e,'mask':_0x1610f9,'custom_id':_0x3572fd});}async['runMjDescribeTask'](_0x547519){const _0x2ec60e=_0x12df21,{jobId:_0x1cdab6}=_0x547519,_0x535bf2=await this[_0x2ec60e(0x2e7)][_0x2ec60e(0x2fd)]({'where':{'jobId':_0x1cdab6}});await this[_0x2ec60e(0x25e)](_0x1cdab6,midjourney_constant_1[_0x2ec60e(0x141)][_0x2ec60e(0x105)]);const _0x395f7f=await this[_0x2ec60e(0x167)]['getConfigs'](['mjProxy']),{mode:_0x30e61d,id:_0x518f79,extraParam:_0x51a6b0,action:_0x25759c}=_0x535bf2;if(!_0x51a6b0){common_1[_0x2ec60e(0x12b)][_0x2ec60e(0x1dc)](_0x2ec60e(0x221)),await this[_0x2ec60e(0x29b)]({'id':_0x518f79,'userId':_0x535bf2[_0x2ec60e(0x28a)],'action':_0x535bf2[_0x2ec60e(0x186)]});return;}const _0x33f490=JSON[_0x2ec60e(0x1ed)](_0x51a6b0),{attachments:_0x1a54da}=_0x33f490;common_1[_0x2ec60e(0x12b)][_0x2ec60e(0x14a)]('文生图是否代理',_0x395f7f);if(Number(_0x395f7f)===0x0)await this['runImageToTextJob']({'attachments':_0x1a54da,'mode':_0x30e61d},async(_0x3b133b,_0x10da87)=>{const _0x105c62=_0x2ec60e;console[_0x105c62(0x14a)](_0x105c62(0x2d3),_0x3b133b,_0x10da87);if(_0x3b133b===_0x105c62(0x27d)){const {progress:_0x5389b3,url:_0x18cca4,timestamp:_0x54e2bc,id:_0x57c12c,flags:_0x1c176f,components:_0x29d805,embed:_0x8382a0}=_0x10da87,_0x4116fb=(new Date(_0x54e2bc)[_0x105c62(0x1c2)]()-new Date(_0x535bf2[_0x105c62(0x206)])['getTime']())/0x3e8;await this[_0x105c62(0x164)](_0x1cdab6,{..._0x10da87,'components':_0x29d805,'attachments':{'width':0x0,'height':0x0},'messageId':_0x57c12c,'messageFlags':_0x1c176f,'url':_0x18cca4||'','action':_0x25759c,'prompt':_0x8382a0[_0x105c62(0x30a)],'progress':_0x5389b3,'durationSpent':_0x4116fb}),await this[_0x105c62(0x239)]({'durationSpent':_0x4116fb,'id':_0x518f79,'messageId':_0x57c12c,'messageFlags':_0x1c176f,'extend':JSON[_0x105c62(0x268)]({'components':_0x29d805,'attachments':{}})||'','jobId':_0x1cdab6,'createdAt':_0x535bf2[_0x105c62(0x206)],'progress':_0x5389b3,'action':_0x25759c,'url':_0x18cca4||'','type':_0x3b133b,'mode':_0x30e61d,'prompt':_0x8382a0[_0x105c62(0x30a)]});}})[_0x2ec60e(0x13a)](_0x113110=>{const _0x2b11f3=_0x2ec60e;common_1[_0x2b11f3(0x12b)][_0x2b11f3(0x1dc)](_0x113110),this[_0x2b11f3(0x29b)]({'id':_0x518f79,'userId':_0x535bf2[_0x2b11f3(0x28a)],'action':_0x535bf2[_0x2b11f3(0x186)]});});else{const {guild_id:_0x779033,channel_id:_0x55b54f,authorization:_0x5e0e1e,mjProxyUrl:_0x52c2aa,mjSocketProxyUrl:_0x41c062}=await this[_0x2ec60e(0x236)](_0x30e61d)[_0x2ec60e(0x13a)](_0x45c716=>{return Promise['reject'](_0x45c716);}),_0x2adaca=await this['runMjDescribeProxy']({'guild_id':_0x779033,'channel_id':_0x55b54f,'authorization':_0x5e0e1e,'files':_0x1a54da,'proxy':_0x52c2aa});await this[_0x2ec60e(0x1df)](_0x41c062)[_0x2ec60e(0x2c1)](_0x4f1280=>{const _0x223e57=_0x2ec60e;common_1[_0x223e57(0x12b)]['log']('socket.active',_0x4f1280[_0x223e57(0x211)]),common_1['Logger'][_0x223e57(0x14a)]('socket.connected',_0x4f1280[_0x223e57(0x19b)]),(!_0x4f1280[_0x223e57(0x211)]||!_0x4f1280['connected'])&&_0x4f1280['connect'](),_0x4f1280[_0x223e57(0x211)]&&!_0x4f1280[_0x223e57(0x19b)]&&_0x4f1280[_0x223e57(0x23c)](),_0x4f1280['on'](_0x223e57(0x253),async _0x174200=>{const _0x32498f=_0x223e57,{nonceId:_0x562c31,msg:_0x4c16a3,type:_0x1ab651}=_0x174200;if(_0x2adaca[_0x32498f(0x2dd)]===_0x562c31){if(_0x1ab651===_0x32498f(0x27d)){const {progress:_0x3cf96f,url:_0x3c9bd8,timestamp:_0x219092,id:_0x2dbbba,flags:_0x59bd92,components:_0x5660fe,embed:_0x51b049}=_0x4c16a3;console[_0x32498f(0x14a)](_0x32498f(0x144),_0x4c16a3);const _0x30370b=(new Date(_0x219092)[_0x32498f(0x1c2)]()-new Date(_0x535bf2[_0x32498f(0x206)])[_0x32498f(0x1c2)]())/0x3e8;await this['updateDrawData'](_0x1cdab6,{..._0x4c16a3,'components':_0x5660fe,'attachments':{'width':0x0,'height':0x0},'messageId':_0x2dbbba,'messageFlags':_0x59bd92,'url':_0x3c9bd8||'','action':_0x25759c,'prompt':_0x51b049[_0x32498f(0x30a)],'progress':_0x3cf96f,'durationSpent':_0x30370b}),common_1[_0x32498f(0x12b)]['log'](_0x32498f(0x1ff)),await this[_0x32498f(0x239)]({'durationSpent':_0x30370b,'id':_0x518f79,'messageId':_0x2dbbba,'messageFlags':_0x59bd92,'extend':JSON[_0x32498f(0x268)]({'components':_0x5660fe,'attachments':{}})||'','jobId':_0x1cdab6,'createdAt':_0x535bf2['createdAt'],'progress':_0x3cf96f,'action':_0x25759c,'url':_0x3c9bd8||'','type':_0x1ab651,'mode':_0x30e61d,'prompt':_0x51b049['description']});}}});});}return!![];}async[_0x12df21(0x258)](_0x93f1d6){const _0x14ac14=_0x12df21,{proxy:_0x54d40e,guild_id:_0x3ba355,files:_0x817dea,channel_id:_0x174da0,authorization:_0x421e0f}=_0x93f1d6;return await axios_1[_0x14ac14(0x1b3)]['post'](_0x54d40e+_0x14ac14(0x2d6),{'guild_id':_0x3ba355,'channel_id':_0x174da0,'token':_0x421e0f,'files':_0x817dea});}async[_0x12df21(0xf8)](_0x58d1d2){const _0x10662b=_0x12df21,{proxy:_0x591861,guild_id:_0x20c3eb,files:_0x5f4f92,channel_id:_0x3ee90c,authorization:_0x3f0ea4}=_0x58d1d2;return await axios_1[_0x10662b(0x1b3)][_0x10662b(0x11a)](_0x591861+_0x10662b(0x23a),{'guild_id':_0x20c3eb,'channel_id':_0x3ee90c,'token':_0x3f0ea4,'files':_0x5f4f92});}async['runMjBlendTask'](_0x5b3793){const _0x454986=_0x12df21;common_1['Logger'][_0x454986(0x14a)](_0x454986(0x122));const {jobId:_0x187bfa}=_0x5b3793,_0x4645c8=await this['midjourneyEntity'][_0x454986(0x2fd)]({'where':{'jobId':_0x187bfa}});await this[_0x454986(0x25e)](_0x187bfa,midjourney_constant_1['MidjourneyStatusEnum'][_0x454986(0x105)]);const _0x1bff74=await this['globalConfigService'][_0x454986(0x1f7)](['mjProxy']),{mode:_0x17134e,id:_0x3a90ea,createdAt:_0x38ac4f,extraParam:_0x215025,action:_0x68cffa}=_0x4645c8;if(!_0x215025){common_1[_0x454986(0x12b)][_0x454986(0x1dc)](_0x454986(0x221)),this[_0x454986(0x29b)]({'id':_0x3a90ea,'userId':_0x4645c8[_0x454986(0x28a)],'action':_0x4645c8[_0x454986(0x186)]});return;}const _0xfbb4a4=JSON[_0x454986(0x1ed)](_0x215025),{attachments:_0x1cfbd2}=_0xfbb4a4;common_1['Logger'][_0x454986(0x14a)](_0x1bff74==0x0,'执行图混图是否代理');if(Number(_0x1bff74)===0x0){const _0x284453=await this[_0x454986(0x295)]({'attachments':_0x1cfbd2,'mode':_0x17134e},async(_0x24634f,_0x243923)=>{const _0x1acbc3=_0x454986;console[_0x1acbc3(0x14a)](_0x1acbc3(0x24b),_0x24634f,_0x243923);if(_0x24634f===_0x1acbc3(0x27d)){console[_0x1acbc3(0x14a)](_0x1acbc3(0x1c8),_0x68cffa);const {progress:_0x4bdb31,content:_0x3497dc,url:_0x1ce51e,id:_0x5dfa3a,attachments:_0x2d5fe2,flags:_0x2cc230,components:_0x142c4f}=_0x243923;await this[_0x1acbc3(0x239)]({'messageId':_0x5dfa3a,'messageFlags':_0x2cc230,'id':_0x3a90ea,'jobId':_0x187bfa,'createdAt':_0x38ac4f,'extend':JSON[_0x1acbc3(0x268)]({'components':_0x142c4f,'attachments':_0x2d5fe2[0x0]||{}})||'','url':_0x1ce51e,'action':_0x4645c8[_0x1acbc3(0x186)],'progress':_0x4bdb31,'type':_0x1acbc3(0x27d),'mode':_0x17134e,'prompt':_0x3497dc});}})[_0x454986(0x13a)](_0x5ca285=>{const _0x6185d0=_0x454986;common_1[_0x6185d0(0x12b)]['error'](_0x5ca285),this['drawFailed']({'id':_0x3a90ea,'userId':_0x4645c8[_0x6185d0(0x28a)],'action':_0x4645c8['action']});});console[_0x454986(0x14a)](_0x454986(0x13e),_0x284453);const _0x561b78=(new Date(_0x284453[_0x454986(0x28b)])[_0x454986(0x1c2)]()-new Date(_0x38ac4f)[_0x454986(0x1c2)]())/0x3e8,{url:_0x15028c,progress:_0x216410,components:_0x1e913f,attachments:_0x2928d0}=_0x284453;await this[_0x454986(0x164)](_0x187bfa,{..._0x284453,'components':_0x1e913f,'attachments':_0x2928d0[0x0]||{},'messageFlags':_0x284453[_0x454986(0x1a2)],'messageId':_0x284453['id'],'url':_0x15028c,'progress':_0x216410,'action':_0x4645c8['action'],'durationSpent':_0x561b78,'prompt':_0x284453['content']}),await this[_0x454986(0x239)]({'durationSpent':_0x561b78,'messageId':_0x284453['id'],'messageFlags':_0x284453['flags'],'id':_0x3a90ea,'jobId':_0x187bfa,'createdAt':_0x38ac4f,'extend':JSON[_0x454986(0x268)]({'components':_0x1e913f,'attachments':_0x2928d0[0x0]||{}})||'','url':_0x15028c,'action':_0x4645c8[_0x454986(0x186)],'progress':_0x216410,'type':_0x454986(0x2f2),'mode':_0x17134e,'prompt':_0x284453['content']});}else{common_1['Logger'][_0x454986(0x14a)](_0x454986(0x146));const {guild_id:_0xef3d9d,channel_id:_0x4c8c87,authorization:_0x26f0fe,mjProxyUrl:_0x443a7b,mjSocketProxyUrl:_0x1cbb86}=await this[_0x454986(0x236)](_0x17134e)[_0x454986(0x13a)](_0x44b4b5=>{const _0x36abd5=_0x454986;return Promise[_0x36abd5(0x106)](_0x44b4b5);}),_0x2ee627=await this[_0x454986(0xf8)]({'guild_id':_0xef3d9d,'channel_id':_0x4c8c87,'authorization':_0x26f0fe,'files':_0x1cfbd2,'proxy':_0x443a7b});await this[_0x454986(0x1df)](_0x1cbb86)[_0x454986(0x2c1)](_0x3eeb4e=>{const _0x1648bb=_0x454986;common_1['Logger'][_0x1648bb(0x14a)](_0x1648bb(0x231),_0x3eeb4e['active']),common_1[_0x1648bb(0x12b)][_0x1648bb(0x14a)](_0x1648bb(0x2b1),_0x3eeb4e[_0x1648bb(0x19b)]),(!_0x3eeb4e[_0x1648bb(0x211)]||!_0x3eeb4e[_0x1648bb(0x19b)])&&_0x3eeb4e[_0x1648bb(0x23c)](),_0x3eeb4e[_0x1648bb(0x211)]&&!_0x3eeb4e[_0x1648bb(0x19b)]&&_0x3eeb4e[_0x1648bb(0x23c)](),_0x3eeb4e['on'](_0x1648bb(0x20c),async _0x5cab85=>{const _0x3d6eb8=_0x1648bb,{nonceId:_0x2fc843,msg:_0x737b2e,type:_0x34cba0}=_0x5cab85;if(_0x2ee627[_0x3d6eb8(0x2dd)]===_0x2fc843){if(_0x34cba0===_0x3d6eb8(0x27d)||_0x34cba0==='MESSAGE_CREATE'){const {progress:_0x2a0308,content:_0x2ac8db,url:_0x549209,id:_0x53c0bc,attachments:_0x14473f,flags:_0x194810,components:_0x2a649e}=_0x737b2e;if(_0x2a0308<0x64)await this[_0x3d6eb8(0x239)]({'messageId':_0x53c0bc,'messageFlags':_0x194810,'id':_0x3a90ea,'jobId':_0x187bfa,'createdAt':_0x38ac4f,'extend':JSON[_0x3d6eb8(0x268)]({'components':_0x2a649e,'attachments':_0x14473f[0x0]||{}})||'','url':_0x549209,'action':_0x4645c8[_0x3d6eb8(0x186)],'progress':_0x2a0308,'type':_0x3d6eb8(0x27d),'mode':_0x17134e,'prompt':_0x2ac8db});else{const _0x3b331a=(new Date(_0x737b2e[_0x3d6eb8(0x28b)])[_0x3d6eb8(0x1c2)]()-new Date(_0x38ac4f)['getTime']())/0x3e8,{components:_0x519a9a,attachments:_0x4909c8}=_0x737b2e;await this['updateDrawData'](_0x187bfa,{'components':_0x519a9a,'attachments':_0x4909c8[0x0]||{},'messageFlags':_0x194810,'messageId':_0x53c0bc,'url':_0x549209,'progress':_0x2a0308,'action':_0x4645c8['action'],'durationSpent':_0x3b331a,'prompt':_0x2ac8db}),await this['saveToRedis']({'durationSpent':_0x3b331a,'messageId':_0x53c0bc,'messageFlags':_0x194810,'id':_0x3a90ea,'jobId':_0x187bfa,'createdAt':_0x38ac4f,'extend':JSON[_0x3d6eb8(0x268)]({'components':_0x519a9a,'attachments':_0x4909c8[0x0]||{}})||'','url':_0x549209,'action':_0x4645c8['action'],'progress':_0x2a0308,'type':_0x3d6eb8(0x2f2),'mode':_0x17134e,'prompt':_0x2ac8db});}}}});});}return!![];}async[_0x12df21(0x1b4)](_0x5709c9){const _0x5cd5ee=_0x12df21,{jobId:_0x190c98,messageId:_0x164f83,drawId:_0x4a6724,customId:_0x24f48e,messageFlags:_0x3688d4}=_0x5709c9,_0x5de09a=await this['midjourneyEntity'][_0x5cd5ee(0x2fd)]({'where':{'jobId':_0x190c98}});await this[_0x5cd5ee(0x25e)](_0x190c98,midjourney_constant_1[_0x5cd5ee(0x141)][_0x5cd5ee(0x105)]);const _0xe9a95e=await this['globalConfigService'][_0x5cd5ee(0x1f7)]([_0x5cd5ee(0x2d2)]),{mode:_0x3724a3}=_0x5de09a;if(Number(_0xe9a95e)===0x0){const _0x2b1650=await this[_0x5cd5ee(0x1bf)]({'messageId':_0x164f83,'customId':_0x24f48e,'messageFlags':_0x3688d4,'mode':_0x3724a3},async(_0x203a47,_0x255f9f)=>{const _0x597fdc=_0x5cd5ee;if(_0x203a47==='MESSAGE_UPDATE'){common_1['Logger'][_0x597fdc(0x14a)]('MESSAGE_UPDATE\x20jobId',_0x190c98);const {progress:_0x155dee,content:_0x148f67,url:_0x54aeeb,id:_0x1ed803,flags:_0x45ba39,components:_0x13ff9b}=_0x255f9f;_0x5de09a[_0x597fdc(0x186)]!==midjourney_constant_1[_0x597fdc(0x2ad)][_0x597fdc(0x2a2)]&&await this[_0x597fdc(0x239)]({'id':_0x4a6724,'messageId':_0x1ed803,'messageFlags':_0x45ba39,'extend':JSON[_0x597fdc(0x268)]({'components':_0x13ff9b})||'','jobId':_0x190c98,'action':_0x5de09a[_0x597fdc(0x186)],'createdAt':_0x5de09a[_0x597fdc(0x206)],'progress':_0x155dee,'url':_0x54aeeb||'','type':_0x203a47,'mode':_0x3724a3,'prompt':_0x148f67||''});}if(_0x203a47===_0x597fdc(0x238)){const {progress:_0x113367,id:_0x5b194e,flags:_0x4c86bd,url:_0x2e3eb2,attachments:_0x2206af,components:_0x12b64d}=_0x255f9f;common_1[_0x597fdc(0x12b)][_0x597fdc(0x14a)]('MESSAGE_CREATE\x20jobId',_0x190c98),await this[_0x597fdc(0x239)]({'id':_0x4a6724,'messageId':_0x5b194e,'messageFlags':_0x4c86bd,'extend':JSON['stringify']({'components':_0x12b64d,'attachments':_0x2206af})||'','jobId':_0x190c98,'action':_0x5de09a[_0x597fdc(0x186)],'createdAt':_0x5de09a['createdAt'],'progress':_0x113367,'url':_0x2e3eb2||'','type':_0x203a47,'mode':_0x3724a3,'prompt':_0x255f9f[_0x597fdc(0x1fd)]||_0x5de09a[_0x597fdc(0x2df)]});}if(_0x203a47==='INTERACTION_MODAL_CREATE'){const {components:_0x2bbc42,id:_0x28d7cd,custom_id:_0xf100a7}=_0x255f9f;await this[_0x597fdc(0x278)]({'mode':_0x3724a3,'components':_0x2bbc42,'customId':_0xf100a7,'id':_0x28d7cd,'action':_0x5de09a[_0x597fdc(0x186)],'jobId':_0x190c98,'drawId':_0x4a6724,'createdAt':_0x5de09a[_0x597fdc(0x206)]});}})[_0x5cd5ee(0x13a)](_0x347f64=>{const _0x189eb2=_0x5cd5ee;common_1[_0x189eb2(0x12b)]['error'](_0x347f64),this[_0x189eb2(0x29b)]({'id':_0x4a6724,'userId':_0x5de09a[_0x189eb2(0x28a)],'action':_0x5de09a[_0x189eb2(0x186)]});});if(!_0x2b1650)return;const _0x14525d=(new Date(_0x2b1650['timestamp'])['getTime']()-new Date(_0x5de09a[_0x5cd5ee(0x206)])[_0x5cd5ee(0x1c2)]())/0x3e8,{url:_0x2c8b56,progress:_0xf0aba8,attachments:_0x597780,components:_0x5aae60}=_0x2b1650;await this[_0x5cd5ee(0x164)](_0x190c98,{..._0x2b1650,'components':_0x5aae60,'attachments':_0x597780[0x0]||{},'messageId':_0x2b1650['id'],'messageFlags':_0x2b1650[_0x5cd5ee(0x1a2)],'url':_0x2c8b56,'action':_0x5de09a[_0x5cd5ee(0x186)],'prompt':_0x2b1650[_0x5cd5ee(0x1fd)],'progress':_0xf0aba8,'durationSpent':_0x14525d}),await this[_0x5cd5ee(0x239)]({'durationSpent':_0x14525d,'messageId':_0x2b1650['id'],'messageFlags':_0x2b1650[_0x5cd5ee(0x1a2)],'id':_0x5de09a['id'],'jobId':_0x190c98,'createdAt':_0x5de09a[_0x5cd5ee(0x206)],'extend':JSON[_0x5cd5ee(0x268)]({'components':_0x5aae60,'attachments':_0x597780}),'action':_0x5de09a[_0x5cd5ee(0x186)],'url':_0x2c8b56,'progress':_0xf0aba8,'type':_0x5cd5ee(0x2f2),'mode':_0x3724a3,'prompt':_0x2b1650[_0x5cd5ee(0x1fd)]});}else{const {guild_id:_0x49f7d8,channel_id:_0x620cc2,authorization:_0x3aca22,mjProxyUrl:_0x32d395,mjSocketProxyUrl:_0x6e7f2a}=await this['getMjDefaultParams'](_0x3724a3)[_0x5cd5ee(0x13a)](_0xd6e1da=>{return Promise['reject'](_0xd6e1da);}),_0x4b2f53=await this[_0x5cd5ee(0x300)]({'message_id':_0x164f83,'custom_id':_0x24f48e,'channel_id':_0x620cc2,'proxy':_0x32d395,'flags':_0x3688d4,'authorization':_0x3aca22,'guild_id':_0x49f7d8});await this[_0x5cd5ee(0x1df)](_0x6e7f2a)[_0x5cd5ee(0x2c1)](_0x4cda6a=>{const _0xea6adf=_0x5cd5ee;common_1['Logger'][_0xea6adf(0x14a)](_0xea6adf(0x231),_0x4cda6a[_0xea6adf(0x211)]),common_1[_0xea6adf(0x12b)][_0xea6adf(0x14a)](_0xea6adf(0x2b1),_0x4cda6a[_0xea6adf(0x19b)]),(!_0x4cda6a[_0xea6adf(0x211)]||!_0x4cda6a[_0xea6adf(0x19b)])&&_0x4cda6a['connect'](),_0x4cda6a[_0xea6adf(0x211)]&&!_0x4cda6a[_0xea6adf(0x19b)]&&_0x4cda6a[_0xea6adf(0x23c)](),_0x4cda6a['on'](_0xea6adf(0x186),async _0xfd8c0c=>{const _0x4b7895=_0xea6adf,{nonceId:_0x299b8b,msg:_0xda7ff3,type:_0x25d10f}=_0xfd8c0c;if(_0x4b2f53['data']===_0x299b8b){if(_0x25d10f===_0x4b7895(0x27d)){const {progress:_0x47d5a9,content:_0x410beb,createdAt:_0x409c60,url:_0x31ce25,id:_0x226302,flags:_0x2ac1b2,attachments:_0x5093b2,components:_0x2c8e85}=_0xda7ff3;_0x5de09a[_0x4b7895(0x186)]!==midjourney_constant_1[_0x4b7895(0x2ad)]['IMAGE_TO_TEXT_ACTION']&&(console[_0x4b7895(0x14a)]('执行按钮操作',_0x47d5a9,_0x5de09a[_0x4b7895(0x186)]),await this[_0x4b7895(0x239)]({'id':_0x4a6724,'messageId':_0x226302,'messageFlags':_0x2ac1b2,'extend':JSON[_0x4b7895(0x268)]({'components':_0x2c8e85})||'','jobId':_0x190c98,'action':_0x5de09a[_0x4b7895(0x186)],'createdAt':_0x5de09a['createdAt'],'progress':_0x47d5a9,'url':_0x31ce25||'','type':_0x25d10f,'mode':_0x3724a3,'prompt':_0x410beb||''}));}if(_0x25d10f===_0x4b7895(0x238)){console[_0x4b7895(0x14a)](_0x4b7895(0x177));const {progress:_0xa0a4bf,timestamp:_0x4b2d57,createdAt:_0x241145,content:_0x3e4397,id:_0x152181,flags:_0x4ceb11,url:_0x10fb36,attachments:_0x2a9118,components:_0x9d8a04}=_0xda7ff3;if(_0xa0a4bf===0x64){console[_0x4b7895(0x14a)](_0x4b2d57),console[_0x4b7895(0x14a)](_0x5de09a[_0x4b7895(0x206)]);const _0x3392f2=(new Date(_0x4b2d57)[_0x4b7895(0x1c2)]()-new Date(_0x5de09a[_0x4b7895(0x206)])[_0x4b7895(0x1c2)]())/0x3e8;console[_0x4b7895(0x14a)](_0x3392f2),await this[_0x4b7895(0x164)](_0x5de09a[_0x4b7895(0x309)],{..._0xda7ff3,'url':_0x10fb36,'attachments':_0x2a9118,'action':_0x5de09a[_0x4b7895(0x186)],'progress':_0xa0a4bf,'prompt':_0x3e4397,'messageId':_0x164f83,'messageFlags':_0x4ceb11,'durationSpent':_0x3392f2}),await this[_0x4b7895(0x239)]({'progress':_0xa0a4bf,'url':_0x10fb36,'type':_0x4b7895(0x27d),'durationSpent':_0x3392f2,'jobId':_0x5de09a[_0x4b7895(0x309)],'createdAt':_0x241145,'action':_0x5de09a[_0x4b7895(0x186)],'messageId':_0x164f83,'messageFlags':_0x4ceb11,'extend':JSON['stringify']({'components':_0x9d8a04,'attachments':_0x2a9118[0x0]||{}})||'','id':_0x5de09a['id'],'mode':_0x3724a3,'prompt':_0x3e4397});}else await this['saveToRedis']({'id':_0x4a6724,'messageId':_0x152181,'messageFlags':_0x4ceb11,'extend':JSON[_0x4b7895(0x268)]({'components':_0x9d8a04,'attachments':_0x2a9118})||'','jobId':_0x190c98,'action':_0x5de09a[_0x4b7895(0x186)],'createdAt':_0x5de09a[_0x4b7895(0x206)],'progress':_0xa0a4bf,'url':_0x10fb36||'','type':_0x25d10f,'mode':_0x3724a3,'prompt':_0xda7ff3[_0x4b7895(0x1fd)]||_0x5de09a[_0x4b7895(0x2df)]});}if(_0x25d10f===_0x4b7895(0x2aa)){const {components:_0x4ed898,id:_0x200a75,custom_id:_0x44ef22}=_0xda7ff3;await this[_0x4b7895(0x278)]({'mode':_0x3724a3,'components':_0x4ed898,'customId':_0x44ef22,'id':_0x200a75,'action':_0x5de09a[_0x4b7895(0x186)],'jobId':_0x190c98,'drawId':_0x4a6724,'createdAt':_0x5de09a[_0x4b7895(0x206)]});}}});});}return!![];}async[_0x12df21(0x239)](_0x213511){const _0x5eebe6=_0x12df21,{jobId:_0x396228,durationSpent:_0x333747,action:_0xa66a7a,messageId:_0xd092e4,messageFlags:_0x156237,id:_0x4a06cc,type:_0x1071bb,extend:_0x3725f3,createdAt:_0x576daa,progress:_0x2f3e12,url:_0xac7093,prompt:_0x446fd7,mode:_0x10e699}=_0x213511;let _0x4a0179='';if(_0xac7093){const _0x1dd251=await this[_0x5eebe6(0x167)]['getConfigs']([_0x5eebe6(0xf7)]);_0x4a0179=_0x1dd251+_0x5eebe6(0x2e9)+_0xac7093;}return this['redisCacheService'][_0x5eebe6(0x181)]({'key':_0x396228,'val':JSON[_0x5eebe6(0x268)]({'durationSpent':_0x333747,'messageId':_0xd092e4,'messageFlags':_0x156237,'id':_0x4a06cc,'action':_0xa66a7a,'extend':_0x3725f3,'progress':_0x2f3e12,'createdAt':_0x576daa,'status':_0x2f3e12<0x64?midjourney_constant_1['MidjourneyStatusEnum'][_0x5eebe6(0x105)]:midjourney_constant_1['MidjourneyStatusEnum'][_0x5eebe6(0x21a)],'prompt':_0x446fd7,'mode':_0x10e699,'type':_0x1071bb,'cosUrl':_0x4a0179})},0x5*0x3c*0x3e8);}async['handleGetRegionInfo'](_0x2dfaf9){const {messageId:_0x348f61,customId:_0x3976bf,messageFlags:_0x629486,mode:_0x7663c4}=_0x2dfaf9;return new Promise(async _0xa085b7=>{const _0x575026=_0xe190,{guild_id:_0x2ece1a,channel_id:_0x5869dc,authorization:_0x399c1a,mjProxyUrl:_0x330f1e,mjProxy:_0x3cfe07}=await this[_0x575026(0x236)](_0x7663c4)[_0x575026(0x13a)](_0x5a63d7=>{const _0x511c9d=_0x575026;return Promise[_0x511c9d(0x106)](_0x5a63d7);});if(_0x3cfe07==0x0)await this[_0x575026(0x120)](_0x7663c4),await this[_0x575026(0x1bf)]({'messageId':_0x348f61,'customId':_0x3976bf,'messageFlags':_0x629486,'mode':_0x7663c4},async(_0x3ba61e,_0x1f9f67)=>{if(_0x3ba61e==='INTERACTION_IFRAME_MODAL_CREATE'){const {custom_id:_0x30cf2b,id:_0x30f66a,nonce:_0x154b1d,varyRegionImgBase64:_0x31641e,varyRegionPrompt:_0x3651dc}=_0x1f9f67;_0xa085b7({'customId':_0x30cf2b,'messageId':_0x30f66a,'nonce':_0x154b1d,'varyRegionImgBase64':_0x31641e,'varyRegionPrompt':_0x3651dc});}})[_0x575026(0x13a)](_0x2ad616=>{const _0x168013=_0x575026;common_1[_0x168013(0x12b)][_0x168013(0x1dc)](_0x2ad616);});else{const _0x52b10a=await this[_0x575026(0x16a)]({'messageId':_0x348f61,'customId':_0x3976bf,'messageFlags':_0x629486,'guild_id':_0x2ece1a,'channel_id':_0x5869dc,'authorization':_0x399c1a,'mjProxyUrl':_0x330f1e});_0xa085b7(_0x52b10a);}});}async[_0x12df21(0x2a4)](_0x1750a4){const _0x8db464=_0x12df21;try{const _0x40208d=await this['midjourneyEntity']['findOne']({'where':{'jobId':_0x1750a4}});if(!_0x40208d)throw new Error(_0x8db464(0x2a9));const _0x5aff3d=await this[_0x8db464(0x21d)][_0x8db464(0x2a4)]({},_0x40208d['mjpTaskId']);if(_0x5aff3d[_0x8db464(0x1d0)]!==0x1)throw new Error(_0x5aff3d['description']);return _0x5aff3d[_0x8db464(0x1ce)];}catch(_0x5903a0){throw new common_1[(_0x8db464(0x1b0))](_0x5903a0['message'],common_1[_0x8db464(0x1f3)][_0x8db464(0x249)]);}}async[_0x12df21(0x16a)](_0x54c46c){const _0x451414=_0x12df21,{messageId:_0x111829,customId:_0x246c0d,messageFlags:_0x3fdcfe,guild_id:_0x465c60,channel_id:_0x51fc1f,authorization:_0x4717c0,mjProxyUrl:_0x205a48}=_0x54c46c;return axios_1[_0x451414(0x1b3)][_0x451414(0x11a)](_0x205a48+'/api/mj/region_info',{'message_id':_0x111829,'custom_id':_0x246c0d,'flags':_0x3fdcfe,'guild_id':_0x465c60,'channel_id':_0x51fc1f,'token':_0x4717c0})['then'](_0x96745b=>_0x96745b['data']);}async[_0x12df21(0x278)](_0x1d4a12){const _0x251761=_0x12df21,{mode:_0x2b8f83,id:_0x33b162,customId:_0x4d9ca1,createdAt:_0x19b430,jobId:_0x22d0c9,drawId:_0x57b575,action:_0x4d8bd2,components:_0x167055}=_0x1d4a12;await this[_0x251761(0x120)](_0x2b8f83);const _0x2d662d=await this[_0x251761(0x225)][_0x2b8f83]['api'][_0x251761(0x119)](_0x33b162,_0x4d9ca1,_0x167055,(_0x4aebb1,_0x167b67)=>{const _0x108b41=_0x251761;if(_0x4aebb1===_0x108b41(0x27d)){const {progress:_0x407840,content:_0x53d427,url:_0x2292bf,id:_0xa5423f,flags:_0x414244,components:_0x36aa41}=_0x167b67;this[_0x108b41(0x239)]({'messageId':_0xa5423f,'messageFlags':_0x414244,'id':_0x57b575,'extend':JSON[_0x108b41(0x268)]({'components':_0x36aa41})||'','jobId':_0x22d0c9,'createdAt':_0x19b430,'progress':_0x407840,'action':_0x4d8bd2,'url':_0x2292bf,'type':_0x4aebb1,'mode':_0x2b8f83,'prompt':_0x53d427});}});console[_0x251761(0x14a)](_0x251761(0x1f1),_0x2d662d);const _0xf3c561=(new Date(_0x2d662d[_0x251761(0x28b)])[_0x251761(0x1c2)]()-new Date(_0x19b430)['getTime']())/0x3e8,{url:_0x372ce4,progress:_0x377961,components:_0x463900,attachments:_0x4a9af5}=_0x2d662d;await this[_0x251761(0x164)](_0x22d0c9,{..._0x2d662d,'components':_0x463900,'action':_0x4d8bd2,'attachments':_0x4a9af5[0x0]||{},'prompt':_0x2d662d[_0x251761(0x1fd)],'messageFlags':_0x2d662d['flags'],'messageId':_0x2d662d['id'],'url':_0x372ce4,'progress':_0x377961,'durationSpent':_0xf3c561}),await this[_0x251761(0x239)]({'jobId':_0x22d0c9,'messageId':_0x2d662d['id'],'messageFlags':_0x2d662d[_0x251761(0x1a2)],'id':_0x57b575,'durationSpent':_0xf3c561,'createdAt':_0x19b430,'extend':JSON['stringify']({'components':_0x463900,'attachments':_0x4a9af5[0x0]||{}})||'','url':_0x372ce4,'action':_0x4d8bd2,'progress':_0x377961,'type':_0x251761(0x2f2),'mode':_0x2b8f83,'prompt':_0x2d662d['content']});}async[_0x12df21(0x164)](_0x1afd19,_0x1f5ab3){const _0x49ed09=_0x12df21;try{const {url:_0x30cb9d,messageId:_0x406c47,action:_0x2ac7c2,components:_0xcbb460,messageFlags:_0x502404,prompt:prompt='',attachments:_0x391a18,durationSpent:_0x2c915d,progress:_0x55fec9}=_0x1f5ab3;console[_0x49ed09(0x14a)](_0x49ed09(0x205),_0x55fec9);const {width:width=0x0,height:height=0x0}=_0x391a18,_0x5a0af7=await this[_0x49ed09(0x167)]['getConfigs']([_0x49ed09(0x2c9)]);common_1[_0x49ed09(0x12b)][_0x49ed09(0x14a)](_0x49ed09(0x173),_0x5a0af7);let _0x49fd45='';const _0x43ad25=Date[_0x49ed09(0x255)]();if(!Number(_0x5a0af7)||Number(_0x5a0af7)===0x0){common_1[_0x49ed09(0x12b)][_0x49ed09(0x14a)](_0x49ed09(0x2cc),'MidjourneyService');const _0x4094f7=new Date();_0x49fd45=await this[_0x49ed09(0x2f0)]['uploadFileFromUrl']({'filename':_0x43ad25,'url':_0x30cb9d}),console['log'](_0x49ed09(0x151),_0x49fd45);const _0x29f760=new Date();common_1[_0x49ed09(0x12b)]['log'](_0x49ed09(0x14d)+(_0x29f760['getTime']()-_0x4094f7[_0x49ed09(0x1c2)]())/0x3e8+'秒',_0x49ed09(0x25c));}else{const _0x3862d4=await this['globalConfigService'][_0x49ed09(0x1f7)]([_0x49ed09(0xf7)]);_0x49fd45=_0x3862d4+_0x49ed09(0x2e9)+_0x30cb9d,common_1[_0x49ed09(0x12b)][_0x49ed09(0x14a)](_0x49ed09(0x1ad));}const _0x406ce3=await this[_0x49ed09(0x2f0)][_0x49ed09(0x138)](),_0x2ff9c3={'prompt':prompt,'messageId':_0x406c47,'messageFlags':_0x502404,'status':midjourney_constant_1[_0x49ed09(0x141)][_0x49ed09(0x21a)],'progress':_0x55fec9,'action':_0x2ac7c2,'fileInfo':JSON[_0x49ed09(0x268)]({'filename':_0x43ad25,'cosUrl':_0x49fd45,'width':width,'height':height,'cosType':_0x406ce3}),'extend':JSON[_0x49ed09(0x268)]({'attachments':_0x391a18,'components':_0xcbb460,'url':_0x30cb9d}),'durationSpent':_0x2c915d||0x0,'isSaveImg':!Number(_0x5a0af7)||Number(_0x5a0af7)===0x0};console[_0x49ed09(0x14a)](_0x49ed09(0x222),_0x2ff9c3),await this[_0x49ed09(0x2e7)][_0x49ed09(0x2f6)]({'jobId':_0x1afd19},_0x2ff9c3)[_0x49ed09(0x2c1)](_0x140e78=>_0x140e78[_0x49ed09(0x2ba)]>0x0)[_0x49ed09(0x13a)](_0x3ecf28=>{throw new Error(_0x3ecf28);});}catch(_0x283112){console[_0x49ed09(0x14a)](_0x49ed09(0x128),_0x1afd19,_0x283112);}}[_0x12df21(0x2fc)](_0x502756,_0x29c927,_0xc078c6,_0x130526){const _0x14dee4=_0x12df21;if(!_0x502756)return{};const _0x230f0b=JSON[_0x14dee4(0x1ed)](_0x502756),{cosUrl:_0x1ac48b,width:_0x1de32b,height:_0x1121be,cosType:_0x1d3505}=_0x230f0b,_0x240205=0x136,_0x3573cc=_0x1d3505||(_0x1ac48b[_0x14dee4(0x121)](_0x14dee4(0x195))?_0x14dee4(0x178):_0x1ac48b[_0x14dee4(0x121)](_0x14dee4(0x270))?_0x14dee4(0x215):_0x14dee4(0x2cb));let _0x47ad6c;if(_0x3573cc===_0x14dee4(0x178)){const _0x1ceee8=_0x1de32b/_0x1121be,_0x25f1ed=Math[_0x14dee4(0x246)](_0x240205/_0x1ceee8);_0x47ad6c=_0x1ac48b+('?imageView2/1/w/'+_0x240205+_0x14dee4(0x25f)+_0x25f1ed+'/q/55');}if(_0x3573cc===_0x14dee4(0x215)){const _0x1c7ddb=_0x1121be/_0x1de32b,_0x19d6e6=Math[_0x14dee4(0x246)](_0x240205/_0x1c7ddb);_0x47ad6c=_0x1ac48b+(_0x14dee4(0x28e)+_0x19d6e6);}_0x3573cc===_0x14dee4(0x2cb)&&(_0x47ad6c=_0x1ac48b[_0x14dee4(0x1aa)](/\.png$/,_0x14dee4(0x22e)));_0x230f0b['thumbImg']=_0x47ad6c;if(!_0x29c927){const _0x196e4e=_0xc078c6+_0x14dee4(0x2e9)+_0x130526;_0x230f0b['thumbImg']=_0x196e4e,_0x230f0b[_0x14dee4(0x277)]=_0x196e4e;}return _0x230f0b;}[_0x12df21(0x2d7)](_0x42428f){const _0x590aa5=_0x12df21,_0x59ff81=/- Variations \(.*?\)/;return _0x59ff81[_0x590aa5(0x16f)](_0x42428f);}async[_0x12df21(0x112)](){const _0x49b315=_0x12df21;return await this[_0x49b315(0x2e0)]['count']({'where':{'enable':0x1,'mode':(0x0,typeorm_2['In'])([midjourney_constant_1[_0x49b315(0x290)][_0x49b315(0x2fb)],midjourney_constant_1[_0x49b315(0x290)][_0x49b315(0x28f)],midjourney_constant_1[_0x49b315(0x290)]['turbo']])}})[_0x49b315(0x2c1)](_0x382b03=>_0x382b03>0x0)['catch'](_0x10041d=>{const _0x1a5402=_0x49b315;return common_1[_0x1a5402(0x12b)][_0x1a5402(0x1dc)](_0x10041d),![];});}async[_0x12df21(0x107)](_0x20e6c0=midjourney_constant_1[_0x12df21(0x290)][_0x12df21(0x2fb)]){const _0xa56082=_0x12df21,_0x58eb52=await this[_0xa56082(0x2e0)]['find']({'where':{'enable':0x1,'mode':_0x20e6c0},'order':{'weight':_0xa56082(0x245)}});if(!_0x58eb52[_0xa56082(0x126)])return Promise['reject'](_0xa56082(0x20f)+(_0x20e6c0===midjourney_constant_1[_0xa56082(0x290)][_0xa56082(0x2fb)]?'快速':_0x20e6c0===midjourney_constant_1[_0xa56082(0x290)]['relax']?'休闲':_0xa56082(0x170))+_0xa56082(0x134));return(0x0,utils_1[_0xa56082(0x294)])(_0x58eb52);}async[_0x12df21(0x118)](_0x21d38a){const _0x41d8fc=_0x12df21;if(MjConfig_1[_0x41d8fc(0x1b3)][_0x41d8fc(0x293)]!==_0x41d8fc(0x2d2))return new mjParam_entity_1[(_0x41d8fc(0x2bf))]();const _0x18c3e8=await this['mjParamEntity']['find']({'where':{'enable':0x1,'mode':_0x21d38a,'fastRemainTime':(0x0,typeorm_2[_0x41d8fc(0x1ab)])((0x0,typeorm_2[_0x41d8fc(0x2a0)])())},'order':{'weight':_0x41d8fc(0x245)}});if(!_0x18c3e8[_0x41d8fc(0x126)])throw new Error('没有满足条件的MJ账号，请联系管理员！');return _0x18c3e8[0x0];}async[_0x12df21(0x227)](_0x4155c6){const _0x1ac5b0=_0x12df21,{proxyUrl:_0x1d6330}=_0x4155c6,_0x1b3464=await this[_0x1ac5b0(0x167)][_0x1ac5b0(0x1f7)]([_0x1ac5b0(0x1d1)]);return _0x1d6330||_0x1b3464||_0x1ac5b0(0x131);}async[_0x12df21(0x11f)](_0x4c6279){const _0x35a2e4=_0x12df21;try{const {guildId:_0x80d6de,account:_0x4ed81a,authorization:_0x3c7d2d,mode:_0x2a8bd0,timeout:_0x3e8857,channelId:_0x3caf47,remark:_0xd004c8,mjBotChannelId:_0x876d01,nijiBotChannelId:_0x54a5a9}=_0x4c6279;var _0x196245=await this[_0x35a2e4(0x114)]['create']({'data':{'channelId':_0x3caf47,'coreSize':0x3,'guildId':_0x80d6de,'mjBotChannelId':_0x876d01||'','nijiBotChannelId':_0x54a5a9||'','queueSize':0xa,'remark':_0xd004c8,'remixAutoSubmit':![],'timeoutMinutes':_0x3e8857,'userAgent':_0x35a2e4(0x13b),'userToken':_0x3c7d2d}});if(_0x196245[_0x35a2e4(0x1d0)]!==0x1)throw new Error(_0x196245[_0x35a2e4(0x30a)]);const _0x2a43ec=await this[_0x35a2e4(0x2e0)][_0x35a2e4(0x1b2)]({'account':_0x4ed81a,'authorization':_0x3c7d2d,'mode':_0x2a8bd0,'timeout':_0x3e8857,'channelId':_0x3caf47,'guildId':_0x80d6de,'remark':_0xd004c8,'mjpId':_0x196245[_0x35a2e4(0x1ce)],'mjBotChannelId':_0x876d01||'','nijiBotChannelId':_0x54a5a9||''});return await this[_0x35a2e4(0x274)](_0x196245[_0x35a2e4(0x1ce)]),!!_0x2a43ec;}catch(_0xad322d){common_1['Logger'][_0x35a2e4(0x1dc)](_0xad322d);throw new common_1['HttpException'](_0xad322d[_0x35a2e4(0x1c5)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x12df21(0x15c)](_0x2d8789){const _0x169aa8=_0x12df21,{id:_0x1e1706,account:_0x185308,authorization:_0x2adfa4,mode:_0x641f24,guildId:_0x3981eb,remark:_0x45506a,channelId:_0x25c994,timeout:_0x2fad1d,enable:_0x453847,mjBotChannelId:_0x3c269c,nijiBotChannelId:_0x24ad46}=_0x2d8789;try{const _0x5e07dd=await this[_0x169aa8(0x2e0)]['findOneBy']({'id':Number(_0x1e1706)});var _0x2b7528=await this[_0x169aa8(0x114)]['updateReconnect']({'data':{'channelId':_0x25c994,'coreSize':0x3,'guildId':_0x3981eb,'mjBotChannelId':_0x3c269c||'','nijiBotChannelId':_0x24ad46||'','queueSize':0xa,'remark':_0x45506a,'remixAutoSubmit':![],'timeoutMinutes':_0x2fad1d,'userAgent':_0x169aa8(0x13b),'userToken':_0x2adfa4,'enable':Boolean(_0x453847)}},_0x5e07dd[_0x169aa8(0x1cd)]);if(_0x2b7528['code']!==0x1)throw new Error(_0x2b7528[_0x169aa8(0x30a)]);return await this[_0x169aa8(0x2e0)]['update'](_0x1e1706,{'account':_0x185308,'authorization':_0x2adfa4,'mode':_0x641f24,'guildId':_0x3981eb,'remark':_0x45506a,'channelId':_0x25c994,'timeout':_0x2fad1d,'mjBotChannelId':_0x3c269c||'','nijiBotChannelId':_0x24ad46||''});}catch(_0x2e2b64){common_1[_0x169aa8(0x12b)][_0x169aa8(0x1dc)](_0x2e2b64);throw new common_1['HttpException'](_0x2e2b64['message'],common_1[_0x169aa8(0x1f3)][_0x169aa8(0x249)]);}}async[_0x12df21(0x104)](_0x389935,_0x306854){const _0x21017f=_0x12df21;_0x389935['mjVersion']=_0x306854[_0x21017f(0x1ef)];if(_0x306854[_0x21017f(0x183)]===_0x21017f(0x269))_0x389935['mode']=midjourney_constant_1[_0x21017f(0x290)][_0x21017f(0x2fb)];else{if(_0x306854[_0x21017f(0x183)]===_0x21017f(0x305))_0x389935[_0x21017f(0x183)]=midjourney_constant_1['DrawSpeed'][_0x21017f(0x28f)];else _0x306854[_0x21017f(0x183)]==='TURBO'&&(_0x389935[_0x21017f(0x183)]=midjourney_constant_1[_0x21017f(0x290)][_0x21017f(0x170)]);}_0x389935[_0x21017f(0x155)]=_0x306854[_0x21017f(0x28d)],_0x389935[_0x21017f(0x229)]=_0x306854[_0x21017f(0x28d)],_0x389935[_0x21017f(0x184)]=_0x306854[_0x21017f(0x184)],_0x389935[_0x21017f(0x223)]=_0x306854[_0x21017f(0x223)],_0x389935['remix']=Number(_0x306854[_0x21017f(0x2a3)]);if(_0x306854['subscribePlan']==='BASIC')_0x389935[_0x21017f(0x288)]=0x1;else{if(_0x306854['subscribePlan']==='STANDARD')_0x389935['orderPlan']=0x2;else{if(_0x306854['subscribePlan']===_0x21017f(0x311))_0x389935['orderPlan']=0x3;else _0x306854[_0x21017f(0x26a)]==='MEGA'&&(_0x389935['orderPlan']=0x4);}}_0x389935[_0x21017f(0x26c)]=_0x306854['renewDate'],_0x389935[_0x21017f(0x108)]=_0x306854['timeoutMinutes'],_0x389935[_0x21017f(0x19c)]=JSON[_0x21017f(0x268)](_0x306854[_0x21017f(0x201)]),_0x389935['info']=JSON[_0x21017f(0x268)](_0x306854[_0x21017f(0x123)]),await this['mjParamEntity'][_0x21017f(0x1b2)](_0x389935);}async[_0x12df21(0x274)](_0x4c284a){const _0x97b259=_0x12df21;try{if(MjConfig_1['default'][_0x97b259(0x293)]!=='mjProxy')return;const _0x2da032=await this[_0x97b259(0x114)]['fetch']({},_0x4c284a);if(!_0x2da032)return;const _0x29df58=await this['mjParamEntity']['findOne']({'where':{'mjpId':_0x4c284a}});await this[_0x97b259(0x104)](_0x29df58,_0x2da032);}catch(_0x9581df){common_1[_0x97b259(0x12b)][_0x97b259(0x1dc)](_0x97b259(0x25b),_0x9581df);}}async[_0x12df21(0x1a6)](){const _0x2839e3=_0x12df21,_0x4b5be6=await this[_0x2839e3(0x2e0)][_0x2839e3(0x2e3)]();if(!_0x4b5be6[_0x2839e3(0x126)])return;for(let _0xf25687=0x0;_0xf25687<_0x4b5be6['length'];_0xf25687++){this[_0x2839e3(0x274)](_0x4b5be6[_0xf25687]['mjpId']);}}async[_0x12df21(0x2ab)]({id:_0xb25c51}){const _0x174eb2=_0x12df21;try{const _0x4c200b=await this[_0x174eb2(0x2e0)][_0x174eb2(0x1fe)]({'id':Number(_0xb25c51)}),_0x25fbbf=await this['mjpAccountService']['syncInfo']({},_0x4c200b['mjpId']);if(_0x25fbbf[_0x174eb2(0x1d0)]!==0x1)throw new Error(_0x25fbbf['description']);await this[_0x174eb2(0x104)](_0x4c200b,_0x25fbbf['result']);}catch(_0x3dbcd3){throw new common_1['HttpException'](_0x3dbcd3[_0x174eb2(0x1c5)],common_1[_0x174eb2(0x1f3)][_0x174eb2(0x249)]);}}async[_0x12df21(0x21f)](_0x265951){const _0x3c13ae=_0x12df21;try{const _0x9b8638=await this[_0x3c13ae(0x2e0)][_0x3c13ae(0x1fe)]({'id':Number(_0x265951['id'])}),_0x2c9dde=await this['mjpAccountService'][_0x3c13ae(0x21f)]({'data':_0x265951},_0x9b8638[_0x3c13ae(0x1cd)]);if(_0x2c9dde[_0x3c13ae(0x1d0)]!==0x1)throw new Error(_0x2c9dde[_0x3c13ae(0x30a)]);return _0x9b8638[_0x3c13ae(0x213)]=_0x265951['version'],await this['mjParamEntity'][_0x3c13ae(0x1b2)](_0x9b8638),!![];}catch(_0x18b5b6){throw new common_1[(_0x3c13ae(0x1b0))](_0x18b5b6[_0x3c13ae(0x1c5)],common_1[_0x3c13ae(0x1f3)]['BAD_REQUEST']);}}async[_0x12df21(0x186)](_0x10a4e0){const _0x245534=_0x12df21;try{const _0x50e99a=await this[_0x245534(0x2e0)][_0x245534(0x1fe)]({'id':Number(_0x10a4e0['id'])}),_0x177b51=await this['mjpAccountService'][_0x245534(0x186)]({'data':_0x10a4e0},_0x50e99a[_0x245534(0x1cd)]);if(_0x177b51[_0x245534(0x1d0)]!==0x1)throw new Error(_0x177b51[_0x245534(0x30a)]);return!![];}catch(_0x598d62){throw new common_1[(_0x245534(0x1b0))](_0x598d62['message'],common_1[_0x245534(0x1f3)][_0x245534(0x249)]);}}async[_0x12df21(0x1f4)](_0x40d50f){const _0x5cfe6d=_0x12df21,{id:_0x434efc}=_0x40d50f;try{const _0x5e754c=await this[_0x5cfe6d(0x2e0)]['findOne']({'where':{'id':Number(_0x434efc)}});if(!_0x5e754c)throw new Error(_0x5cfe6d(0x10e));common_1[_0x5cfe6d(0x12b)][_0x5cfe6d(0x1dc)]('mjpId:\x20',_0x5e754c[_0x5cfe6d(0x1cd)]);const _0x1ad210=await this[_0x5cfe6d(0x114)][_0x5cfe6d(0x101)]({},_0x5e754c[_0x5cfe6d(0x1cd)]);if(_0x1ad210[_0x5cfe6d(0x1d0)]!==0x1)throw new Error(_0x1ad210[_0x5cfe6d(0x30a)]);const _0x354fc2=await this[_0x5cfe6d(0x2e0)][_0x5cfe6d(0x101)]({'id':_0x434efc});return _0x354fc2[_0x5cfe6d(0x2ba)];}catch(_0x2ab692){throw new common_1[(_0x5cfe6d(0x1b0))](_0x2ab692[_0x5cfe6d(0x1c5)],common_1[_0x5cfe6d(0x1f3)][_0x5cfe6d(0x249)]);}}async[_0x12df21(0x2cf)](_0x293805){const _0x5ea23d=_0x12df21,{id:_0x828050}=_0x293805,_0x4d06f7=await this[_0x5ea23d(0x2e0)][_0x5ea23d(0x2fd)]({'where':{'id':_0x828050}});if(!_0x4d06f7)throw new common_1[(_0x5ea23d(0x1b0))](_0x5ea23d(0x217),common_1['HttpStatus'][_0x5ea23d(0x249)]);try{return await this[_0x5ea23d(0x1bc)](_0x4d06f7)[_0x5ea23d(0x13a)](_0x52b67e=>{const _0x24a594=_0x5ea23d;console[_0x24a594(0x14a)](_0x52b67e);});}catch(_0x5e3cd4){throw new common_1['HttpException'](_0x5ea23d(0x1bd),common_1['HttpStatus'][_0x5ea23d(0x249)]);}}async[_0x12df21(0x2f1)](_0x683589){const _0x1b991d=_0x12df21,{channelId:_0x14f8d8,guildId:_0x33cee0,authorization:_0x227145,proxy:_0x4a1408}=_0x683589;return await axios_1[_0x1b991d(0x1b3)]['post'](_0x4a1408+_0x1b991d(0x1ae),{'token':_0x227145,'channel_id':_0x14f8d8,'guild_id':_0x33cee0})['then'](_0x4089b4=>_0x4089b4[_0x1b991d(0x2dd)]);}async['syncInfo'](_0x419a6b,_0x574d4d=![]){const _0x2c8c9b=_0x12df21,{mjProxy:_0x5dc393,mjProxyUrl:_0x15434e,mjSocketProxyUrl:_0xe7e5b7}=await this[_0x2c8c9b(0x167)]['getConfigs']([_0x2c8c9b(0x2d2),_0x2c8c9b(0xfa),_0x2c8c9b(0x212)]),{channelId:_0x51c0cb,guildId:_0x192140,authorization:_0x1457c5}=_0x419a6b;let _0x4ea275;_0x5dc393==0x0?_0x4ea275=await this[_0x2c8c9b(0x280)](_0x419a6b):(_0x4ea275=await this[_0x2c8c9b(0x2f1)]({'channelId':_0x51c0cb,'guildId':_0x192140,'authorization':_0x1457c5,'proxy':_0x15434e}),console[_0x2c8c9b(0x14a)](_0x4ea275));const {settingInfo:_0x260fb9,info:_0x2236d6,subscription:_0xf3ebd5,fastRemainTime:_0x2c56e2,lifetimeUsage:_0x889d80,relaxedUsage:_0x2b66c5,orderPlan:_0x87a624}=_0x4ea275,_0x2881bf=await this[_0x2c8c9b(0x2e0)]['update'](_0x419a6b['id'],{'remix':_0x260fb9[_0x2c8c9b(0x2d4)][0x1][_0x2c8c9b(0x2d4)][0x1][_0x2c8c9b(0x145)]===0x3?0x1:0x0,'setting':JSON['stringify'](_0x260fb9),'fastRemainTime':_0x2c56e2[_0x2c8c9b(0x10d)](),'info':_0x2236d6,'renewDate':_0xf3ebd5[_0x2c8c9b(0x10d)](),'orderPlan':_0x87a624,'lifetimeUsage':_0x889d80[_0x2c8c9b(0x10d)](),'relaxedUsage':_0x2b66c5[_0x2c8c9b(0x10d)]()})[_0x2c8c9b(0x2c1)](_0x4edde0=>_0x4edde0[_0x2c8c9b(0x2ba)]>0x0)[_0x2c8c9b(0x13a)](_0x52e4e7=>{throw _0x52e4e7;});if(_0x574d4d){const _0x1535c0=_0x260fb9[_0x2c8c9b(0x2d4)];return _0x1535c0[0x1][_0x2c8c9b(0x2d4)][0x1][_0x2c8c9b(0x145)]===0x3;}else return _0x2881bf;}async['getAccountInfo'](_0xc1dab4){return new Promise(async _0x9bc8d6=>{const _0x245e4=_0xe190;await this[_0x245e4(0x225)][_0xc1dab4][_0x245e4(0x2ac)][_0x245e4(0x2d5)]((_0x22ee1d,_0x4c23f2)=>{const _0xa6860c=_0x245e4;_0x22ee1d===_0xa6860c(0x27d)&&_0x9bc8d6(_0x4c23f2);});});}async['getSettingInfo'](_0x2cb112){return new Promise(async _0x27fe97=>{const _0x5813bc=_0xe190;await this[_0x5813bc(0x225)][_0x2cb112][_0x5813bc(0x2ac)]['settings']((_0x1361b7,_0x3177d4)=>{_0x1361b7==='MESSAGE_UPDATE'&&_0x27fe97(_0x3177d4);});});}async[_0x12df21(0x1d2)](_0x5380ee){const _0x4831a9=_0x12df21,{id:_0x323496,enable:_0x1c0084}=_0x5380ee;return await this['mjParamEntity'][_0x4831a9(0x2f6)](_0x323496,{'enable':_0x1c0084})[_0x4831a9(0x2c1)](_0x657be8=>_0x657be8[_0x4831a9(0x2ba)]>0x0);}async[_0x12df21(0x292)](_0x147a88,_0x1a710b){const _0x173cc9=_0x12df21,_0x19513f=_0x1a710b[_0x173cc9(0x182)]['role'],_0x502132=_0x19513f===_0x173cc9(0x158),{id:_0xd0530}=_0x147a88;let _0x454ced=null;try{const _0x248835=await this[_0x173cc9(0x2e0)][_0x173cc9(0x2fd)]({'where':{'id':_0xd0530}});return _0x502132&&(_0x454ced=await this[_0x173cc9(0x114)][_0x173cc9(0x2b4)]({},_0x248835[_0x173cc9(0x1cd)])),{..._0x248835,'mjpAccountInfo':_0x454ced,'authorization':_0x502132?_0x248835[_0x173cc9(0x136)]:(0x0,utils_1['hideString'])(_0x248835[_0x173cc9(0x136)]),'guildId':_0x502132?_0x248835[_0x173cc9(0x1a3)]:(0x0,utils_1[_0x173cc9(0x1c7)])(_0x248835[_0x173cc9(0x1a3)]),'channelId':_0x502132?_0x248835[_0x173cc9(0x263)]:(0x0,utils_1[_0x173cc9(0x1c7)])(_0x248835[_0x173cc9(0x263)])};}catch(_0x12c839){throw new common_1[(_0x173cc9(0x1b0))](_0x12c839,common_1[_0x173cc9(0x1f3)]['BAD_REQUEST']);}}async[_0x12df21(0x1f6)](_0x4fcfcb,_0x491524){const _0x24057a=_0x12df21,_0x1de84e=_0x491524[_0x24057a(0x182)][_0x24057a(0x13d)],{page:page=0x1,size:size=0x14,account:_0x2d6b31,channelId:_0x10c3dd,enable:_0x65c4a5}=_0x4fcfcb;if(!page||!size)throw new common_1[(_0x24057a(0x1b0))](_0x24057a(0x179),common_1['HttpStatus'][_0x24057a(0x249)]);const _0x2cfaea={};_0x2d6b31&&Object[_0x24057a(0x14b)](_0x2cfaea,{'account':(0x0,typeorm_2[_0x24057a(0x1c9)])('%'+_0x2d6b31+'%')}),_0x10c3dd&&Object[_0x24057a(0x14b)](_0x2cfaea,{'channelId':(0x0,typeorm_2['Like'])('%'+_0x10c3dd+'%')}),_0x65c4a5>0x0&&Object['assign'](_0x2cfaea,{'enable':_0x65c4a5});const [_0x546ba3,_0x1d1713]=await this[_0x24057a(0x2e0)][_0x24057a(0x257)]({'skip':(page-0x1)*size,'where':_0x2cfaea,'take':size,'order':{'createdAt':_0x24057a(0x245)},'cache':!![],'select':['id',_0x24057a(0x1a3),'channelId',_0x24057a(0x136),_0x24057a(0x2e8),'weight',_0x24057a(0x286),_0x24057a(0x155),'orderPlan','renewDate','createdAt',_0x24057a(0x183)]});return{'rows':_0x1de84e===_0x24057a(0x158)?_0x546ba3:_0x546ba3[_0x24057a(0x25d)](_0x4024bd=>({..._0x4024bd,'authorization':(0x0,utils_1[_0x24057a(0x1c7)])(_0x4024bd['authorization']),'guildId':(0x0,utils_1['hideString'])(_0x4024bd[_0x24057a(0x1a3)]),'channelId':(0x0,utils_1['hideString'])(_0x4024bd['channelId'])}))||[],'count':_0x1d1713||0x0};}async['setAttachment'](_0x44a324){const _0x157e01=_0x12df21,{authorization:_0x4c75cc,channel_id:_0x4aa856}=_0x44a324,_0x57b791=_0x157e01(0x30b)+_0x4aa856+'/attachments',_0x74ff09={'Content-Type':_0x157e01(0x139),'authorization':_0x4c75cc};try{return await axios_1[_0x157e01(0x1b3)]['post'](_0x57b791,{'files':_0x44a324['files']},{'headers':_0x74ff09});}catch(_0x32b620){console[_0x157e01(0x14a)](_0x157e01(0x154),_0x32b620);throw new common_1[(_0x157e01(0x1b0))](_0x157e01(0x198),common_1[_0x157e01(0x1f3)][_0x157e01(0x249)]);}}async[_0x12df21(0x2fe)](_0x20ca3d){const _0x4c3004=_0x12df21,{proxy:_0x1931bf,needImage:_0xfc1aa4,file:_0x3a7b35,authorization:_0x2a2260,channel_id:_0x448ba0}=_0x20ca3d,_0x33993e={'authorization':_0x2a2260,'needImage':_0xfc1aa4,'channel_id':_0x448ba0,'files':_0x3a7b35[_0x4c3004(0x25d)](_0x42fbf7=>_0x42fbf7[_0x4c3004(0x148)][_0x4c3004(0x18b)](_0x4c3004(0x1f5)))};return await axios_1['default'][_0x4c3004(0x11a)](_0x1931bf+_0x4c3004(0x22d),_0x33993e)['then'](_0x1d6751=>_0x1d6751[_0x4c3004(0x2dd)])[_0x4c3004(0x13a)](_0x572511=>Promise[_0x4c3004(0x106)](_0x572511));}async[_0x12df21(0x161)](_0x3148fd){const _0x509e72=_0x12df21,{buffer:_0x45c331,channel_id:_0xfdff19,authorization:_0x2db941,filename:_0x136e17,needImage:needImage=![]}=_0x3148fd,_0x2882be=_0x45c331[_0x509e72(0x126)],_0x13782f=(0x0,createRandomId_1[_0x509e72(0x1fa)])(),_0x441147=await this[_0x509e72(0x24a)]({'authorization':_0x2db941,'channel_id':_0xfdff19,'files':[{'filename':_0x136e17,'file_size':_0x2882be,'id':_0x13782f}]});if(_0x441147[_0x509e72(0x30e)]!=0xc8)return Promise['reject'](_0x509e72(0x198));const _0x951419=_0x441147[_0x509e72(0x2dd)];if(_0x951419[_0x509e72(0x19d)]?.['length']!=0x1)return Promise[_0x509e72(0x106)](_0x509e72(0x1a5));const _0x87f1=await axios_1[_0x509e72(0x1b3)][_0x509e72(0x196)](_0x951419[_0x509e72(0x19d)][0x0][_0x509e72(0x1ec)],_0x45c331,{'headers':{'Content-Type':_0x509e72(0x1f8)}})['catch'](_0x526e3e=>{const _0x4dd112=_0x509e72;return Promise[_0x4dd112(0x106)](_0x4dd112(0x198)+_0x526e3e);});if(_0x87f1&&_0x87f1[_0x509e72(0x30e)]!=0xc8&&_0x87f1[_0x509e72(0x30e)]!=0xc9)throw new common_1[(_0x509e72(0x1b0))](_0x509e72(0x15f),common_1[_0x509e72(0x1f3)][_0x509e72(0x249)]);const _0x2c7374=_0x951419[_0x509e72(0x19d)][0x0]['upload_filename'],_0xf10a03=_0x2c7374[_0x509e72(0x2b2)]('/'),_0x3e3c88=_0xf10a03[_0x509e72(0x126)]>0x1?_0xf10a03[0x1]:_0xf10a03[0x0];if(needImage){const _0x2c0b8d=_0x509e72(0x30b)+_0xfdff19+'/messages',_0xeab00a=await(0x0,axios_1['default'])({'url':''+_0x2c0b8d,'method':_0x509e72(0x11a),'headers':{'Authorization':''+_0x2db941,'Content-Type':'application/json'},'data':{'content':_0x3e3c88,'channel_id':_0xfdff19,'type':0x0,'sticker_ids':[],'attachments':[{'id':0x0,'filename':_0x3e3c88,'uploaded_filename':_0x2c7374}]}});if(_0xeab00a['status']!==0xc8)throw new common_1[(_0x509e72(0x1b0))]('上传文件失败...,\x20upload\x20message\x20fail',common_1[_0x509e72(0x1f3)][_0x509e72(0x249)]);const _0x453aa0=await _0xeab00a[_0x509e72(0x2dd)];if(_0x453aa0['attachments']?.[_0x509e72(0x126)]!=0x1)throw new common_1[(_0x509e72(0x1b0))](_0x509e72(0x26d),common_1[_0x509e72(0x1f3)][_0x509e72(0x249)]);return{'attachments':[{'id':_0x13782f,'filename':_0x3e3c88,'uploaded_filename':_0x2c7374}],'image':_0x453aa0[_0x509e72(0x19d)][0x0]};}else return{'attachments':[{'id':_0x13782f,'filename':_0x3e3c88,'uploaded_filename':_0x2c7374}],'image':{'url':''}};}async[_0x12df21(0x25e)](_0x5796bd,_0x9874e7){const _0x38caf4=_0x12df21;return await this['midjourneyEntity'][_0x38caf4(0x2f6)]({'jobId':_0x5796bd},{'status':_0x9874e7});}async[_0x12df21(0x236)](_0x3b7ef6=midjourney_constant_1[_0x12df21(0x290)][_0x12df21(0x2fb)]){const _0x2cf3cb=_0x12df21;try{const _0x59d369=await this[_0x2cf3cb(0x107)](_0x3b7ef6)['catch'](_0x52af55=>{throw _0x52af55;}),_0xc0f309=await this['globalConfigService'][_0x2cf3cb(0x1f7)]([_0x2cf3cb(0x2d2),_0x2cf3cb(0xfa),_0x2cf3cb(0x212)]);return{'guild_id':_0x59d369[_0x2cf3cb(0x1a3)],'channel_id':_0x59d369['channelId'],'authorization':_0x59d369['authorization'],'mjProxy':_0xc0f309[_0x2cf3cb(0x2d2)],'mjProxyUrl':_0xc0f309[_0x2cf3cb(0xfa)],'mjSocketProxyUrl':_0xc0f309[_0x2cf3cb(0x212)]};}catch(_0x3e4747){return Promise[_0x2cf3cb(0x106)](_0x3e4747);}}async[_0x12df21(0x232)](_0x10a7d5,_0x48e1b6){const _0xfb494=_0x12df21;try{const _0x218d73=_0x10a7d5['user']['id'],{page:page=0x1,size:size=0x14,status:_0x1bfde0,rec:_0x4c6b6f,favorite:_0x29e977}=_0x48e1b6,_0x5527f8={};_0x218d73&&Object[_0xfb494(0x14b)](_0x5527f8,{'userId':_0x218d73});Number(_0x29e977)===0x1?Object[_0xfb494(0x14b)](_0x5527f8,{'favorite':Number(_0x29e977)}):_0x1bfde0>0x0&&Object[_0xfb494(0x14b)](_0x5527f8,{'status':_0x1bfde0});const [_0x2caf44,_0x1b3d85]=await this['midjourneyEntity']['findAndCount']({'where':_0x5527f8,'order':{'id':'DESC'},'take':size,'skip':(page-0x1)*size});return{'rows':(0x0,utils_1[_0xfb494(0x2c5)])(_0x2caf44),'count':_0x1b3d85};}catch(_0x4b4f43){console[_0xfb494(0x14a)](_0x4b4f43);throw new common_1[(_0xfb494(0x1b0))]('获取我得绘制列表失败',common_1[_0xfb494(0x1f3)][_0xfb494(0x249)]);}}async['checkIsActionDone'](_0x5cb821,_0x2a3574){const _0x32f486=_0x12df21,_0x4c948c=await this[_0x32f486(0x2e7)][_0x32f486(0x252)]({'where':{'originTaskId':String(_0x5cb821),'customId':_0x2a3574}});if(_0x4c948c>0x0)throw new common_1[(_0x32f486(0x1b0))](_0x32f486(0x261),common_1[_0x32f486(0x1f3)][_0x32f486(0x249)]);return![];}async[_0x12df21(0x133)](_0x1cd141,_0x299bb7){const _0x56b879=_0x12df21;try{const _0x2ac109=await this[_0x56b879(0x2e7)][_0x56b879(0x2fd)]({'where':{'id':_0x1cd141,'userId':_0x299bb7[_0x56b879(0x182)]['id']}});if(!_0x2ac109)throw new Error(_0x56b879(0x18d));if(_0x2ac109[_0x56b879(0x30e)]===midjourney_constant_1['MidjourneyStatusEnum'][_0x56b879(0x105)])throw new Error(_0x56b879(0x26b));await this['mjpTaskService'][_0x56b879(0x1da)](null,_0x2ac109[_0x56b879(0x2c3)]);const _0x139f89=await this['midjourneyEntity'][_0x56b879(0x101)]({'id':_0x1cd141});if(_0x139f89[_0x56b879(0x2ba)]>0x0)return _0x56b879(0x2d1);else throw new Error(_0x56b879(0x168));}catch(_0x16f5b8){throw new common_1['HttpException'](_0x16f5b8[_0x56b879(0x1c5)],common_1[_0x56b879(0x1f3)][_0x56b879(0x249)]);}}async[_0x12df21(0x2e4)](_0x5863f5,_0x483bd2){const _0x160a46=_0x12df21,{id:_0x39d12f}=_0x5863f5[_0x160a46(0x182)],_0x560eff=await this[_0x160a46(0x2e7)]['count']({'where':{'userId':_0x39d12f,'status':(0x0,typeorm_2['In'])([0x1,0x2])}}),_0x160fe7=await this[_0x160a46(0x236)](_0x483bd2)[_0x160a46(0x13a)](_0x28aa28=>{return Promise['reject'](_0x28aa28);});if(!_0x160fe7)throw new common_1['HttpException'](_0x160a46(0x2c2),common_1[_0x160a46(0x1f3)]['BAD_REQUEST']);const _0x12807c=await this[_0x160a46(0x167)][_0x160a46(0x1f7)](['mjLimitCount']),_0x33ff21=_0x12807c?Number(_0x12807c):0xa;if(_0x560eff>=_0x33ff21)throw new common_1[(_0x160a46(0x1b0))](_0x160a46(0x296)+_0x33ff21+_0x160a46(0x1d5),common_1[_0x160a46(0x1f3)][_0x160a46(0x249)]);}async[_0x12df21(0x29b)](_0x523375){const _0xc7a61=_0x12df21,{id:_0x54cfe2,userId:_0x5f46d2,action:_0x3486d0}=_0x523375,_0x420306=0x4;await this[_0xc7a61(0x152)][_0xc7a61(0x137)](_0x5f46d2,_0x420306),await this[_0xc7a61(0x2e7)][_0xc7a61(0x2f6)]({'id':_0x54cfe2},{'status':midjourney_constant_1[_0xc7a61(0x141)][_0xc7a61(0x18c)]});}async[_0x12df21(0x11d)](_0x1aec4e){const _0x53f66f=_0x12df21,{page:page=0x1,size:size=0x14,rec:_0x1ca34c,squareType:_0x7fa67a,userId:_0x3763c5,status:_0x375543,favorite:favorite=0x0,keyword:_0x5391f9}=_0x1aec4e,_0x1357e9={};_0x3763c5&&Object['assign'](_0x1357e9,{'userId':_0x3763c5}),favorite&&Object[_0x53f66f(0x14b)](_0x1357e9,{'favorite':favorite}),_0x1ca34c&&Object[_0x53f66f(0x14b)](_0x1357e9,{'rec':_0x1ca34c}),_0x5391f9&&Object[_0x53f66f(0x14b)](_0x1357e9,{'prompt':(0x0,typeorm_2[_0x53f66f(0x1c9)])('%'+_0x5391f9+'%')}),_0x375543>0x0&&Object[_0x53f66f(0x14b)](_0x1357e9,{'status':_0x375543}),_0x7fa67a!==''&&Object[_0x53f66f(0x14b)](_0x1357e9,{'squareType':_0x7fa67a});const [_0x32c669,_0x5ae787]=await this[_0x53f66f(0x2e7)]['findAndCount']({'where':_0x1357e9,'take':size,'order':{'id':_0x53f66f(0x245)},'skip':(page-0x1)*size,'select':[_0x53f66f(0x287),_0x53f66f(0x2ce),_0x53f66f(0x186),_0x53f66f(0x183),'prompt',_0x53f66f(0xff),_0x53f66f(0x157),_0x53f66f(0x132),_0x53f66f(0x206),'id',_0x53f66f(0x309),_0x53f66f(0x16d),_0x53f66f(0x2ce),_0x53f66f(0x2df),_0x53f66f(0x113),_0x53f66f(0x241)]});return _0x32c669[_0x53f66f(0x259)](_0x47c193=>{const _0x54653b=_0x53f66f;_0x47c193[_0x54653b(0x287)]=_0x47c193[_0x54653b(0x287)]?JSON[_0x54653b(0x1ed)](_0x47c193['fileInfo']):{};}),{'rows':_0x32c669,'count':_0x5ae787};}async[_0x12df21(0xf5)](_0x20f18b,_0x9484e){const _0x1b471a=_0x12df21;try{let _0x558c70,_0x2f933d,_0x339781,_0x4da736;const {jobId:_0x53756b,detail:_0x5701cb}=_0x9484e;if(_0x20f18b[_0x1b471a(0x1c4)][_0x1b471a(0x136)]){const _0x502f28=_0x20f18b[_0x1b471a(0x1c4)][_0x1b471a(0x136)][_0x1b471a(0x2b2)]('\x20'),_0x361a2e=jwt['verify'](_0x502f28[0x1],process[_0x1b471a(0x275)][_0x1b471a(0x172)]);_0x2f933d=_0x361a2e['id'];}const _0x3b6905=await this[_0x1b471a(0x2e7)]['findOne']({'where':{'jobId':_0x53756b}});return _0x5701cb&&(this[_0x1b471a(0x102)][_0x1b471a(0x24d)](relate_contant_1[_0x1b471a(0x2da)]['mj'],_0x3b6905['id']),_0x558c70=await this['userEntity'][_0x1b471a(0x2fd)]({'where':{'id':_0x3b6905[_0x1b471a(0x28a)]}}),_0x339781=await this[_0x1b471a(0x102)]['getByRelateId'](relate_contant_1[_0x1b471a(0x2da)]['mj'],_0x3b6905['id']),_0x2f933d&&(_0x4da736=await this[_0x1b471a(0x102)][_0x1b471a(0x1ea)](relate_contant_1[_0x1b471a(0x2da)]['mj'],_0x3b6905['id']))),{..._0x3b6905,'avatar':_0x558c70?_0x558c70['avatar']:null,'username':_0x558c70?_0x558c70['username']:null,'nickname':_0x558c70?_0x558c70[_0x1b471a(0x15b)]:null,'visitNum':_0x339781?_0x339781[_0x1b471a(0x22f)]:0x0,'agreeNum':_0x339781?_0x339781[_0x1b471a(0x302)]:0x0,'agree':_0x4da736?_0x4da736[_0x1b471a(0x186)]:null};}catch(_0x52957a){throw new common_1[(_0x1b471a(0x1b0))](_0x52957a[_0x1b471a(0x1c5)],common_1[_0x1b471a(0x1f3)][_0x1b471a(0x249)]);}}async[_0x12df21(0x1d7)](_0x1a719e,_0x4a1f02){const _0x161fc6=_0x12df21;try{if(!_0x4a1f02[_0x161fc6(0x303)]||!_0x4a1f02[_0x161fc6(0x303)][_0x161fc6(0x126)])return[];const _0x1abbc6=_0x4a1f02[_0x161fc6(0x303)]['split'](','),_0x19c882=await this[_0x161fc6(0x2e7)][_0x161fc6(0x2e3)]({'where':{'jobId':(0x0,typeorm_2['In'])(_0x1abbc6)}});return _0x19c882;}catch(_0xbf87cf){throw new common_1[(_0x161fc6(0x1b0))](_0xbf87cf['message'],common_1[_0x161fc6(0x1f3)][_0x161fc6(0x249)]);}}async[_0x12df21(0x1d3)](_0x5bc2bf,_0x2a8f5b){const _0x5d4e4d=_0x12df21;try{const {page:page=0x1,size:size=0xa,rec:_0x290207,userId:_0x49f501,status:_0x370a89}=_0x2a8f5b,_0x416340={};_0x290207&&Object[_0x5d4e4d(0x14b)](_0x416340,{'rec':_0x290207}),_0x49f501&&Object[_0x5d4e4d(0x14b)](_0x416340,{'userId':_0x49f501}),_0x370a89&&Object[_0x5d4e4d(0x14b)](_0x416340,{'status':_0x370a89});const [_0x2903bc,_0x56d812]=await this[_0x5d4e4d(0x2e7)][_0x5d4e4d(0x257)]({'where':_0x416340,'order':{'id':_0x5d4e4d(0x245)},'take':size,'skip':(page-0x1)*size}),_0x1f7d7e=_0x2903bc[_0x5d4e4d(0x25d)](_0x17492f=>_0x17492f[_0x5d4e4d(0x28a)])[_0x5d4e4d(0x24c)](_0x1e070c=>_0x1e070c<0x186a0),_0x4e3c3f=await this[_0x5d4e4d(0x298)][_0x5d4e4d(0x2e3)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1f7d7e)},'select':['id',_0x5d4e4d(0x2c4),_0x5d4e4d(0x189),_0x5d4e4d(0x21e)]});return _0x2903bc[_0x5d4e4d(0x259)](_0x37822d=>{const _0x4c9b9e=_0x5d4e4d;_0x37822d[_0x4c9b9e(0x165)]=_0x4e3c3f[_0x4c9b9e(0x2e3)](_0x2142f8=>_0x2142f8['id']===_0x37822d[_0x4c9b9e(0x28a)]),_0x37822d[_0x4c9b9e(0x272)]=![];}),_0x5bc2bf[_0x5d4e4d(0x182)][_0x5d4e4d(0x13d)]!==_0x5d4e4d(0x158)&&_0x2903bc[_0x5d4e4d(0x259)](_0x495b1b=>{const _0x4053c3=_0x5d4e4d;_0x495b1b[_0x4053c3(0x165)]&&_0x495b1b[_0x4053c3(0x165)][_0x4053c3(0x21e)]&&(_0x495b1b[_0x4053c3(0x165)][_0x4053c3(0x21e)]=_0x495b1b[_0x4053c3(0x165)][_0x4053c3(0x21e)][_0x4053c3(0x1aa)](/(.{2}).+(.{2}@.+)/,_0x4053c3(0x110)));}),{'rows':_0x2903bc,'count':_0x56d812};}catch(_0x23f728){throw new common_1['HttpException'](_0x5d4e4d(0x242),common_1['HttpStatus'][_0x5d4e4d(0x249)]);}}['filterStar'](_0x8418f7){const _0x4f1136=_0x12df21;return _0x8418f7[_0x4f1136(0x1aa)](/^\**/g,'');}async[_0x12df21(0x209)](_0x53c33d){const _0x57f5ee=_0x12df21,{id:_0x3547ca,squareType:_0x3161d4}=_0x53c33d,_0x140fe5=await this[_0x57f5ee(0x2e7)][_0x57f5ee(0x2fd)]({'where':{'id':_0x3547ca,'status':midjourney_constant_1[_0x57f5ee(0x141)][_0x57f5ee(0x21a)]}});if(!_0x140fe5)throw new common_1['HttpException'](_0x57f5ee(0x197),common_1[_0x57f5ee(0x1f3)][_0x57f5ee(0x249)]);const _0xfc7e3a=await this['midjourneyEntity'][_0x57f5ee(0x2f6)]({'id':_0x3547ca},{'rec':0x1,'squareType':_0x3161d4})['catch'](_0x3404dc=>{throw new common_1['HttpException'](_0x3404dc,common_1['HttpStatus']['BAD_REQUEST']);});if(_0xfc7e3a[_0x57f5ee(0x2ba)]<=0x0)throw new common_1['HttpException'](_0x57f5ee(0x1af),common_1[_0x57f5ee(0x1f3)]['BAD_REQUEST']);return await this[_0x57f5ee(0x2f4)][_0x57f5ee(0x216)]({'key':'squire-images'}),!![];}async[_0x12df21(0x27a)](_0x22344b){const _0x549d7e=_0x12df21,{id:_0x5871a2,favorite:_0x129832}=_0x22344b,_0x22efb9=await this['midjourneyEntity'][_0x549d7e(0x2fd)]({'where':{'id':_0x5871a2}})['catch'](_0x260095=>{const _0x280060=_0x549d7e;common_1[_0x280060(0x12b)][_0x280060(0x1dc)](_0x260095);});if(!_0x22efb9)throw new common_1[(_0x549d7e(0x1b0))]('当前图片不存在！',common_1['HttpStatus']['BAD_REQUEST']);const _0x33fed5=await this['midjourneyEntity'][_0x549d7e(0x2f6)]({'id':_0x5871a2},{'favorite':_0x129832});if(_0x33fed5[_0x549d7e(0x2ba)]<=0x0)throw new common_1[(_0x549d7e(0x1b0))](_0x549d7e(0x1af),common_1[_0x549d7e(0x1f3)][_0x549d7e(0x249)]);return!![];}async[_0x12df21(0x271)](){const _0x457020=_0x12df21;try{await this[_0x457020(0x2e7)][_0x457020(0x2f6)]({'status':0x2},{'status':0x4});}catch(_0x45d5ba){console[_0x457020(0x14a)](_0x457020(0x2ef),_0x45d5ba);}}async[_0x12df21(0x2ee)](_0x5da62e,_0x14c677){const _0x1a0a59=_0x12df21,{id:_0x458f4}=_0x14c677;if(!_0x458f4)throw new common_1[(_0x1a0a59(0x1b0))](_0x1a0a59(0xfe),common_1[_0x1a0a59(0x1f3)][_0x1a0a59(0x249)]);const _0x4de66f=await this['midjourneyEntity'][_0x1a0a59(0x101)]({'id':_0x458f4});if(_0x4de66f['affected']<=0x0)throw new common_1[(_0x1a0a59(0x1b0))](_0x1a0a59(0x21c),common_1[_0x1a0a59(0x1f3)][_0x1a0a59(0x249)]);return!![];}async[_0x12df21(0x207)](_0x39b909,_0xdddcfa){const _0x5c09e9=_0x12df21;try{const {prompt:_0x2a2834,status:_0x2fd5b3,isCarryParams:_0x14844e,imageUrl:_0x518fc0,title:_0x26ec4f,order:_0x22a427,id:_0x16229f,aspect:_0x487414}=_0xdddcfa;return _0x16229f?await this[_0x5c09e9(0x279)][_0x5c09e9(0x2f6)]({'id':_0x16229f},{'prompt':_0x2a2834,'imageUrl':_0x518fc0,'status':_0x2fd5b3,'isCarryParams':_0x14844e,'order':_0x22a427,'aspect':_0x487414})['then'](_0x1b6c78=>!!_0x1b6c78):await this[_0x5c09e9(0x279)][_0x5c09e9(0x1b2)]({'prompt':_0x2a2834,'status':_0x2fd5b3,'imageUrl':_0x518fc0,'isCarryParams':_0x14844e,'title':_0x26ec4f,'order':_0x22a427,'aspect':_0x487414})['then'](_0x37cf82=>!!_0x37cf82);}catch(_0x5dc6b6){console[_0x5c09e9(0x14a)](_0x5c09e9(0x171),_0x5dc6b6);}}async[_0x12df21(0x281)](_0x1bb390,_0x51807e){const _0x201004=_0x12df21,{id:_0x312daa}=_0x51807e;if(!_0x312daa)throw new common_1[(_0x201004(0x1b0))](_0x201004(0xfe),common_1[_0x201004(0x1f3)][_0x201004(0x249)]);return await this[_0x201004(0x279)]['delete']({'id':_0x312daa});}async[_0x12df21(0x11e)](){const _0x5a63fb=_0x12df21;return await this[_0x5a63fb(0x279)][_0x5a63fb(0x2e3)]({'order':{'order':_0x5a63fb(0x245)}})[_0x5a63fb(0x2c1)](_0x29e104=>_0x29e104||[])[_0x5a63fb(0x13a)](_0x3a180c=>{const _0x31ab91=_0x5a63fb;common_1['Logger'][_0x31ab91(0x1dc)](_0x3a180c);});}async[_0x12df21(0x15a)](_0x49b5a1){const _0x5c99ac=_0x12df21,{size:_0x28c308,page:_0x1cdf75}=_0x49b5a1;return await this['mjPromptsEntity'][_0x5c99ac(0x2e3)]({'order':{'order':_0x5c99ac(0x245)},'take':_0x28c308,'skip':(_0x1cdf75-0x1)*_0x28c308})[_0x5c99ac(0x13a)](_0x4df227=>{console['log'](_0x4df227);});}async[_0x12df21(0x26e)](_0x411e41){const {mode:_0x17233e}=_0x411e41;}async[_0x12df21(0x203)](_0x43774f){const _0x42fc96=_0x12df21;try{const {name:_0x4840cb,value:_0x353322}=_0x43774f,_0x3d7294=await this[_0x42fc96(0x1cf)][_0x42fc96(0x1fe)]({'name':_0x4840cb});if(_0x3d7294)throw new common_1[(_0x42fc96(0x1b0))](_0x42fc96(0x160),common_1[_0x42fc96(0x1f3)][_0x42fc96(0x249)]);return await this[_0x42fc96(0x1cf)][_0x42fc96(0x1b2)]({'name':_0x4840cb,'value':_0x353322})[_0x42fc96(0x2c1)](_0x1365d4=>!!_0x1365d4)[_0x42fc96(0x13a)](_0x3e3f70=>{const _0x2b14df=_0x42fc96;console[_0x2b14df(0x14a)](_0x3e3f70);throw new common_1[(_0x2b14df(0x1b0))](_0x3e3f70,common_1[_0x2b14df(0x1f3)][_0x2b14df(0x249)]);});}catch(_0x14cf49){return![];}}async[_0x12df21(0x162)](_0x4fb649){const _0x121a09=_0x12df21,{id:_0x1c158c,name:_0x313ed7,value:_0x29a703}=_0x4fb649;return await this[_0x121a09(0x1cf)][_0x121a09(0x2f6)](_0x1c158c,{'name':_0x313ed7,'value':_0x29a703})[_0x121a09(0x2c1)](_0x4b7af2=>!!_0x4b7af2);}async['removeMjInspireClassify'](_0x2a7653){const _0x39cb81=_0x12df21,{id:_0x21339d}=_0x2a7653;return await this[_0x39cb81(0x1cf)][_0x39cb81(0x101)]({'id':_0x21339d})[_0x39cb81(0x13a)](_0x52481e=>{const _0x226857=_0x39cb81;throw new common_1[(_0x226857(0x1b0))](_0x52481e,common_1['HttpStatus']['BAD_REQUEST']);});}async[_0x12df21(0x166)](_0x163f3e){const _0x595356=_0x12df21,{size:_0x4733a7,page:_0x3ee85d}=_0x163f3e,_0x4c3444=await this[_0x595356(0x1cf)]['findAndCount']({'order':{'createdAt':_0x595356(0x245)},'take':_0x4733a7,'skip':(_0x3ee85d-0x1)*_0x4733a7})[_0x595356(0x13a)](_0x38dcf9=>{const _0x576b34=_0x595356;throw new common_1[(_0x576b34(0x1b0))](_0x38dcf9,common_1[_0x576b34(0x1f3)][_0x576b34(0x249)]);});if(!_0x4c3444)throw new common_1[(_0x595356(0x1b0))](_0x595356(0x2f3),common_1[_0x595356(0x1f3)][_0x595356(0x249)]);const [_0x38c253,_0x5922a9]=_0x4c3444;return{'rows':_0x38c253,'count':_0x5922a9};}async[_0x12df21(0x226)](_0x3402c7){const _0x4d2e92=_0x12df21,{id:_0x395a7c}=_0x3402c7;return await this['mjInspireClassifyEntity'][_0x4d2e92(0x2fd)]({'where':{'id':_0x395a7c}});}async[_0x12df21(0x20b)](_0x41202a){const _0x170235=_0x12df21;try{const {classifyName:_0x49526e,level:_0x1735ef,type:_0x53194f,pid:pid=0x0}=_0x41202a;return await this[_0x170235(0x2d8)][_0x170235(0x1b2)]({'classifyName':_0x49526e,'level':_0x1735ef,'type':_0x53194f,'pid':pid})['then'](_0x1d174e=>!!_0x1d174e)[_0x170235(0x13a)](_0x4dafcd=>{const _0x4c297a=_0x170235;console[_0x4c297a(0x14a)](_0x4dafcd);throw new common_1[(_0x4c297a(0x1b0))](_0x4dafcd,common_1[_0x4c297a(0x1f3)]['BAD_REQUEST']);});}catch(_0x5352d5){return![];}}async[_0x12df21(0x163)](_0x580095){const _0x3d2eeb=_0x12df21,{id:_0x2ccfec,classifyName:_0x3febda,level:_0x5e3ebb,type:_0x97f934,pid:_0x39b22b}=_0x580095;return this['connection'][_0x3d2eeb(0x1ba)](async()=>{const _0x37b1cb=_0x3d2eeb,_0x36dea1=await this[_0x37b1cb(0x2d8)][_0x37b1cb(0x2fd)]({'where':{'id':_0x2ccfec}});_0x36dea1[_0x37b1cb(0x17a)]!==_0x97f934&&await this[_0x37b1cb(0x2d8)]['update']({'pid':_0x2ccfec},{'type':_0x97f934}),await this['mjIncantationClassifyEntity']['update'](_0x2ccfec,{'classifyName':_0x3febda,'level':_0x5e3ebb,'type':_0x97f934,'pid':_0x39b22b});}),!![];}async['removeMjIncantationClassify'](_0x5731ff){const _0xc3f4fb=_0x12df21,{id:_0x45a7fe}=_0x5731ff;return await this[_0xc3f4fb(0x2d8)][_0xc3f4fb(0x101)]({'id':_0x45a7fe})[_0xc3f4fb(0x2c1)](_0x4ca4a1=>_0x4ca4a1['affected']>0x0);}async[_0x12df21(0x194)](_0x5c4ca9){const _0x5206a8=_0x12df21,{id:_0x3db27f}=_0x5c4ca9;return await this['mjIncantationClassifyEntity'][_0x5206a8(0x2fd)]({'where':{'id':_0x3db27f}});}async[_0x12df21(0x1d9)](){const _0x18040b=_0x12df21;return this[_0x18040b(0x2d8)][_0x18040b(0x2e3)]({'where':{'level':0x1}});}async[_0x12df21(0x1e3)](_0x36769c){const _0x5eee56=_0x12df21,{size:_0xff5c36,page:_0x1c1d55,type:_0x43331e,keyword:_0x21f497,level:_0x1d9855}=_0x36769c;let _0x45339e={};_0x1d9855>0x0&&(_0x45339e['level']=_0x1d9855);_0x43331e&&(_0x45339e[_0x5eee56(0x17a)]=_0x43331e);_0x21f497&&(_0x45339e[_0x5eee56(0x2ae)]=(0x0,typeorm_2[_0x5eee56(0x1c9)])('%'+_0x21f497+'%'));const _0x53b78b=await this['mjIncantationClassifyEntity'][_0x5eee56(0x257)]({'order':{'createdAt':_0x5eee56(0x245)},'where':_0x45339e,'take':_0xff5c36,'skip':(_0x1c1d55-0x1)*_0xff5c36})[_0x5eee56(0x13a)](_0x189059=>{const _0x2afbdd=_0x5eee56;console[_0x2afbdd(0x14a)](_0x189059);});if(!_0x53b78b)throw new common_1[(_0x5eee56(0x1b0))]('查询咒语分类失败',common_1[_0x5eee56(0x1f3)]['BAD_REQUEST']);const [_0x41f4fb,_0x543c28]=_0x53b78b;return{'rows':_0x41f4fb,'count':_0x543c28};}async['queryMjIncantationClassifyAllByLevel'](_0x1a88d4){const _0x828ecd=_0x12df21,{level:_0x454a8d,type:_0x1c7901}=_0x1a88d4,_0x5c847d={};_0x454a8d===0x0?_0x5c847d[_0x828ecd(0x147)]=(0x0,typeorm_2[_0x828ecd(0x228)])(_0x454a8d):_0x5c847d['level']=_0x454a8d;_0x1c7901&&(_0x5c847d[_0x828ecd(0x17a)]=_0x1c7901);const _0x1a4e54=await this[_0x828ecd(0x2d8)][_0x828ecd(0x1c0)](_0x5c847d)[_0x828ecd(0x13a)](_0x405d26=>{const _0x975cfe=_0x828ecd;console[_0x975cfe(0x14a)](_0x405d26);});if(!_0x1a4e54)throw new common_1[(_0x828ecd(0x1b0))](_0x828ecd(0x2b9),common_1[_0x828ecd(0x1f3)][_0x828ecd(0x249)]);if(_0x454a8d===0x0)return{'level1':_0x1a4e54[_0x828ecd(0x24c)](_0x45b528=>_0x45b528[_0x828ecd(0x147)]===0x1),'level2':_0x1a4e54[_0x828ecd(0x24c)](_0x1b5229=>_0x1b5229[_0x828ecd(0x147)]===0x2)};return _0x1a4e54;}async[_0x12df21(0x27b)](_0xa24c29){const _0x37d14b=_0x12df21;try{const {incantationEn:_0x2ad9a8,incantationCn:_0x45a16a,img:_0x394800,pid:_0x9b1466}=_0xa24c29;return await this['mjIncantationEntity'][_0x37d14b(0x1b2)]({'incantationEn':_0x2ad9a8,'incantationCn':_0x45a16a,'img':_0x394800,'pid':_0x9b1466})['then'](_0x133287=>!!_0x133287)[_0x37d14b(0x13a)](_0x497164=>{throw _0x497164;});}catch(_0xdfc555){return console[_0x37d14b(0x14a)](_0xdfc555),![];}}async['modifyMjIncantation'](_0x3a1dbe){const _0x3517fc=_0x12df21,{id:_0x3ae609,incantationEn:_0x34fffc,incantationCn:_0x4d4792,img:_0x403267,pid:_0x30b267}=_0x3a1dbe;return await this[_0x3517fc(0x310)][_0x3517fc(0x2f6)](_0x3ae609,{'incantationCn':_0x4d4792,'incantationEn':_0x34fffc,'img':_0x403267,'pid':_0x30b267});}async[_0x12df21(0x29e)](_0x19e619){const _0x20838b=_0x12df21,{id:_0x1a522e}=_0x19e619;return await this['mjIncantationEntity'][_0x20838b(0x101)]({'id':_0x1a522e})['then'](_0x5c8c17=>_0x5c8c17[_0x20838b(0x2ba)]>0x0);}async[_0x12df21(0x140)](_0x3c41b2){const _0x3eea2d=_0x12df21,{id:_0x3e6964}=_0x3c41b2;return await this['mjIncantationEntity'][_0x3eea2d(0x2fd)]({'where':{'id':_0x3e6964}});}async['queryMjIncantation'](_0xced902){const _0x533a03=_0x12df21,{size:_0x3ae866,page:_0x52cd8f,keyword:_0x9db8ee,pid:_0x53b3bc}=_0xced902;let _0x341f1d={};_0x53b3bc>0x0&&(_0x341f1d[_0x533a03(0x2fa)]=_0x53b3bc);_0x9db8ee&&(_0x341f1d[_0x533a03(0x156)]=(0x0,typeorm_2[_0x533a03(0x1c9)])('%'+_0x9db8ee+'%'));const _0x550871=await this[_0x533a03(0x310)][_0x533a03(0x257)]({'order':{'createdAt':_0x533a03(0x245)},'where':_0x341f1d,'take':_0x3ae866,'skip':(_0x52cd8f-0x1)*_0x3ae866})['catch'](_0x1bc587=>{const _0xda94cf=_0x533a03;console[_0xda94cf(0x14a)](_0x1bc587);});if(!_0x550871)throw new common_1[(_0x533a03(0x1b0))](_0x533a03(0x187),common_1[_0x533a03(0x1f3)][_0x533a03(0x249)]);const [_0x2ef6a1,_0x22e53f]=_0x550871;return{'rows':_0x2ef6a1,'count':_0x22e53f};}async[_0x12df21(0x1c6)](_0x3f600e){const _0x1bc200=_0x12df21,{id:_0x495d3e}=_0x3f600e,_0x137f8b=await this[_0x1bc200(0x2d8)][_0x1bc200(0x2fd)]({'where':{'level':0x1,'id':_0x495d3e}})['catch'](_0x2553dc=>{const _0x12c94b=_0x1bc200;common_1['Logger'][_0x12c94b(0x1dc)](_0x2553dc);});if(!_0x137f8b)throw new common_1['HttpException'](_0x1bc200(0x284),common_1['HttpStatus']['BAD_REQUEST']);const _0x555847=await this['mjIncantationClassifyEntity'][_0x1bc200(0x2e3)]({'where':{'level':0x2,'pid':_0x137f8b['id']}})[_0x1bc200(0x13a)](_0x151a6d=>{const _0x42becc=_0x1bc200;common_1[_0x42becc(0x12b)][_0x42becc(0x1dc)](_0x151a6d);});if(!_0x555847||_0x555847['length']===0x0)return{'rows':[]};const _0x18b04e=_0x555847[_0x1bc200(0x25d)](_0x5ad4d9=>_0x5ad4d9['id']),_0x2b3ecd=await this[_0x1bc200(0x310)][_0x1bc200(0x2e3)]({'where':{'pid':(0x0,typeorm_2['In'])(_0x18b04e)}})[_0x1bc200(0x13a)](_0x2b61fd=>{const _0x1d7103=_0x1bc200;common_1['Logger'][_0x1d7103(0x1dc)](_0x2b61fd);});if(!_0x2b3ecd)throw new common_1[(_0x1bc200(0x1b0))](_0x1bc200(0x187),common_1[_0x1bc200(0x1f3)][_0x1bc200(0x249)]);const _0x3ab62d=_0x555847[_0x1bc200(0x25d)](_0x2b967b=>{const _0x5266db=_0x1bc200;return{'children':_0x2b3ecd[_0x5266db(0x24c)](_0x16c5eb=>_0x16c5eb[_0x5266db(0x2fa)]===_0x2b967b['id'])||[],..._0x2b967b};});return{'rows':_0x3ab62d};}async[_0x12df21(0x22b)](){const _0x197c59=_0x12df21,_0x4d015c=await this[_0x197c59(0x310)][_0x197c59(0x2e3)]({'order':{'createdAt':'DESC'}})[_0x197c59(0x13a)](_0x36943f=>{const _0x1797e9=_0x197c59;console[_0x1797e9(0x14a)](_0x36943f);});if(!_0x4d015c)throw new common_1['HttpException'](_0x197c59(0x187),common_1['HttpStatus'][_0x197c59(0x249)]);return _0x4d015c;}async[_0x12df21(0x11b)](_0x3986eb){const _0x4f2a66=_0x12df21,{id:_0x33ca66,suggestCn:_0x33a4a7,suggestEn:_0x3a76e7,order:_0x900d74,image:_0xf59788}=_0x3986eb,_0x1ade7d=await this[_0x4f2a66(0x210)]['findOne']({'where':{'suggestCn':_0x33a4a7}});if(_0x33ca66){if(_0x1ade7d&&_0x1ade7d['id']!==_0x33ca66)throw new common_1[(_0x4f2a66(0x1b0))]('推荐关键词已存在，不可重复添加',common_1['HttpStatus'][_0x4f2a66(0x249)]);}else{if(_0x1ade7d)throw new common_1[(_0x4f2a66(0x1b0))](_0x4f2a66(0x10b),common_1[_0x4f2a66(0x1f3)][_0x4f2a66(0x249)]);}const _0x549a6c=await this['mjSuggestWordEntity'][_0x4f2a66(0x1b2)]({'id':_0x33ca66,'suggestCn':_0x33a4a7,'suggestEn':_0x3a76e7,'order':_0x900d74||0x64,'image':_0xf59788||''})[_0x4f2a66(0x2c1)](_0x2dc253=>!!_0x2dc253['id'])[_0x4f2a66(0x13a)](_0x363179=>{console['log'](_0x363179);});if(!_0x549a6c)throw new common_1[(_0x4f2a66(0x1b0))](_0x4f2a66(0x260),common_1['HttpStatus'][_0x4f2a66(0x249)]);return _0x549a6c;}async['removeSuggestWords'](_0x33e752){const _0x5464a5=_0x12df21,{id:_0x30e99c}=_0x33e752,_0x27a09e=await this[_0x5464a5(0x210)][_0x5464a5(0x159)]({'where':{'id':_0x30e99c}});if(!_0x27a09e)throw new common_1[(_0x5464a5(0x1b0))](_0x5464a5(0x1bb),common_1[_0x5464a5(0x1f3)]['BAD_REQUEST']);const _0x3ce874=await this[_0x5464a5(0x210)][_0x5464a5(0x101)](_0x30e99c)[_0x5464a5(0x2c1)](_0x3211a2=>_0x3211a2[_0x5464a5(0x2ba)]>0x0)[_0x5464a5(0x13a)](_0xd4d1ad=>{const _0x4fe6f8=_0x5464a5;console[_0x4fe6f8(0x14a)](_0xd4d1ad);});if(!_0x3ce874)throw new common_1[(_0x5464a5(0x1b0))](_0x5464a5(0x103),common_1[_0x5464a5(0x1f3)]['BAD_REQUEST']);return _0x3ce874;}async['querySuggestWords'](_0x5c9364){const _0x1cf385=_0x12df21;let _0x59d477={};const {page:_0x1b0d69,size:_0x3143ae}=_0x5c9364,_0x2ddb04=await this['mjSuggestWordEntity'][_0x1cf385(0x257)]({'where':_0x59d477,'take':_0x3143ae,'skip':(_0x1b0d69-0x1)*_0x3143ae,'order':{'order':_0x1cf385(0x245)}})['then'](([_0x5b6e16,_0x1005b8])=>({'rows':_0x5b6e16,'count':_0x1005b8}))[_0x1cf385(0x13a)](_0x36cbbf=>{const _0x36a06c=_0x1cf385;console[_0x36a06c(0x14a)](_0x36cbbf);});if(!_0x2ddb04)throw new common_1[(_0x1cf385(0x1b0))](_0x1cf385(0x247),common_1[_0x1cf385(0x1f3)][_0x1cf385(0x249)]);return _0x2ddb04;}async[_0x12df21(0x1be)](_0x3e6d48){const _0x30fb2f=_0x12df21,{accountId:_0x4c1523,customId:_0x3d2e22,flags:_0x2ea42d,messageId:_0x1230c2,mode:_0x4b56bc}=_0x3e6d48,_0x180b29=await this[_0x30fb2f(0x2e0)]['exist']({'where':{'id':_0x4c1523}});if(!_0x180b29)throw new common_1[(_0x30fb2f(0x1b0))](_0x30fb2f(0x2c6),common_1['HttpStatus']['BAD_REQUEST']);const {guild_id:_0x4eb7da,channel_id:_0x4d0954,authorization:_0x2827a2,mjProxyUrl:_0x4ea941,mjProxy:_0x49548f}=await this[_0x30fb2f(0x236)](_0x4b56bc)[_0x30fb2f(0x13a)](_0x17d69a=>{const _0x524630=_0x30fb2f;return Promise[_0x524630(0x106)](_0x17d69a);});console[_0x30fb2f(0x14a)](_0x49548f==0x1?'走代理':_0x30fb2f(0x1d4));if(_0x49548f==0x0){const _0x2619d0=await this['runActionSetting'](_0x3e6d48),{msg:_0x1120d6,type:_0x605275}=_0x2619d0;if(_0x605275==='MESSAGE_UPDATE')return await this[_0x30fb2f(0x2e0)][_0x30fb2f(0x2f6)]({'id':_0x4c1523},{'setting':JSON[_0x30fb2f(0x268)](_0x1120d6)})[_0x30fb2f(0x2c1)](_0x34a890=>_0x34a890[_0x30fb2f(0x2ba)]>0x0)[_0x30fb2f(0x13a)](_0x277215=>{const _0x5a2796=_0x30fb2f;common_1['Logger'][_0x5a2796(0x1dc)](_0x277215);throw new common_1[(_0x5a2796(0x1b0))](_0x277215,common_1['HttpStatus'][_0x5a2796(0x249)]);});return!![];}else{const _0x5134f9=await this[_0x30fb2f(0x10a)]({'customId':_0x3d2e22,'messageId':_0x1230c2,'flags':_0x2ea42d,'guildId':_0x4eb7da,'channelId':_0x4d0954,'token':_0x2827a2,'mjProxyUrl':_0x4ea941});return console[_0x30fb2f(0x14a)](_0x30fb2f(0x2dc),_0x5134f9),await this['mjParamEntity'][_0x30fb2f(0x2f6)]({'id':_0x4c1523},{'setting':JSON[_0x30fb2f(0x268)](_0x5134f9)})[_0x30fb2f(0x2c1)](_0x1351f3=>_0x1351f3[_0x30fb2f(0x2ba)]>0x0)['catch'](_0x17d830=>{const _0x277cec=_0x30fb2f;common_1[_0x277cec(0x12b)]['error'](_0x17d830);throw new common_1[(_0x277cec(0x1b0))](_0x17d830,common_1[_0x277cec(0x1f3)][_0x277cec(0x249)]);});}}async[_0x12df21(0x10a)](_0x6868fb){const _0x3c317=_0x12df21,{channelId:_0x584ec4,token:_0x214bfb,guildId:_0x2816e6,flags:_0x269517,mjProxyUrl:_0x3882db,customId:_0x57f7a5,messageId:_0x36fbd3}=_0x6868fb;return axios_1['default'][_0x3c317(0x11a)](_0x3882db+'/api/mj/setting_update',{'custom_id':_0x57f7a5,'flags':_0x269517,'message_id':_0x36fbd3,'token':_0x214bfb,'channel_id':_0x584ec4,'guild_id':_0x2816e6})[_0x3c317(0x2c1)](_0x1153a2=>_0x1153a2['data'])[_0x3c317(0x13a)](_0x52f8cd=>Promise[_0x3c317(0x106)](_0x52f8cd));}async['handleGetMjSetting'](_0x393827){const _0xca1851=_0x12df21,{accountId:_0x551a60}=_0x393827,_0x1c811c=await this['mjParamEntity']['findOne']({'where':{'id':_0x551a60}});if(!_0x1c811c)throw new common_1[(_0xca1851(0x1b0))]('账户不存在',common_1[_0xca1851(0x1f3)]['BAD_REQUEST']);const {setting:_0x52a6a2}=_0x1c811c,_0x272b0d=_0x52a6a2?JSON[_0xca1851(0x1ed)](_0x52a6a2):'';if(!_0x272b0d)return await this[_0xca1851(0x1bc)](_0x1c811c,!![])['catch'](_0x417483=>{const _0x18b2cf=_0xca1851;console[_0x18b2cf(0x14a)](_0x417483);});else{const _0x366eaa=_0x272b0d[_0xca1851(0x2d4)];return _0x366eaa[_0xca1851(0x126)]>=0x2?_0x366eaa[0x1][_0xca1851(0x2d4)][0x1][_0xca1851(0x145)]===0x3:await this[_0xca1851(0x1bc)](_0x1c811c,!![])[_0xca1851(0x13a)](_0x1f6116=>{const _0x15bd5d=_0xca1851;console[_0x15bd5d(0x14a)](_0x1f6116);});}}async['runActionSetting'](_0x2a194f){const _0xa31232=_0x12df21,{messageId:_0x4d0b54,customId:_0x529b6e,flags:_0x57f832,mode:_0x15e0bb,accountId:_0xdfe2f4}=_0x2a194f,{guild_id:_0x5a30fc,channel_id:_0x344049,authorization:_0x50c0f5}=await this[_0xa31232(0x236)](_0x15e0bb)[_0xa31232(0x13a)](_0x2de0cf=>{const _0x2f16e0=_0xa31232;return Promise[_0x2f16e0(0x106)](_0x2de0cf);}),_0xf73544=this[_0xa31232(0x23d)],_0x51e15f=this['apiBaseUrl'];return!this['midJourney'][_0x15e0bb]&&await this[_0xa31232(0x2a1)]({'channel_id':_0x344049,'guild_id':_0x5a30fc,'token':_0x50c0f5,'wsBaseUrl':_0xf73544,'apiBaseUrl':_0x51e15f},_0x15e0bb),new Promise(async(_0x56c7b4,_0x4312c0)=>{const _0x32d934=_0xa31232;return await this[_0x32d934(0x225)][_0x15e0bb]['api']['action'](_0x4d0b54,_0x529b6e,_0x57f832,(_0x412149,_0x420dc7)=>{const _0x532b70=_0x32d934;console[_0x532b70(0x14a)](_0x532b70(0x17a),_0x412149,'receive',_0x420dc7),_0x56c7b4({'type':_0x412149,'msg':_0x420dc7});});});}[_0x12df21(0x2bd)](_0x5b6917){const _0x3213b9=_0x12df21;if(!_0x5b6917)return'fast';if(_0x5b6917===midjourney_constant_1['DrawSpeed']['fast'])return _0x3213b9(0x2fb);if(_0x5b6917===midjourney_constant_1[_0x3213b9(0x290)][_0x3213b9(0x28f)])return _0x3213b9(0x28f);if(_0x5b6917===midjourney_constant_1['DrawSpeed'][_0x3213b9(0x170)])return _0x3213b9(0x170);return _0x3213b9(0x2fb);}async[_0x12df21(0x235)](_0x781d44){const _0x2f9ff2=_0x12df21,_0x158867=await this['mjpTaskService'][_0x2f9ff2(0x1b1)]({'data':{'ids':[_0x781d44]}});common_1['Logger']['log'](_0x2f9ff2(0x1ac)),this[_0x2f9ff2(0x2c0)](_0x158867[0x0]);}async[_0x12df21(0x2c0)](_0x54d2c7){const _0x4e1804=_0x12df21;common_1[_0x4e1804(0x12b)][_0x4e1804(0x14a)](_0x54d2c7,_0x4e1804(0x262));try{let _0xba333e=[];const _0x3de2ad=midjourney_constant_1[_0x4e1804(0x25a)][_0x4e1804(0x240)](_0x54d2c7[_0x4e1804(0x30e)]),_0x2fda57=_0x54d2c7[_0x4e1804(0x1d8)]?parseFloat(_0x54d2c7[_0x4e1804(0x1d8)]):null;let _0x41e1b2=await this['midjourneyEntity'][_0x4e1804(0x2fd)]({'where':{'mjpTaskId':_0x54d2c7['id']}});if(_0x54d2c7['status']===_0x4e1804(0x2a7)&&_0x41e1b2[_0x4e1804(0x20d)]){common_1[_0x4e1804(0x12b)][_0x4e1804(0x14a)](_0x4e1804(0x2b7),_0x4e1804(0x2bb));return;}_0x54d2c7[_0x4e1804(0x201)]&&(_0xba333e=_0x54d2c7[_0x4e1804(0x201)]['filter'](_0x1fb1ce=>_0x1fb1ce[_0x4e1804(0x190)]!==_0x4e1804(0x1e2)&&_0x1fb1ce[_0x4e1804(0x190)]!==_0x4e1804(0x1c3)&&_0x1fb1ce['emoji']!=='❤️'));MjConfig_1[_0x4e1804(0x1b3)]['mjProxyImgUrl']&&_0x54d2c7['imageUrl']&&(_0x54d2c7[_0x4e1804(0x16d)]=_0x54d2c7[_0x4e1804(0x16d)][_0x4e1804(0x1aa)](_0x4e1804(0x17f),MjConfig_1[_0x4e1804(0x1b3)][_0x4e1804(0xf7)]));const _0x36d4d0={'id':_0x41e1b2['id'],'status':_0x3de2ad,'progress':_0x2fda57,'durationSpent':null,'imageUrl':_0x54d2c7[_0x4e1804(0x16d)],'failReason':_0x54d2c7[_0x4e1804(0x18a)],'buttons':JSON[_0x4e1804(0x268)](_0xba333e)};return(_0x54d2c7[_0x4e1804(0x186)]=_0x4e1804(0x30d))&&(_0x36d4d0['prompt']=_0x54d2c7['prompt']||_0x36d4d0[_0x4e1804(0x16b)]||''),_0x54d2c7[_0x4e1804(0x174)]&&_0x54d2c7['startTime']&&(_0x36d4d0['durationSpent']=(_0x54d2c7[_0x4e1804(0x174)]-_0x54d2c7['startTime'])/0x3e8),_0x41e1b2=await this[_0x4e1804(0x2e7)][_0x4e1804(0x1b2)](_0x36d4d0),_0x54d2c7[_0x4e1804(0x30e)]===_0x4e1804(0x28c)&&_0x54d2c7[_0x4e1804(0x16d)]&&this[_0x4e1804(0x2f0)]['transferImg'](_0x41e1b2['id'],_0x41e1b2['imageUrl']),null;}catch(_0x1cee35){common_1[_0x4e1804(0x12b)]['error']('Mj任务通知异常:\x20',_0x1cee35);}}async[_0x12df21(0x230)](){const _0x4cf94d=_0x12df21;try{const _0x36e47b=await this[_0x4cf94d(0x2e7)][_0x4cf94d(0x2e3)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6])}});if(_0x36e47b[_0x4cf94d(0x126)])for(let _0x42e1b8=0x0;_0x42e1b8<_0x36e47b['length'];_0x42e1b8++){const _0x13f921=redisKey_constant_1['MJ_TASK_UPDATE']+_0x36e47b[_0x42e1b8][_0x4cf94d(0x2c3)],_0x1311b9=await this[_0x4cf94d(0x2f4)][_0x4cf94d(0x240)]({'key':_0x13f921});if(_0x1311b9)continue;else this[_0x4cf94d(0x2f4)][_0x4cf94d(0x181)]({'key':_0x13f921,'val':_0x4cf94d(0x2b6)}),this[_0x4cf94d(0x21d)]['listByCondition']({'data':{'ids':[_0x36e47b[_0x42e1b8][_0x4cf94d(0x2c3)]]}})['then'](async _0x5510a1=>{const _0x5ef9ab=_0x4cf94d,_0x28d99d=_0x5510a1[0x0],_0x3885da=_0x36e47b[_0x42e1b8],_0x3028c5=midjourney_constant_1[_0x5ef9ab(0x25a)]['get'](_0x28d99d['status']),_0x267744=_0x28d99d[_0x5ef9ab(0x1d8)]?parseFloat(_0x28d99d[_0x5ef9ab(0x1d8)]):null;if(_0x3885da[_0x5ef9ab(0x1d8)]===_0x267744&&_0x3885da[_0x5ef9ab(0x30e)]===_0x3028c5){}else{const _0x27298c=_0x28d99d['buttons'][_0x5ef9ab(0x24c)](_0x44eb23=>_0x44eb23[_0x5ef9ab(0x190)]!==_0x5ef9ab(0x1e2)&&_0x44eb23['label']!==_0x5ef9ab(0x1c3)&&_0x44eb23[_0x5ef9ab(0x2a5)]!=='❤️'),_0xc64d3e={'id':_0x3885da['id'],'mjpTaskId':_0x28d99d['id'],'status':_0x3028c5,'progress':_0x267744,'durationSpent':null,'imageUrl':_0x28d99d[_0x5ef9ab(0x16d)],'failReason':_0x28d99d['failReason'],'buttons':JSON['stringify'](_0x27298c)};(_0x28d99d[_0x5ef9ab(0x186)]='DESCRIBE')&&(_0xc64d3e[_0x5ef9ab(0x16b)]=_0x28d99d[_0x5ef9ab(0x16b)]||_0xc64d3e[_0x5ef9ab(0x16b)]||''),_0x28d99d[_0x5ef9ab(0x174)]&&_0x28d99d[_0x5ef9ab(0x1e0)]&&(_0xc64d3e[_0x5ef9ab(0x12c)]=(_0x28d99d[_0x5ef9ab(0x174)]-_0x28d99d['startTime'])/0x3e8),await this[_0x5ef9ab(0x2e7)][_0x5ef9ab(0x1b2)](_0xc64d3e);}})[_0x4cf94d(0x13a)](_0x4f997a=>{const _0x536b74=_0x4cf94d;common_1[_0x536b74(0x12b)]['error'](_0x536b74(0x2c8),_0x4f997a);})[_0x4cf94d(0x266)](()=>{const _0x264dc7=_0x4cf94d;this[_0x264dc7(0x2f4)]['del']({'key':_0x13f921});});}}catch(_0x3dd5f8){}}async['syncMjImg'](){const _0x358380=_0x12df21;if(MjConfig_1['default']['mjNotSaveImg'])return;try{const _0x391e66=await this[_0x358380(0x2e7)][_0x358380(0x2e3)]({'where':{'status':0x3,'imageUrl':(0x0,typeorm_2['Like'])('https://cdn.discordapp.com%')}});if(_0x391e66['length'])for(let _0x37dbb8=0x0;_0x37dbb8<_0x391e66[_0x358380(0x126)];_0x37dbb8++){let {id:_0xf1cee5,imageUrl:_0x5f3127}=_0x391e66[_0x37dbb8];this['uploadService'][_0x358380(0x175)](_0xf1cee5,_0x5f3127);}}catch(_0x3e8151){common_1[_0x358380(0x12b)][_0x358380(0x1dc)](_0x3e8151);}}};MidjourneyService=__decorate([(0x0,common_1[_0x12df21(0x143)])(),__param(0x0,(0x0,typeorm_1[_0x12df21(0xfb)])(midjourney_entity_1['MidjourneyEntity'])),__param(0x1,(0x0,typeorm_1[_0x12df21(0xfb)])(user_entity_1[_0x12df21(0x224)])),__param(0x2,(0x0,typeorm_1[_0x12df21(0xfb)])(mjPrompts_entity_1[_0x12df21(0x243)])),__param(0x3,(0x0,typeorm_1[_0x12df21(0xfb)])(mjParam_entity_1[_0x12df21(0x2bf)])),__param(0x4,(0x0,typeorm_1['InjectRepository'])(mjIncantationClassify_entity_1[_0x12df21(0x204)])),__param(0x5,(0x0,typeorm_1[_0x12df21(0xfb)])(mjInspireClassify_entity_1[_0x12df21(0x12e)])),__param(0x6,(0x0,typeorm_1[_0x12df21(0xfb)])(mjSuggestWord_entity_1[_0x12df21(0x265)])),__param(0x7,(0x0,typeorm_1[_0x12df21(0xfb)])(mjIncantation_entity_1[_0x12df21(0x2e6)])),__metadata(_0x12df21(0x2ea),[typeorm_2['Repository'],typeorm_2[_0x12df21(0x2f5)],typeorm_2[_0x12df21(0x2f5)],typeorm_2['Repository'],typeorm_2[_0x12df21(0x2f5)],typeorm_2[_0x12df21(0x2f5)],typeorm_2[_0x12df21(0x2f5)],typeorm_2[_0x12df21(0x2f5)],globalConfig_service_1[_0x12df21(0x1eb)],upload_service_1[_0x12df21(0xfc)],badwords_service_1[_0x12df21(0x130)],userBalance_service_1[_0x12df21(0x19e)],fanyi_service_1['FanyiService'],user_service_1[_0x12df21(0x20e)],redisCache_service_1[_0x12df21(0x19a)],mjpAccount_service_1['MjpAccountService'],mjpTask_service_1['MjpTaskService'],aiLog_service_1[_0x12df21(0x218)],typeorm_2[_0x12df21(0x1ca)]])],MidjourneyService),exports[_0x12df21(0x25c)]=MidjourneyService;