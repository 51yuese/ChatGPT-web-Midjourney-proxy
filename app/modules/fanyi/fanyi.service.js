'use strict';function _0x593e(){const _0x29ca01=['onModuleInit','2WjvJsm','system','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','translateToEnglish','当前管理员还未开放翻译服务、请联系管理员开通吧!','./../globalConfig/globalConfig.service','catch','dst','5lUxSyd','modelsService','请输入要翻译的内容!','apiKey','137448bRBjbf','EModelType','/v1','default','getConfigs','Injectable','5708540AIlsOB','message','now','api','@nestjs/common','content','Logger','FanyiService','data','openai','chat','getRandomKey','metadata','defaultUrl','getOwnPropertyDescriptor','error','../models/models.service','HttpException','ModelsService','36110464AtFIYl','length','text','post','1091942OnPgwZ','defineProperty','翻译失败[','3378717avKGQC','object','globalConfigService','then','592oHvpDP','removeSpecialCharacters','../../common/constants/model.constant','user','createHash','BAD_REQUEST','gpt-4-all','openaiBaseUrl','translate\x20key','digest','4396566lpkYkX','function','https://fanyi-api.baidu.com/api/trans/vip/translate','翻译花费时间\x20%s\x20秒','toString','hex','baseURL','HttpStatus','log','auto','14sQDjPI','../../common/utils','create','decorate','12hzUQpe','completions','14034860hbyayF','11KFDoxh','https://api.openai.com'];_0x593e=function(){return _0x29ca01;};return _0x593e();}const _0x110e36=_0x3a44;(function(_0x150b13,_0x21f3d2){const _0x1de2d3=_0x3a44,_0x3d872a=_0x150b13();while(!![]){try{const _0x22813f=parseInt(_0x1de2d3(0x205))/0x1*(-parseInt(_0x1de2d3(0x1e0))/0x2)+-parseInt(_0x1de2d3(0x1e3))/0x3+parseInt(_0x1de2d3(0x1c9))/0x4*(parseInt(_0x1de2d3(0x1bf))/0x5)+parseInt(_0x1de2d3(0x1f1))/0x6*(parseInt(_0x1de2d3(0x1fb))/0x7)+-parseInt(_0x1de2d3(0x1e7))/0x8*(parseInt(_0x1de2d3(0x1c3))/0x9)+-parseInt(_0x1de2d3(0x201))/0xa*(parseInt(_0x1de2d3(0x202))/0xb)+parseInt(_0x1de2d3(0x1ff))/0xc*(parseInt(_0x1de2d3(0x1dc))/0xd);if(_0x22813f===_0x21f3d2)break;else _0x3d872a['push'](_0x3d872a['shift']());}catch(_0x53b3f2){_0x3d872a['push'](_0x3d872a['shift']());}}}(_0x593e,0xe043e));var __decorate=this&&this['__decorate']||function(_0x565b9c,_0x3df229,_0x20655c,_0x3eccb6){const _0x7a5a6=_0x3a44;var _0x47fb95=arguments[_0x7a5a6(0x1dd)],_0x12309a=_0x47fb95<0x3?_0x3df229:_0x3eccb6===null?_0x3eccb6=Object[_0x7a5a6(0x1d7)](_0x3df229,_0x20655c):_0x3eccb6,_0x2f0cfa;if(typeof Reflect==='object'&&typeof Reflect[_0x7a5a6(0x1fe)]===_0x7a5a6(0x1f2))_0x12309a=Reflect['decorate'](_0x565b9c,_0x3df229,_0x20655c,_0x3eccb6);else{for(var _0x5c3222=_0x565b9c[_0x7a5a6(0x1dd)]-0x1;_0x5c3222>=0x0;_0x5c3222--)if(_0x2f0cfa=_0x565b9c[_0x5c3222])_0x12309a=(_0x47fb95<0x3?_0x2f0cfa(_0x12309a):_0x47fb95>0x3?_0x2f0cfa(_0x3df229,_0x20655c,_0x12309a):_0x2f0cfa(_0x3df229,_0x20655c))||_0x12309a;}return _0x47fb95>0x3&&_0x12309a&&Object[_0x7a5a6(0x1e1)](_0x3df229,_0x20655c,_0x12309a),_0x12309a;},__metadata=this&&this['__metadata']||function(_0x4df1ec,_0x47275d){const _0x4b4ceb=_0x3a44;if(typeof Reflect===_0x4b4ceb(0x1e4)&&typeof Reflect['metadata']===_0x4b4ceb(0x1f2))return Reflect[_0x4b4ceb(0x1d5)](_0x4df1ec,_0x47275d);};Object[_0x110e36(0x1e1)](exports,'__esModule',{'value':!![]}),exports[_0x110e36(0x1d0)]=void 0x0;function _0x3a44(_0x5a8368,_0x1e101e){const _0x593e1d=_0x593e();return _0x3a44=function(_0x3a4461,_0xdfb0a2){_0x3a4461=_0x3a4461-0x1bf;let _0xc987de=_0x593e1d[_0x3a4461];return _0xc987de;},_0x3a44(_0x5a8368,_0x1e101e);}const globalConfig_service_1=require(_0x110e36(0x20a)),common_1=require(_0x110e36(0x1cd)),axios_1=require('axios'),crypto=require('crypto'),openai_1=require(_0x110e36(0x1d2)),utils_1=require(_0x110e36(0x1fc)),models_service_1=require(_0x110e36(0x1d9)),model_constant_1=require(_0x110e36(0x1e9));let FanyiService=class FanyiService{constructor(_0x5a6461,_0x3aab45){const _0x2b879d=_0x110e36;this[_0x2b879d(0x1e5)]=_0x5a6461,this[_0x2b879d(0x1c0)]=_0x3aab45,this[_0x2b879d(0x1d6)]=_0x2b879d(0x203);}[_0x110e36(0x204)](){const _0x534dac=_0x110e36;this[_0x534dac(0x1cc)]=new openai_1['default']({'apiKey':'default-gomaxai-key','baseURL':this[_0x534dac(0x1d6)]+_0x534dac(0x1c5)});}async['convertToEnglish'](_0xb47e35){const _0x274b84=_0x110e36;if(!_0xb47e35)throw new common_1[(_0x274b84(0x1da))](_0x274b84(0x1c1),common_1['HttpStatus']['BAD_REQUEST']);const {baiduFanyiAppId:_0x60f0d0,baiduFanyiSecret:_0x5b779d}=await this['globalConfigService'][_0x274b84(0x1c7)](['baiduFanyiAppId','baiduFanyiSecret']);if(!_0x60f0d0||!_0x5b779d)throw new common_1[(_0x274b84(0x1da))](_0x274b84(0x209),common_1[_0x274b84(0x1f8)]['BAD_REQUEST']);const _0x29f1b9=Date['now']()[_0x274b84(0x1f5)](),_0x3a74a6=crypto[_0x274b84(0x1eb)]('md5')['update'](_0x60f0d0+_0xb47e35+_0x29f1b9+_0x5b779d)[_0x274b84(0x1f0)](_0x274b84(0x1f6)),_0x1ab3dc=_0x274b84(0x1f3),_0x2809e1={'q':_0xb47e35['toString'](),'from':_0x274b84(0x1fa),'to':'en','appid':_0x60f0d0,'salt':_0x29f1b9,'sign':_0x3a74a6},_0x186be0=await axios_1[_0x274b84(0x1c6)][_0x274b84(0x1df)](_0x1ab3dc,_0x2809e1,{'headers':{'Content-Type':'application/x-www-form-urlencoded'}}),{from:_0x5cb884,to:_0x1aba6a,trans_result:_0x411c73,error_code:_0x4724f9,error_msg:_0x20b383}=_0x186be0[_0x274b84(0x1d1)];if(_0x4724f9)throw new common_1[(_0x274b84(0x1da))]('翻译失败['+_0x4724f9+']['+_0x20b383+']!',common_1[_0x274b84(0x1f8)][_0x274b84(0x1ec)]);if(!_0x411c73||!_0x411c73[_0x274b84(0x1dd)])throw new common_1[(_0x274b84(0x1da))](_0x274b84(0x1e2)+_0x4724f9+']['+_0x20b383+']!',common_1[_0x274b84(0x1f8)][_0x274b84(0x1ec)]);else return _0x411c73[0x0][_0x274b84(0x20c)];}async[_0x110e36(0x208)](_0x379aa5){const _0x33c049=_0x110e36,_0x14925d='接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！';let _0x208d2d=await this[_0x33c049(0x1c0)][_0x33c049(0x1d4)](model_constant_1[_0x33c049(0x1c4)]['OTHER']);if(!_0x208d2d)throw new common_1[(_0x33c049(0x1da))](_0x33c049(0x207),common_1['HttpStatus'][_0x33c049(0x1ec)]);const {timeout:_0x22a432,model:_0x48f70a,key:_0x21354d,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x51ee98}=_0x208d2d;let _0x4dc8da=_0x51ee98;!_0x51ee98&&(_0x4dc8da=await this[_0x33c049(0x1e5)][_0x33c049(0x1c7)]([_0x33c049(0x1ee)]));this['api'][_0x33c049(0x1c2)]=(0x0,utils_1[_0x33c049(0x1e8)])(_0x21354d),this['api'][_0x33c049(0x1f7)]=(_0x4dc8da||this['defaultUrl'])+_0x33c049(0x1c5),this[_0x33c049(0x1cc)]['timeout']=0x493e0;try{common_1[_0x33c049(0x1cf)][_0x33c049(0x1f9)](_0x21354d,_0x33c049(0x1ef)),common_1['Logger'][_0x33c049(0x1f9)](_0x4dc8da,'gpt-fanyi');const _0x14a7af=Date[_0x33c049(0x1cb)](),_0x13d120=await this['api'][_0x33c049(0x1d3)][_0x33c049(0x200)][_0x33c049(0x1fd)]({'messages':[{'role':_0x33c049(0x206),'content':_0x14925d},{'role':_0x33c049(0x1ea),'content':_0x379aa5}],'model':_0x33c049(0x1ed),'stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':_0x33c049(0x1de)}})[_0x33c049(0x1e6)](_0x477284=>{const _0x5cf684=_0x33c049;return _0x477284?.['choices'][0x0]?.[_0x5cf684(0x1ca)][_0x5cf684(0x1ce)]||'';})[_0x33c049(0x20b)](_0x1606b4=>{const _0x8a822f=_0x33c049;return common_1[_0x8a822f(0x1cf)][_0x8a822f(0x1d8)](_0x1606b4),'';}),_0x1570f8=Date[_0x33c049(0x1cb)](),_0x3cf497=(_0x1570f8-_0x14a7af)/0x3e8;return common_1[_0x33c049(0x1cf)][_0x33c049(0x1f9)](_0x3cf497,_0x33c049(0x1f4)),_0x13d120;}catch(_0x4e89b6){console['log']('fanyi-error',_0x21354d,_0x4e89b6);throw new common_1[(_0x33c049(0x1da))](_0x4e89b6[_0x33c049(0x1ca)],common_1[_0x33c049(0x1f8)][_0x33c049(0x1ec)]);}}};FanyiService=__decorate([(0x0,common_1[_0x110e36(0x1c8)])(),__metadata('design:paramtypes',[globalConfig_service_1['GlobalConfigService'],models_service_1[_0x110e36(0x1db)]])],FanyiService),exports['FanyiService']=FanyiService;