'use strict';const _0x246a1a=_0x1592;(function(_0x31ef6f,_0xade823){const _0x14a00a=_0x1592,_0x2f62f2=_0x31ef6f();while(!![]){try{const _0x4a1114=parseInt(_0x14a00a(0x225))/0x1+-parseInt(_0x14a00a(0x200))/0x2*(parseInt(_0x14a00a(0x206))/0x3)+-parseInt(_0x14a00a(0x226))/0x4+parseInt(_0x14a00a(0x214))/0x5*(parseInt(_0x14a00a(0x20f))/0x6)+parseInt(_0x14a00a(0x1f7))/0x7+parseInt(_0x14a00a(0x22c))/0x8*(-parseInt(_0x14a00a(0x1ed))/0x9)+-parseInt(_0x14a00a(0x1fc))/0xa*(-parseInt(_0x14a00a(0x221))/0xb);if(_0x4a1114===_0xade823)break;else _0x2f62f2['push'](_0x2f62f2['shift']());}catch(_0x56b26f){_0x2f62f2['push'](_0x2f62f2['shift']());}}}(_0x14fb,0xc2609));var __decorate=this&&this['__decorate']||function(_0xb0ac25,_0xee9988,_0x100fca,_0x2abdad){const _0x3626b0=_0x1592;var _0x1ab8ef=arguments[_0x3626b0(0x1f0)],_0x440767=_0x1ab8ef<0x3?_0xee9988:_0x2abdad===null?_0x2abdad=Object[_0x3626b0(0x231)](_0xee9988,_0x100fca):_0x2abdad,_0x40445a;if(typeof Reflect===_0x3626b0(0x1ea)&&typeof Reflect[_0x3626b0(0x215)]==='function')_0x440767=Reflect['decorate'](_0xb0ac25,_0xee9988,_0x100fca,_0x2abdad);else{for(var _0x56ca3d=_0xb0ac25['length']-0x1;_0x56ca3d>=0x0;_0x56ca3d--)if(_0x40445a=_0xb0ac25[_0x56ca3d])_0x440767=(_0x1ab8ef<0x3?_0x40445a(_0x440767):_0x1ab8ef>0x3?_0x40445a(_0xee9988,_0x100fca,_0x440767):_0x40445a(_0xee9988,_0x100fca))||_0x440767;}return _0x1ab8ef>0x3&&_0x440767&&Object['defineProperty'](_0xee9988,_0x100fca,_0x440767),_0x440767;},__metadata=this&&this[_0x246a1a(0x203)]||function(_0x43299f,_0x1cb88a){const _0x40faf9=_0x246a1a;if(typeof Reflect===_0x40faf9(0x1ea)&&typeof Reflect['metadata']===_0x40faf9(0x237))return Reflect['metadata'](_0x43299f,_0x1cb88a);};Object[_0x246a1a(0x1f2)](exports,_0x246a1a(0x1f4),{'value':!![]}),exports[_0x246a1a(0x1fe)]=void 0x0;function _0x1592(_0x2ea3c6,_0x5e822a){const _0x14fb8c=_0x14fb();return _0x1592=function(_0x1592e0,_0x50cc4a){_0x1592e0=_0x1592e0-0x1e9;let _0x2316ac=_0x14fb8c[_0x1592e0];return _0x2316ac;},_0x1592(_0x2ea3c6,_0x5e822a);}const globalConfig_service_1=require(_0x246a1a(0x21a)),common_1=require(_0x246a1a(0x212)),axios_1=require(_0x246a1a(0x227)),crypto=require('crypto'),openai_1=require(_0x246a1a(0x233)),utils_1=require('../../common/utils'),models_service_1=require(_0x246a1a(0x238)),model_constant_1=require(_0x246a1a(0x22a));let FanyiService=class FanyiService{constructor(_0xeb381c,_0xf13448){const _0x298f7e=_0x246a1a;this[_0x298f7e(0x1eb)]=_0xeb381c,this['modelsService']=_0xf13448,this['defaultUrl']=_0x298f7e(0x20e);}[_0x246a1a(0x208)](){const _0x2ba3b3=_0x246a1a;this[_0x2ba3b3(0x22b)]=new openai_1['default']({'apiKey':_0x2ba3b3(0x207),'baseURL':this['defaultUrl']+_0x2ba3b3(0x1fd)});}async[_0x246a1a(0x218)](_0x62ad78){const _0x5e8d42=_0x246a1a;if(!_0x62ad78)throw new common_1[(_0x5e8d42(0x220))](_0x5e8d42(0x1ec),common_1[_0x5e8d42(0x217)][_0x5e8d42(0x21c)]);const {baiduFanyiAppId:_0x56ae85,baiduFanyiSecret:_0x3a25e8}=await this[_0x5e8d42(0x1eb)][_0x5e8d42(0x229)]([_0x5e8d42(0x1f5),_0x5e8d42(0x224)]);if(!_0x56ae85||!_0x3a25e8)throw new common_1['HttpException'](_0x5e8d42(0x236),common_1['HttpStatus'][_0x5e8d42(0x21c)]);const _0x55d88f=Date['now']()[_0x5e8d42(0x23a)](),_0x295254=crypto[_0x5e8d42(0x223)]('md5')[_0x5e8d42(0x21f)](_0x56ae85+_0x62ad78+_0x55d88f+_0x3a25e8)[_0x5e8d42(0x1f9)](_0x5e8d42(0x1f3)),_0x5e8f51=_0x5e8d42(0x21d),_0x42cec1={'q':_0x62ad78[_0x5e8d42(0x23a)](),'from':'auto','to':'en','appid':_0x56ae85,'salt':_0x55d88f,'sign':_0x295254},_0xb00f=await axios_1[_0x5e8d42(0x222)]['post'](_0x5e8f51,_0x42cec1,{'headers':{'Content-Type':_0x5e8d42(0x205)}}),{from:_0x4a25f1,to:_0xa31dfd,trans_result:_0x55e8ff,error_code:_0x20ed24,error_msg:_0x3fba9d}=_0xb00f[_0x5e8d42(0x23b)];if(_0x20ed24)throw new common_1[(_0x5e8d42(0x220))](_0x5e8d42(0x1ee)+_0x20ed24+']['+_0x3fba9d+']!',common_1[_0x5e8d42(0x217)][_0x5e8d42(0x21c)]);if(!_0x55e8ff||!_0x55e8ff['length'])throw new common_1['HttpException'](_0x5e8d42(0x1ee)+_0x20ed24+']['+_0x3fba9d+']!',common_1['HttpStatus'][_0x5e8d42(0x21c)]);else return _0x55e8ff[0x0][_0x5e8d42(0x219)];}async[_0x246a1a(0x1fb)](_0x9597d2){const _0x1f7e32=_0x246a1a,_0x545f5a=_0x1f7e32(0x1ff);let _0x3417ea=await this[_0x1f7e32(0x202)][_0x1f7e32(0x1f1)](model_constant_1[_0x1f7e32(0x234)][_0x1f7e32(0x22d)]);if(!_0x3417ea)throw new common_1[(_0x1f7e32(0x220))](_0x1f7e32(0x230),common_1[_0x1f7e32(0x217)][_0x1f7e32(0x21c)]);const {timeout:_0x418c9a,model:_0x42dba4,key:_0x3f6682,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x43063d}=_0x3417ea;let _0x42496e=_0x43063d;!_0x43063d&&(_0x42496e=await this[_0x1f7e32(0x1eb)][_0x1f7e32(0x229)]([_0x1f7e32(0x20a)]));this[_0x1f7e32(0x22b)][_0x1f7e32(0x216)]=(0x0,utils_1['removeSpecialCharacters'])(_0x3f6682),this[_0x1f7e32(0x22b)][_0x1f7e32(0x209)]=(_0x42496e||this[_0x1f7e32(0x201)])+_0x1f7e32(0x1fd),this[_0x1f7e32(0x22b)]['timeout']=0x493e0;try{common_1['Logger'][_0x1f7e32(0x213)](_0x3f6682,'translate\x20key'),common_1['Logger']['log'](_0x42496e,_0x1f7e32(0x20c));const _0x773da3=Date[_0x1f7e32(0x1fa)](),_0x39fef8=await this['api'][_0x1f7e32(0x21e)][_0x1f7e32(0x232)][_0x1f7e32(0x20b)]({'messages':[{'role':_0x1f7e32(0x1f6),'content':_0x545f5a},{'role':_0x1f7e32(0x204),'content':_0x9597d2}],'model':_0x1f7e32(0x1f8),'stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':_0x1f7e32(0x228)}})['then'](_0x217fc6=>{const _0x57496d=_0x1f7e32;return _0x217fc6?.[_0x57496d(0x20d)][0x0]?.['message'][_0x57496d(0x211)]||'';})['catch'](_0x15b05a=>{const _0x19f4e3=_0x1f7e32;return common_1['Logger'][_0x19f4e3(0x22e)](_0x15b05a),'';}),_0x1010bf=Date[_0x1f7e32(0x1fa)](),_0x4116e0=(_0x1010bf-_0x773da3)/0x3e8;return common_1['Logger'][_0x1f7e32(0x213)](_0x4116e0,_0x1f7e32(0x1e9)),_0x39fef8;}catch(_0x1efda6){console['log'](_0x1f7e32(0x235),_0x3f6682,_0x1efda6);throw new common_1[(_0x1f7e32(0x220))](_0x1efda6[_0x1f7e32(0x239)],common_1[_0x1f7e32(0x217)][_0x1f7e32(0x21c)]);}}};function _0x14fb(){const _0x412fcc=['dst','./../globalConfig/globalConfig.service','ModelsService','BAD_REQUEST','https://fanyi-api.baidu.com/api/trans/vip/translate','chat','update','HttpException','3014cOoNgz','default','createHash','baiduFanyiSecret','1267120pwhNUn','2864660gRrIJr','axios','text','getConfigs','../../common/constants/model.constant','api','856dhGEal','OTHER','error','Injectable','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','getOwnPropertyDescriptor','completions','openai','EModelType','fanyi-error','当前管理员还未开放翻译服务、请联系管理员开通吧!','function','../models/models.service','message','toString','data','翻译花费时间\x20%s\x20秒','object','globalConfigService','请输入要翻译的内容!','87921JGndLn','翻译失败[','design:paramtypes','length','getRandomKey','defineProperty','hex','__esModule','baiduFanyiAppId','system','490497kfxxTu','gpt-4-all','digest','now','translateToEnglish','73180DbVUKq','/v1','FanyiService','接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！','348pfygAD','defaultUrl','modelsService','__metadata','user','application/x-www-form-urlencoded','15570ksDMFi','default-gomaxai-key','onModuleInit','baseURL','openaiBaseUrl','create','gpt-fanyi','choices','https://api.openai.com','354iXjwhM','GlobalConfigService','content','@nestjs/common','log','10030nRVrsW','decorate','apiKey','HttpStatus','convertToEnglish'];_0x14fb=function(){return _0x412fcc;};return _0x14fb();}FanyiService=__decorate([(0x0,common_1[_0x246a1a(0x22f)])(),__metadata(_0x246a1a(0x1ef),[globalConfig_service_1[_0x246a1a(0x210)],models_service_1[_0x246a1a(0x21b)]])],FanyiService),exports['FanyiService']=FanyiService;