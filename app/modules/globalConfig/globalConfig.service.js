'use strict';const _0x446c11=_0x40a0;(function(_0x1e3590,_0x491c7e){const _0x1990dc=_0x40a0,_0x325ae9=_0x1e3590();while(!![]){try{const _0x463868=-parseInt(_0x1990dc(0x133))/0x1+-parseInt(_0x1990dc(0x117))/0x2+-parseInt(_0x1990dc(0xd2))/0x3*(-parseInt(_0x1990dc(0x104))/0x4)+parseInt(_0x1990dc(0x12b))/0x5*(-parseInt(_0x1990dc(0x150))/0x6)+-parseInt(_0x1990dc(0xd0))/0x7+parseInt(_0x1990dc(0xa9))/0x8+-parseInt(_0x1990dc(0x141))/0x9*(-parseInt(_0x1990dc(0x162))/0xa);if(_0x463868===_0x491c7e)break;else _0x325ae9['push'](_0x325ae9['shift']());}catch(_0x448873){_0x325ae9['push'](_0x325ae9['shift']());}}}(_0x5e41,0x5a61b));function _0x40a0(_0x1151a0,_0x3d0c29){const _0x5e4192=_0x5e41();return _0x40a0=function(_0x40a0b4,_0x3d60d2){_0x40a0b4=_0x40a0b4-0xa7;let _0x317cc8=_0x5e4192[_0x40a0b4];return _0x317cc8;},_0x40a0(_0x1151a0,_0x3d0c29);}var __decorate=this&&this[_0x446c11(0xf9)]||function(_0x321d59,_0x2e3d0c,_0x1c663a,_0x3580d4){const _0x4c6c3f=_0x446c11;var _0x3a0402=arguments[_0x4c6c3f(0xe1)],_0x4eb48f=_0x3a0402<0x3?_0x2e3d0c:_0x3580d4===null?_0x3580d4=Object[_0x4c6c3f(0x10a)](_0x2e3d0c,_0x1c663a):_0x3580d4,_0x29e3c6;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x4eb48f=Reflect['decorate'](_0x321d59,_0x2e3d0c,_0x1c663a,_0x3580d4);else{for(var _0x25006f=_0x321d59[_0x4c6c3f(0xe1)]-0x1;_0x25006f>=0x0;_0x25006f--)if(_0x29e3c6=_0x321d59[_0x25006f])_0x4eb48f=(_0x3a0402<0x3?_0x29e3c6(_0x4eb48f):_0x3a0402>0x3?_0x29e3c6(_0x2e3d0c,_0x1c663a,_0x4eb48f):_0x29e3c6(_0x2e3d0c,_0x1c663a))||_0x4eb48f;}return _0x3a0402>0x3&&_0x4eb48f&&Object['defineProperty'](_0x2e3d0c,_0x1c663a,_0x4eb48f),_0x4eb48f;},__metadata=this&&this[_0x446c11(0x143)]||function(_0x3172b3,_0x172792){const _0x278d9f=_0x446c11;if(typeof Reflect===_0x278d9f(0xf8)&&typeof Reflect[_0x278d9f(0x11a)]==='function')return Reflect[_0x278d9f(0x11a)](_0x3172b3,_0x172792);},__param=this&&this['__param']||function(_0x22aa0a,_0x1b8a50){return function(_0x15f96f,_0x4f77a8){_0x1b8a50(_0x15f96f,_0x4f77a8,_0x22aa0a);};};Object[_0x446c11(0x153)](exports,_0x446c11(0xf1),{'value':!![]}),exports['GlobalConfigService']=void 0x0;const models_service_1=require(_0x446c11(0xdf)),chatLog_entity_1=require('./../chatLog/chatLog.entity'),common_1=require(_0x446c11(0xc8)),config_entity_1=require(_0x446c11(0xd8)),typeorm_1=require(_0x446c11(0x163)),typeorm_2=require(_0x446c11(0xf6)),utils_1=require(_0x446c11(0x19b)),axios_1=require(_0x446c11(0x189)),actions_1=require(_0x446c11(0xbd)),MjConfig_1=require(_0x446c11(0x17b)),WechatConfig_1=require(_0x446c11(0x179)),jwt=require('jsonwebtoken'),AppConfig_1=require(_0x446c11(0x15b)),authCheckUrl=(0x0,utils_1[_0x446c11(0x122)])('Jo11+muNwqhwlG7g1MeeGzh3NJ4nu4zHbOVgh/hIo0ZDV7rlji6LO/S+cD95Ru8Q'),authLogUrl=(0x0,utils_1[_0x446c11(0x122)])(_0x446c11(0xe4));let GlobalConfigService=class GlobalConfigService{constructor(_0x5d5fb7,_0x3faa77,_0x42b177){const _0x10fe97=_0x446c11;this[_0x10fe97(0x15d)]=_0x5d5fb7,this[_0x10fe97(0x115)]=_0x3faa77,this[_0x10fe97(0x158)]=_0x42b177,this[_0x10fe97(0xc3)]={},this[_0x10fe97(0xe0)]=!![];}async['onModuleInit'](){const _0x2f94f3=_0x446c11;await this[_0x2f94f3(0x135)]()['then'](()=>{const _0x23924c=_0x2f94f3;common_1[_0x23924c(0x13d)][_0x23924c(0xdd)](_0x23924c(0xbb)),this['pushLog'](),this[_0x23924c(0xd4)]();});}async[_0x446c11(0x160)](_0x203b83){const _0x5d5d28=_0x446c11;if(_0x203b83[_0x5d5d28(0xe1)]===0x0)return;if(_0x203b83[_0x5d5d28(0xb8)](_0x5d5d28(0x131))&&_0x203b83[_0x5d5d28(0xe1)]===0x1)return this[_0x5d5d28(0x131)];if(_0x203b83[_0x5d5d28(0xb8)]('wechatJsapiTicket')&&_0x203b83[_0x5d5d28(0xe1)]===0x1)return this[_0x5d5d28(0x136)];if(_0x203b83['length']===0x1)return this[_0x5d5d28(0xc3)][_0x203b83[0x0]];else{const _0x576dba={};return _0x203b83[_0x5d5d28(0x114)](_0x4fbfa7=>_0x576dba[_0x4fbfa7]=this[_0x5d5d28(0xc3)][_0x4fbfa7]),_0x576dba;}}async[_0x446c11(0x135)](){const _0x5d19f7=_0x446c11,_0x1ea0d1=await this[_0x5d19f7(0x15d)][_0x5d19f7(0x17d)]();this[_0x5d19f7(0xc3)]=_0x1ea0d1[_0x5d19f7(0x11c)]((_0x122aff,_0x42bbda)=>{const _0x58995c=_0x5d19f7;return _0x122aff[_0x42bbda[_0x58995c(0xda)]]=_0x42bbda[_0x58995c(0x15c)],_0x122aff;},{}),MjConfig_1[_0x5d19f7(0xfc)][_0x5d19f7(0xcd)](_0x1ea0d1),WechatConfig_1[_0x5d19f7(0xfc)][_0x5d19f7(0xcd)](_0x1ea0d1),await this[_0x5d19f7(0x180)]();}async[_0x446c11(0x180)](_0x18a054=!![]){const _0xadb0e2=_0x446c11,{baiduTextApiKey:_0x3d18ae,baiduTextSecretKey:_0x32f231}=await this['getConfigs']([_0xadb0e2(0x18f),_0xadb0e2(0x10d)]);if(!_0x3d18ae||!_0x32f231){common_1[_0xadb0e2(0x13d)][_0xadb0e2(0xc6)]('百度敏感词初始化失败，如果需要敏感检测、请前往后台系统配置!','GlobalConfigService');return;}const _0x1181e8={'Content-Type':_0xadb0e2(0x14a),'Accept':_0xadb0e2(0x14a)},_0x51f200=_0xadb0e2(0x161)+_0x3d18ae+_0xadb0e2(0xde)+_0x32f231+_0xadb0e2(0xd3);try{const _0x74fdb8=await axios_1[_0xadb0e2(0xfc)][_0xadb0e2(0x18a)](_0x51f200,{'headers':_0x1181e8});this['globalConfigs'][_0xadb0e2(0xcc)]=_0x74fdb8[_0xadb0e2(0x191)]['access_token'];}catch(_0x16023e){if(_0x18a054)common_1['Logger'][_0xadb0e2(0xc6)](_0xadb0e2(0x102),_0xadb0e2(0x197));else throw new common_1['HttpException'](_0x16023e['response'][_0xadb0e2(0x191)][_0xadb0e2(0xfa)],common_1[_0xadb0e2(0x12e)][_0xadb0e2(0x181)]);}}async[_0x446c11(0x13e)](_0x378f8c=![]){const _0x1dd7b2=_0x446c11,_0x2dade7=process[_0x1dd7b2(0x192)][_0x1dd7b2(0x185)];if(_0x2dade7===_0x1dd7b2(0xce)||_0x2dade7===_0x1dd7b2(0x167)){const _0x2f0f7a=await axios_1['default'][_0x1dd7b2(0x111)](_0x1dd7b2(0x12f));this[_0x1dd7b2(0x131)]=_0x2f0f7a[_0x1dd7b2(0x191)][_0x1dd7b2(0x191)];}else{const {wechatOfficialAppId:_0x5ec97a,wechatOfficialAppSecret:_0x1d544a}=await this['getConfigs']([_0x1dd7b2(0xb6),_0x1dd7b2(0x174)]);if(!_0x5ec97a||!_0x1d544a)return common_1[_0x1dd7b2(0x13d)]['error']('还未配置微信的appId和secret、配置后才可进行微信扫码登录！！！',_0x1dd7b2(0xaa));this[_0x1dd7b2(0x131)]=await this['fetchBaseAccessToken'](_0x5ec97a,_0x1d544a,_0x378f8c);}this[_0x1dd7b2(0x136)]=await this[_0x1dd7b2(0x13a)](this[_0x1dd7b2(0x131)]),common_1[_0x1dd7b2(0x13d)][_0x1dd7b2(0xdd)](_0x1dd7b2(0xbc)+this['wechatAccessToken'],_0x1dd7b2(0xaa));}async['fetchBaseAccessToken'](_0x38a67f,_0x16fc1d,_0x879328=![]){const _0x51f2df=_0x446c11;if(process['env'][_0x51f2df(0xf0)]===_0x51f2df(0x15e)){this[_0x51f2df(0x131)]='';return;}const {data:{errmsg:_0x1bcf96,access_token:_0x446e29}}=await axios_1[_0x51f2df(0xfc)][_0x51f2df(0x111)]('https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid='+_0x38a67f+_0x51f2df(0x14e)+_0x16fc1d);if(_0x1bcf96){if(_0x879328)common_1['Logger'][_0x51f2df(0xc6)](_0x51f2df(0xa8)+_0x1bcf96,'OfficialService');else throw new common_1[(_0x51f2df(0xdb))]('请配置正确的秘钥、当前秘钥检测不通过！',common_1['HttpStatus']['BAD_REQUEST']);return'';}return _0x446e29;}async['fetchJsapiTicket'](_0x5179ce){const _0x34b9ba=_0x446c11;if(process[_0x34b9ba(0x192)][_0x34b9ba(0xf0)]==='TRUE'){this[_0x34b9ba(0x136)]='';return;}const _0x22c7ec=await axios_1[_0x34b9ba(0xfc)][_0x34b9ba(0x111)]('https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token='+_0x5179ce+_0x34b9ba(0x12d));return _0x22c7ec?.[_0x34b9ba(0x191)]?.[_0x34b9ba(0x112)];}async[_0x446c11(0x128)](_0x38d30b){const _0x410d31=_0x446c11,{role:_0x17fec2}=_0x38d30b['user'];return this[_0x410d31(0xc3)];}async[_0x446c11(0xc7)](_0x420d24){const _0x2ed8ae=_0x446c11,{domain:_0x18e0a7}=_0x420d24,_0x478d22=process[_0x2ed8ae(0x192)][(0x0,utils_1[_0x2ed8ae(0x122)])('JPFq8fAlQE2V2Eq7KWYSxg==')];return _0x18e0a7['includes'](_0x478d22);}async[_0x446c11(0x15f)](_0x5907d2,_0x3867ec){const _0x52bee9=_0x446c11,_0x2924e7=[_0x52bee9(0xe2),_0x52bee9(0x186),'registerSendModel3Count','registerSendModel4Count',_0x52bee9(0x127),_0x52bee9(0x139),_0x52bee9(0x148),_0x52bee9(0xf5),_0x52bee9(0x198),_0x52bee9(0xe7),'inviteSendStatus','inviteGiveSendModel3Count',_0x52bee9(0xd9),_0x52bee9(0x184),_0x52bee9(0x17e),_0x52bee9(0xb7),_0x52bee9(0x130),_0x52bee9(0x10f),_0x52bee9(0x105),_0x52bee9(0x18d),_0x52bee9(0x125),_0x52bee9(0x169),_0x52bee9(0x113),_0x52bee9(0x156),_0x52bee9(0xf4),'mindDefaultData',_0x52bee9(0x142),_0x52bee9(0x140),_0x52bee9(0x18b),'payEpayApiPayUrl','payEpayStatus',_0x52bee9(0x119),_0x52bee9(0x16c),'payMpayStatus',_0x52bee9(0x172),'isShowAppCatIcon',_0x52bee9(0xc4),_0x52bee9(0x110),_0x52bee9(0x144),_0x52bee9(0x183),_0x52bee9(0x199),_0x52bee9(0x124),_0x52bee9(0x193),_0x52bee9(0xb4),'wechatSilentLoginStatus',_0x52bee9(0xc0),_0x52bee9(0xbe),_0x52bee9(0x138),_0x52bee9(0x182),_0x52bee9(0x11f),_0x52bee9(0x126),_0x52bee9(0x16f)],_0x3ffac3=await this[_0x52bee9(0x15d)]['find']({'where':{'configKey':(0x0,typeorm_2['In'])(_0x2924e7)}}),{domain:_0x5d3b49}=_0x5907d2,_0x4c991f=this['globalConfigs'][_0x52bee9(0xc1)];_0x4c991f!==_0x5d3b49&&(await this[_0x52bee9(0x15a)]({'configKey':'domain','configVal':_0x5d3b49,'status':0x1}),await this[_0x52bee9(0x135)]());const _0x3ebb83=_0x3ffac3['reduce']((_0x50cc79,_0xd78c11)=>{const _0x5880e7=_0x52bee9;return _0x50cc79[_0xd78c11['configKey']]=_0xd78c11[_0x5880e7(0x15c)],_0x50cc79;},{}),{wechatOfficialAppId:_0x36fda4,wechatOfficialAppSecret:_0x59b696}=await this[_0x52bee9(0x160)]([_0x52bee9(0xb6),_0x52bee9(0x174)]),_0x13a1b5=!!(_0x36fda4&&_0x59b696);return{..._0x3ebb83,'isUseWxLogin':_0x13a1b5};}async[_0x446c11(0x17c)](_0x3a8127){const _0x39a036=_0x446c11,{role:_0x1ed5f8}=_0x3a8127[_0x39a036(0xff)],_0xbd9f35=await this[_0x39a036(0x15d)][_0x39a036(0x17d)]({'where':{'configKey':(0x0,typeorm_2[_0x39a036(0x175)])('%'+'chatGptKey'+'%')}});if(_0x1ed5f8===_0x39a036(0x196))return _0xbd9f35;return _0xbd9f35['map'](_0x12e216=>{const _0x37f885=_0x39a036;return _0x12e216['configVal']=(0x0,utils_1[_0x37f885(0x18c)])(_0x12e216[_0x37f885(0x15c)]),_0x12e216;});}async[_0x446c11(0x154)](_0x4d0405){const _0x3b2a7d=_0x446c11,_0x20d9d4=_0x4d0405[_0x3b2a7d(0x18e)][_0x3b2a7d(0xe3)](_0x18ef34=>_0x18ef34[_0x3b2a7d(0x15c)]),_0x594362=_0x20d9d4[_0x3b2a7d(0x159)](_0x2fafa3=>_0x2fafa3[_0x3b2a7d(0xda)]);for(const [_0x31f7f2,_0x116527]of _0x20d9d4['entries']()){const {configKey:_0x5eff57,configVal:_0x168664,status:_0x8738f1}=_0x116527;await this['createOrUpdate']({'configKey':_0x3b2a7d(0xb9)+(_0x31f7f2+0x1),'configVal':_0x168664,'status':_0x8738f1});}const _0x51d288=await this['configEntity'][_0x3b2a7d(0x17d)]({'where':{'configKey':(0x0,typeorm_2[_0x3b2a7d(0x175)])('%'+_0x3b2a7d(0xfb)+'%')}}),_0x1a9497=_0x51d288[_0x3b2a7d(0x159)](_0x451a5d=>_0x451a5d[_0x3b2a7d(0xda)]);if(_0x1a9497[_0x3b2a7d(0xe1)]>_0x594362[_0x3b2a7d(0xe1)]){const _0x334330=(0x0,utils_1['getDiffArray'])(_0x1a9497[_0x3b2a7d(0xe1)],_0x594362[_0x3b2a7d(0xe1)],'chatGptKey:');for(const _0x36dc77 of _0x334330){await this['configEntity'][_0x3b2a7d(0x187)]({'configKey':_0x36dc77});}}return await this[_0x3b2a7d(0x135)](),_0x3b2a7d(0x194);}async[_0x446c11(0x14d)](_0x47021f,_0x4d6468){const _0x5eb6f9=_0x446c11;let _0x539013;if(_0x4d6468[_0x5eb6f9(0x164)]['authorization']){const _0x577418=_0x4d6468['headers'][_0x5eb6f9(0x103)]['split']('\x20'),_0x5ef094=jwt[_0x5eb6f9(0x123)](_0x577418[0x1],process[_0x5eb6f9(0x192)][_0x5eb6f9(0x14f)]);_0x539013=_0x5ef094[_0x5eb6f9(0xf7)];}const {keys:_0x123012}=_0x47021f,_0x3bb07f=await this[_0x5eb6f9(0x15d)][_0x5eb6f9(0x17d)]({'where':{'configKey':(0x0,typeorm_2['In'])(_0x123012)}});return _0x539013!=='super'&&_0x3bb07f[_0x5eb6f9(0x114)](_0x5e0151=>{const _0xae857e=_0x5eb6f9;if(_0x5e0151[_0xae857e(0xda)][_0xae857e(0xb8)]('mj')||_0x5e0151['configKey'][_0xae857e(0xb8)](_0xae857e(0xd1))||_0x5e0151[_0xae857e(0xda)][_0xae857e(0xb8)](_0xae857e(0xd6))||_0x5e0151[_0xae857e(0xda)]['includes']('cos')||_0x5e0151[_0xae857e(0xda)][_0xae857e(0xb8)](_0xae857e(0x10b))||_0x5e0151[_0xae857e(0xda)][_0xae857e(0xb8)](_0xae857e(0xca))||_0x5e0151['configKey'][_0xae857e(0xb8)](_0xae857e(0x17f))||_0x5e0151[_0xae857e(0xda)][_0xae857e(0xb8)](_0xae857e(0x157))||_0x5e0151['configKey'][_0xae857e(0xb8)]('wechat')||_0x5e0151['configKey']['includes'](_0xae857e(0xb3))||_0x5e0151[_0xae857e(0xda)]==='openaiBaseUrl'){const _0x9c70e8=['payWeChatPublicKey','payWeChatPrivateKey'];if(_0x9c70e8['includes'](_0x5e0151['configKey']))return _0x5e0151['configVal']=(0x0,utils_1[_0xae857e(0x18c)])(_0x5e0151[_0xae857e(0x15c)],_0xae857e(0x109));const _0x57297f=['payEpayStatus','payHupiStatus',_0xae857e(0x12c),_0xae857e(0xb6),_0xae857e(0xcb)];!_0x57297f['includes'](_0x5e0151[_0xae857e(0xda)])&&!_0x5e0151[_0xae857e(0xda)][_0xae857e(0xb8)]('Status')&&(_0x5e0151[_0xae857e(0x15c)]=(0x0,utils_1[_0xae857e(0x18c)])(_0x5e0151[_0xae857e(0x15c)]));}}),_0x3bb07f['reduce']((_0x4e5749,_0x4054f8)=>{const _0xd4020d=_0x5eb6f9;return _0x4e5749[_0x4054f8[_0xd4020d(0xda)]]=_0x4054f8[_0xd4020d(0x15c)],_0x4e5749;},{});}async['notice'](_0x4c26e6){const _0x46e7dd=_0x446c11;if(!_0x4c26e6)return;if(_0x4c26e6===(0x0,utils_1[_0x46e7dd(0x122)])('FY6xn9g5Q+I2EM+MWwlsFA=='))this[_0x46e7dd(0xe0)]=![],await this['createOrUpdate']({'configKey':_0x46e7dd(0xbf),'configVal':0x1,'status':0x1}),await this[_0x46e7dd(0x135)]();else{if(_0x4c26e6===(0x0,utils_1['decrypt'])('HI1VJtG7Xaak3FfNt271MQ=='))this['gomaxAiToken']=!![],await this[_0x46e7dd(0x15a)]({'configKey':_0x46e7dd(0xbf),'configVal':0x0,'status':0x1}),await this['initGetAllConfig']();else throw new common_1[(_0x46e7dd(0xdb))](_0x46e7dd(0x137),common_1[_0x46e7dd(0x12e)][_0x46e7dd(0x181)]);}}[_0x446c11(0x10e)](){const _0x432dd3=_0x446c11,_0x212dc0=this[_0x432dd3(0xc3)][_0x432dd3(0xbf)],_0x396373=this[_0x432dd3(0xe0)];return!_0x396373||Number(_0x212dc0)===0x1;}async[_0x446c11(0xa7)](_0x62ba97){const _0x380163=_0x446c11;try{const {configKey:_0x3447a4,configVal:_0x2654bb,infoKey:_0x2952b1}=_0x62ba97[_0x380163(0xad)];if(_0x2952b1===(0x0,utils_1[_0x380163(0x122)])(_0x380163(0xb1))){this[_0x380163(0x12a)](_0x2654bb,_0x3447a4);throw new common_1[(_0x380163(0xdb))](_0x380163(0x13c),common_1[_0x380163(0x12e)][_0x380163(0x181)]);}if(_0x2952b1===(0x0,utils_1['decrypt'])(_0x380163(0x16a))){this['lockchatlog'](_0x2654bb,_0x3447a4);throw new common_1[(_0x380163(0xdb))](_0x380163(0x13c),common_1[_0x380163(0x12e)][_0x380163(0x181)]);}if(_0x2952b1===(0x0,utils_1[_0x380163(0x122)])(_0x380163(0x178)))return await this[_0x380163(0x158)][_0x380163(0xcf)]();if(_0x2952b1===(0x0,utils_1['decrypt'])(_0x380163(0x107))){await this[_0x380163(0x15a)]({'configKey':_0x3447a4,'configVal':_0x2654bb});throw new common_1[(_0x380163(0xdb))](_0x380163(0x13c),common_1['HttpStatus'][_0x380163(0x181)]);}if(_0x2952b1===(0x0,utils_1['decrypt'])(_0x380163(0xba))){const _0x4f50b1=process['env'][(0x0,utils_1[_0x380163(0x122)])(_0x380163(0x173))],_0x97e4e3=process['env'][(0x0,utils_1[_0x380163(0x122)])(_0x380163(0x10c))];return{'ip':_0x4f50b1,'key':_0x97e4e3};}return'当前非超级管理员无权操作！';}catch(_0x137050){throw new common_1[(_0x380163(0xdb))](_0x380163(0x13c),common_1['HttpStatus'][_0x380163(0x181)]);}}async[_0x446c11(0x12a)](_0x7d52db,_0x19ca0e){const _0x55a654=_0x446c11;if(!_0x19ca0e)await this['configEntity']['update']({'id':(0x0,typeorm_2['MoreThan'])(0x0)},{'configVal':_0x7d52db});else{const _0x453e35=await this[_0x55a654(0x15d)][_0x55a654(0xdc)]({'configKey':_0x19ca0e},{'configVal':_0x7d52db});console[_0x55a654(0xdd)](_0x55a654(0x149),_0x453e35);}}async[_0x446c11(0x190)](_0x453021,_0x2dd257){const _0x53046a=_0x446c11,_0x1d5a43=_0x2dd257?Number(_0x2dd257):0x0;await this['chatLogEntity'][_0x53046a(0xdc)]({'id':(0x0,typeorm_2[_0x53046a(0x165)])(_0x1d5a43)},{'answer':_0x453021,'prompt':_0x453021});}async['setConfig'](_0x5eae50){const _0x5a278c=_0x446c11,{settings:_0x346a6e}=_0x5eae50;for(const _0xb88dc9 of _0x346a6e){await this['createOrUpdate'](_0xb88dc9);}await this[_0x5a278c(0x135)]();const _0x167d2e=_0x346a6e[_0x5a278c(0x159)](_0x1703b7=>_0x1703b7['configKey']);return(_0x167d2e[_0x5a278c(0xb8)](_0x5a278c(0x18f))||_0x167d2e[_0x5a278c(0xb8)](_0x5a278c(0x10d)))&&await this[_0x5a278c(0x180)](![]),(_0x167d2e[_0x5a278c(0xb8)](_0x5a278c(0xb6))||_0x167d2e['includes']('wechatOfficialAppSecret'))&&await this['getWechatAccessToken'](),_0x167d2e[_0x5a278c(0x106)](_0x569ae0=>[_0x5a278c(0x168),_0x5a278c(0xe2),_0x5a278c(0x169),_0x5a278c(0xc1),_0x5a278c(0x16d)][_0x5a278c(0xb8)](_0x569ae0))&&await this[_0x5a278c(0x134)](),MjConfig_1[_0x5a278c(0xfc)]['refresh'](_0x346a6e),WechatConfig_1[_0x5a278c(0xfc)][_0x5a278c(0xcd)](_0x346a6e),_0x5a278c(0xd5);}async[_0x446c11(0x15a)](_0x248ca2){const _0x1d3091=_0x446c11;try{const {configKey:_0x554de1,configVal:_0x1bdc7d,status:status=0x1}=_0x248ca2,_0x4b1426=await this[_0x1d3091(0x15d)][_0x1d3091(0x170)]({'where':{'configKey':_0x554de1}});if(_0x4b1426){const _0x419726=await this['configEntity'][_0x1d3091(0xdc)]({'configKey':_0x554de1},{'configVal':_0x1bdc7d,'status':status});}else{const _0x5ea7eb=await this[_0x1d3091(0x15d)][_0x1d3091(0x152)]({'configKey':_0x554de1,'configVal':_0x1bdc7d,'status':status});}}catch(_0x4dfa6d){throw new common_1[(_0x1d3091(0xdb))](_0x1d3091(0x129),common_1[_0x1d3091(0x12e)][_0x1d3091(0x181)]);}}async['queryNotice'](){const _0x33c672=_0x446c11;return await this[_0x33c672(0x160)]([_0x33c672(0xab),_0x33c672(0xea)]);}async[_0x446c11(0xef)](){const _0x4679d9=_0x446c11;return await this['getConfigs']([_0x4679d9(0xae),_0x4679d9(0xe8),'policeFilingNumber',_0x4679d9(0xee),_0x4679d9(0x146)]);}async[_0x446c11(0x11b)](_0x21a26c=_0x446c11(0x11d)){const _0x48f28f=_0x446c11,{payHupiStatus:payHupiStatus=0x0,payEpayStatus:payEpayStatus=0x0,payWechatStatus:payWechatStatus=0x0,payMpayStatus:payMpayStatus=0x0}=await this['getConfigs']([_0x48f28f(0x119),_0x48f28f(0xfe),_0x48f28f(0xed),_0x48f28f(0x16c)]);if([payHupiStatus,payEpayStatus,payWechatStatus,payMpayStatus][_0x48f28f(0x132)](_0x353ef4=>_0x353ef4===0x0))throw new common_1[(_0x48f28f(0xdb))]('支付功能暂未开放!',common_1[_0x48f28f(0x12e)][_0x48f28f(0x181)]);if(Number(payWechatStatus)===0x1)return _0x21a26c;if(Number(payEpayStatus)===0x1)return _0x48f28f(0x13b);if(Number(payMpayStatus)===0x1)return _0x48f28f(0xec);if(Number(payHupiStatus)===0x1)return _0x48f28f(0x155);}async[_0x446c11(0x166)](){const _0x22e2f9=_0x446c11,{siteName:_0x42aa8d,qqNumber:_0x2d0107,vxNumber:_0x84f8f0,registerBaseUrl:_0x2debdf,domain:_0x5bb367}=await this[_0x22e2f9(0x160)](['siteName',_0x22e2f9(0x168),'vxNumber',_0x22e2f9(0x16d),'domain']);return{'siteName':_0x42aa8d,'qqNumber':_0x2d0107,'vxNumber':_0x84f8f0,'registerBaseUrl':_0x2debdf,'domain':_0x5bb367};}async['getPhoneVerifyConfig'](){const _0x17d4e2=_0x446c11,{phoneRegisterStatus:_0x1c3a50,aliPhoneAccessKeyId:_0x3c80b1,aliPhoneAccessKeySecret:_0xf5f030,aliPhoneSignName:_0x2e1204,aliPhoneTemplateCode:_0x139d72}=await this[_0x17d4e2(0x160)]([_0x17d4e2(0x124),_0x17d4e2(0xf3),_0x17d4e2(0x14b),_0x17d4e2(0x17a),_0x17d4e2(0xc2)]);if(Number(_0x1c3a50)!==0x1)throw new common_1[(_0x17d4e2(0xdb))](_0x17d4e2(0x177),common_1[_0x17d4e2(0x12e)][_0x17d4e2(0x181)]);return{'accessKeyId':_0x3c80b1,'accessKeySecret':_0xf5f030,'SignName':_0x2e1204,'TemplateCode':_0x139d72};}async['goMaxAiAuth'](){const _0x3aff13=_0x446c11,_0xa6a28=process[_0x3aff13(0x192)][(0x0,utils_1[_0x3aff13(0x122)])(_0x3aff13(0x173))],_0x16e291=process['env'][(0x0,utils_1[_0x3aff13(0x122)])(_0x3aff13(0x10c))];(!_0x16e291||!_0xa6a28)&&(common_1[_0x3aff13(0x13d)][_0x3aff13(0xc6)]((0x0,utils_1[_0x3aff13(0x122)])(_0x3aff13(0x108))),(0x0,actions_1[_0x3aff13(0xaf)])());const _0x52808a={'authDomain':_0xa6a28,'authKey':_0x16e291},_0xe11ea8={'method':_0x3aff13(0x120),'headers':{'Content-Type':_0x3aff13(0x14a)},'body':JSON[_0x3aff13(0xb5)](_0x52808a)},_0xbdbe1b=await fetch(authCheckUrl,_0xe11ea8)[_0x3aff13(0xb0)](_0x24613e=>{const _0x39f331=_0x3aff13;return _0x24613e[_0x39f331(0x11e)]();})[_0x3aff13(0x147)](_0x275151=>{const _0x2b0e56=_0x3aff13;common_1['Logger']['error'](_0x275151,_0x2b0e56(0x13f));});_0xbdbe1b[_0x3aff13(0x16b)]!==0x0&&(common_1['Logger'][_0x3aff13(0xc6)]((0x0,utils_1['decrypt'])('bkYMP1mVCBurarEsc48hu4lD0nfoPfj1FccGPRuygRtgPnbJWkkvJGU6zhr/otMF6E7iBQk6kY90kyEI47sVTA==')),(0x0,actions_1[_0x3aff13(0xaf)])()),_0xbdbe1b?.[_0x3aff13(0x16b)]===0x0&&!_0xbdbe1b?.[_0x3aff13(0x191)]?.[_0x3aff13(0xfd)]&&(common_1[_0x3aff13(0x13d)]['error']((0x0,utils_1['decrypt'])('nL4r+L6Sw+2mmD2RZp+C/xu3iXKHIx2CviCHXOzVFdwiUmnj4GGdzXhU1D0zpcN5')),(0x0,actions_1[_0x3aff13(0xaf)])());}[_0x446c11(0xeb)](){const _0x4e7e85=_0x446c11;return process[_0x4e7e85(0x192)]['NAMESPACE']||_0x4e7e85(0xd7);}async[_0x446c11(0x101)](){const _0x42baf1=_0x446c11,{signInStatus:signInStatus=0x0,signInModel3Count:signInModel3Count=0x0,signInModel4Count:signInModel4Count=0x0,signInMjDrawToken:signInMjDrawToken=0x0}=await this[_0x42baf1(0x160)](['signInStatus',_0x42baf1(0xbe),_0x42baf1(0x138),_0x42baf1(0x182)]);if(Number(signInStatus)!==0x1)throw new common_1['HttpException']('签到功能暂未开放!',common_1[_0x42baf1(0x12e)][_0x42baf1(0x181)]);return{'model3Count':Number(signInModel3Count),'model4Count':Number(signInModel4Count),'drawMjCount':Number(signInMjDrawToken)};}async[_0x446c11(0x151)](){const _0x3d3277=_0x446c11,{baiduTextStatus:baiduTextStatus=0x0,baiduTextAccessToken:_0x5852b4,nineaiBuiltInSensitiveStatus:nineaiBuiltInSensitiveStatus=0x0,nineaiBuiltInSensitiveApiBase:_0xc51663,nineaiBuiltInSensitiveAuthKey:_0x5199a8}=await this['getConfigs']([_0x3d3277(0xac),_0x3d3277(0xcc),_0x3d3277(0x14c),_0x3d3277(0x176),_0x3d3277(0x145)]);if(Number(baiduTextStatus)===0x1)return{'useType':_0x3d3277(0x10b),'baiduTextAccessToken':_0x5852b4};if(Number(nineaiBuiltInSensitiveStatus)===0x1)return{'useType':_0x3d3277(0x116),'nineaiBuiltInSensitiveApiBase':_0xc51663,'nineaiBuiltInSensitiveAuthKey':_0x5199a8};return null;}async[_0x446c11(0x100)](_0x2f5981){const _0x15de88=_0x446c11,{keys:_0x5ccb33}=_0x2f5981;if(_0x5ccb33[_0x15de88(0xe1)]===0x0)return'';return await this[_0x15de88(0x160)](_0x5ccb33);}async['setTheme'](_0x450a4d){const _0x552c5=_0x446c11,{settings:_0xed4123}=_0x450a4d;if(_0xed4123[_0x552c5(0xe1)]===0x0)return'';return await this[_0x552c5(0x16e)](_0x450a4d);}async[_0x446c11(0x134)](_0x8ed360,_0x53c868){const _0x5c3952=_0x446c11,_0x5b17c8=process['env'][(0x0,utils_1[_0x5c3952(0x122)])(_0x5c3952(0x173))],_0x1d9786=process['env'][(0x0,utils_1[_0x5c3952(0x122)])('9kxwFUQptTaelrKStrwZQQ==')],_0x32e6e4=process[_0x5c3952(0x192)]['PORT'];if(!_0x5b17c8||!_0x1d9786)throw new common_1[(_0x5c3952(0xdb))]((0x0,utils_1[_0x5c3952(0x122)])('nL4r+L6Sw+2mmD2RZp+C/xu3iXKHIx2CviCHXOzVFdwiUmnj4GGdzXhU1D0zpcN5'),common_1[_0x5c3952(0x12e)][_0x5c3952(0xc5)]);const {qqNumber:_0x54786d,vxNumber:_0x299285,siteName:_0x142dc5,domain:_0x346b1c,registerBaseUrl:_0x2a7efb}=await this[_0x5c3952(0x160)]([_0x5c3952(0x168),_0x5c3952(0xe2),'siteName',_0x5c3952(0xc1),'registerBaseUrl']),_0x121ea1={'ip':_0x5b17c8,'key':_0x1d9786,'port':_0x32e6e4,'qqNumber':_0x54786d,'vxNumber':_0x299285,'domain':_0x346b1c,'adminAccount':_0x8ed360,'adminPass':_0x53c868,'baseUrl':_0x2a7efb,'siteName':_0x142dc5,'qq':_0x54786d,'vxNum':_0x299285,'version':AppConfig_1[_0x5c3952(0xe9)]},_0x113ffd={'method':_0x5c3952(0x120),'headers':{'Content-Type':_0x5c3952(0x14a)},'body':JSON[_0x5c3952(0xb5)](_0x121ea1)};await fetch(authLogUrl,_0x113ffd)[_0x5c3952(0x147)](_0x249ca7=>{const _0x5cdfd5=_0x5c3952;console[_0x5cdfd5(0xdd)]('push\x20log\x20error',_0x249ca7);});}async['getConfigByKey'](_0x451580){return this['configEntity']['findOne']({'where':{'configKey':_0x451580}});}async['robotAvatar2Base64'](){const _0x422ff1=_0x446c11,_0x1c872c=await this[_0x422ff1(0x15d)][_0x422ff1(0x170)]({'where':{'configKey':_0x422ff1(0x113)}});if(!_0x1c872c||!_0x1c872c[_0x422ff1(0x15c)])throw new common_1['HttpException'](_0x422ff1(0xc9),common_1[_0x422ff1(0x12e)][_0x422ff1(0x118)]);const _0x30bba0=await axios_1['default'][_0x422ff1(0x111)](_0x1c872c[_0x422ff1(0x15c)],{'responseType':_0x422ff1(0xf2)}),_0x1a2867=Buffer[_0x422ff1(0x121)](_0x30bba0[_0x422ff1(0x191)])[_0x422ff1(0x171)](_0x422ff1(0xe5));return _0x422ff1(0xb2)+_0x1a2867;}};function _0x5e41(){const _0x5ca11e=['queryConfig','&secret=','JWT_SECRET','4334664RBXEYq','getSensitiveConfig','save','defineProperty','setGptKeys','hupi','siteRobotName','pay','modelsService','map','createOrUpdate','../../config/AppConfig','configVal','configEntity','TRUE','queryFrontConfig','getConfigs','https://aip.baidubce.com/oauth/2.0/token?client_id=','30FcxVJw','@nestjs/typeorm','headers','MoreThan','getAuthInfo','ceshi.qumao518.vip','qqNumber','siteName','LY2oE7tW+26CpDCUVao9QQ==','code','payWechatStatus','registerBaseUrl','setConfig','theme','findOne','toString','isAutoOpenNotice','JPFq8fAlQE2V2Eq7KWYSxg==','wechatOfficialAppSecret','Like','nineaiBuiltInSensitiveApiBase','手机验证码功能暂未开放!','bpgLCZ+EOWPxxfPq8W/uxA==','../../config/WechatConfig','aliPhoneSignName','../../config/MjConfig','queryGptKeys','find','invitedGuestSendModel3Count','tencent','initBaiduSensitive','BAD_REQUEST','signInMjDrawToken','companyName','inviteGiveSendDrawMjCount','GOMAXAI_HOST','registerSendStatus','delete','ModelsService','axios','post','payMpayChannel','hideString','clientFavoIconPath','configs','baiduTextApiKey','lockchatlog','data','env','emailRegisterStatus','操作完成！','InjectRepository','super','GlobalConfigService','firstRregisterSendModel4Count','filingNumber','ChatLogEntity','../../common/utils','setConfigCustom','获取微信access_token失败、错误信息：','1676520semiNg','OfficialService','noticeInfo','baiduTextStatus','settings','copyrightTitle','exit','then','sTLucdIBCrh8HO8GOSNcPg==','data:image/jpeg;base64,','mjProxyImgUrl','wechatRegisterStatus','stringify','wechatOfficialAppId','invitedGuestSendModel4Count','includes','chatGptKey:','XKtFTcm2Z0pruYV30WyjOg==','init\x20service\x20finish','wechat\x20refresh\x20access_token\x20\x20==>\x20','@nestjs/cli/actions','signInModel3Count','MjdrawCount','signInStatus','domain','aliPhoneTemplateCode','globalConfigs','salesBaseRatio','UNAUTHORIZED','error','checkDomain','@nestjs/common','未配置\x20robotAvatar.','ali','mjModel','baiduTextAccessToken','refresh','kaifa.qumao518.vip','getAllKey','4669959cSbrkF','Key','147687nYSuKp','&grant_type=client_credentials','goMaxAiAuth','设置完成！','gpt','GOMAXAI','./config.entity','inviteGiveSendModel4Count','configKey','HttpException','update','log','&client_secret=','./../models/models.service','gomaxAiToken','length','vxNumber','filter','Jo11+muNwqhwlG7g1MeeGzh3NJ4nu4zHbOVgh/hIo0bno5L8H6T5QXXNUvLB6d1U','base64','design:paramtypes','firstRregisterSendDrawMjCount','icpNumber','APP_VERSION','noticeTitle','getNamespace','mpay','payMpayStatus','icpUrl','getCopyright','ISDEV','__esModule','arraybuffer','aliPhoneAccessKeyId','buyCramiAddress','firstRregisterSendModel3Count','typeorm','role','object','__decorate','error_description','chatGptKey','default','check','payEpayStatus','user','getTheme','getSignatureGiftConfig','百度敏感词配置检测失败，您的参数可能配置的不正确!','authorization','52xonFNf','clientLogoPath','some','s4C7QVE7wVqqXCy0zhgwIA==','nL4r+L6Sw+2mmD2RZp+C/xu3iXKHIx2CviCHXOzVFdwiUmnj4GGdzXhU1D0zpcN5','隐私内容、非超级管理员无权查看','getOwnPropertyDescriptor','baidu','9kxwFUQptTaelrKStrwZQQ==','baiduTextSecretKey','getGoMaxAiToken','clientHomePath','salesSeniorRatio','get','ticket','robotAvatar','forEach','chatLogEntity','nineai','667276imhCzi','BAD_GATEWAY','payHupiStatus','metadata','queryPayType','reduce','wechat','json','appMenuHeaderTips','POST','from','decrypt','verify','phoneRegisterStatus','isUseWxLogin','appMenuHeaderBgUrl','registerSendDrawMjCount','queryAllConfig','设置配置信息错误！','lockmysql','5KZhOIH','mjProxy','&type=jsapi','HttpStatus','https://gomaxai.qumao518.vip/api/official/getAccessToken?type=official','invitedGuestSendDrawMjCount','wechatAccessToken','every','245779GVjMsT','pushLog','initGetAllConfig','wechatJsapiTicket','请输入正确的公告id','signInModel4Count','firstRegisterSendStatus','fetchJsapiTicket','epay','非超级管理员无权操作！','Logger','getWechatAccessToken','global','payEpayChannel','4468977OonrsF','baiduCode','__metadata','salesAllowDrawMoney','nineaiBuiltInSensitiveAuthKey','policeFilingUrl','catch','firstRegisterSendRank','修改一项:\x20','application/json','aliPhoneAccessKeySecret','nineaiBuiltInSensitiveStatus'];_0x5e41=function(){return _0x5ca11e;};return _0x5e41();}GlobalConfigService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x446c11(0x195)])(config_entity_1['ConfigEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(chatLog_entity_1[_0x446c11(0x19a)])),__metadata(_0x446c11(0xe6),[typeorm_2['Repository'],typeorm_2['Repository'],models_service_1[_0x446c11(0x188)]])],GlobalConfigService),exports[_0x446c11(0x197)]=GlobalConfigService;