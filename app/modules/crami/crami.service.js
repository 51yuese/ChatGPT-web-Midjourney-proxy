'use strict';const _0x1e593d=_0x5123;(function(_0x2b0e98,_0x5501de){const _0xab27dc=_0x5123,_0xe4dfd0=_0x2b0e98();while(!![]){try{const _0xa2d15b=-parseInt(_0xab27dc(0x1f3))/0x1*(-parseInt(_0xab27dc(0x229))/0x2)+-parseInt(_0xab27dc(0x1f4))/0x3*(-parseInt(_0xab27dc(0x20d))/0x4)+parseInt(_0xab27dc(0x204))/0x5+-parseInt(_0xab27dc(0x22d))/0x6+-parseInt(_0xab27dc(0x20b))/0x7*(parseInt(_0xab27dc(0x1f2))/0x8)+parseInt(_0xab27dc(0x1fd))/0x9+-parseInt(_0xab27dc(0x230))/0xa;if(_0xa2d15b===_0x5501de)break;else _0xe4dfd0['push'](_0xe4dfd0['shift']());}catch(_0x15d4d1){_0xe4dfd0['push'](_0xe4dfd0['shift']());}}}(_0x2cf3,0x60d3d));function _0x2cf3(){const _0x12f3ee=['DESC','Injectable','更新套餐失败、请重试！','generateCrami','PACKAGE_GIFT','queryAllCrami','username','CramiPackageEntity','675028bjdeSd','使用卡密成功','getOwnPropertyDescriptor','更新套餐成功！','2842584RWKizK','Like','__decorate','2258470rnEjvP','defineProperty','super','count','useId','generateCramiCode','findOne','find','push','saveRecordRechargeLog','typeorm','queryAllPackage','../../common/constants/balance.constant','../userBalance/userBalance.service','./crami.entity','RechargeType','当前套餐不存在、请确认您选择的套餐是否存在！','packageName','delPackage','@nestjs/common','MoreThan','affected','userBalanceService','packageId','delete','当前卡密不存在、请确认您要删除的卡密是否存在！','forEach','HttpException','__param','updatePackage','当前卡密已被使用、已使用的卡密禁止删除！','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','573064JunKXo','1VKGdRS','6RehQvH','every','cramiPackageEntity','queryOnePackage','email','UserBalanceService','../user/user.entity','userEntity','save','4282965uNjsqu','InjectRepository','createCrami','metadata','role','code','当前套餐不存在、请检查你的输入参数！','924040EWaCRO','Not','function','当前卡密已被使用、请确认您输入的卡密是否正确！','自定义卡密必须至少一项余额不为0️零！','@nestjs/typeorm','create','7ZGmtIw','addBalanceToUser','339284VnQszl','maskEmail','LessThanOrEqual','HttpStatus','update','decorate','cramiEntity','BAD_REQUEST','length','map','maskCrami','log','user','assign','Repository','name','batchDelCrami','__esModule','CramiService','useCrami'];_0x2cf3=function(){return _0x12f3ee;};return _0x2cf3();}var __decorate=this&&this[_0x1e593d(0x22f)]||function(_0x115a04,_0x26ee7e,_0x400549,_0xfcb552){const _0x1a9ce2=_0x1e593d;var _0x36be2b=arguments[_0x1a9ce2(0x215)],_0x56dd44=_0x36be2b<0x3?_0x26ee7e:_0xfcb552===null?_0xfcb552=Object[_0x1a9ce2(0x22b)](_0x26ee7e,_0x400549):_0xfcb552,_0x23c348;if(typeof Reflect==='object'&&typeof Reflect[_0x1a9ce2(0x212)]===_0x1a9ce2(0x206))_0x56dd44=Reflect[_0x1a9ce2(0x212)](_0x115a04,_0x26ee7e,_0x400549,_0xfcb552);else{for(var _0x3180cf=_0x115a04['length']-0x1;_0x3180cf>=0x0;_0x3180cf--)if(_0x23c348=_0x115a04[_0x3180cf])_0x56dd44=(_0x36be2b<0x3?_0x23c348(_0x56dd44):_0x36be2b>0x3?_0x23c348(_0x26ee7e,_0x400549,_0x56dd44):_0x23c348(_0x26ee7e,_0x400549))||_0x56dd44;}return _0x36be2b>0x3&&_0x56dd44&&Object[_0x1a9ce2(0x231)](_0x26ee7e,_0x400549,_0x56dd44),_0x56dd44;},__metadata=this&&this['__metadata']||function(_0x44be09,_0x1dde09){const _0x323e9a=_0x1e593d;if(typeof Reflect==='object'&&typeof Reflect[_0x323e9a(0x200)]===_0x323e9a(0x206))return Reflect[_0x323e9a(0x200)](_0x44be09,_0x1dde09);},__param=this&&this[_0x1e593d(0x1ee)]||function(_0x1eafec,_0x500b97){return function(_0x483b58,_0x1d0089){_0x500b97(_0x483b58,_0x1d0089,_0x1eafec);};};function _0x5123(_0x9d3737,_0x5319ed){const _0x2cf3be=_0x2cf3();return _0x5123=function(_0x5123dd,_0x5b8764){_0x5123dd=_0x5123dd-0x1d9;let _0x26f782=_0x2cf3be[_0x5123dd];return _0x26f782;},_0x5123(_0x9d3737,_0x5319ed);}Object[_0x1e593d(0x231)](exports,_0x1e593d(0x21e),{'value':!![]}),exports[_0x1e593d(0x21f)]=void 0x0;const common_1=require(_0x1e593d(0x1e5)),crami_entity_1=require(_0x1e593d(0x1e0)),typeorm_1=require(_0x1e593d(0x209)),typeorm_2=require(_0x1e593d(0x1dc)),cramiPackage_entity_1=require('./cramiPackage.entity'),utils_1=require('../../common/utils'),user_entity_1=require(_0x1e593d(0x1fa)),userBalance_service_1=require(_0x1e593d(0x1df)),balance_constant_1=require(_0x1e593d(0x1de));let CramiService=class CramiService{constructor(_0x4e16,_0x51dc8b,_0x4d1bc8,_0x1af9bb){const _0x503f5e=_0x1e593d;this[_0x503f5e(0x213)]=_0x4e16,this[_0x503f5e(0x1f6)]=_0x51dc8b,this[_0x503f5e(0x1fb)]=_0x4d1bc8,this[_0x503f5e(0x1e8)]=_0x1af9bb;}async[_0x1e593d(0x1f7)](_0x4d85f3){const _0xa46874=_0x1e593d;return await this[_0xa46874(0x1f6)][_0xa46874(0x236)]({'where':{'id':_0x4d85f3}});}async[_0x1e593d(0x1dd)](_0x4bc49e){const _0x200be5=_0x1e593d;try{const {page:page=0x1,size:size=0xa,name:_0x2f48fb,status:_0x11d3f3,type:_0x3576de}=_0x4bc49e,_0x2f0957={};_0x2f48fb&&Object['assign'](_0x2f0957,{'name':(0x0,typeorm_2[_0x200be5(0x22e)])('%'+_0x2f48fb+'%')}),_0x11d3f3&&Object[_0x200be5(0x21a)](_0x2f0957,{'status':_0x11d3f3});_0x3576de&&(_0x3576de>0x0?Object[_0x200be5(0x21a)](_0x2f0957,{'days':(0x0,typeorm_2[_0x200be5(0x1e6)])(0x0)}):Object[_0x200be5(0x21a)](_0x2f0957,{'days':(0x0,typeorm_2[_0x200be5(0x20f)])(0x0)}));const [_0x4a632b,_0x5c9e83]=await this[_0x200be5(0x1f6)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'where':_0x2f0957,'order':{'order':_0x200be5(0x221)}});return{'rows':_0x4a632b,'count':_0x5c9e83};}catch(_0x540463){console[_0x200be5(0x218)]('error:\x20',_0x540463);}}async['createPackage'](_0x262158){const _0x196fdf=_0x1e593d,{name:_0x4d6094,weight:_0x14555b}=_0x262158,_0x3385b3=await this['cramiPackageEntity'][_0x196fdf(0x236)]({'where':[{'name':_0x4d6094},{'weight':_0x14555b}]});if(_0x3385b3)throw new common_1['HttpException']('套餐名称或套餐等级重复、请检查！',common_1[_0x196fdf(0x210)][_0x196fdf(0x214)]);try{return await this['cramiPackageEntity'][_0x196fdf(0x1fc)](_0x262158);}catch(_0x3bce14){console[_0x196fdf(0x218)]('error:\x20',_0x3bce14);throw new common_1[(_0x196fdf(0x1ed))](_0x3bce14,common_1[_0x196fdf(0x210)][_0x196fdf(0x214)]);}}async[_0x1e593d(0x1ef)](_0x5c1509){const _0x1a82ed=_0x1e593d,{id:_0x310d95,name:_0x446bf2,weight:_0x193357}=_0x5c1509,_0x23baf3=await this[_0x1a82ed(0x1f6)]['findOne']({'where':{'id':_0x310d95}});if(!_0x23baf3)throw new common_1[(_0x1a82ed(0x1ed))](_0x1a82ed(0x203),common_1[_0x1a82ed(0x210)]['BAD_REQUEST']);const _0x54f355=await this[_0x1a82ed(0x1f6)][_0x1a82ed(0x233)]({'where':[{'name':_0x446bf2,'id':(0x0,typeorm_2[_0x1a82ed(0x205)])(_0x310d95)},{'weight':_0x193357,'id':(0x0,typeorm_2[_0x1a82ed(0x205)])(_0x310d95)}]});if(_0x54f355)throw new common_1['HttpException']('套餐名称或套餐等级重复、请检查！',common_1[_0x1a82ed(0x210)][_0x1a82ed(0x214)]);const _0x2597f5=await this[_0x1a82ed(0x1f6)]['update']({'id':_0x310d95},_0x5c1509);if(_0x2597f5[_0x1a82ed(0x1e7)]>0x0)return _0x1a82ed(0x22c);else throw new common_1[(_0x1a82ed(0x1ed))](_0x1a82ed(0x223),common_1[_0x1a82ed(0x210)][_0x1a82ed(0x214)]);}async[_0x1e593d(0x1e4)](_0x458825){const _0x562b8a=_0x1e593d,{id:_0x4a5ffd}=_0x458825,_0x2be25d=await this['cramiEntity'][_0x562b8a(0x233)]({'where':{'packageId':_0x4a5ffd}});if(_0x2be25d)throw new common_1['HttpException'](_0x562b8a(0x1f1),common_1['HttpStatus'][_0x562b8a(0x214)]);return await this[_0x562b8a(0x1f6)][_0x562b8a(0x1ea)]({'id':_0x4a5ffd});}async[_0x1e593d(0x1ff)](_0x20de02){const _0x347af5=_0x1e593d,{packageId:_0x6c8f4d,count:count=0x1}=_0x20de02;if(_0x6c8f4d){const _0x3ba3d6=await this[_0x347af5(0x1f6)][_0x347af5(0x236)]({'where':{'id':_0x6c8f4d}});if(!_0x3ba3d6)throw new common_1[(_0x347af5(0x1ed))](_0x347af5(0x1e2),common_1[_0x347af5(0x210)]['BAD_REQUEST']);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x3ba3d6,_0x3db48f={'packageId':_0x6c8f4d,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x347af5(0x224)](_0x3db48f,count);}if(!_0x6c8f4d){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x20de02;if([model3Count,model4Count,drawMjCount][_0x347af5(0x1f5)](_0x3ebd19=>!_0x3ebd19))throw new common_1[(_0x347af5(0x1ed))](_0x347af5(0x208),common_1['HttpStatus'][_0x347af5(0x214)]);const _0x2d4a8b={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x347af5(0x224)](_0x2d4a8b,count);}}async[_0x1e593d(0x224)](_0x8db6b5,_0x52f7c1){const _0x2143e2=_0x1e593d,_0x1f0a87=[];for(let _0x216545=0x0;_0x216545<_0x52f7c1;_0x216545++){const _0x270d18=(0x0,utils_1[_0x2143e2(0x235)])(),_0xc1575f=this[_0x2143e2(0x213)][_0x2143e2(0x20a)](Object[_0x2143e2(0x21a)](Object[_0x2143e2(0x21a)]({},_0x8db6b5),{'code':_0x270d18}));_0x1f0a87[_0x2143e2(0x1da)](_0xc1575f);}return await this[_0x2143e2(0x213)][_0x2143e2(0x1fc)](_0x1f0a87);}async[_0x1e593d(0x220)](_0x3bf21f,_0xe7bb3){const _0xef247c=_0x1e593d,{id:_0x3fe0af}=_0x3bf21f[_0xef247c(0x219)],_0x223c96=await this[_0xef247c(0x213)][_0xef247c(0x236)]({'where':{'code':_0xe7bb3[_0xef247c(0x202)]}});if(!_0x223c96)throw new common_1[(_0xef247c(0x1ed))]('当前卡密不存在、请确认您输入的卡密是否正确！',common_1[_0xef247c(0x210)][_0xef247c(0x214)]);const {status:_0x53a821,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x50535b}=_0x223c96;if(_0x53a821===0x1)throw new common_1[(_0xef247c(0x1ed))](_0xef247c(0x207),common_1[_0xef247c(0x210)]['BAD_REQUEST']);const _0x41cd86={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x50535b};return await this['userBalanceService'][_0xef247c(0x20c)](_0x3fe0af,Object[_0xef247c(0x21a)]({},_0x41cd86),days),await this[_0xef247c(0x1e8)][_0xef247c(0x1db)]({'userId':_0x3fe0af,'rechargeType':balance_constant_1[_0xef247c(0x1e1)][_0xef247c(0x225)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0xef247c(0x213)][_0xef247c(0x211)]({'code':_0xe7bb3[_0xef247c(0x202)]},{'useId':_0x3fe0af,'status':0x1}),_0xef247c(0x22a);}async[_0x1e593d(0x226)](_0xe096b9,_0x35dced){const _0x40c62b=_0x1e593d,{page:page=0x1,size:size=0xa,status:_0x546d7d,useId:_0x222476}=_0xe096b9,_0x3b4802={};_0x546d7d&&Object['assign'](_0x3b4802,{'status':_0x546d7d}),_0x222476&&Object[_0x40c62b(0x21a)](_0x3b4802,{'useId':_0x222476});const [_0x598c0a,_0x471df7]=await this[_0x40c62b(0x213)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x40c62b(0x221)},'where':_0x3b4802}),_0xaa9ede=_0x598c0a['map'](_0x519b47=>_0x519b47[_0x40c62b(0x234)]),_0x193d45=_0x598c0a[_0x40c62b(0x216)](_0x4a371b=>_0x4a371b[_0x40c62b(0x1e9)]),_0x3b1321=await this['userEntity'][_0x40c62b(0x1d9)]({'where':{'id':(0x0,typeorm_2['In'])(_0xaa9ede)}}),_0x3b4289=await this[_0x40c62b(0x1f6)][_0x40c62b(0x1d9)]({'where':{'id':(0x0,typeorm_2['In'])(_0x193d45)}});return _0x598c0a[_0x40c62b(0x1ec)](_0x477c0a=>{const _0xe79763=_0x40c62b;var _0x34a5b1,_0x38d321,_0xce94af;_0x477c0a['username']=(_0x34a5b1=_0x3b1321[_0xe79763(0x1d9)](_0x41ba9d=>_0x41ba9d['id']===_0x477c0a[_0xe79763(0x234)]))===null||_0x34a5b1===void 0x0?void 0x0:_0x34a5b1[_0xe79763(0x227)],_0x477c0a[_0xe79763(0x1f8)]=(_0x38d321=_0x3b1321['find'](_0x17f5a0=>_0x17f5a0['id']===_0x477c0a['useId']))===null||_0x38d321===void 0x0?void 0x0:_0x38d321[_0xe79763(0x1f8)],_0x477c0a[_0xe79763(0x1e3)]=(_0xce94af=_0x3b4289['find'](_0x575601=>_0x575601['id']===_0x477c0a['packageId']))===null||_0xce94af===void 0x0?void 0x0:_0xce94af[_0xe79763(0x21c)];}),_0x35dced[_0x40c62b(0x219)][_0x40c62b(0x201)]!==_0x40c62b(0x232)&&_0x598c0a[_0x40c62b(0x1ec)](_0x284ef7=>_0x284ef7['email']=(0x0,utils_1[_0x40c62b(0x20e)])(_0x284ef7[_0x40c62b(0x1f8)])),_0x35dced[_0x40c62b(0x219)]['role']!==_0x40c62b(0x232)&&_0x598c0a[_0x40c62b(0x1ec)](_0x2e3fe9=>_0x2e3fe9['code']=(0x0,utils_1[_0x40c62b(0x217)])(_0x2e3fe9[_0x40c62b(0x202)])),{'rows':_0x598c0a,'count':_0x471df7};}async['delCrami'](_0x32a286){const _0x21f018=_0x1e593d,_0xb55c95=await this['cramiEntity']['findOne']({'where':{'id':_0x32a286}});if(!_0xb55c95)throw new common_1[(_0x21f018(0x1ed))](_0x21f018(0x1eb),common_1[_0x21f018(0x210)]['BAD_REQUEST']);if(_0xb55c95['status']===0x1)throw new common_1['HttpException'](_0x21f018(0x1f0),common_1[_0x21f018(0x210)][_0x21f018(0x214)]);return await this[_0x21f018(0x213)][_0x21f018(0x1ea)]({'id':_0x32a286});}async[_0x1e593d(0x21d)](_0x18bba9){const _0x1eb052=_0x1e593d,{ids:_0x304cb8}=_0x18bba9,_0x5aae82=await this[_0x1eb052(0x213)]['delete'](_0x304cb8);if(_0x5aae82[_0x1eb052(0x1e7)]>0x0)return'删除卡密成功！';else throw new common_1[(_0x1eb052(0x1ed))]('删除卡密失败、请重试！',common_1[_0x1eb052(0x210)]['BAD_REQUEST']);}};CramiService=__decorate([(0x0,common_1[_0x1e593d(0x222)])(),__param(0x0,(0x0,typeorm_1[_0x1e593d(0x1fe)])(crami_entity_1['CramiEntity'])),__param(0x1,(0x0,typeorm_1[_0x1e593d(0x1fe)])(cramiPackage_entity_1[_0x1e593d(0x228)])),__param(0x2,(0x0,typeorm_1[_0x1e593d(0x1fe)])(user_entity_1['UserEntity'])),__metadata('design:paramtypes',[typeorm_2['Repository'],typeorm_2[_0x1e593d(0x21b)],typeorm_2['Repository'],userBalance_service_1[_0x1e593d(0x1f9)]])],CramiService),exports[_0x1e593d(0x21f)]=CramiService;