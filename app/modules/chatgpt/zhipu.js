'use strict';const _0x5d0c93=_0x4f59;(function(_0x24bfd5,_0x59ce32){const _0x5be496=_0x4f59,_0x2d8816=_0x24bfd5();while(!![]){try{const _0x3bda1b=parseInt(_0x5be496(0x145))/0x1*(-parseInt(_0x5be496(0x15b))/0x2)+parseInt(_0x5be496(0x13a))/0x3*(-parseInt(_0x5be496(0x154))/0x4)+-parseInt(_0x5be496(0x148))/0x5*(-parseInt(_0x5be496(0x152))/0x6)+-parseInt(_0x5be496(0x140))/0x7+parseInt(_0x5be496(0x14d))/0x8+-parseInt(_0x5be496(0x13e))/0x9+parseInt(_0x5be496(0x161))/0xa*(parseInt(_0x5be496(0x13b))/0xb);if(_0x3bda1b===_0x59ce32)break;else _0x2d8816['push'](_0x2d8816['shift']());}catch(_0x4b56b1){_0x2d8816['push'](_0x2d8816['shift']());}}}(_0x4347,0x58caa));function _0x4f59(_0x172e1e,_0x2d76a1){const _0x4347f1=_0x4347();return _0x4f59=function(_0x4f5923,_0x1699e8){_0x4f5923=_0x4f5923-0x13a;let _0x3b503c=_0x4347f1[_0x4f5923];return _0x3b503c;},_0x4f59(_0x172e1e,_0x2d76a1);}Object[_0x5d0c93(0x162)](exports,'__esModule',{'value':!![]}),exports[_0x5d0c93(0x156)]=exports[_0x5d0c93(0x14f)]=exports['compilerMetaJsonStr']=exports[_0x5d0c93(0x13f)]=void 0x0;const axios=require(_0x5d0c93(0x146)),jwt=require('jsonwebtoken');function generateToken(_0x362000,_0x4ae2ff=0x3e8*0x3c*0x3c*0x18*0x168){const _0x3a21bc=_0x5d0c93,[_0x17e36d,_0x6838aa]=_0x362000[_0x3a21bc(0x151)]('.'),_0xc6579d={'api_key':_0x17e36d,'exp':Math['round'](Date[_0x3a21bc(0x149)]())+_0x4ae2ff*0x3e8,'timestamp':Math[_0x3a21bc(0x158)](Date['now']())};return jwt['sign'](_0xc6579d,_0x6838aa,{'algorithm':_0x3a21bc(0x153),'header':{'alg':_0x3a21bc(0x153),'sign_type':_0x3a21bc(0x157)}});}exports[_0x5d0c93(0x13f)]=generateToken;function compilerMetaJsonStr(_0x3288fa){const _0x58d893=_0x5d0c93;let _0x4c73fc={};try{_0x4c73fc=JSON['parse'](_0x3288fa);}catch(_0x13ac17){_0x4c73fc={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x58d893(0x160)](_0x58d893(0x13d),_0x3288fa);}return _0x4c73fc;}function _0x4347(){const _0x2984bf=['defineProperty','application/json','event:','trim','length','3KrGhoo','231ClCkEZ','end','json\x20parse\x20error\x20from\x20zhipu!','198666IGRblj','generateToken','548051uYLDKS','data','log','toString','text','712WOXVTG','axios','catch','163205MjkRZN','now','then','https://open.bigmodel.cn/api/paas/v3/model-api/','POST','4859632EfudXc','meta:','compilerStream','error:\x20','split','24gQIUtf','HS256','2161040NKhBcz','replace','sendMessageFromZhipu','SIGN','round','stream','id:','1846unQpcg','data:','/sse-invoke','usage','is_end','error','439750bgPbyR'];_0x4347=function(){return _0x2984bf;};return _0x4347();}exports['compilerMetaJsonStr']=compilerMetaJsonStr;function compilerStream(_0x166ca8){const _0x3ef730=_0x5d0c93;console[_0x3ef730(0x142)](_0x166ca8);if(_0x166ca8[_0x3ef730(0x166)]===0x3)return{'event':_0x166ca8[0x0][_0x3ef730(0x155)](_0x3ef730(0x164),''),'id':_0x166ca8[0x1][_0x3ef730(0x155)](_0x3ef730(0x15a),''),'is_end':![],'result':_0x166ca8[0x2][_0x3ef730(0x155)]('data:','')[_0x3ef730(0x165)]()};if(_0x166ca8['length']===0x4)return{'event':_0x166ca8[0x0][_0x3ef730(0x155)]('event:',''),'id':_0x166ca8[0x1][_0x3ef730(0x155)](_0x3ef730(0x15a),''),'result':_0x166ca8[0x2][_0x3ef730(0x155)](_0x3ef730(0x15c),'')['trim'](),'is_end':!![],'usage':compilerMetaJsonStr(_0x166ca8[0x3][_0x3ef730(0x155)](_0x3ef730(0x14e),''))?.[_0x3ef730(0x15e)]};}exports[_0x5d0c93(0x14f)]=compilerStream;async function sendMessageFromZhipu(_0x3029af,{onProgress:_0x3f6b0a,key:_0x30019c,model:_0x27f356,temperature:temperature=0.95}){const _0x39c3a4=await generateToken(_0x30019c);return new Promise((_0x113cb8,_0x11bc54)=>{const _0x2498de=_0x4f59,_0x29cec9=_0x2498de(0x14b)+_0x27f356+_0x2498de(0x15d),_0x5f5466={'method':_0x2498de(0x14c),'url':_0x29cec9,'responseType':_0x2498de(0x159),'headers':{'Content-Type':_0x2498de(0x163),'Authorization':_0x39c3a4},'data':{'prompt':_0x3029af,'temperature':temperature}};axios(_0x5f5466)[_0x2498de(0x14a)](_0x593414=>{const _0x5ca858=_0x2498de,_0x5260f3=_0x593414[_0x5ca858(0x141)];let _0x1e7397,_0x37648f='';_0x5260f3['on'](_0x5ca858(0x141),_0x3b0f54=>{const _0x563ce1=_0x5ca858,_0x475a70=_0x3b0f54[_0x563ce1(0x143)]()['split']('\x0a')['filter'](_0x3b7f6e=>_0x3b7f6e[_0x563ce1(0x165)]()!=='');console[_0x563ce1(0x142)](_0x475a70);const _0x50964a=compilerStream(_0x475a70);console[_0x563ce1(0x142)](_0x50964a);if(!_0x50964a)return;const {id:_0x22e3db,result:_0x2830a8,is_end:_0x225ffb}=_0x50964a;_0x2830a8&&(_0x37648f+=_0x2830a8[_0x563ce1(0x165)]()),_0x225ffb&&(_0x50964a[_0x563ce1(0x15f)]=![],_0x1e7397=_0x50964a,_0x1e7397[_0x563ce1(0x144)]=_0x37648f),_0x3f6b0a(_0x50964a);}),_0x5260f3['on'](_0x5ca858(0x13c),()=>{_0x113cb8(_0x1e7397),_0x37648f='';});})[_0x2498de(0x147)](_0xbe4cff=>{const _0x2aa256=_0x2498de;console[_0x2aa256(0x142)](_0x2aa256(0x150),_0xbe4cff);});});}exports[_0x5d0c93(0x156)]=sendMessageFromZhipu;