'use strict';const _0x5d5f4b=_0x2a16;(function(_0x52772c,_0xb870ae){const _0x2f0bc2=_0x2a16,_0x5beaa2=_0x52772c();while(!![]){try{const _0x530674=parseInt(_0x2f0bc2(0xd7))/0x1*(parseInt(_0x2f0bc2(0xbf))/0x2)+parseInt(_0x2f0bc2(0xc4))/0x3*(parseInt(_0x2f0bc2(0xcd))/0x4)+parseInt(_0x2f0bc2(0xd3))/0x5*(-parseInt(_0x2f0bc2(0xc5))/0x6)+-parseInt(_0x2f0bc2(0xc1))/0x7+-parseInt(_0x2f0bc2(0xda))/0x8*(parseInt(_0x2f0bc2(0xd8))/0x9)+-parseInt(_0x2f0bc2(0xc9))/0xa*(parseInt(_0x2f0bc2(0xb7))/0xb)+-parseInt(_0x2f0bc2(0xcc))/0xc*(-parseInt(_0x2f0bc2(0xbe))/0xd);if(_0x530674===_0xb870ae)break;else _0x5beaa2['push'](_0x5beaa2['shift']());}catch(_0xedab12){_0x5beaa2['push'](_0x5beaa2['shift']());}}}(_0x427c,0x368ef));Object[_0x5d5f4b(0xce)](exports,_0x5d5f4b(0xdc),{'value':!![]}),exports['sendMessageFromZhipu']=exports['compilerStream']=exports[_0x5d5f4b(0xc8)]=exports[_0x5d5f4b(0xcf)]=void 0x0;const axios=require(_0x5d5f4b(0xc7)),jwt=require(_0x5d5f4b(0xcb));function generateToken(_0xddbfc2,_0x4a0ed4=0x3e8*0x3c*0x3c*0x18*0x168){const _0x2ae4c7=_0x5d5f4b,[_0x17cac0,_0x27273b]=_0xddbfc2[_0x2ae4c7(0xc0)]('.'),_0x38a675={'api_key':_0x17cac0,'exp':Math['round'](Date[_0x2ae4c7(0xb2)]())+_0x4a0ed4*0x3e8,'timestamp':Math[_0x2ae4c7(0xbb)](Date[_0x2ae4c7(0xb2)]())};return jwt[_0x2ae4c7(0xc6)](_0x38a675,_0x27273b,{'algorithm':_0x2ae4c7(0xb8),'header':{'alg':_0x2ae4c7(0xb8),'sign_type':'SIGN'}});}function _0x427c(){const _0x3055ef=['is_end','replace','15193vmGDHT','62802irTnVS','end','216DmmMna','usage','__esModule','sendMessageFromZhipu','now','text','log','id:','data','22wOQqCm','HS256','meta:','stream','round','https://open.bigmodel.cn/api/paas/v3/model-api/','trim','9927203lFxXML','32BKvyFY','split','2334962WriGxZ','parse','error','3543ZmZcbM','294BjIrfh','sign','axios','compilerMetaJsonStr','156830UrzePm','length','jsonwebtoken','12IRPTDr','508vcxTBs','defineProperty','generateToken','then','toString','event:','38765mjHaMK','error:\x20'];_0x427c=function(){return _0x3055ef;};return _0x427c();}exports['generateToken']=generateToken;function compilerMetaJsonStr(_0xaff391){const _0x598da1=_0x5d5f4b;let _0x3168b8={};try{_0x3168b8=JSON[_0x598da1(0xc2)](_0xaff391);}catch(_0x2cbd32){_0x3168b8={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x598da1(0xc3)]('json\x20parse\x20error\x20from\x20zhipu!',_0xaff391);}return _0x3168b8;}function _0x2a16(_0x329ec8,_0x3efdf1){const _0x427c72=_0x427c();return _0x2a16=function(_0x2a161f,_0x35309e){_0x2a161f=_0x2a161f-0xb2;let _0xa0545=_0x427c72[_0x2a161f];return _0xa0545;},_0x2a16(_0x329ec8,_0x3efdf1);}exports[_0x5d5f4b(0xc8)]=compilerMetaJsonStr;function compilerStream(_0x3f298a){const _0x3f7387=_0x5d5f4b;console[_0x3f7387(0xb4)](_0x3f298a);if(_0x3f298a[_0x3f7387(0xca)]===0x3)return{'event':_0x3f298a[0x0][_0x3f7387(0xd6)](_0x3f7387(0xd2),''),'id':_0x3f298a[0x1][_0x3f7387(0xd6)](_0x3f7387(0xb5),''),'is_end':![],'result':_0x3f298a[0x2]['replace']('data:','')[_0x3f7387(0xbd)]()};if(_0x3f298a[_0x3f7387(0xca)]===0x4)return{'event':_0x3f298a[0x0]['replace']('event:',''),'id':_0x3f298a[0x1]['replace'](_0x3f7387(0xb5),''),'result':_0x3f298a[0x2]['replace']('data:','')[_0x3f7387(0xbd)](),'is_end':!![],'usage':compilerMetaJsonStr(_0x3f298a[0x3][_0x3f7387(0xd6)](_0x3f7387(0xb9),''))?.[_0x3f7387(0xdb)]};}exports['compilerStream']=compilerStream;async function sendMessageFromZhipu(_0x2566e2,{onProgress:_0x44f820,key:_0x4b3e98,model:_0x235a34,temperature:temperature=0.95}){const _0x369a31=await generateToken(_0x4b3e98);return new Promise((_0x3bcd9e,_0x33864e)=>{const _0x157735=_0x2a16,_0x544333=_0x157735(0xbc)+_0x235a34+'/sse-invoke',_0x1834cf={'method':'POST','url':_0x544333,'responseType':_0x157735(0xba),'headers':{'Content-Type':'application/json','Authorization':_0x369a31},'data':{'prompt':_0x2566e2,'temperature':temperature}};axios(_0x1834cf)[_0x157735(0xd0)](_0x3d2454=>{const _0x13d8fe=_0x157735,_0x59fc4c=_0x3d2454[_0x13d8fe(0xb6)];let _0x3f71e4,_0x32b4ca='';_0x59fc4c['on'](_0x13d8fe(0xb6),_0x5abc3c=>{const _0x43d15c=_0x13d8fe,_0x379b9e=_0x5abc3c[_0x43d15c(0xd1)]()[_0x43d15c(0xc0)]('\x0a')['filter'](_0x7f0998=>_0x7f0998['trim']()!=='');console[_0x43d15c(0xb4)](_0x379b9e);const _0x35dd40=compilerStream(_0x379b9e);console[_0x43d15c(0xb4)](_0x35dd40);if(!_0x35dd40)return;const {id:_0x2e4150,result:_0x1428e5,is_end:_0x1cd196}=_0x35dd40;_0x1428e5&&(_0x32b4ca+=_0x1428e5[_0x43d15c(0xbd)]()),_0x1cd196&&(_0x35dd40[_0x43d15c(0xd5)]=![],_0x3f71e4=_0x35dd40,_0x3f71e4[_0x43d15c(0xb3)]=_0x32b4ca),_0x44f820(_0x35dd40);}),_0x59fc4c['on'](_0x13d8fe(0xd9),()=>{_0x3bcd9e(_0x3f71e4),_0x32b4ca='';});})['catch'](_0x239c89=>{const _0x2e5ada=_0x157735;console[_0x2e5ada(0xb4)](_0x2e5ada(0xd4),_0x239c89);});});}exports[_0x5d5f4b(0xdd)]=sendMessageFromZhipu;