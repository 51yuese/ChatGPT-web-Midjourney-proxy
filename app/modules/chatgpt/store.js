'use strict';function _0x1d11(){const _0x3ac5ff=['replace','buildMessageFromParentMessageId','_getTokenCount','get_encoding','__esModule','log','2711888CjLNPH','generateKey','user','1193899YdxHNH','959060cJXgbH','262184ERRups','chat','NineStore','namespace','477ApCYqL','setData','56HXFfUk','@dqbd/tiktoken','get','_recursivePruning','12rxtxqA','getData','content','defineProperty','push','slice','reduce','expires','concat','uuid','set','length','241970dicXhq','16773YXSPjG','formatOptions','system','getUuid','splice','store','cl100k_base','min','402175egELMj'];_0x1d11=function(){return _0x3ac5ff;};return _0x1d11();}function _0x3820(_0x54c5c7,_0x5a8994){const _0x1d1174=_0x1d11();return _0x3820=function(_0x382021,_0x476bfc){_0x382021=_0x382021-0x1d4;let _0x348393=_0x1d1174[_0x382021];return _0x348393;},_0x3820(_0x54c5c7,_0x5a8994);}const _0x1ccfe6=_0x3820;(function(_0x533da6,_0x45d501){const _0x36461e=_0x3820,_0x1d9feb=_0x533da6();while(!![]){try{const _0x4cc50b=parseInt(_0x36461e(0x1f6))/0x1+parseInt(_0x36461e(0x1dd))/0x2*(parseInt(_0x36461e(0x1ee))/0x3)+parseInt(_0x36461e(0x1d7))/0x4+parseInt(_0x36461e(0x1d6))/0x5+-parseInt(_0x36461e(0x1e1))/0x6*(-parseInt(_0x36461e(0x1d5))/0x7)+parseInt(_0x36461e(0x1fd))/0x8+parseInt(_0x36461e(0x1db))/0x9*(-parseInt(_0x36461e(0x1ed))/0xa);if(_0x4cc50b===_0x45d501)break;else _0x1d9feb['push'](_0x1d9feb['shift']());}catch(_0x47d97b){_0x1d9feb['push'](_0x1d9feb['shift']());}}}(_0x1d11,0x342ec));Object[_0x1ccfe6(0x1e4)](exports,_0x1ccfe6(0x1fb),{'value':!![]}),exports[_0x1ccfe6(0x1d9)]=void 0x0;const uuid_1=require(_0x1ccfe6(0x1ea)),tiktoken_1=require(_0x1ccfe6(0x1de)),tokenizer=(0x0,tiktoken_1[_0x1ccfe6(0x1fa)])(_0x1ccfe6(0x1f4));class NineStore{constructor(_0x2533c1){const _0x39c4fe=_0x1ccfe6,{store:_0x190224,namespace:_0x4505ca,expires:_0x8b0bbe}=this[_0x39c4fe(0x1ef)](_0x2533c1);this['store']=_0x190224,this[_0x39c4fe(0x1da)]=_0x4505ca,this[_0x39c4fe(0x1e8)]=_0x8b0bbe;}[_0x1ccfe6(0x1ef)](_0x307d88){const _0x1c2432=_0x1ccfe6,{store:_0x55e63b,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x1c2432(0x1d8)}=_0x307d88;return{'store':_0x55e63b,'namespace':namespace,'expires':expires};}[_0x1ccfe6(0x1fe)](_0xb01a77){const _0x5a45a7=_0x1ccfe6;return this['namespace']?this[_0x5a45a7(0x1da)]+'-'+_0xb01a77:_0xb01a77;}async[_0x1ccfe6(0x1e2)](_0x289482){const _0x483ba8=_0x1ccfe6,_0x491751=await this[_0x483ba8(0x1f3)][_0x483ba8(0x1df)](_0x289482);return _0x491751;}async[_0x1ccfe6(0x1dc)](_0x22dbf9,_0x3d8ef4=this['expires']){const _0x4dedb4=_0x1ccfe6;await this[_0x4dedb4(0x1f3)][_0x4dedb4(0x1eb)](_0x22dbf9['id'],_0x22dbf9,_0x3d8ef4);}async[_0x1ccfe6(0x1f8)](_0x50aac2,_0x495bfe){const _0xf749e2=_0x1ccfe6;let {maxRounds:_0x43163a,maxModelToken:_0x302e40,maxResponseTokens:_0x2a6221,systemMessage:systemMessage='',name:_0x842c1c}=_0x495bfe,{parentMessageId:_0x2042e0}=_0x495bfe,_0x5e5e5e=[],_0x4e01c0=0x0;systemMessage&&_0x5e5e5e[_0xf749e2(0x1e5)]({'role':_0xf749e2(0x1f0),'content':systemMessage});const _0x2be8ba=_0x5e5e5e['length'];let _0x32844e=0x0,_0x51cd3d=_0x50aac2?_0x5e5e5e['concat']([{'role':_0xf749e2(0x1d4),'content':_0x50aac2,'name':_0x842c1c}]):_0x5e5e5e;do{if(!_0x2042e0)break;const _0x35ba4c=await this[_0xf749e2(0x1e2)](_0x2042e0);if(!_0x35ba4c)break;const {text:_0x11f6aa,name:_0x198aee,role:_0x256da9}=_0x35ba4c;_0x51cd3d=_0x51cd3d[_0xf749e2(0x1e6)](0x0,_0x2be8ba)[_0xf749e2(0x1e9)]([{'role':_0x256da9,'content':_0x11f6aa,'name':_0x198aee},..._0x51cd3d['slice'](_0x2be8ba)]),_0x32844e++;if(_0x43163a&&_0x32844e>=_0x43163a)break;if(_0x302e40&&_0x2a6221){const _0x81f80b=_0x302e40-_0x2a6221;_0x4e01c0=await this[_0xf749e2(0x1f9)](_0x51cd3d);const _0x7cad28=_0x4e01c0+0xc8<=_0x81f80b;!_0x7cad28&&(_0x51cd3d=this[_0xf749e2(0x1e0)](_0x5e5e5e,_0x81f80b,systemMessage));}_0x2042e0=_0x35ba4c['parentMessageId'];}while(!![]);const _0x2212d0=Math['max'](0x1,Math[_0xf749e2(0x1f5)](_0x302e40-_0x4e01c0,_0x2a6221));return _0x51cd3d;}async[_0x1ccfe6(0x1f9)](_0x247b14){const _0x5c68a1=_0x1ccfe6;let _0x43f616=_0x247b14[_0x5c68a1(0x1e7)]((_0x5828f5,_0x406e65)=>{const _0x4249a9=_0x5c68a1;return _0x5828f5+=_0x406e65[_0x4249a9(0x1e3)];},'');return console[_0x5c68a1(0x1fc)]('汇总的文本数量:\x20',_0x43f616),_0x43f616=_0x43f616[_0x5c68a1(0x1f7)](/<\|endoftext\|>/g,''),tokenizer['encode'](_0x43f616)[_0x5c68a1(0x1ec)];}async['_recursivePruning'](_0x3df6ea,_0x50c467,_0x195e2e){const _0x2b7437=_0x1ccfe6,_0x436a30=await this[_0x2b7437(0x1f9)](_0x3df6ea);if(_0x436a30<=_0x50c467)return _0x3df6ea;return _0x3df6ea[_0x2b7437(0x1f2)](_0x195e2e?0x1:0x0,0x1),this[_0x2b7437(0x1e0)](_0x3df6ea,_0x50c467,_0x195e2e);}[_0x1ccfe6(0x1f1)](){return(0x0,uuid_1['v4'])();}}exports[_0x1ccfe6(0x1d9)]=NineStore;