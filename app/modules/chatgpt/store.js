'use strict';function _0x43b3(_0x16f72f,_0x413e87){const _0x2f6867=_0x2f68();return _0x43b3=function(_0x43b363,_0x3604a9){_0x43b363=_0x43b363-0x190;let _0x5dcd30=_0x2f6867[_0x43b363];return _0x5dcd30;},_0x43b3(_0x16f72f,_0x413e87);}const _0x517708=_0x43b3;function _0x2f68(){const _0x3f06e8=['min','11185LSZLsU','log','uuid','NineStore','push','defineProperty','length','concat','slice','64yOlQXe','__esModule','25495830hrOMWk','getData','generateKey','3960220lRIrrL','726szFggS','getUuid','34216KYIZFc','9507garFaP','namespace','expires','setData','formatOptions','_recursivePruning','reduce','parentMessageId','542syuPSj','system','11XvVQVV','6706593CnkLNq','store','cl100k_base','_getTokenCount','user','chat','get_encoding','content','719744pGHpyA'];_0x2f68=function(){return _0x3f06e8;};return _0x2f68();}(function(_0x460daf,_0x1bfd57){const _0x47b221=_0x43b3,_0xc6d554=_0x460daf();while(!![]){try{const _0x1d5db7=parseInt(_0x47b221(0x19f))/0x1+parseInt(_0x47b221(0x194))/0x2*(parseInt(_0x47b221(0x1b3))/0x3)+parseInt(_0x47b221(0x1af))/0x4+-parseInt(_0x47b221(0x1a1))/0x5*(parseInt(_0x47b221(0x1b0))/0x6)+parseInt(_0x47b221(0x1b2))/0x7*(parseInt(_0x47b221(0x1aa))/0x8)+parseInt(_0x47b221(0x197))/0x9+parseInt(_0x47b221(0x1ac))/0xa*(-parseInt(_0x47b221(0x196))/0xb);if(_0x1d5db7===_0x1bfd57)break;else _0xc6d554['push'](_0xc6d554['shift']());}catch(_0x4e5bc2){_0xc6d554['push'](_0xc6d554['shift']());}}}(_0x2f68,0x8208b));Object[_0x517708(0x1a6)](exports,_0x517708(0x1ab),{'value':!![]}),exports[_0x517708(0x1a4)]=void 0x0;const uuid_1=require(_0x517708(0x1a3)),tiktoken_1=require('@dqbd/tiktoken'),tokenizer=(0x0,tiktoken_1[_0x517708(0x19d)])(_0x517708(0x199));class NineStore{constructor(_0x4c57a8){const _0x296363=_0x517708,{store:_0x71a9cf,namespace:_0x3534a7,expires:_0x3aad13}=this['formatOptions'](_0x4c57a8);this[_0x296363(0x198)]=_0x71a9cf,this[_0x296363(0x1b4)]=_0x3534a7,this[_0x296363(0x1b5)]=_0x3aad13;}[_0x517708(0x190)](_0x1e8fa7){const _0x113b99=_0x517708,{store:_0x3e64e2,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x113b99(0x19c)}=_0x1e8fa7;return{'store':_0x3e64e2,'namespace':namespace,'expires':expires};}[_0x517708(0x1ae)](_0x2f7c20){const _0x363247=_0x517708;return this[_0x363247(0x1b4)]?this[_0x363247(0x1b4)]+'-'+_0x2f7c20:_0x2f7c20;}async['getData'](_0x5757eb){const _0x171257=_0x517708,_0xee62f=await this[_0x171257(0x198)]['get'](_0x5757eb);return _0xee62f;}async[_0x517708(0x1b6)](_0x3855fe,_0x5d14ac=this[_0x517708(0x1b5)]){const _0x5db7c8=_0x517708;await this[_0x5db7c8(0x198)]['set'](_0x3855fe['id'],_0x3855fe,_0x5d14ac);}async['buildMessageFromParentMessageId'](_0x49b2cc,_0x1a59b8){const _0x2dc31f=_0x517708;let {maxRounds:_0x47320a,maxModelToken:_0x3873ee,maxResponseTokens:_0x108e8e,systemMessage:systemMessage='',name:_0x23165b}=_0x1a59b8,{parentMessageId:_0x466e23}=_0x1a59b8,_0x205e60=[],_0xe83e28=0x0;systemMessage&&_0x205e60[_0x2dc31f(0x1a5)]({'role':_0x2dc31f(0x195),'content':systemMessage});const _0xc3bf5=_0x205e60[_0x2dc31f(0x1a7)];let _0x19e036=0x0,_0x105f25=_0x49b2cc?_0x205e60[_0x2dc31f(0x1a8)]([{'role':_0x2dc31f(0x19b),'content':_0x49b2cc,'name':_0x23165b}]):_0x205e60;do{if(!_0x466e23)break;const _0x54b02a=await this[_0x2dc31f(0x1ad)](_0x466e23);if(!_0x54b02a)break;const {text:_0x4dd85d,name:_0x242437,role:_0x4abd33}=_0x54b02a;_0x105f25=_0x105f25[_0x2dc31f(0x1a9)](0x0,_0xc3bf5)['concat']([{'role':_0x4abd33,'content':_0x4dd85d,'name':_0x242437},..._0x105f25[_0x2dc31f(0x1a9)](_0xc3bf5)]),_0x19e036++;if(_0x47320a&&_0x19e036>=_0x47320a)break;if(_0x3873ee&&_0x108e8e){const _0x549d56=_0x3873ee-_0x108e8e;_0xe83e28=await this[_0x2dc31f(0x19a)](_0x105f25);const _0x583604=_0xe83e28+0xc8<=_0x549d56;!_0x583604&&(_0x105f25=this[_0x2dc31f(0x191)](_0x205e60,_0x549d56,systemMessage));}_0x466e23=_0x54b02a[_0x2dc31f(0x193)];}while(!![]);const _0x56f77e=Math['max'](0x1,Math[_0x2dc31f(0x1a0)](_0x3873ee-_0xe83e28,_0x108e8e));return _0x105f25;}async[_0x517708(0x19a)](_0x59a974){const _0x25a885=_0x517708;let _0x4c75aa=_0x59a974[_0x25a885(0x192)]((_0x223f6c,_0x1091a3)=>{const _0x4c9c36=_0x25a885;return _0x223f6c+=_0x1091a3[_0x4c9c36(0x19e)];},'');return console[_0x25a885(0x1a2)]('汇总的文本数量:\x20',_0x4c75aa),_0x4c75aa=_0x4c75aa['replace'](/<\|endoftext\|>/g,''),tokenizer['encode'](_0x4c75aa)[_0x25a885(0x1a7)];}async[_0x517708(0x191)](_0x6956c6,_0x394fdc,_0x513a36){const _0x1bd3b5=_0x517708,_0x19f685=await this[_0x1bd3b5(0x19a)](_0x6956c6);if(_0x19f685<=_0x394fdc)return _0x6956c6;return _0x6956c6['splice'](_0x513a36?0x1:0x0,0x1),this[_0x1bd3b5(0x191)](_0x6956c6,_0x394fdc,_0x513a36);}[_0x517708(0x1b1)](){return(0x0,uuid_1['v4'])();}}exports[_0x517708(0x1a4)]=NineStore;