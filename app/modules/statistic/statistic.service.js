'use strict';const _0x53f28c=_0x4f83;(function(_0x32cbc1,_0x3674dc){const _0x2072e5=_0x4f83,_0x27edfe=_0x32cbc1();while(!![]){try{const _0x26d89f=parseInt(_0x2072e5(0x1c5))/0x1+parseInt(_0x2072e5(0x1df))/0x2+-parseInt(_0x2072e5(0x1a4))/0x3*(-parseInt(_0x2072e5(0x223))/0x4)+-parseInt(_0x2072e5(0x1ec))/0x5*(parseInt(_0x2072e5(0x202))/0x6)+parseInt(_0x2072e5(0x1fd))/0x7*(-parseInt(_0x2072e5(0x1c0))/0x8)+-parseInt(_0x2072e5(0x1aa))/0x9+parseInt(_0x2072e5(0x1fc))/0xa;if(_0x26d89f===_0x3674dc)break;else _0x27edfe['push'](_0x27edfe['shift']());}catch(_0x3e0ac3){_0x27edfe['push'](_0x27edfe['shift']());}}}(_0x3266,0x859cf));var __decorate=this&&this[_0x53f28c(0x19e)]||function(_0x53dd17,_0x2e231a,_0x27306b,_0x1e260a){const _0x45de03=_0x53f28c;var _0x52e0db=arguments[_0x45de03(0x219)],_0x20ca5b=_0x52e0db<0x3?_0x2e231a:_0x1e260a===null?_0x1e260a=Object[_0x45de03(0x20c)](_0x2e231a,_0x27306b):_0x1e260a,_0x3c1f7e;if(typeof Reflect===_0x45de03(0x1e2)&&typeof Reflect[_0x45de03(0x1f2)]==='function')_0x20ca5b=Reflect['decorate'](_0x53dd17,_0x2e231a,_0x27306b,_0x1e260a);else{for(var _0x23c2f4=_0x53dd17[_0x45de03(0x219)]-0x1;_0x23c2f4>=0x0;_0x23c2f4--)if(_0x3c1f7e=_0x53dd17[_0x23c2f4])_0x20ca5b=(_0x52e0db<0x3?_0x3c1f7e(_0x20ca5b):_0x52e0db>0x3?_0x3c1f7e(_0x2e231a,_0x27306b,_0x20ca5b):_0x3c1f7e(_0x2e231a,_0x27306b))||_0x20ca5b;}return _0x52e0db>0x3&&_0x20ca5b&&Object[_0x45de03(0x20e)](_0x2e231a,_0x27306b,_0x20ca5b),_0x20ca5b;},__metadata=this&&this[_0x53f28c(0x1cb)]||function(_0x4a72e5,_0x779e6){const _0x95087c=_0x53f28c;if(typeof Reflect===_0x95087c(0x1e2)&&typeof Reflect[_0x95087c(0x1a5)]===_0x95087c(0x1db))return Reflect['metadata'](_0x4a72e5,_0x779e6);},__param=this&&this[_0x53f28c(0x203)]||function(_0x42ae39,_0x4d9ce4){return function(_0x3d92b3,_0x14a7a0){_0x4d9ce4(_0x3d92b3,_0x14a7a0,_0x42ae39);};};function _0x4f83(_0xdeee69,_0x381243){const _0x32666c=_0x3266();return _0x4f83=function(_0x4f8351,_0x5a92b3){_0x4f8351=_0x4f8351-0x192;let _0x26a895=_0x32666c[_0x4f8351];return _0x26a895;},_0x4f83(_0xdeee69,_0x381243);}Object[_0x53f28c(0x20e)](exports,_0x53f28c(0x200),{'value':!![]}),exports[_0x53f28c(0x1f7)]=void 0x0;function _0x3266(){const _0x2a5256=['M.DD','countTotalMusic','__decorate','user','midjourney.createdAt\x20<\x20:tomorrow','YYYYMMDD','DATE(midjourney.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','countChatsByTimeRange','357PrEpTt','metadata','../user/user.entity','user.createdAt\x20<\x20:tomorrow','https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token=','map','1800045xYBtXE','MidjourneyStatusEnum','sum','where','@nestjs/common','formatDate','chatLogEntity','SELECT\x20SUM(price)\x20sum\x20FROM\x20`order`\x20WHERE\x20status\x20=\x201','获取百度统计数据失败','axios','configEntity','ConfigEntity','countNewChatsToday','default','getTime','order.createdAt\x20<\x20:tomorrow','chatLog','baiduSiteId','百度授权码过期','%Y-%m-%d','query','chatlog','245432dsTECi','getRawMany','endTime','startTime','toFixed','372027xYwOxN','setDate','IsNull','@nestjs/typeorm','data','order.createdAt\x20>=\x20:today','__metadata','music','userEntity','Injectable','countNewDrawsToday','Connection','Repository','user.createdAt\x20>=\x20:today','find','pv_count,visitor_count,ip_count,bounce_ratio,avg_visit_time','../globalConfig/config.entity','DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','getDate','value','count','countMjDrawsByTimeRange','function','../chatLog/chatLog.entity','countTodayCollection','HttpException','1061858xcWAvM','configKey','design:paramtypes','object','andWhere','modelUse','select','countTotalCollection','请先配置百度统计siteId','midjourneyEntity','SELECT\x20SUM(price)\x20sum\x20FROM\x20`order`\x20WHERE\x20status\x20=\x201\x20AND\x20DATE(updatedAt)\x20=\x20CURDATE()','chatLog.type\x20=\x20:type','configVal','5pzQfhr','now','connection','chatLog.createdAt\x20<\x20:tomorrow','ChatLogEntity','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x20\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName;\x0a\x20\x20\x20\x20','decorate','BAD_REQUEST','countOrders','orderEntity','push','StatisticService','countDrawsByTimeRange','baiduToken','getBaiduStatistics','typeorm','578510dtImhO','7JjtAZP','../midjourney/midjourney.entity','orderBy','__esModule','countUsers','5015496QQYEOp','__param','DRAWED','Not','midjourney.createdAt\x20>=\x20:startDate','InjectRepository','countNewUsersToday','chatlog.type\x20=\x20:type','请先配置百度统计accessToken','getBaseStatistic','getOwnPropertyDescriptor','../../common/constants/midjourney.constant','defineProperty','createQueryBuilder','&end_date=','HttpStatus','date','chatlog.createdAt\x20>=\x20:startDate','countChats','order','&metrics=','diff','chatLog.createdAt\x20>=\x20:today','length','../../common/constants/balance.constant','setHours','countNewOrdersToday','midjourney','countDraws','chatlog.modelType\x20=\x20\x27music\x27','CHAT_TYPE','getBaiduVisit','PAINT_TYPE','21952YgoeTr','day','\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27','MidjourneyEntity','DeductionKey','&start_date=','&method=','groupBy','countNewMidhourneysToday','get','getCount','%Y-%m-%d\x20%H:00'];_0x3266=function(){return _0x2a5256;};return _0x3266();}const common_1=require(_0x53f28c(0x1ae)),typeorm_1=require(_0x53f28c(0x1c8)),user_entity_1=require(_0x53f28c(0x1a6)),typeorm_2=require(_0x53f28c(0x1fb)),chatLog_entity_1=require(_0x53f28c(0x1dc)),balance_constant_1=require(_0x53f28c(0x21a)),date_1=require('../../common/utils/date'),axios_1=require(_0x53f28c(0x1b3)),config_entity_1=require(_0x53f28c(0x1d5)),order_entity_1=require('../order/order.entity'),midjourney_entity_1=require(_0x53f28c(0x1fe)),midjourney_constant_1=require(_0x53f28c(0x20d));let StatisticService=class StatisticService{constructor(_0x380f8b,_0x180269,_0xdaed4e,_0x1d0554,_0x241c9e,_0x4a27aa){const _0x2209a2=_0x53f28c;this[_0x2209a2(0x1cd)]=_0x380f8b,this[_0x2209a2(0x1b0)]=_0x180269,this[_0x2209a2(0x1b4)]=_0xdaed4e,this[_0x2209a2(0x1f5)]=_0x1d0554,this[_0x2209a2(0x1e8)]=_0x241c9e,this[_0x2209a2(0x1ee)]=_0x4a27aa;}async[_0x53f28c(0x20b)](){const _0x4b756d=_0x53f28c,_0x194281=await this[_0x4b756d(0x201)](),_0xe3b913=await this[_0x4b756d(0x208)](),_0x5a493a=await this[_0x4b756d(0x214)](),_0x13f848=await this[_0x4b756d(0x1b6)](),_0x1cbf8e=await this[_0x4b756d(0x21e)](),_0x16cacc=await this[_0x4b756d(0x1cf)](),_0x18daba=await this['countNewMidhourneysToday'](),_0x550fd8=await this['countOrders'](),_0x351b0f=await this[_0x4b756d(0x21c)](),_0x440a4d=await this[_0x4b756d(0x1dd)](),_0x16998e=await this[_0x4b756d(0x1e6)](),_0x195fec=await this['countTodayMusic'](),_0x378972=await this['countTotalMusic']();return{'userCount':_0x194281,'newUserCount':_0xe3b913,'chatCount':_0x5a493a,'newChatCount':_0x13f848,'drawCount':_0x1cbf8e,'newDrawCount':_0x18daba+_0x16cacc,'orderCount':_0x550fd8,'newOrderCount':_0x351b0f,'todayBrokerage':0x0,'totalBrokerage':0x0,'todayCollection':_0x440a4d,'totalCollection':_0x16998e,'todayMusic':_0x195fec,'totalMusic':_0x378972,'todayVideo':0x0,'totalVideo':0x0};}async['getChatStatistic']({days:days=0x7}){const _0x35b067=_0x53f28c,_0x188095=await this[_0x35b067(0x1a3)](days),_0x437935=await this['countDrawsByTimeRange'](days),_0x4b2bcc=await this[_0x35b067(0x1da)](days);return{'date':_0x188095[_0x35b067(0x1a9)](_0x5c716d=>_0x5c716d[_0x35b067(0x212)]),'chat':_0x188095['map'](_0x518efa=>_0x518efa[_0x35b067(0x1d8)]),'draw':_0x437935[_0x35b067(0x1a9)]((_0x32f6a1,_0x58a463)=>{const _0x507d49=_0x35b067;return _0x32f6a1[_0x507d49(0x1d8)]+_0x4b2bcc[_0x58a463][_0x507d49(0x1d8)];})};}async[_0x53f28c(0x221)]({days:days=0x7}){const _0x4294d2=await this['getBaiduStatistics'](days);return _0x4294d2;}async['countUsers'](){const _0x201aab=_0x53f28c,_0x59c230=await this[_0x201aab(0x1cd)][_0x201aab(0x1d9)]();return _0x59c230;}async['countNewUsersToday'](){const _0x3f000a=_0x53f28c,_0x2309db=new Date();_0x2309db['setHours'](0x0,0x0,0x0,0x0);const _0x4312a2=new Date(_0x2309db[_0x3f000a(0x1b8)]()+0x18*0x3c*0x3c*0x3e8),_0x402a53=this['userEntity'][_0x3f000a(0x20f)](_0x3f000a(0x19f)),_0x1e80e8=await _0x402a53[_0x3f000a(0x1ad)](_0x3f000a(0x1d2),{'today':_0x2309db})[_0x3f000a(0x1e3)](_0x3f000a(0x1a7),{'tomorrow':_0x4312a2})[_0x3f000a(0x19a)]();return _0x1e80e8;}async[_0x53f28c(0x214)](){const _0x88e0=_0x53f28c,_0x5a689a=await this['chatLogEntity'][_0x88e0(0x1d9)]({'where':{'type':balance_constant_1[_0x88e0(0x194)][_0x88e0(0x220)]}});return _0x5a689a;}async[_0x53f28c(0x1b6)](){const _0x402112=_0x53f28c,_0x43cf32=new Date();_0x43cf32['setHours'](0x0,0x0,0x0,0x0);const _0x14c03b=new Date(_0x43cf32[_0x402112(0x1b8)]()+0x18*0x3c*0x3c*0x3e8),_0x22483a=this['chatLogEntity'][_0x402112(0x20f)](_0x402112(0x1ba)),_0x24c165=await _0x22483a[_0x402112(0x1ad)](_0x402112(0x1ea),{'type':balance_constant_1['DeductionKey'][_0x402112(0x220)]})[_0x402112(0x1e3)](_0x402112(0x218),{'today':_0x43cf32})[_0x402112(0x1e3)]('chatLog.createdAt\x20<\x20:tomorrow',{'tomorrow':_0x14c03b})[_0x402112(0x19a)]();return _0x24c165;}async[_0x53f28c(0x21e)](){const _0x5bbfc0=_0x53f28c,_0x444f71=await this[_0x5bbfc0(0x1b0)][_0x5bbfc0(0x1d9)]({'where':{'type':balance_constant_1['DeductionKey'][_0x5bbfc0(0x222)]}});return _0x444f71;}async[_0x53f28c(0x1cf)](){const _0x3f85e1=_0x53f28c,_0x53ea89=new Date();_0x53ea89['setHours'](0x0,0x0,0x0,0x0);const _0x2f97e3=new Date(_0x53ea89[_0x3f85e1(0x1b8)]()+0x18*0x3c*0x3c*0x3e8),_0x28174e=this[_0x3f85e1(0x1b0)]['createQueryBuilder'](_0x3f85e1(0x1ba)),_0x2b12e4=await _0x28174e['where'](_0x3f85e1(0x1ea),{'type':balance_constant_1[_0x3f85e1(0x194)][_0x3f85e1(0x222)]})[_0x3f85e1(0x1e3)](_0x3f85e1(0x218),{'today':_0x53ea89})['andWhere'](_0x3f85e1(0x1ef),{'tomorrow':_0x2f97e3})[_0x3f85e1(0x19a)]();return _0x2b12e4;}async[_0x53f28c(0x198)](){const _0xf3338f=_0x53f28c,_0x544553=new Date();_0x544553['setHours'](0x0,0x0,0x0,0x0);const _0x1c8f53=new Date(_0x544553[_0xf3338f(0x1b8)]()+0x18*0x3c*0x3c*0x3e8),_0x3cbbff=this[_0xf3338f(0x1e8)]['createQueryBuilder']('midjourney'),_0x5042cc=await _0x3cbbff[_0xf3338f(0x1ad)]('midjourney.createdAt\x20>=\x20:today',{'today':_0x544553})[_0xf3338f(0x1e3)](_0xf3338f(0x1a0),{'tomorrow':_0x1c8f53})[_0xf3338f(0x19a)]();return _0x5042cc;}async[_0x53f28c(0x1a3)](_0x30a02d){const _0x27e89b=_0x53f28c,_0x19b6c2=new Date();_0x19b6c2['setHours'](0x0,0x0,0x0,0x0);const _0x33fa8c=new Date(_0x19b6c2[_0x27e89b(0x1b8)]()-(_0x30a02d-0x1)*0x18*0x3c*0x3c*0x3e8),_0x430d6e=this[_0x27e89b(0x1b0)][_0x27e89b(0x20f)](_0x27e89b(0x1bf)),_0x186f5e=await _0x430d6e[_0x27e89b(0x1e5)](_0x27e89b(0x1d6))[_0x27e89b(0x1ad)]('chatlog.type\x20=\x20:type',{'type':balance_constant_1[_0x27e89b(0x194)][_0x27e89b(0x220)]})[_0x27e89b(0x1e3)](_0x27e89b(0x213),{'startDate':_0x33fa8c})[_0x27e89b(0x197)](_0x27e89b(0x212))[_0x27e89b(0x1ff)]('date')[_0x27e89b(0x1c1)](),_0x24b56b=[],_0x26ad30=_0x33fa8c;for(let _0x102f27=0x0;_0x102f27<_0x30a02d;_0x102f27++){const _0x3ed2aa=(0x0,date_1[_0x27e89b(0x1af)])(new Date(_0x26ad30),_0x27e89b(0x19c)),_0x46c1b2=_0x186f5e['find'](_0x267633=>(0x0,date_1['formatDate'])(new Date(_0x267633[_0x27e89b(0x212)]),_0x27e89b(0x19c))===_0x3ed2aa)?.[_0x27e89b(0x1d9)]??0x0;_0x46c1b2>0x0?_0x24b56b[_0x27e89b(0x1f6)]({'date':_0x3ed2aa,'value':Number(_0x46c1b2)}):_0x24b56b[_0x27e89b(0x1f6)]({'date':_0x3ed2aa,'value':0x0}),_0x26ad30[_0x27e89b(0x1c6)](_0x26ad30[_0x27e89b(0x1d7)]()+0x1);}return _0x24b56b;}async[_0x53f28c(0x1f8)](_0x3c9f4b){const _0x1e3e7d=_0x53f28c,_0x531eca=new Date();_0x531eca[_0x1e3e7d(0x21b)](0x0,0x0,0x0,0x0);const _0x8b0e83=new Date(_0x531eca[_0x1e3e7d(0x1b8)]()-(_0x3c9f4b-0x1)*0x18*0x3c*0x3c*0x3e8),_0x176964=this['chatLogEntity'][_0x1e3e7d(0x20f)]('chatlog'),_0x281229=await _0x176964[_0x1e3e7d(0x1e5)](_0x1e3e7d(0x1d6))[_0x1e3e7d(0x1ad)](_0x1e3e7d(0x209),{'type':balance_constant_1[_0x1e3e7d(0x194)]['PAINT_TYPE']})[_0x1e3e7d(0x1e3)](_0x1e3e7d(0x213),{'startDate':_0x8b0e83})[_0x1e3e7d(0x197)](_0x1e3e7d(0x212))[_0x1e3e7d(0x1ff)](_0x1e3e7d(0x212))['getRawMany'](),_0x39e713=[],_0x14fbd7=_0x8b0e83;for(let _0x2b7181=0x0;_0x2b7181<_0x3c9f4b;_0x2b7181++){const _0x4d9539=(0x0,date_1[_0x1e3e7d(0x1af)])(new Date(_0x14fbd7),'M.DD'),_0x52f980=_0x281229['find'](_0x32dd75=>(0x0,date_1[_0x1e3e7d(0x1af)])(new Date(_0x32dd75[_0x1e3e7d(0x212)]),_0x1e3e7d(0x19c))===_0x4d9539)?.[_0x1e3e7d(0x1d9)]??0x0;_0x52f980>0x0?_0x39e713[_0x1e3e7d(0x1f6)]({'date':_0x4d9539,'value':Number(_0x52f980)}):_0x39e713[_0x1e3e7d(0x1f6)]({'date':_0x4d9539,'value':0x0}),_0x14fbd7['setDate'](_0x14fbd7[_0x1e3e7d(0x1d7)]()+0x1);}return _0x39e713;}async[_0x53f28c(0x1da)](_0x3d93b1){const _0x17b351=_0x53f28c,_0x254833=new Date();_0x254833['setHours'](0x0,0x0,0x0,0x0);const _0x10c9da=new Date(_0x254833['getTime']()-(_0x3d93b1-0x1)*0x18*0x3c*0x3c*0x3e8),_0x4e999b=this['midjourneyEntity']['createQueryBuilder'](_0x17b351(0x21d)),_0xb5df7e=await _0x4e999b[_0x17b351(0x1e5)](_0x17b351(0x1a2))[_0x17b351(0x1ad)]('midjourney.status\x20=\x20:status',{'status':midjourney_constant_1[_0x17b351(0x1ab)][_0x17b351(0x204)]})[_0x17b351(0x1e3)](_0x17b351(0x206),{'startDate':_0x10c9da})[_0x17b351(0x197)](_0x17b351(0x212))[_0x17b351(0x1ff)](_0x17b351(0x212))[_0x17b351(0x1c1)](),_0x59e76c=[],_0x452299=_0x10c9da;for(let _0x41da9c=0x0;_0x41da9c<_0x3d93b1;_0x41da9c++){const _0x508911=(0x0,date_1[_0x17b351(0x1af)])(new Date(_0x452299),_0x17b351(0x19c)),_0x2a55c5=_0xb5df7e[_0x17b351(0x1d3)](_0x553633=>(0x0,date_1[_0x17b351(0x1af)])(new Date(_0x553633['date']),_0x17b351(0x19c))===_0x508911)?.[_0x17b351(0x1d9)]??0x0;_0x2a55c5>0x0?_0x59e76c[_0x17b351(0x1f6)]({'date':_0x508911,'value':Number(_0x2a55c5)}):_0x59e76c[_0x17b351(0x1f6)]({'date':_0x508911,'value':0x0}),_0x452299[_0x17b351(0x1c6)](_0x452299[_0x17b351(0x1d7)]()+0x1);}return _0x59e76c;}async[_0x53f28c(0x1fa)](_0x3b55a4){const _0x3a9295=_0x53f28c,_0x22a85e=(0x0,date_1[_0x3a9295(0x1af)])(new Date(),_0x3a9295(0x1a1)),_0x115b6f=(0x0,date_1[_0x3a9295(0x1af)])(new Date(Date[_0x3a9295(0x1ed)]()-Number(_0x3b55a4-0x1)*0x18*0x3c*0x3c*0x3e8),_0x3a9295(0x1a1)),_0x323942=_0x3a9295(0x1d4),_0x364753='overview/getTimeTrendRpt',_0x5303c5=await this[_0x3a9295(0x1b4)][_0x3a9295(0x1d3)]({'where':{'configKey':(0x0,typeorm_2['In'])(['baiduToken',_0x3a9295(0x1bb)])}}),_0x27fcda=_0x5303c5[_0x3a9295(0x1d3)](_0x55e8af=>_0x55e8af[_0x3a9295(0x1e0)]===_0x3a9295(0x1bb))?.[_0x3a9295(0x1eb)],_0x4e0c68=_0x5303c5[_0x3a9295(0x1d3)](_0x81b789=>_0x81b789[_0x3a9295(0x1e0)]===_0x3a9295(0x1f9))?.[_0x3a9295(0x1eb)];if(!_0x27fcda||!_0x4e0c68)return[];if(!_0x27fcda)throw new common_1['HttpException'](_0x3a9295(0x1e7),common_1[_0x3a9295(0x211)][_0x3a9295(0x1f3)]);if(!_0x4e0c68)throw new common_1[(_0x3a9295(0x1de))](_0x3a9295(0x20a),common_1[_0x3a9295(0x211)][_0x3a9295(0x1f3)]);const _0x35758b=_0x3a9295(0x1a8)+_0x4e0c68+'&site_id='+_0x27fcda+_0x3a9295(0x196)+_0x364753+_0x3a9295(0x195)+_0x115b6f+_0x3a9295(0x210)+_0x22a85e+_0x3a9295(0x216)+_0x323942,_0x4ee1e8=await axios_1[_0x3a9295(0x1b7)][_0x3a9295(0x199)](_0x35758b),{error_code:_0x4c34b0,message:_0x8c7ef6}=_0x4ee1e8[_0x3a9295(0x1c9)];if(_0x4c34b0===0x6f)throw new common_1['HttpException'](_0x8c7ef6||_0x3a9295(0x1bc),common_1[_0x3a9295(0x211)][_0x3a9295(0x1f3)]);if(_0x4c34b0&&_0x4c34b0!==0xc8)throw new common_1['HttpException'](_0x8c7ef6||_0x3a9295(0x1b2),common_1[_0x3a9295(0x211)][_0x3a9295(0x1f3)]);return _0x4ee1e8[_0x3a9295(0x1c9)]['result'];}async[_0x53f28c(0x1f4)](){const _0x58ef48=_0x53f28c,_0x32d180=await this[_0x58ef48(0x1f5)][_0x58ef48(0x1d9)]();return _0x32d180;}async[_0x53f28c(0x21c)](){const _0x4c50bb=_0x53f28c,_0x48d58b=new Date();_0x48d58b['setHours'](0x0,0x0,0x0,0x0);const _0x220269=new Date(_0x48d58b[_0x4c50bb(0x1b8)]()+0x18*0x3c*0x3c*0x3e8),_0x5b2f0e=this['orderEntity'][_0x4c50bb(0x20f)](_0x4c50bb(0x215)),_0x1b9bff=await _0x5b2f0e['where'](_0x4c50bb(0x1ca),{'today':_0x48d58b})[_0x4c50bb(0x1e3)](_0x4c50bb(0x1b9),{'tomorrow':_0x220269})[_0x4c50bb(0x19a)]();return _0x1b9bff;}async['countTodayMusic'](){const _0x1f2d44=_0x53f28c,_0x5828c6=new Date();_0x5828c6['setHours'](0x0,0x0,0x0,0x0);const _0x756afc=new Date(_0x5828c6[_0x1f2d44(0x1b8)]()+0x18*0x3c*0x3c*0x3e8),_0x3f29d9=this['chatLogEntity']['createQueryBuilder'](_0x1f2d44(0x1bf)),_0xc4a713=await _0x3f29d9[_0x1f2d44(0x1ad)](_0x1f2d44(0x21f))['andWhere']('chatlog.answer\x20is\x20not\x20null')[_0x1f2d44(0x1e3)]('chatlog.createdAt\x20>=\x20:today',{'today':_0x5828c6})[_0x1f2d44(0x1e3)]('chatlog.createdAt\x20<\x20:tomorrow',{'tomorrow':_0x756afc})[_0x1f2d44(0x19a)]();return _0xc4a713;}async[_0x53f28c(0x19d)](){const _0x1a0555=_0x53f28c,_0x84bcdc=await this['chatLogEntity'][_0x1a0555(0x1d9)]({'where':{'modelType':_0x1a0555(0x1cc),'answer':(0x0,typeorm_2[_0x1a0555(0x205)])((0x0,typeorm_2[_0x1a0555(0x1c7)])())}});return _0x84bcdc;}async[_0x53f28c(0x1dd)](){const _0x55e144=_0x53f28c,_0x15f5a1=await this[_0x55e144(0x1ee)][_0x55e144(0x1be)](_0x55e144(0x1e9)),_0x31a7c1=_0x15f5a1[_0x55e144(0x1ac)]?Number(_0x15f5a1['sum']):0x0;return _0x31a7c1[_0x55e144(0x1c4)](0x2);}async[_0x53f28c(0x1e6)](){const _0xc1df6=_0x53f28c,_0x2ad014=await this[_0xc1df6(0x1ee)][_0xc1df6(0x1be)](_0xc1df6(0x1b1)),_0x5decdb=_0x2ad014['sum']?Number(_0x2ad014[_0xc1df6(0x1ac)]):0x0;return _0x5decdb[_0xc1df6(0x1c4)](0x2);}async[_0x53f28c(0x1e4)](_0x1d517a){const _0x43292c=_0x53f28c,_0x5d6f1f=await this[_0x43292c(0x1ee)][_0x43292c(0x1be)]('\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20model\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27'+_0x1d517a[_0x43292c(0x1c3)]+_0x43292c(0x192)+_0x1d517a[_0x43292c(0x1c2)]+'\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x0a\x20\x20\x20\x20'),_0x5add23=(0x0,date_1['default'])(_0x1d517a[_0x43292c(0x1c3)])[_0x43292c(0x217)]((0x0,date_1['default'])(_0x1d517a['endTime']),_0x43292c(0x224)),_0xaadf2=_0x5add23===0x0?_0x43292c(0x19b):_0x43292c(0x1bd),_0x1f4ddf=await this['connection'][_0x43292c(0x1be)]('\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATE_FORMAT(\x20createdAt,\x20\x27'+_0xaadf2+'\x27\x20)\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27'+_0x1d517a[_0x43292c(0x1c3)]+_0x43292c(0x192)+_0x1d517a[_0x43292c(0x1c2)]+_0x43292c(0x1f1));return{'pie':_0x5d6f1f,'line':_0x1f4ddf};}};StatisticService=__decorate([(0x0,common_1[_0x53f28c(0x1ce)])(),__param(0x0,(0x0,typeorm_1[_0x53f28c(0x207)])(user_entity_1['UserEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(chatLog_entity_1[_0x53f28c(0x1f0)])),__param(0x2,(0x0,typeorm_1[_0x53f28c(0x207)])(config_entity_1[_0x53f28c(0x1b5)])),__param(0x3,(0x0,typeorm_1[_0x53f28c(0x207)])(order_entity_1['OrderEntity'])),__param(0x4,(0x0,typeorm_1['InjectRepository'])(midjourney_entity_1[_0x53f28c(0x193)])),__metadata(_0x53f28c(0x1e1),[typeorm_2[_0x53f28c(0x1d1)],typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2[_0x53f28c(0x1d1)],typeorm_2[_0x53f28c(0x1d0)]])],StatisticService),exports['StatisticService']=StatisticService;