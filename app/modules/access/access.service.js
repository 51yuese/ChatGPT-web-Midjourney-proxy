'use strict';const _0x4ad349=_0x1bc2;(function(_0x2c3b6d,_0x5d4bb2){const _0x400926=_0x1bc2,_0x5624c8=_0x2c3b6d();while(!![]){try{const _0x14d5a6=parseInt(_0x400926(0x16c))/0x1+parseInt(_0x400926(0x165))/0x2*(-parseInt(_0x400926(0x17b))/0x3)+parseInt(_0x400926(0x133))/0x4*(parseInt(_0x400926(0x15e))/0x5)+parseInt(_0x400926(0x144))/0x6*(parseInt(_0x400926(0x14a))/0x7)+parseInt(_0x400926(0x141))/0x8+parseInt(_0x400926(0x166))/0x9+-parseInt(_0x400926(0x16f))/0xa*(parseInt(_0x400926(0x151))/0xb);if(_0x14d5a6===_0x5d4bb2)break;else _0x5624c8['push'](_0x5624c8['shift']());}catch(_0x2d4fa5){_0x5624c8['push'](_0x5624c8['shift']());}}}(_0xcd7f,0x6c60b));function _0xcd7f(){const _0x266d50=['90eInhDZ','createPsd','BAD_REQUEST','userMap','findAndCount','queryOne','151144ExCMsG','map','userService','queryUserByUsername','__decorate','accessEntity','typeorm','820259BApiMg','queryAccessCount','UserService','affected','handleSaveAccess','set','AccessService','getManagerAccess','filter','用户不存在','clear','createUser','GONE','10SpbbPG','save','DESC','添加管理员失败','findOne','error:\x20','AccessEntity','4vtwlCS','1770255nVVJkC','getOwnPropertyDescriptor','updateUserPassword','checked','function','count','146721xcomuD','@nestjs/typeorm','./access.entity','90MZJsIJ','handleUpdateStatus','管理员不存在，请核对','getOne','managerStatus','__metadata','HttpStatus','parse','find','length','catch','get','991209WFsKmN','update','password','getUserById','forEach','userId','metadata','setManagerDelete','object','handleManagerUpdate','queryManagerAccess','assign','InjectRepository','1331628Cnapuu','管理员已存在','../../common/utils','HttpException','decorate','分页参数错误','handleResetPassword','__esModule','log','stringify','flat','delete','accessLabel','123456','3541856JrIenW','defineProperty','design:paramtypes'];_0xcd7f=function(){return _0x266d50;};return _0xcd7f();}function _0x1bc2(_0x499554,_0xe6e57d){const _0xcd7f4e=_0xcd7f();return _0x1bc2=function(_0x1bc287,_0x3e96f1){_0x1bc287=_0x1bc287-0x12c;let _0x5f2cc1=_0xcd7f4e[_0x1bc287];return _0x5f2cc1;},_0x1bc2(_0x499554,_0xe6e57d);}var __decorate=this&&this[_0x4ad349(0x14e)]||function(_0x1182c3,_0x221a93,_0x5a6c77,_0x3f9ac9){const _0x2c355c=_0x4ad349;var _0x1acc7=arguments['length'],_0x52fe50=_0x1acc7<0x3?_0x221a93:_0x3f9ac9===null?_0x3f9ac9=Object[_0x2c355c(0x167)](_0x221a93,_0x5a6c77):_0x3f9ac9,_0x4c23b7;if(typeof Reflect===_0x2c355c(0x12e)&&typeof Reflect[_0x2c355c(0x137)]==='function')_0x52fe50=Reflect[_0x2c355c(0x137)](_0x1182c3,_0x221a93,_0x5a6c77,_0x3f9ac9);else{for(var _0xcbf0ee=_0x1182c3[_0x2c355c(0x178)]-0x1;_0xcbf0ee>=0x0;_0xcbf0ee--)if(_0x4c23b7=_0x1182c3[_0xcbf0ee])_0x52fe50=(_0x1acc7<0x3?_0x4c23b7(_0x52fe50):_0x1acc7>0x3?_0x4c23b7(_0x221a93,_0x5a6c77,_0x52fe50):_0x4c23b7(_0x221a93,_0x5a6c77))||_0x52fe50;}return _0x1acc7>0x3&&_0x52fe50&&Object[_0x2c355c(0x142)](_0x221a93,_0x5a6c77,_0x52fe50),_0x52fe50;},__metadata=this&&this[_0x4ad349(0x174)]||function(_0xb23a58,_0x5aa16e){const _0x42b37b=_0x4ad349;if(typeof Reflect===_0x42b37b(0x12e)&&typeof Reflect['metadata']===_0x42b37b(0x16a))return Reflect[_0x42b37b(0x12c)](_0xb23a58,_0x5aa16e);},__param=this&&this['__param']||function(_0x3a88a6,_0x4cc311){return function(_0x953e18,_0x475839){_0x4cc311(_0x953e18,_0x475839,_0x3a88a6);};};Object[_0x4ad349(0x142)](exports,_0x4ad349(0x13a),{'value':!![]}),exports[_0x4ad349(0x157)]=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require(_0x4ad349(0x16d)),access_entity_1=require(_0x4ad349(0x16e)),typeorm_2=require(_0x4ad349(0x150)),user_service_1=require('../user/user.service'),utils_1=require(_0x4ad349(0x135));let AccessService=class AccessService{constructor(_0x496474,_0x5b5e4e){const _0x22f11c=_0x4ad349;this[_0x22f11c(0x14f)]=_0x496474,this['userService']=_0x5b5e4e,this[_0x22f11c(0x147)]=new Map(),this[_0x22f11c(0x147)][_0x22f11c(0x15b)]();}async[_0x4ad349(0x172)](_0x14d7a0){const _0x4b3eb0=_0x4ad349;return await this[_0x4b3eb0(0x14f)][_0x4b3eb0(0x162)]({'where':{'userId':_0x14d7a0}});}async[_0x4ad349(0x158)](_0xadae15){const _0x129496=_0x4ad349,{id:_0x5585e5}=_0xadae15;if(!_0x5585e5)throw new common_1[(_0x129496(0x136))]('参数错误',common_1[_0x129496(0x175)]['BAD_REQUEST']);const _0x335d99=await this[_0x129496(0x14c)][_0x129496(0x17e)](_0x5585e5);if(!_0x335d99)throw new common_1[(_0x129496(0x136))](_0x129496(0x15a),common_1[_0x129496(0x175)][_0x129496(0x146)]);const _0x459f0d=await this[_0x129496(0x14f)][_0x129496(0x162)]({'where':{'userId':_0x335d99['id']}});if(!_0x459f0d)throw new common_1[(_0x129496(0x136))]('管理员不存在',common_1[_0x129496(0x175)]['BAD_REQUEST']);const {role:_0x1d7354,username:_0x3e26ad}=_0x335d99;return{..._0x459f0d,'role':_0x1d7354,'password':_0x335d99[_0x129496(0x17d)],'username':_0x3e26ad,'id':_0x335d99['id']};}async[_0x4ad349(0x130)](_0x596074,_0x43ee55){const _0x1a96ba=_0x4ad349,{page:page=0x1,size:size=0xa,username:_0x1cf940,status:_0x3f7eae,phone:_0x3d3316}=_0x596074;if(!page||!size)throw new common_1[(_0x1a96ba(0x136))](_0x1a96ba(0x138),0x190);const _0x27c00a={'userType':0x1};if(_0x1cf940){const {rows:_0x4d3105}=await this[_0x1a96ba(0x14c)]['queryByPage']({'page':page,'size':size,'username':_0x1cf940,'email':'','status':0x0,'keyword':'','phone':_0x3d3316}),_0x6f35d8=_0x4d3105[_0x1a96ba(0x14b)](_0x7f4b=>_0x7f4b['id']),_0x3bbe13=await this[_0x1a96ba(0x14f)]['findBy']({'userId':(0x0,typeorm_2['In'])(_0x6f35d8)}),_0x1aad20=new Map();_0x4d3105[_0x1a96ba(0x17f)](_0x1a8d0d=>{const _0x37d9bd=_0x1a96ba;_0x1aad20[_0x37d9bd(0x156)](_0x1a8d0d['id'],_0x1a8d0d);});const _0x8e316a=_0x3bbe13[_0x1a96ba(0x14b)](_0x585bd4=>Object['assign']({},_0x585bd4,_0x1aad20[_0x1a96ba(0x17a)](_0x585bd4[_0x1a96ba(0x180)])));let _0x4b6492=_0x3f7eae>0x0?_0x8e316a[_0x1a96ba(0x159)](_0x2a783b=>_0x2a783b['managerStatus']===_0x3f7eae):_0x8e316a;return{'rows':_0x4b6492||[],'count':_0x4b6492['length']||0x0};}[0x1,0x2,'1','2']['includes'](_0x3f7eae)&&(_0x27c00a[_0x1a96ba(0x173)]=_0x3f7eae);const [_0x110013,_0x44d928]=await this[_0x1a96ba(0x14f)][_0x1a96ba(0x148)]({'skip':(page-0x1)*size,'where':_0x27c00a,'take':size,'order':{'createdAt':_0x1a96ba(0x160)},'cache':!![],'select':['managerStatus','userId','accessLabel','id']}),_0xf986dc=_0x110013['map'](_0x188271=>_0x188271['userId']),_0x44a549=await this[_0x1a96ba(0x14c)]['queryUserInfoByIds'](_0xf986dc);_0x44a549[_0x1a96ba(0x17f)](_0x3e6524=>this[_0x1a96ba(0x147)][_0x1a96ba(0x156)](_0x3e6524['id'],_0x3e6524));const _0x4dd486=_0x110013['map'](_0x1a5203=>{const _0x3b2160=_0x1a96ba,_0x33f8ec=this['userMap'][_0x3b2160(0x17a)](_0x1a5203[_0x3b2160(0x180)]);return Object[_0x3b2160(0x131)]({},_0x33f8ec,_0x1a5203);});return{'rows':_0x4dd486||[],'count':_0x44d928||0x0};}async['queryAccessByIds'](_0x6452d0){const _0xe9faf0=_0x4ad349;return await this['accessEntity'][_0xe9faf0(0x177)]({'where':{'userId':(0x0,typeorm_2['In'])(_0x6452d0)},'select':['id',_0xe9faf0(0x13f),'createdAt',_0xe9faf0(0x180)]});}async[_0x4ad349(0x152)](){const _0x3b870d=_0x4ad349;return await this[_0x3b870d(0x14f)][_0x3b870d(0x16b)]();}async[_0x4ad349(0x12d)](_0x38059f){const _0x1eeef9=_0x4ad349,{id:_0x8e9709}=_0x38059f,_0x296e67=await this[_0x1eeef9(0x14f)][_0x1eeef9(0x162)]({'where':{'id':_0x8e9709}}),_0x47b13d=await this[_0x1eeef9(0x14c)]['delUser']({'id':_0x296e67['userId'],'moreId':0x0});if(_0x47b13d)return this[_0x1eeef9(0x14f)][_0x1eeef9(0x13e)]({'id':_0x8e9709});return![];}async['handleManagerAdd'](_0x585c41){const _0x422adf=_0x4ad349,{username:_0x1a14d3,access:_0x4506e3,role:_0x21a61b,password:_0x24f4c9}=_0x585c41,_0x1aba49=await this['userService'][_0x422adf(0x14d)](_0x1a14d3);if(_0x1aba49&&(0x0,utils_1['comparePassword'])(_0x1a14d3,_0x1aba49[_0x422adf(0x17d)]))throw new common_1['HttpException'](_0x422adf(0x134),common_1[_0x422adf(0x175)][_0x422adf(0x146)]);const _0x4fb03d=(0x0,utils_1[_0x422adf(0x145)])(_0x24f4c9),_0x4c031a=(0x0,utils_1['createRandomUid'])()+'@manager.com',_0x215564=await this[_0x422adf(0x14c)][_0x422adf(0x15c)]({'email':_0x4c031a,'username':_0x1a14d3,'status':0x1,'password':_0x4fb03d,'sex':0x1,'role':_0x21a61b});if(!_0x215564)throw new common_1[(_0x422adf(0x136))](_0x422adf(0x161),common_1[_0x422adf(0x175)][_0x422adf(0x146)]);try{const _0x164a70=_0x4506e3['length']&&JSON['parse'](_0x4506e3)[_0x422adf(0x14b)](_0x159d44=>_0x159d44[_0x422adf(0x169)])[_0x422adf(0x13d)](),_0x5bebf8=await this[_0x422adf(0x155)]({'userType':0x1,'access':_0x4506e3,'userId':_0x215564['id'],'accessLabel':_0x164a70[_0x422adf(0x178)]?_0x164a70:''});return!!_0x5bebf8;}catch(_0x422e5e){console[_0x422adf(0x13b)](_0x422adf(0x163),_0x422e5e);throw new common_1[(_0x422adf(0x136))](_0x422e5e,common_1[_0x422adf(0x175)]['BAD_REQUEST']);}}async[_0x4ad349(0x155)](_0x40393e){const _0xceccb7=_0x4ad349,{userType:_0x269052,access:_0xc186e6,userId:_0x4f7dc2,accessLabel:_0x54ebc7}=_0x40393e;return await this['accessEntity'][_0xceccb7(0x15f)]({'userType':_0x269052,'access':_0xc186e6,'userId':_0x4f7dc2,'accessLabel':_0x54ebc7&&JSON['stringify'](_0x54ebc7)||''});}async[_0x4ad349(0x12f)](_0x2e3090){const _0x394ca8=_0x4ad349,{id:_0x593a64,userId:_0x18ebfa,access:_0x499343}=_0x2e3090,_0x15cef1=await this[_0x394ca8(0x14c)][_0x394ca8(0x149)]({'id':_0x18ebfa});if(!_0x15cef1)throw new common_1[(_0x394ca8(0x136))](_0x394ca8(0x171),common_1[_0x394ca8(0x175)][_0x394ca8(0x15d)]);try{const _0x5ab080=_0x499343[_0x394ca8(0x178)]&&JSON[_0x394ca8(0x176)](_0x499343)[_0x394ca8(0x14b)](_0x41e4e0=>_0x41e4e0[_0x394ca8(0x169)])[_0x394ca8(0x13d)](),_0x327205=await this[_0x394ca8(0x14f)]['update']({'userId':_0x15cef1['id']},{'userId':_0x18ebfa,'access':_0x499343,'accessLabel':_0x5ab080&&JSON[_0x394ca8(0x13c)](_0x5ab080)||''})[_0x394ca8(0x179)](_0x4570a3=>{throw _0x4570a3;});return!!_0x327205;}catch(_0xe8bbd3){return console[_0x394ca8(0x13b)](_0xe8bbd3),![];}}async[_0x4ad349(0x170)](_0x4ffb45){const _0x6d53ed=_0x4ad349,{id:_0x38f3e8,status:_0x3168d0}=_0x4ffb45,_0x2a9718=await this[_0x6d53ed(0x14f)][_0x6d53ed(0x17c)](_0x38f3e8,{'managerStatus':_0x3168d0});return _0x2a9718[_0x6d53ed(0x154)]>0x0;}async[_0x4ad349(0x139)](_0x1d36d0){const _0xdf6990=_0x4ad349,{id:_0xe76067}=_0x1d36d0,_0xaf92fd=_0xdf6990(0x140),_0x30a7ae=await this[_0xdf6990(0x14f)][_0xdf6990(0x162)]({'where':{'id':_0xe76067}});return this['userService'][_0xdf6990(0x168)](_0x30a7ae[_0xdf6990(0x180)],_0xaf92fd);}};AccessService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x4ad349(0x132)])(access_entity_1[_0x4ad349(0x164)])),__metadata(_0x4ad349(0x143),[typeorm_2['Repository'],user_service_1[_0x4ad349(0x153)]])],AccessService),exports['AccessService']=AccessService;