'use strict';function _0x5b81(_0x5a2cc0,_0x2e4b64){const _0x10c451=_0x10c4();return _0x5b81=function(_0x5b8161,_0x312c46){_0x5b8161=_0x5b8161-0x10d;let _0x51e380=_0x10c451[_0x5b8161];return _0x51e380;},_0x5b81(_0x5a2cc0,_0x2e4b64);}const _0x280b15=_0x5b81;(function(_0x22b487,_0x1f6bd2){const _0x27163a=_0x5b81,_0x307ecb=_0x22b487();while(!![]){try{const _0xd6d6e1=-parseInt(_0x27163a(0x124))/0x1+-parseInt(_0x27163a(0x11c))/0x2+parseInt(_0x27163a(0x120))/0x3*(-parseInt(_0x27163a(0x139))/0x4)+parseInt(_0x27163a(0x157))/0x5*(-parseInt(_0x27163a(0x12e))/0x6)+parseInt(_0x27163a(0x132))/0x7*(parseInt(_0x27163a(0x14d))/0x8)+parseInt(_0x27163a(0x113))/0x9+parseInt(_0x27163a(0x145))/0xa;if(_0xd6d6e1===_0x1f6bd2)break;else _0x307ecb['push'](_0x307ecb['shift']());}catch(_0x5a41e7){_0x307ecb['push'](_0x307ecb['shift']());}}}(_0x10c4,0xc7b5a));var __decorate=this&&this[_0x280b15(0x15c)]||function(_0xf44a24,_0x47d8d3,_0x3924c4,_0x5885c2){const _0x49235a=_0x280b15;var _0x59452e=arguments['length'],_0x170db1=_0x59452e<0x3?_0x47d8d3:_0x5885c2===null?_0x5885c2=Object['getOwnPropertyDescriptor'](_0x47d8d3,_0x3924c4):_0x5885c2,_0xb2855;if(typeof Reflect==='object'&&typeof Reflect[_0x49235a(0x14f)]===_0x49235a(0x156))_0x170db1=Reflect[_0x49235a(0x14f)](_0xf44a24,_0x47d8d3,_0x3924c4,_0x5885c2);else{for(var _0x132498=_0xf44a24[_0x49235a(0x15b)]-0x1;_0x132498>=0x0;_0x132498--)if(_0xb2855=_0xf44a24[_0x132498])_0x170db1=(_0x59452e<0x3?_0xb2855(_0x170db1):_0x59452e>0x3?_0xb2855(_0x47d8d3,_0x3924c4,_0x170db1):_0xb2855(_0x47d8d3,_0x3924c4))||_0x170db1;}return _0x59452e>0x3&&_0x170db1&&Object[_0x49235a(0x14c)](_0x47d8d3,_0x3924c4,_0x170db1),_0x170db1;},__metadata=this&&this[_0x280b15(0x151)]||function(_0x5c0461,_0x203897){const _0x4afeb1=_0x280b15;if(typeof Reflect===_0x4afeb1(0x137)&&typeof Reflect[_0x4afeb1(0x135)]===_0x4afeb1(0x156))return Reflect[_0x4afeb1(0x135)](_0x5c0461,_0x203897);},__param=this&&this[_0x280b15(0x123)]||function(_0x3ecafb,_0x3bc093){return function(_0x2ed3a2,_0x2dee50){_0x3bc093(_0x2ed3a2,_0x2dee50,_0x3ecafb);};};function _0x10c4(){const _0x7af891=['object','管理员不存在，请核对','4ztseTi','DESC','accessLabel','catch','clear','handleResetPassword','managerStatus','BAD_REQUEST','find','InjectRepository','typeorm','get','26792250fUNkru','UserService','userId','getOne','log','getUserById','HttpStatus','defineProperty','88fVMEiy','design:paramtypes','decorate','GONE','__metadata','findOne','flat','includes','../../common/utils','function','87095QNvCEy','handleManagerAdd','accessEntity','@manager.com','length','__decorate','HttpException','__esModule','checked','@nestjs/common','queryByPage','Repository','handleSaveAccess','assign','forEach','5789619sbMybV','queryUserInfoByIds','map','userService','queryOne','userMap','stringify','comparePassword','queryManagerAccess','1271158GbjraZ','filter','count','用户不存在','983829oAlPlW','delete','queryUserByUsername','__param','1223205soFsyM','../user/user.service','queryAccessByIds','getManagerAccess','管理员已存在','123456','createUser','parse','findBy','handleManagerUpdate','132Qeuxrj','管理员不存在','AccessService','createPsd','41643NvFsxt','error:\x20','createRandomUid','metadata','Injectable'];_0x10c4=function(){return _0x7af891;};return _0x10c4();}Object['defineProperty'](exports,_0x280b15(0x15e),{'value':!![]}),exports[_0x280b15(0x130)]=void 0x0;const common_1=require(_0x280b15(0x10d)),typeorm_1=require('@nestjs/typeorm'),access_entity_1=require('./access.entity'),typeorm_2=require(_0x280b15(0x143)),user_service_1=require(_0x280b15(0x125)),utils_1=require(_0x280b15(0x155));let AccessService=class AccessService{constructor(_0x35a087,_0x5114e4){const _0x5acb5d=_0x280b15;this[_0x5acb5d(0x159)]=_0x35a087,this[_0x5acb5d(0x116)]=_0x5114e4,this[_0x5acb5d(0x118)]=new Map(),this['userMap'][_0x5acb5d(0x13d)]();}async[_0x280b15(0x148)](_0x2597cd){const _0x2319e4=_0x280b15;return await this[_0x2319e4(0x159)][_0x2319e4(0x152)]({'where':{'userId':_0x2597cd}});}async[_0x280b15(0x127)](_0xcda0d7){const _0x28b524=_0x280b15,{id:_0x2e2801}=_0xcda0d7;if(!_0x2e2801)throw new common_1['HttpException']('参数错误',common_1[_0x28b524(0x14b)][_0x28b524(0x140)]);const _0x575349=await this[_0x28b524(0x116)][_0x28b524(0x14a)](_0x2e2801);if(!_0x575349)throw new common_1['HttpException'](_0x28b524(0x11f),common_1['HttpStatus'][_0x28b524(0x140)]);const _0x148f9a=await this[_0x28b524(0x159)][_0x28b524(0x152)]({'where':{'userId':_0x575349['id']}});if(!_0x148f9a)throw new common_1[(_0x28b524(0x15d))](_0x28b524(0x12f),common_1[_0x28b524(0x14b)][_0x28b524(0x140)]);const {role:_0x2a280c,username:_0x1b22b0}=_0x575349;return{..._0x148f9a,'role':_0x2a280c,'password':_0x575349['password'],'username':_0x1b22b0,'id':_0x575349['id']};}async[_0x280b15(0x11b)](_0x41bd4b,_0x5edc25){const _0x5a5c2d=_0x280b15,{page:page=0x1,size:size=0xa,username:_0x547de7,status:_0x5c6957,phone:_0x331d8a}=_0x41bd4b;if(!page||!size)throw new common_1[(_0x5a5c2d(0x15d))]('分页参数错误',0x190);const _0x4b7310={'userType':0x1};if(_0x547de7){const {rows:_0x1c5d55}=await this[_0x5a5c2d(0x116)][_0x5a5c2d(0x10e)]({'page':page,'size':size,'username':_0x547de7,'email':'','status':0x0,'keyword':'','phone':_0x331d8a}),_0xfb2019=_0x1c5d55[_0x5a5c2d(0x115)](_0x4b0af2=>_0x4b0af2['id']),_0x51211e=await this['accessEntity'][_0x5a5c2d(0x12c)]({'userId':(0x0,typeorm_2['In'])(_0xfb2019)}),_0x3e6eb0=new Map();_0x1c5d55[_0x5a5c2d(0x112)](_0x53f308=>{_0x3e6eb0['set'](_0x53f308['id'],_0x53f308);});const _0x5ee2a3=_0x51211e[_0x5a5c2d(0x115)](_0x46a099=>Object[_0x5a5c2d(0x111)]({},_0x46a099,_0x3e6eb0[_0x5a5c2d(0x144)](_0x46a099[_0x5a5c2d(0x147)])));let _0x13c6a3=_0x5c6957>0x0?_0x5ee2a3[_0x5a5c2d(0x11d)](_0x5b944a=>_0x5b944a['managerStatus']===_0x5c6957):_0x5ee2a3;return{'rows':_0x13c6a3||[],'count':_0x13c6a3[_0x5a5c2d(0x15b)]||0x0};}[0x1,0x2,'1','2'][_0x5a5c2d(0x154)](_0x5c6957)&&(_0x4b7310[_0x5a5c2d(0x13f)]=_0x5c6957);const [_0x125e37,_0x1543de]=await this[_0x5a5c2d(0x159)]['findAndCount']({'skip':(page-0x1)*size,'where':_0x4b7310,'take':size,'order':{'createdAt':_0x5a5c2d(0x13a)},'cache':!![],'select':[_0x5a5c2d(0x13f),_0x5a5c2d(0x147),'accessLabel','id']}),_0x4d3154=_0x125e37[_0x5a5c2d(0x115)](_0x13069a=>_0x13069a[_0x5a5c2d(0x147)]),_0x100522=await this[_0x5a5c2d(0x116)][_0x5a5c2d(0x114)](_0x4d3154);_0x100522[_0x5a5c2d(0x112)](_0x5051a6=>this[_0x5a5c2d(0x118)]['set'](_0x5051a6['id'],_0x5051a6));const _0x127eb1=_0x125e37[_0x5a5c2d(0x115)](_0x4d8f89=>{const _0x4ffe65=_0x5a5c2d,_0x3ee1eb=this['userMap'][_0x4ffe65(0x144)](_0x4d8f89['userId']);return Object[_0x4ffe65(0x111)]({},_0x3ee1eb,_0x4d8f89);});return{'rows':_0x127eb1||[],'count':_0x1543de||0x0};}async[_0x280b15(0x126)](_0x3a944e){const _0x34acdb=_0x280b15;return await this[_0x34acdb(0x159)][_0x34acdb(0x141)]({'where':{'userId':(0x0,typeorm_2['In'])(_0x3a944e)},'select':['id',_0x34acdb(0x13b),'createdAt',_0x34acdb(0x147)]});}async['queryAccessCount'](){const _0x456867=_0x280b15;return await this[_0x456867(0x159)][_0x456867(0x11e)]();}async['setManagerDelete'](_0x187f6b){const _0x27bae9=_0x280b15,{id:_0xccde19}=_0x187f6b,_0x19909a=await this[_0x27bae9(0x159)]['findOne']({'where':{'id':_0xccde19}}),_0x586560=await this[_0x27bae9(0x116)]['delUser']({'id':_0x19909a[_0x27bae9(0x147)],'moreId':0x0});if(_0x586560)return this['accessEntity'][_0x27bae9(0x121)]({'id':_0xccde19});return![];}async[_0x280b15(0x158)](_0x79430d){const _0x411012=_0x280b15,{username:_0x38c19b,access:_0x38a926,role:_0x1acaef,password:_0x2a3d9f}=_0x79430d,_0x14619c=await this['userService'][_0x411012(0x122)](_0x38c19b);if(_0x14619c&&(0x0,utils_1[_0x411012(0x11a)])(_0x38c19b,_0x14619c['password']))throw new common_1[(_0x411012(0x15d))](_0x411012(0x128),common_1[_0x411012(0x14b)][_0x411012(0x140)]);const _0x7b72cd=(0x0,utils_1[_0x411012(0x131)])(_0x2a3d9f),_0xbb7c8f=(0x0,utils_1[_0x411012(0x134)])()+_0x411012(0x15a),_0xc3a073=await this[_0x411012(0x116)][_0x411012(0x12a)]({'email':_0xbb7c8f,'username':_0x38c19b,'status':0x1,'password':_0x7b72cd,'sex':0x1,'role':_0x1acaef});if(!_0xc3a073)throw new common_1['HttpException']('添加管理员失败',common_1[_0x411012(0x14b)][_0x411012(0x140)]);try{const _0x599976=_0x38a926[_0x411012(0x15b)]&&JSON[_0x411012(0x12b)](_0x38a926)['map'](_0x51f826=>_0x51f826['checked'])[_0x411012(0x153)](),_0x3e839e=await this[_0x411012(0x110)]({'userType':0x1,'access':_0x38a926,'userId':_0xc3a073['id'],'accessLabel':_0x599976[_0x411012(0x15b)]?_0x599976:''});return!!_0x3e839e;}catch(_0x405c58){console[_0x411012(0x149)](_0x411012(0x133),_0x405c58);throw new common_1['HttpException'](_0x405c58,common_1['HttpStatus'][_0x411012(0x140)]);}}async[_0x280b15(0x110)](_0x53a107){const _0x324758=_0x280b15,{userType:_0x2572bc,access:_0x15bd3b,userId:_0x32ecf1,accessLabel:_0x284ad9}=_0x53a107;return await this[_0x324758(0x159)]['save']({'userType':_0x2572bc,'access':_0x15bd3b,'userId':_0x32ecf1,'accessLabel':_0x284ad9&&JSON[_0x324758(0x119)](_0x284ad9)||''});}async[_0x280b15(0x12d)](_0x14d3e6){const _0x4a1e4e=_0x280b15,{id:_0x180c82,userId:_0x2938ee,access:_0x475b4e}=_0x14d3e6,_0x3aa9fe=await this[_0x4a1e4e(0x116)][_0x4a1e4e(0x117)]({'id':_0x2938ee});if(!_0x3aa9fe)throw new common_1['HttpException'](_0x4a1e4e(0x138),common_1[_0x4a1e4e(0x14b)][_0x4a1e4e(0x150)]);try{const _0xad6af0=_0x475b4e[_0x4a1e4e(0x15b)]&&JSON[_0x4a1e4e(0x12b)](_0x475b4e)[_0x4a1e4e(0x115)](_0x32282c=>_0x32282c[_0x4a1e4e(0x15f)])[_0x4a1e4e(0x153)](),_0x46a5e5=await this[_0x4a1e4e(0x159)]['update']({'userId':_0x3aa9fe['id']},{'userId':_0x2938ee,'access':_0x475b4e,'accessLabel':_0xad6af0&&JSON['stringify'](_0xad6af0)||''})[_0x4a1e4e(0x13c)](_0x2d8e1d=>{throw _0x2d8e1d;});return!!_0x46a5e5;}catch(_0x474bcf){return console['log'](_0x474bcf),![];}}async['handleUpdateStatus'](_0x16b4f9){const {id:_0x3bde11,status:_0xf07b64}=_0x16b4f9,_0x379d67=await this['accessEntity']['update'](_0x3bde11,{'managerStatus':_0xf07b64});return _0x379d67['affected']>0x0;}async[_0x280b15(0x13e)](_0x1fb28e){const _0x4105cb=_0x280b15,{id:_0x1777ef}=_0x1fb28e,_0xd96189=_0x4105cb(0x129),_0x1bfdaf=await this['accessEntity'][_0x4105cb(0x152)]({'where':{'id':_0x1777ef}});return this[_0x4105cb(0x116)]['updateUserPassword'](_0x1bfdaf['userId'],_0xd96189);}};AccessService=__decorate([(0x0,common_1[_0x280b15(0x136)])(),__param(0x0,(0x0,typeorm_1[_0x280b15(0x142)])(access_entity_1['AccessEntity'])),__metadata(_0x280b15(0x14e),[typeorm_2[_0x280b15(0x10f)],user_service_1[_0x280b15(0x146)]])],AccessService),exports[_0x280b15(0x130)]=AccessService;