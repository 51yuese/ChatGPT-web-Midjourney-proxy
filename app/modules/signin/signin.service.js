'use strict';const _0x42a2e1=_0x3230;(function(_0x5a0d86,_0x31591b){const _0x221073=_0x3230,_0x16601d=_0x5a0d86();while(!![]){try{const _0x1f491f=-parseInt(_0x221073(0xad))/0x1*(parseInt(_0x221073(0xcf))/0x2)+-parseInt(_0x221073(0xe5))/0x3*(parseInt(_0x221073(0xb1))/0x4)+parseInt(_0x221073(0xba))/0x5*(parseInt(_0x221073(0xd0))/0x6)+-parseInt(_0x221073(0xa4))/0x7+-parseInt(_0x221073(0xc1))/0x8+-parseInt(_0x221073(0xb8))/0x9*(parseInt(_0x221073(0xa1))/0xa)+parseInt(_0x221073(0xb9))/0xb;if(_0x1f491f===_0x31591b)break;else _0x16601d['push'](_0x16601d['shift']());}catch(_0x903508){_0x16601d['push'](_0x16601d['shift']());}}}(_0x3ca2,0xc7b28));var __decorate=this&&this[_0x42a2e1(0xea)]||function(_0x1f7c15,_0x206d6d,_0x58feaf,_0x17a834){const _0x2cef5e=_0x42a2e1;var _0x345d72=arguments[_0x2cef5e(0xda)],_0x3d49f8=_0x345d72<0x3?_0x206d6d:_0x17a834===null?_0x17a834=Object['getOwnPropertyDescriptor'](_0x206d6d,_0x58feaf):_0x17a834,_0x284a81;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x3d49f8=Reflect[_0x2cef5e(0xc8)](_0x1f7c15,_0x206d6d,_0x58feaf,_0x17a834);else{for(var _0x3637bd=_0x1f7c15[_0x2cef5e(0xda)]-0x1;_0x3637bd>=0x0;_0x3637bd--)if(_0x284a81=_0x1f7c15[_0x3637bd])_0x3d49f8=(_0x345d72<0x3?_0x284a81(_0x3d49f8):_0x345d72>0x3?_0x284a81(_0x206d6d,_0x58feaf,_0x3d49f8):_0x284a81(_0x206d6d,_0x58feaf))||_0x3d49f8;}return _0x345d72>0x3&&_0x3d49f8&&Object['defineProperty'](_0x206d6d,_0x58feaf,_0x3d49f8),_0x3d49f8;},__metadata=this&&this['__metadata']||function(_0x3f23e6,_0x508de2){const _0x325f37=_0x42a2e1;if(typeof Reflect===_0x325f37(0xab)&&typeof Reflect['metadata']===_0x325f37(0xeb))return Reflect[_0x325f37(0x9f)](_0x3f23e6,_0x508de2);},__param=this&&this[_0x42a2e1(0xaa)]||function(_0x3306e5,_0x42e6aa){return function(_0x4a7429,_0x497089){_0x42e6aa(_0x4a7429,_0x497089,_0x3306e5);};};function _0x3230(_0x46b0cd,_0x39ac01){const _0x3ca273=_0x3ca2();return _0x3230=function(_0x3230d4,_0x1dc7e7){_0x3230d4=_0x3230d4-0x9d;let _0x3004e1=_0x3ca273[_0x3230d4];return _0x3004e1;},_0x3230(_0x46b0cd,_0x39ac01);}function _0x3ca2(){const _0x9fbb67=['userEntity','UserEntity','昨天签到了、今天是连续签到！','7305040tGpNYK','day','user','getRawMany','../../common/utils/date','./../globalConfig/globalConfig.service','subtract','decorate','design:paramtypes','../user/user.entity','YYYY-MM-DD\x20HH:mm:ss','getDate','setDate','./../userBalance/userBalance.service','14fWWIGG','84DzwujC','signin.signInTime\x20>=\x20:firstDay','HttpStatus','andWhere','Injectable','SigninService','InjectRepository','endOf','YYYY-MM-DD','isSigned','length','Sign\x20in\x20successful.','getSignatureGiftConfig','BAD_REQUEST','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','signin','format','push','default','addBalanceToUser','error:\x20','231JDnOXd','findOne','__esModule','globalConfigService','getSigninLog','__decorate','function','获取签到数据失败！','update','metadata','@nestjs/common','20TWeKDP','Logger','signin.userId\x20=\x20:userId','3602270fLRdJm','./signIn.entity','defineProperty','month','typeorm','find','__param','object','UserBalanceService','71985EjpWDd','createQueryBuilder','GlobalConfigService','select','82024kxUdKC','signin.signInTime\x20<=\x20:lastDay','signinEntity','HttpException','log','SigninEntity','userBalanceService','5776731lodOON','47316159PAXRiJ','468145FTzuzG','Repository','debug','save'];_0x3ca2=function(){return _0x9fbb67;};return _0x3ca2();}Object[_0x42a2e1(0xa6)](exports,_0x42a2e1(0xe7),{'value':!![]}),exports[_0x42a2e1(0xd5)]=void 0x0;const globalConfig_service_1=require(_0x42a2e1(0xc6)),userBalance_service_1=require(_0x42a2e1(0xce)),common_1=require(_0x42a2e1(0xa0)),signIn_entity_1=require(_0x42a2e1(0xa5)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x42a2e1(0xa8)),date_1=require(_0x42a2e1(0xc5)),user_entity_1=require(_0x42a2e1(0xca)),balance_constant_1=require('../../common/constants/balance.constant');let SigninService=class SigninService{constructor(_0x49fc9e,_0x424dc8,_0x3746fd,_0x152153){const _0x1e047e=_0x42a2e1;this[_0x1e047e(0xb3)]=_0x49fc9e,this[_0x1e047e(0xbe)]=_0x424dc8,this[_0x1e047e(0xb7)]=_0x3746fd,this[_0x1e047e(0xe8)]=_0x152153;}async['sign'](_0x3caf8e){const _0x3840ee=_0x42a2e1,{id:_0x3a8951}=_0x3caf8e[_0x3840ee(0xc3)],_0x5d6098=(0x0,date_1[_0x3840ee(0xe2)])(new Date())['format'](_0x3840ee(0xd8)),_0x5a34f3=await this[_0x3840ee(0xb3)]['findOne']({'where':{'userId':_0x3a8951,'signInDate':_0x5d6098}});if(_0x5a34f3)throw new common_1[(_0x3840ee(0xb4))]('今日已签到、改天再来吧!.',common_1[_0x3840ee(0xd2)][_0x3840ee(0xdd)]);const {model3Count:_0x3ad617,model4Count:_0x520027,drawMjCount:_0x629147}=await this[_0x3840ee(0xe8)][_0x3840ee(0xdc)]();await this[_0x3840ee(0xb3)][_0x3840ee(0xbd)]({'userId':_0x3a8951,'signInTime':new Date(),'signInDate':_0x5d6098,'isSigned':!![]}),await this[_0x3840ee(0xb7)][_0x3840ee(0xe3)](_0x3a8951,{'model3Count':_0x3ad617,'model4Count':_0x520027,'drawMjCount':_0x629147}),await this[_0x3840ee(0xb7)]['saveRecordRechargeLog']({'userId':_0x3a8951,'rechargeType':balance_constant_1['RechargeType']['SIGN_IN'],'model3Count':_0x3ad617,'model4Count':_0x520027,'drawMjCount':_0x629147});const _0x1967aa=(0x0,date_1[_0x3840ee(0xe2)])(new Date())[_0x3840ee(0xc7)](0x1,_0x3840ee(0xc2))['format'](_0x3840ee(0xd8)),_0x384fa3=await this[_0x3840ee(0xb3)][_0x3840ee(0xe6)]({'where':{'userId':_0x3a8951,'signInDate':_0x1967aa}});if(_0x384fa3){common_1[_0x3840ee(0xa2)]['debug']('用户'+_0x3a8951+_0x3840ee(0xc0),_0x3840ee(0xd5));const _0x3fc7ab=await this[_0x3840ee(0xbe)][_0x3840ee(0xe6)]({'where':{'id':_0x3a8951}});if(!_0x3fc7ab)throw new common_1['HttpException']('用户不存在',common_1[_0x3840ee(0xd2)][_0x3840ee(0xdd)]);const {consecutiveDays:consecutiveDays=0x0}=_0x3fc7ab;await this[_0x3840ee(0xbe)][_0x3840ee(0x9e)]({'id':_0x3a8951},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x3840ee(0xa2)][_0x3840ee(0xbc)]('用户'+_0x3a8951+'昨天没签到、今天重置天数！',_0x3840ee(0xd5)),await this[_0x3840ee(0xbe)][_0x3840ee(0x9e)]({'id':_0x3a8951},{'consecutiveDays':0x1});return _0x3840ee(0xdb);}async[_0x42a2e1(0xe9)](_0x51bfc3){const _0x411659=_0x42a2e1;try{const {id:_0x261ee2}=_0x51bfc3[_0x411659(0xc3)],_0x50f498=(0x0,date_1[_0x411659(0xe2)])()['startOf'](_0x411659(0xa7))['format'](_0x411659(0xcb)),_0x302af6=(0x0,date_1['default'])()[_0x411659(0xd7)](_0x411659(0xa7))[_0x411659(0xe0)](_0x411659(0xcb)),_0x5d9e74=this[_0x411659(0xb3)][_0x411659(0xae)](_0x411659(0xdf)),_0x52177c=await _0x5d9e74[_0x411659(0xb0)](_0x411659(0xde))[_0x411659(0xd3)](_0x411659(0xa3),{'userId':_0x51bfc3[_0x411659(0xc3)]['id']})[_0x411659(0xd3)](_0x411659(0xd1),{'firstDay':_0x50f498})[_0x411659(0xd3)](_0x411659(0xb2),{'lastDay':_0x302af6})[_0x411659(0xc4)](),_0x1b96cb=new Date(_0x50f498),_0x5c24d6=new Date(_0x302af6),_0x2aa1db=[],_0x472d2d=new Date(_0x1b96cb);while(_0x472d2d<=_0x5c24d6){_0x2aa1db[_0x411659(0xe1)]((0x0,date_1[_0x411659(0xe2)])(new Date(_0x472d2d))[_0x411659(0xe0)]('YYYY-MM-DD')),_0x472d2d[_0x411659(0xcd)](_0x472d2d[_0x411659(0xcc)]()+0x1);}const _0xda3bf6=[];for(const _0x10c26c of _0x2aa1db){const _0x477fef=_0x52177c[_0x411659(0xa9)](_0x1e4673=>_0x1e4673['signInDate']===_0x10c26c);!_0x477fef?_0xda3bf6[_0x411659(0xe1)]({'signInDate':_0x10c26c,'isSigned':![]}):(_0x477fef[_0x411659(0xd9)]=!![],_0xda3bf6['push'](_0x477fef));}return _0xda3bf6;}catch(_0x4d7c40){console[_0x411659(0xb5)](_0x411659(0xe4),_0x4d7c40);throw new common_1[(_0x411659(0xb4))](_0x411659(0x9d),common_1[_0x411659(0xd2)]['BAD_REQUEST']);}}};SigninService=__decorate([(0x0,common_1[_0x42a2e1(0xd4)])(),__param(0x0,(0x0,typeorm_1[_0x42a2e1(0xd6)])(signIn_entity_1[_0x42a2e1(0xb6)])),__param(0x1,(0x0,typeorm_1[_0x42a2e1(0xd6)])(user_entity_1[_0x42a2e1(0xbf)])),__metadata(_0x42a2e1(0xc9),[typeorm_2[_0x42a2e1(0xbb)],typeorm_2[_0x42a2e1(0xbb)],userBalance_service_1[_0x42a2e1(0xac)],globalConfig_service_1[_0x42a2e1(0xaf)]])],SigninService),exports['SigninService']=SigninService;