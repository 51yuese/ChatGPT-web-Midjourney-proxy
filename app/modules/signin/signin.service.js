'use strict';const _0x47fef0=_0xc7ba;(function(_0x41cd5e,_0x853fb4){const _0x22c6da=_0xc7ba,_0x1dcfab=_0x41cd5e();while(!![]){try{const _0x7f45e7=-parseInt(_0x22c6da(0xb2))/0x1+-parseInt(_0x22c6da(0xd2))/0x2*(parseInt(_0x22c6da(0xde))/0x3)+parseInt(_0x22c6da(0xd6))/0x4*(-parseInt(_0x22c6da(0xdb))/0x5)+parseInt(_0x22c6da(0xe5))/0x6+-parseInt(_0x22c6da(0xc3))/0x7+-parseInt(_0x22c6da(0xe1))/0x8+-parseInt(_0x22c6da(0xba))/0x9*(-parseInt(_0x22c6da(0xeb))/0xa);if(_0x7f45e7===_0x853fb4)break;else _0x1dcfab['push'](_0x1dcfab['shift']());}catch(_0x2b584c){_0x1dcfab['push'](_0x1dcfab['shift']());}}}(_0x32eb,0xc39e7));function _0xc7ba(_0x5443aa,_0x4948f9){const _0x32eb39=_0x32eb();return _0xc7ba=function(_0xc7ba5c,_0x288bbc){_0xc7ba5c=_0xc7ba5c-0xac;let _0x1837e8=_0x32eb39[_0xc7ba5c];return _0x1837e8;},_0xc7ba(_0x5443aa,_0x4948f9);}var __decorate=this&&this[_0x47fef0(0xb9)]||function(_0x35eb8b,_0x7c2165,_0x3f7e3a,_0xe6ee34){const _0x5e6014=_0x47fef0;var _0x55cc97=arguments[_0x5e6014(0xae)],_0x547080=_0x55cc97<0x3?_0x7c2165:_0xe6ee34===null?_0xe6ee34=Object[_0x5e6014(0xcd)](_0x7c2165,_0x3f7e3a):_0xe6ee34,_0x3d7e47;if(typeof Reflect===_0x5e6014(0xd5)&&typeof Reflect[_0x5e6014(0xb7)]===_0x5e6014(0xcb))_0x547080=Reflect[_0x5e6014(0xb7)](_0x35eb8b,_0x7c2165,_0x3f7e3a,_0xe6ee34);else{for(var _0x24dc83=_0x35eb8b['length']-0x1;_0x24dc83>=0x0;_0x24dc83--)if(_0x3d7e47=_0x35eb8b[_0x24dc83])_0x547080=(_0x55cc97<0x3?_0x3d7e47(_0x547080):_0x55cc97>0x3?_0x3d7e47(_0x7c2165,_0x3f7e3a,_0x547080):_0x3d7e47(_0x7c2165,_0x3f7e3a))||_0x547080;}return _0x55cc97>0x3&&_0x547080&&Object[_0x5e6014(0xb0)](_0x7c2165,_0x3f7e3a,_0x547080),_0x547080;},__metadata=this&&this[_0x47fef0(0xda)]||function(_0x1eca6e,_0x55b42a){const _0x17b4ce=_0x47fef0;if(typeof Reflect===_0x17b4ce(0xd5)&&typeof Reflect[_0x17b4ce(0xc0)]===_0x17b4ce(0xcb))return Reflect[_0x17b4ce(0xc0)](_0x1eca6e,_0x55b42a);},__param=this&&this[_0x47fef0(0xe9)]||function(_0x50317a,_0x452273){return function(_0x36c76e,_0x6c7a81){_0x452273(_0x36c76e,_0x6c7a81,_0x50317a);};};Object['defineProperty'](exports,_0x47fef0(0xf0),{'value':!![]}),exports[_0x47fef0(0xd7)]=void 0x0;const globalConfig_service_1=require(_0x47fef0(0xf2)),userBalance_service_1=require(_0x47fef0(0xef)),common_1=require(_0x47fef0(0xdf)),signIn_entity_1=require(_0x47fef0(0xad)),typeorm_1=require(_0x47fef0(0xea)),typeorm_2=require(_0x47fef0(0xbd)),date_1=require(_0x47fef0(0xe3)),user_entity_1=require(_0x47fef0(0xca)),balance_constant_1=require('../../common/constants/balance.constant');let SigninService=class SigninService{constructor(_0x2ed313,_0x18ac02,_0xa18387,_0x41e241){const _0x3900c7=_0x47fef0;this[_0x3900c7(0xdc)]=_0x2ed313,this[_0x3900c7(0xaf)]=_0x18ac02,this[_0x3900c7(0xc6)]=_0xa18387,this['globalConfigService']=_0x41e241;}async['sign'](_0xc1e6a8){const _0x250f3a=_0x47fef0,{id:_0x1f7f0e}=_0xc1e6a8['user'],_0x4b70c5=(0x0,date_1[_0x250f3a(0xb1)])(new Date())['format']('YYYY-MM-DD'),_0x1bc23d=await this[_0x250f3a(0xdc)][_0x250f3a(0xec)]({'where':{'userId':_0x1f7f0e,'signInDate':_0x4b70c5}});if(_0x1bc23d)throw new common_1[(_0x250f3a(0xb3))](_0x250f3a(0xf6),common_1[_0x250f3a(0xbe)][_0x250f3a(0xdd)]);const {model3Count:_0x4134a2,model4Count:_0x280179,drawMjCount:_0xf6c5a9}=await this[_0x250f3a(0xf3)]['getSignatureGiftConfig']();await this[_0x250f3a(0xdc)]['save']({'userId':_0x1f7f0e,'signInTime':new Date(),'signInDate':_0x4b70c5,'isSigned':!![]}),await this['userBalanceService'][_0x250f3a(0xb5)](_0x1f7f0e,{'model3Count':_0x4134a2,'model4Count':_0x280179,'drawMjCount':_0xf6c5a9}),await this[_0x250f3a(0xc6)][_0x250f3a(0xb6)]({'userId':_0x1f7f0e,'rechargeType':balance_constant_1['RechargeType'][_0x250f3a(0xc4)],'model3Count':_0x4134a2,'model4Count':_0x280179,'drawMjCount':_0xf6c5a9});const _0x4fbd7a=(0x0,date_1[_0x250f3a(0xb1)])(new Date())['subtract'](0x1,'day')['format'](_0x250f3a(0xb8)),_0x15c604=await this['signinEntity']['findOne']({'where':{'userId':_0x1f7f0e,'signInDate':_0x4fbd7a}});if(_0x15c604){common_1[_0x250f3a(0xbc)][_0x250f3a(0xe8)]('用户'+_0x1f7f0e+_0x250f3a(0xe4),_0x250f3a(0xd7));const _0x239c05=await this['userEntity'][_0x250f3a(0xec)]({'where':{'id':_0x1f7f0e}});if(!_0x239c05)throw new common_1[(_0x250f3a(0xb3))](_0x250f3a(0xe6),common_1[_0x250f3a(0xbe)][_0x250f3a(0xdd)]);const {consecutiveDays:consecutiveDays=0x0}=_0x239c05;await this[_0x250f3a(0xaf)][_0x250f3a(0xc9)]({'id':_0x1f7f0e},{'consecutiveDays':consecutiveDays+0x1});}else common_1['Logger'][_0x250f3a(0xe8)]('用户'+_0x1f7f0e+_0x250f3a(0xc8),'SigninService'),await this[_0x250f3a(0xaf)]['update']({'id':_0x1f7f0e},{'consecutiveDays':0x1});return _0x250f3a(0xf1);}async['getSigninLog'](_0x209a80){const _0x48a145=_0x47fef0;try{const {id:_0x25bf13}=_0x209a80['user'],_0x4c70c6=(0x0,date_1['default'])()[_0x48a145(0xc5)](_0x48a145(0xce))[_0x48a145(0xed)](_0x48a145(0xd9)),_0x4e9e22=(0x0,date_1[_0x48a145(0xb1)])()[_0x48a145(0xd0)](_0x48a145(0xce))[_0x48a145(0xed)]('YYYY-MM-DD\x20HH:mm:ss'),_0x18d061=this[_0x48a145(0xdc)]['createQueryBuilder'](_0x48a145(0xd8)),_0x2088a9=await _0x18d061[_0x48a145(0xd3)](_0x48a145(0xd4))[_0x48a145(0xe0)]('signin.userId\x20=\x20:userId',{'userId':_0x209a80[_0x48a145(0xe2)]['id']})[_0x48a145(0xe0)](_0x48a145(0xbb),{'firstDay':_0x4c70c6})[_0x48a145(0xe0)]('signin.signInTime\x20<=\x20:lastDay',{'lastDay':_0x4e9e22})['getRawMany'](),_0x2b884c=new Date(_0x4c70c6),_0x409c98=new Date(_0x4e9e22),_0x3d7c41=[],_0x249fb8=new Date(_0x2b884c);while(_0x249fb8<=_0x409c98){_0x3d7c41[_0x48a145(0xe7)]((0x0,date_1[_0x48a145(0xb1)])(new Date(_0x249fb8))[_0x48a145(0xed)](_0x48a145(0xb8))),_0x249fb8[_0x48a145(0xb4)](_0x249fb8[_0x48a145(0xee)]()+0x1);}const _0x7182cd=[];for(const _0x490819 of _0x3d7c41){const _0x52ecb1=_0x2088a9[_0x48a145(0xf5)](_0x11c8b7=>_0x11c8b7[_0x48a145(0xcc)]===_0x490819);!_0x52ecb1?_0x7182cd[_0x48a145(0xe7)]({'signInDate':_0x490819,'isSigned':![]}):(_0x52ecb1[_0x48a145(0xac)]=!![],_0x7182cd[_0x48a145(0xe7)](_0x52ecb1));}return _0x7182cd;}catch(_0x2cfb73){console['log'](_0x48a145(0xd1),_0x2cfb73);throw new common_1['HttpException'](_0x48a145(0xcf),common_1[_0x48a145(0xbe)]['BAD_REQUEST']);}}};function _0x32eb(){const _0x13bf7d=['9219240dcJFnA','user','../../common/utils/date','昨天签到了、今天是连续签到！','3626022yMdAit','用户不存在','push','debug','__param','@nestjs/typeorm','2120ipppjg','findOne','format','getDate','./../userBalance/userBalance.service','__esModule','Sign\x20in\x20successful.','./../globalConfig/globalConfig.service','globalConfigService','GlobalConfigService','find','今日已签到、改天再来吧!.','isSigned','./signIn.entity','length','userEntity','defineProperty','default','1034064zNRbag','HttpException','setDate','addBalanceToUser','saveRecordRechargeLog','decorate','YYYY-MM-DD','__decorate','183861lueiww','signin.signInTime\x20>=\x20:firstDay','Logger','typeorm','HttpStatus','Injectable','metadata','UserBalanceService','InjectRepository','3076521msFWwF','SIGN_IN','startOf','userBalanceService','Repository','昨天没签到、今天重置天数！','update','../user/user.entity','function','signInDate','getOwnPropertyDescriptor','month','获取签到数据失败！','endOf','error:\x20','7386XnRTUS','select','signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned','object','12IwZOvR','SigninService','signin','YYYY-MM-DD\x20HH:mm:ss','__metadata','1128555oNDqyG','signinEntity','BAD_REQUEST','675pkhxsI','@nestjs/common','andWhere'];_0x32eb=function(){return _0x13bf7d;};return _0x32eb();}SigninService=__decorate([(0x0,common_1[_0x47fef0(0xbf)])(),__param(0x0,(0x0,typeorm_1[_0x47fef0(0xc2)])(signIn_entity_1['SigninEntity'])),__param(0x1,(0x0,typeorm_1[_0x47fef0(0xc2)])(user_entity_1['UserEntity'])),__metadata('design:paramtypes',[typeorm_2[_0x47fef0(0xc7)],typeorm_2[_0x47fef0(0xc7)],userBalance_service_1[_0x47fef0(0xc1)],globalConfig_service_1[_0x47fef0(0xf4)]])],SigninService),exports['SigninService']=SigninService;