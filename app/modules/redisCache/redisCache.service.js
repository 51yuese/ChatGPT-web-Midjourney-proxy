'use strict';function _0x111d(){const _0x574e22=['design:paramtypes','__metadata','Inject','__esModule','501690OIEXrO','get','onModuleInit','82494SrIogB','decorate','RedisCacheService','invalidateTokens','1467654BgBsep','set','44649gJPqhj','4rBpwJD','HttpException','getOwnPropertyDescriptor','@nestjs/common','tokens:','3598880bCQuxt','6224848bwQDtz','token:','25RAvpCY','HttpStatus','__decorate','forEach','user','4FPeIjK','object','zRange','del','20624ABOppr','admin','function','checkTokenAuth','10syIBPs','ttl','您已在其他设备覆盖登录、请您重新登录！','includes','redisClient','metadata','length','defineProperty','UNAUTHORIZED','REDIS_CLIENT','super'];_0x111d=function(){return _0x574e22;};return _0x111d();}const _0x2f42bb=_0x566b;(function(_0x50bd3c,_0x49d9a7){const _0xddaa4d=_0x566b,_0x330004=_0x50bd3c();while(!![]){try{const _0x452a0f=-parseInt(_0xddaa4d(0xfa))/0x1*(-parseInt(_0xddaa4d(0xe9))/0x2)+-parseInt(_0xddaa4d(0xe6))/0x3*(parseInt(_0xddaa4d(0xf6))/0x4)+-parseInt(_0xddaa4d(0xf1))/0x5*(parseInt(_0xddaa4d(0xdf))/0x6)+parseInt(_0xddaa4d(0xef))/0x7+parseInt(_0xddaa4d(0xee))/0x8+-parseInt(_0xddaa4d(0xe2))/0x9*(parseInt(_0xddaa4d(0xfe))/0xa)+-parseInt(_0xddaa4d(0xe8))/0xb;if(_0x452a0f===_0x49d9a7)break;else _0x330004['push'](_0x330004['shift']());}catch(_0x32dc32){_0x330004['push'](_0x330004['shift']());}}}(_0x111d,0x7044e));function _0x566b(_0x49301a,_0x36cd6c){const _0x111d82=_0x111d();return _0x566b=function(_0x566b8b,_0x2dd667){_0x566b8b=_0x566b8b-0xdc;let _0x1fdb5f=_0x111d82[_0x566b8b];return _0x1fdb5f;},_0x566b(_0x49301a,_0x36cd6c);}var __decorate=this&&this[_0x2f42bb(0xf3)]||function(_0x4142dd,_0x58c0a9,_0x1744cb,_0x323d4b){const _0x3af447=_0x2f42bb;var _0x54cb48=arguments[_0x3af447(0x104)],_0x3f6f9d=_0x54cb48<0x3?_0x58c0a9:_0x323d4b===null?_0x323d4b=Object[_0x3af447(0xeb)](_0x58c0a9,_0x1744cb):_0x323d4b,_0x498d71;if(typeof Reflect==='object'&&typeof Reflect[_0x3af447(0xe3)]==='function')_0x3f6f9d=Reflect[_0x3af447(0xe3)](_0x4142dd,_0x58c0a9,_0x1744cb,_0x323d4b);else{for(var _0x3c40fe=_0x4142dd[_0x3af447(0x104)]-0x1;_0x3c40fe>=0x0;_0x3c40fe--)if(_0x498d71=_0x4142dd[_0x3c40fe])_0x3f6f9d=(_0x54cb48<0x3?_0x498d71(_0x3f6f9d):_0x54cb48>0x3?_0x498d71(_0x58c0a9,_0x1744cb,_0x3f6f9d):_0x498d71(_0x58c0a9,_0x1744cb))||_0x3f6f9d;}return _0x54cb48>0x3&&_0x3f6f9d&&Object[_0x3af447(0x105)](_0x58c0a9,_0x1744cb,_0x3f6f9d),_0x3f6f9d;},__metadata=this&&this[_0x2f42bb(0xdc)]||function(_0x5631c2,_0x2a18c2){const _0x2e8697=_0x2f42bb;if(typeof Reflect===_0x2e8697(0xf7)&&typeof Reflect['metadata']===_0x2e8697(0xfc))return Reflect[_0x2e8697(0x103)](_0x5631c2,_0x2a18c2);},__param=this&&this['__param']||function(_0x3d7bac,_0x4653bb){return function(_0x162889,_0x4cfe0e){_0x4653bb(_0x162889,_0x4cfe0e,_0x3d7bac);};};Object[_0x2f42bb(0x105)](exports,_0x2f42bb(0xde),{'value':!![]}),exports[_0x2f42bb(0xe4)]=void 0x0;const common_1=require(_0x2f42bb(0xec));let RedisCacheService=class RedisCacheService{constructor(_0x2fe939){this['redisClient']=_0x2fe939;}async[_0x2f42bb(0xe1)](){}async[_0x2f42bb(0xe0)](_0xe7410c){const _0x5cdbd6=_0x2f42bb,{key:_0x3f4fe8}=_0xe7410c;return await this['redisClient'][_0x5cdbd6(0xe0)](_0x3f4fe8);}async['set'](_0x1d34b7,_0x56c859){const _0x20a18c=_0x2f42bb;try{const {key:_0x50a5c1,val:_0x37d539}=_0x1d34b7;await this[_0x20a18c(0x102)][_0x20a18c(0xe7)](_0x50a5c1,_0x37d539),_0x56c859&&await this['redisClient']['expire'](_0x50a5c1,_0x56c859);return;}catch(_0x8875a){throw new common_1[(_0x20a18c(0xea))](_0x8875a,common_1[_0x20a18c(0xf2)]['BAD_REQUEST']);}}async[_0x2f42bb(0xff)](_0x2fca87){const _0x20a1cb=_0x2f42bb;return await this[_0x20a1cb(0x102)][_0x20a1cb(0xff)](_0x2fca87);}async['del'](_0x2ff37e){const _0x4307df=_0x2f42bb,{key:_0x2f3fcc}=_0x2ff37e;return await this[_0x4307df(0x102)]['del'](_0x2f3fcc);}async['saveToken'](_0x2c2048,_0x28dbe3){const _0x231e30=_0x2f42bb,_0x12971b=await this[_0x231e30(0x102)][_0x231e30(0xf8)](_0x231e30(0xed)+_0x2c2048,0x0,-0x1);await this[_0x231e30(0xe5)](_0x2c2048,_0x12971b),await this[_0x231e30(0x102)]['set']('token:'+_0x2c2048,_0x28dbe3);}async[_0x2f42bb(0xe5)](_0x5c40e3,_0x1a1df8){const _0x3e0456=_0x2f42bb;_0x1a1df8[_0x3e0456(0xf4)](_0x392549=>{const _0x21e2b5=_0x3e0456;this['redisClient'][_0x21e2b5(0xf9)]('token:'+_0x5c40e3+':'+_0x392549);});}async[_0x2f42bb(0xfd)](_0x1a79c1,_0x5d4f58){const _0x469c1=_0x2f42bb,{id:_0x313f28,role:_0x5581f3}=_0x5d4f58[_0x469c1(0xf5)];if(_0x5581f3==='visitor')return!![];const _0x356439=await this['redisClient'][_0x469c1(0xe0)](_0x469c1(0xf0)+_0x313f28);if(_0x356439===null)return await this['redisClient'][_0x469c1(0xe7)](_0x469c1(0xf0)+_0x313f28,_0x1a79c1),!![];if(_0x356439!==_0x1a79c1){if([_0x469c1(0x108),_0x469c1(0xfb),'manager'][_0x469c1(0x101)](_0x5581f3))return!![];throw new common_1[(_0x469c1(0xea))](_0x469c1(0x100),common_1[_0x469c1(0xf2)][_0x469c1(0x106)]);}}};RedisCacheService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,common_1[_0x2f42bb(0xdd)])(_0x2f42bb(0x107))),__metadata(_0x2f42bb(0x109),[Object])],RedisCacheService),exports[_0x2f42bb(0xe4)]=RedisCacheService;