'use strict';const _0x7c7c71=_0x30ae;(function(_0x45f603,_0x5fc5cc){const _0x42f87d=_0x30ae,_0x5ae997=_0x45f603();while(!![]){try{const _0x4778c9=parseInt(_0x42f87d(0x217))/0x1*(-parseInt(_0x42f87d(0x21a))/0x2)+-parseInt(_0x42f87d(0x1f3))/0x3*(parseInt(_0x42f87d(0x21c))/0x4)+-parseInt(_0x42f87d(0x1dd))/0x5*(parseInt(_0x42f87d(0x1ff))/0x6)+parseInt(_0x42f87d(0x20d))/0x7+-parseInt(_0x42f87d(0x200))/0x8+parseInt(_0x42f87d(0x1f9))/0x9+parseInt(_0x42f87d(0x1eb))/0xa;if(_0x4778c9===_0x5fc5cc)break;else _0x5ae997['push'](_0x5ae997['shift']());}catch(_0x541549){_0x5ae997['push'](_0x5ae997['shift']());}}}(_0x1ddf,0x795ed));var __decorate=this&&this[_0x7c7c71(0x218)]||function(_0x3920da,_0x37d4de,_0x5392aa,_0x43a2ee){const _0x2c5abc=_0x7c7c71;var _0x71163f=arguments[_0x2c5abc(0x1f6)],_0x43ff74=_0x71163f<0x3?_0x37d4de:_0x43a2ee===null?_0x43a2ee=Object[_0x2c5abc(0x1d7)](_0x37d4de,_0x5392aa):_0x43a2ee,_0x1424c4;if(typeof Reflect===_0x2c5abc(0x213)&&typeof Reflect[_0x2c5abc(0x1d9)]===_0x2c5abc(0x1e6))_0x43ff74=Reflect['decorate'](_0x3920da,_0x37d4de,_0x5392aa,_0x43a2ee);else{for(var _0x547549=_0x3920da[_0x2c5abc(0x1f6)]-0x1;_0x547549>=0x0;_0x547549--)if(_0x1424c4=_0x3920da[_0x547549])_0x43ff74=(_0x71163f<0x3?_0x1424c4(_0x43ff74):_0x71163f>0x3?_0x1424c4(_0x37d4de,_0x5392aa,_0x43ff74):_0x1424c4(_0x37d4de,_0x5392aa))||_0x43ff74;}return _0x71163f>0x3&&_0x43ff74&&Object[_0x2c5abc(0x1d2)](_0x37d4de,_0x5392aa,_0x43ff74),_0x43ff74;},__metadata=this&&this['__metadata']||function(_0x3daef7,_0x865927){const _0x319588=_0x7c7c71;if(typeof Reflect===_0x319588(0x213)&&typeof Reflect[_0x319588(0x220)]===_0x319588(0x1e6))return Reflect[_0x319588(0x220)](_0x3daef7,_0x865927);},__param=this&&this[_0x7c7c71(0x21d)]||function(_0xc01c9b,_0x1c2e81){return function(_0x51331d,_0x49386d){_0x1c2e81(_0x51331d,_0x49386d,_0xc01c9b);};};Object[_0x7c7c71(0x1d2)](exports,_0x7c7c71(0x20c),{'value':!![]}),exports['ChatGroupService']=void 0x0;const common_1=require(_0x7c7c71(0x20a)),chatGroup_entity_1=require(_0x7c7c71(0x1ef)),typeorm_1=require(_0x7c7c71(0x1f8)),typeorm_2=require(_0x7c7c71(0x206)),app_entity_1=require('../app/app.entity'),models_service_1=require(_0x7c7c71(0x1f7)),model_constant_1=require(_0x7c7c71(0x205));function _0x1ddf(){const _0x1022ba=['ModelsService','modelType','update','query','function','music','getGroupInfoFromId','lastTime','CHAT','7694840cpBQNd','forEach','HttpException','新对话','./chatGroup.entity','更新对话失败！','删除失败！','IsNull','80193qnQVms','map','set','length','../models/models.service','@nestjs/typeorm','1217817wKYmSu','ChatGroupService','groupId','Injectable','AppEntity','DESC','15450EtsoNY','1315920SNoaLa','appEntity','findOne','design:paramtypes','ceil','../../common/constants/model.constant','typeorm','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20groupId,\x20MAX(createdAt)\x20AS\x20lastTime\x20\x20FROM\x20chatlog\x20WHERE\x20groupId\x20IN\x20(','getModelByType','InjectRepository','@nestjs/common','stringify','__esModule','6628587XleWot','del','random','error:\x20','save','heat','object','chatGroupEntity','删除成功','find','9rIWyhH','__decorate',')\x20GROUP\x20BY\x20groupId\x0a\x20\x20\x20\x20\x20\x20','159508jCuLyo','config','36RkbBns','__param','modelsService','HttpStatus','metadata','defineProperty','Connection','user','connection','非法操作、您在删除一个非法资源！','getOwnPropertyDescriptor','undefined','decorate','affected','Repository','EModelType','450QZdAnW','join','MUSIC','isSticky','BAD_REQUEST'];_0x1ddf=function(){return _0x1022ba;};return _0x1ddf();}let ChatGroupService=class ChatGroupService{constructor(_0x1087ae,_0xe10bb8,_0x562677,_0x555abe){const _0x7d8b46=_0x7c7c71;this[_0x7d8b46(0x214)]=_0x1087ae,this[_0x7d8b46(0x201)]=_0xe10bb8,this[_0x7d8b46(0x21e)]=_0x562677,this['connection']=_0x555abe;}async['create'](_0x28846a,_0x26f28f){const _0x358ad8=_0x7c7c71;let _0x18b3ef;const {id:_0x189651}=_0x26f28f[_0x358ad8(0x1d4)],{modelType:_0x3e7745}=_0x28846a,_0x296cef={'title':_0x358ad8(0x1ee),'userId':_0x189651,'modelType':_0x3e7745,'config':''};if(_0x3e7745===_0x358ad8(0x1e7)){const _0x413a8c=await this['modelsService'][_0x358ad8(0x208)](model_constant_1[_0x358ad8(0x1dc)][_0x358ad8(0x1df)]);_0x296cef['config']=JSON[_0x358ad8(0x20b)](_0x413a8c);}else{const _0x32a867=await this['modelsService'][_0x358ad8(0x208)](model_constant_1[_0x358ad8(0x1dc)][_0x358ad8(0x1ea)]);_0x296cef[_0x358ad8(0x21b)]=JSON['stringify'](_0x32a867);}const _0x31cdad=await this[_0x358ad8(0x214)][_0x358ad8(0x211)](_0x296cef);return _0x18b3ef&&(_0x18b3ef[_0x358ad8(0x212)]=_0x18b3ef[_0x358ad8(0x212)]+Math[_0x358ad8(0x204)](Math[_0x358ad8(0x20f)]()*0xa),await this[_0x358ad8(0x201)][_0x358ad8(0x211)](_0x18b3ef)),_0x31cdad;}async[_0x7c7c71(0x1e5)](_0x577e00,_0x845b06){const _0x206cb1=_0x7c7c71;try{const {id:_0x2292bc}=_0x845b06[_0x206cb1(0x1d4)],_0x3f1e8a={'userId':_0x2292bc,'isDelete':![]};_0x577e00?_0x3f1e8a[_0x206cb1(0x1e3)]=_0x577e00:_0x3f1e8a[_0x206cb1(0x1e3)]=(0x0,typeorm_2[_0x206cb1(0x1f2)])();const _0x5ac307=await this[_0x206cb1(0x214)][_0x206cb1(0x216)]({'where':_0x3f1e8a,'order':{'isSticky':'DESC','id':_0x206cb1(0x1fe)}});if(!_0x5ac307[_0x206cb1(0x1f6)])return _0x5ac307;const _0x5a3cf7=_0x5ac307[_0x206cb1(0x1f4)](_0x2c7a5f=>_0x2c7a5f['id']),_0x19d833=await this[_0x206cb1(0x1d5)][_0x206cb1(0x1e5)](_0x206cb1(0x207)+_0x5a3cf7[_0x206cb1(0x1de)]()+_0x206cb1(0x219)),_0x32925f=new Map();_0x19d833[_0x206cb1(0x1ec)](_0x5be793=>{const _0x2b076c=_0x206cb1;_0x32925f[_0x2b076c(0x1f5)](_0x5be793[_0x2b076c(0x1fb)],_0x5be793[_0x2b076c(0x1e9)]);});const _0x533089=_0x5ac307[_0x206cb1(0x1f4)](_0x348421=>{return{..._0x348421,'lastTime':_0x32925f['get'](_0x348421['id'])||null};});return _0x533089;}catch(_0x55ae5d){console['log'](_0x206cb1(0x210),_0x55ae5d);}}async[_0x7c7c71(0x1e4)](_0x4789fc,_0x53a2a9){const _0x1ddd1e=_0x7c7c71,{title:_0x2dd561,isSticky:_0x377696,groupId:_0x54e947,config:_0x5ddd57,appType:_0x14e5e8}=_0x4789fc,{id:_0x3cd4e7}=_0x53a2a9[_0x1ddd1e(0x1d4)],_0x32a412=await this[_0x1ddd1e(0x214)][_0x1ddd1e(0x202)]({'where':{'id':_0x54e947,'userId':_0x3cd4e7}});if(!_0x32a412)throw new common_1[(_0x1ddd1e(0x1ed))]('对话组编号和用户编号不匹配，请登录之后创建新的对话！',common_1['HttpStatus'][_0x1ddd1e(0x1e1)]);const _0xe3bbd8={};_0x2dd561&&(_0xe3bbd8['title']=_0x2dd561),typeof _0x377696!==_0x1ddd1e(0x1d8)&&(_0xe3bbd8[_0x1ddd1e(0x1e0)]=_0x377696),_0x5ddd57&&(_0xe3bbd8[_0x1ddd1e(0x21b)]=_0x5ddd57);const _0x17893a=await this['chatGroupEntity']['update']({'id':_0x54e947},_0xe3bbd8);if(_0x17893a[_0x1ddd1e(0x1da)])return!![];else throw new common_1[(_0x1ddd1e(0x1ed))](_0x1ddd1e(0x1f0),common_1[_0x1ddd1e(0x21f)]['BAD_REQUEST']);}async[_0x7c7c71(0x20e)](_0x334d81,_0x46c75c){const _0x22843c=_0x7c7c71,{groupId:_0x9080d3}=_0x334d81,{id:_0x2adc60}=_0x46c75c['user'],_0x4705e4=await this[_0x22843c(0x214)][_0x22843c(0x202)]({'where':{'id':_0x9080d3,'userId':_0x2adc60}});if(!_0x4705e4)throw new common_1[(_0x22843c(0x1ed))](_0x22843c(0x1d6),common_1[_0x22843c(0x21f)][_0x22843c(0x1e1)]);const _0x1f9cdb=await this[_0x22843c(0x214)][_0x22843c(0x1e4)]({'id':_0x9080d3},{'isDelete':!![]});if(_0x1f9cdb[_0x22843c(0x1da)])return _0x22843c(0x215);else throw new common_1['HttpException'](_0x22843c(0x1f1),common_1[_0x22843c(0x21f)][_0x22843c(0x1e1)]);}async['delAll'](_0x20e0d6){const _0x562cfd=_0x7c7c71,{id:_0x36e07b}=_0x20e0d6[_0x562cfd(0x1d4)],_0x2329f6=await this[_0x562cfd(0x214)][_0x562cfd(0x1e4)]({'userId':_0x36e07b,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x2329f6['affected'])return _0x562cfd(0x215);else throw new common_1[(_0x562cfd(0x1ed))](_0x562cfd(0x1f1),common_1[_0x562cfd(0x21f)][_0x562cfd(0x1e1)]);}async[_0x7c7c71(0x1e8)](_0x3ed34f){const _0x177f83=_0x7c7c71;if(!_0x3ed34f||_0x3ed34f===0x0)return null;return await this[_0x177f83(0x214)][_0x177f83(0x202)]({'where':{'id':_0x3ed34f}});}};function _0x30ae(_0x93dbe3,_0x4e3ce6){const _0x1ddfba=_0x1ddf();return _0x30ae=function(_0x30aee1,_0x20f45b){_0x30aee1=_0x30aee1-0x1d2;let _0x86c075=_0x1ddfba[_0x30aee1];return _0x86c075;},_0x30ae(_0x93dbe3,_0x4e3ce6);}ChatGroupService=__decorate([(0x0,common_1[_0x7c7c71(0x1fc)])(),__param(0x0,(0x0,typeorm_1[_0x7c7c71(0x209)])(chatGroup_entity_1['ChatGroupEntity'])),__param(0x1,(0x0,typeorm_1[_0x7c7c71(0x209)])(app_entity_1[_0x7c7c71(0x1fd)])),__metadata(_0x7c7c71(0x203),[typeorm_2[_0x7c7c71(0x1db)],typeorm_2[_0x7c7c71(0x1db)],models_service_1[_0x7c7c71(0x1e2)],typeorm_2[_0x7c7c71(0x1d3)]])],ChatGroupService),exports[_0x7c7c71(0x1fa)]=ChatGroupService;