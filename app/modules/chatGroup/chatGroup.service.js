'use strict';const _0x3e693a=_0x3e93;function _0x3e93(_0x343633,_0x3c53b7){const _0x498963=_0x4989();return _0x3e93=function(_0x3e93d7,_0x45c79e){_0x3e93d7=_0x3e93d7-0x17d;let _0x23346b=_0x498963[_0x3e93d7];return _0x23346b;},_0x3e93(_0x343633,_0x3c53b7);}(function(_0x517b2f,_0x50557e){const _0x343f18=_0x3e93,_0x48e7cf=_0x517b2f();while(!![]){try{const _0x2a0e9a=parseInt(_0x343f18(0x189))/0x1*(-parseInt(_0x343f18(0x19e))/0x2)+-parseInt(_0x343f18(0x1b3))/0x3+-parseInt(_0x343f18(0x182))/0x4+parseInt(_0x343f18(0x1a9))/0x5*(-parseInt(_0x343f18(0x1a4))/0x6)+parseInt(_0x343f18(0x17e))/0x7+-parseInt(_0x343f18(0x18a))/0x8+-parseInt(_0x343f18(0x17f))/0x9*(-parseInt(_0x343f18(0x196))/0xa);if(_0x2a0e9a===_0x50557e)break;else _0x48e7cf['push'](_0x48e7cf['shift']());}catch(_0x1ee923){_0x48e7cf['push'](_0x48e7cf['shift']());}}}(_0x4989,0x59066));var __decorate=this&&this['__decorate']||function(_0x46c0c8,_0x4e74cd,_0x17ea39,_0x5704b5){const _0x5c314d=_0x3e93;var _0x273f5a=arguments[_0x5c314d(0x19f)],_0x2c2ba7=_0x273f5a<0x3?_0x4e74cd:_0x5704b5===null?_0x5704b5=Object[_0x5c314d(0x1b2)](_0x4e74cd,_0x17ea39):_0x5704b5,_0x5e66f3;if(typeof Reflect==='object'&&typeof Reflect[_0x5c314d(0x1a6)]==='function')_0x2c2ba7=Reflect[_0x5c314d(0x1a6)](_0x46c0c8,_0x4e74cd,_0x17ea39,_0x5704b5);else{for(var _0x518566=_0x46c0c8[_0x5c314d(0x19f)]-0x1;_0x518566>=0x0;_0x518566--)if(_0x5e66f3=_0x46c0c8[_0x518566])_0x2c2ba7=(_0x273f5a<0x3?_0x5e66f3(_0x2c2ba7):_0x273f5a>0x3?_0x5e66f3(_0x4e74cd,_0x17ea39,_0x2c2ba7):_0x5e66f3(_0x4e74cd,_0x17ea39))||_0x2c2ba7;}return _0x273f5a>0x3&&_0x2c2ba7&&Object['defineProperty'](_0x4e74cd,_0x17ea39,_0x2c2ba7),_0x2c2ba7;},__metadata=this&&this[_0x3e693a(0x1a0)]||function(_0x3b4958,_0x551f52){const _0x346c7b=_0x3e693a;if(typeof Reflect===_0x346c7b(0x19c)&&typeof Reflect[_0x346c7b(0x193)]===_0x346c7b(0x18b))return Reflect[_0x346c7b(0x193)](_0x3b4958,_0x551f52);},__param=this&&this[_0x3e693a(0x1af)]||function(_0x5e6d6d,_0x3d3b48){return function(_0x32d397,_0x1a5a00){_0x3d3b48(_0x32d397,_0x1a5a00,_0x5e6d6d);};};Object[_0x3e693a(0x18c)](exports,_0x3e693a(0x195),{'value':!![]}),exports[_0x3e693a(0x1b7)]=void 0x0;const common_1=require(_0x3e693a(0x1b9)),chatGroup_entity_1=require(_0x3e693a(0x19d)),typeorm_1=require(_0x3e693a(0x1b5)),typeorm_2=require(_0x3e693a(0x19a)),app_entity_1=require(_0x3e693a(0x1a8)),models_service_1=require(_0x3e693a(0x1bd));let ChatGroupService=class ChatGroupService{constructor(_0x2ac934,_0x28c67d,_0x567415){const _0x3f0e95=_0x3e693a;this[_0x3f0e95(0x1a3)]=_0x2ac934,this['appEntity']=_0x28c67d,this[_0x3f0e95(0x180)]=_0x567415;}async[_0x3e693a(0x18d)](_0x12d706,_0x5950be){const _0x4b14f4=_0x3e693a,{id:_0x5b5287}=_0x5950be['user'],{appId:_0x1d46d7}=_0x12d706,_0x20e8f4={'title':_0x4b14f4(0x1ad),'userId':_0x5b5287};if(_0x1d46d7){const _0x2c8bbc=await this[_0x4b14f4(0x1a1)]['findOne']({'where':{'id':_0x1d46d7}});if(!_0x2c8bbc)throw new common_1[(_0x4b14f4(0x1b0))](_0x4b14f4(0x1b8),common_1[_0x4b14f4(0x183)][_0x4b14f4(0x1aa)]);else{const {status:_0x5baf11,name:_0x148fc1}=_0x2c8bbc,_0x2d0494=await this['chatGroupEntity']['count']({'where':{'userId':_0x5b5287,'appId':_0x1d46d7,'isDelete':![]}});if(_0x2d0494>0x0)throw new common_1[(_0x4b14f4(0x1b0))](_0x4b14f4(0x181),common_1['HttpStatus']['BAD_REQUEST']);if(![0x1,0x3,0x4,0x5][_0x4b14f4(0x191)](_0x5baf11))throw new common_1[(_0x4b14f4(0x1b0))]('非法操作、您在使用一个未启用的应用！',common_1['HttpStatus']['BAD_REQUEST']);_0x148fc1&&(_0x20e8f4[_0x4b14f4(0x188)]=_0x148fc1),_0x1d46d7&&(_0x20e8f4[_0x4b14f4(0x185)]=_0x1d46d7);}}const _0x133419=await this['modelsService']['getBaseConfig'](_0x1d46d7);_0x1d46d7&&(_0x133419[_0x4b14f4(0x185)]=_0x1d46d7);if(!_0x133419)throw new common_1[(_0x4b14f4(0x1b0))](_0x4b14f4(0x1ab),common_1[_0x4b14f4(0x183)]['BAD_REQUEST']);return await this[_0x4b14f4(0x1a3)]['save'](Object[_0x4b14f4(0x1ba)](Object[_0x4b14f4(0x1ba)]({},_0x20e8f4),{'config':JSON['stringify'](_0x133419)}));}async[_0x3e693a(0x1bc)](_0x2d0501){const _0x45272f=_0x3e693a;try{const {id:_0x3d2500}=_0x2d0501[_0x45272f(0x1ac)],_0x20f1c6={'userId':_0x3d2500,'isDelete':![]};return await this['chatGroupEntity'][_0x45272f(0x1a7)]({'where':_0x20f1c6,'order':{'isSticky':_0x45272f(0x190),'id':_0x45272f(0x190)}});}catch(_0x5bc227){console['log'](_0x45272f(0x1b6),_0x5bc227);}}async[_0x3e693a(0x19b)](_0x88ef2f,_0x412fa4){const _0x2cce84=_0x3e693a,{title:_0x3f2d9a,isSticky:_0x1971b6,groupId:_0x4400ab,config:_0x56e800}=_0x88ef2f,{id:_0x27dcc2}=_0x412fa4[_0x2cce84(0x1ac)],_0x38884e=await this[_0x2cce84(0x1a3)][_0x2cce84(0x197)]({'where':{'id':_0x4400ab,'userId':_0x27dcc2}});if(!_0x38884e)throw new common_1['HttpException']('对话组编号和用户编号不匹配，请登录之后创建新的对话！',common_1[_0x2cce84(0x183)][_0x2cce84(0x1aa)]);const {appId:_0x54f913}=_0x38884e;if(_0x54f913&&!_0x3f2d9a)throw new common_1[(_0x2cce84(0x1b0))](_0x2cce84(0x187),common_1[_0x2cce84(0x183)][_0x2cce84(0x1aa)]);const _0x34af9a={};_0x3f2d9a&&(_0x34af9a[_0x2cce84(0x188)]=_0x3f2d9a),typeof _0x1971b6!==_0x2cce84(0x17d)&&(_0x34af9a[_0x2cce84(0x1a5)]=_0x1971b6),_0x56e800&&(_0x34af9a['config']=_0x56e800);const _0x5d9772=await this[_0x2cce84(0x1a3)][_0x2cce84(0x19b)]({'id':_0x4400ab},_0x34af9a);if(_0x5d9772[_0x2cce84(0x1b1)])return!![];else throw new common_1[(_0x2cce84(0x1b0))](_0x2cce84(0x184),common_1[_0x2cce84(0x183)][_0x2cce84(0x1aa)]);}async['del'](_0x293d9e,_0xe1f2f1){const _0x52030d=_0x3e693a,{groupId:_0x38c839}=_0x293d9e,{id:_0x239306}=_0xe1f2f1[_0x52030d(0x1ac)],_0x5e312a=await this[_0x52030d(0x1a3)][_0x52030d(0x197)]({'where':{'id':_0x38c839,'userId':_0x239306}});if(!_0x5e312a)throw new common_1[(_0x52030d(0x1b0))](_0x52030d(0x192),common_1['HttpStatus'][_0x52030d(0x1aa)]);const _0xa8291c=await this[_0x52030d(0x1a3)][_0x52030d(0x19b)]({'id':_0x38c839},{'isDelete':!![]});if(_0xa8291c[_0x52030d(0x1b1)])return _0x52030d(0x198);else throw new common_1['HttpException']('删除失败！',common_1[_0x52030d(0x183)][_0x52030d(0x1aa)]);}async['delAll'](_0x1f8b25){const _0x141211=_0x3e693a,{id:_0x54d612}=_0x1f8b25['user'],_0x404cb0=await this[_0x141211(0x1a3)][_0x141211(0x19b)]({'userId':_0x54d612,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x404cb0['affected'])return'删除成功';else throw new common_1[(_0x141211(0x1b0))](_0x141211(0x1ae),common_1[_0x141211(0x183)][_0x141211(0x1aa)]);}async[_0x3e693a(0x194)](_0x12f9d9){const _0x3ccb37=_0x3e693a;return await this[_0x3ccb37(0x1a3)]['findOne']({'where':{'id':_0x12f9d9}});}};function _0x4989(){const _0x2cdbe0=['HttpStatus','更新对话失败！','appId','AppEntity','应用对话名称不能修改哟！','title','1ZWTihw','4787488bXJRTQ','function','defineProperty','create','ChatGroupEntity','design:paramtypes','DESC','includes','非法操作、您在删除一个非法资源！','metadata','getGroupInfoFromId','__esModule','87680qZDOia','findOne','删除成功','InjectRepository','typeorm','update','object','./chatGroup.entity','53646zDPoWj','length','__metadata','appEntity','ModelsService','chatGroupEntity','12SNojmd','isSticky','decorate','find','../app/app.entity','1379905gOvjQY','BAD_REQUEST','管理员未配置任何AI模型、请先联系管理员开通聊天模型配置！','user','新对话','删除失败！','__param','HttpException','affected','getOwnPropertyDescriptor','741183BAVstu','Repository','@nestjs/typeorm','error:\x20','ChatGroupService','非法操作、您在使用一个不存在的应用！','@nestjs/common','assign','Injectable','query','../models/models.service','undefined','208831pJjzni','2502vkMEkh','modelsService','当前应用已经开启了一个对话无需新建了！','2713636dOnwiB'];_0x4989=function(){return _0x2cdbe0;};return _0x4989();}ChatGroupService=__decorate([(0x0,common_1[_0x3e693a(0x1bb)])(),__param(0x0,(0x0,typeorm_1[_0x3e693a(0x199)])(chatGroup_entity_1[_0x3e693a(0x18e)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(app_entity_1[_0x3e693a(0x186)])),__metadata(_0x3e693a(0x18f),[typeorm_2[_0x3e693a(0x1b4)],typeorm_2[_0x3e693a(0x1b4)],models_service_1[_0x3e693a(0x1a2)]])],ChatGroupService),exports[_0x3e693a(0x1b7)]=ChatGroupService;