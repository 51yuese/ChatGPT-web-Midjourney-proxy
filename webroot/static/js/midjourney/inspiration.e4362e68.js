import{d as e,b as a,ar as l,u as t,y as s,c as n,v as i,G as o,I as u,V as r,z as v,W as f,i as d,j as c,a2 as p,F as m,r as A,as as h,o as g,n as y,w,at as x,g as k,a4 as b,h as B,k as C,l as E,a0 as I,a1 as U,ab as j,au as K,av as D,M as R,m as S,C as F,D as J,H as L}from"../main-9f041486.js";import{t as V}from"../throttle/throttle.33f09de3.js";import{S as W}from"../index/index.a184fda1.js";const q={class:"overflow-hidden pr-0 h-full flex flex-col"},N={class:"market overflow-y-auto flex-1 min-h-screen h-[80vh] p-2 relative itemContent"},O=["id"],Q=["id","src","onLoad","onError"],z=["onClick"],G=[c("div",null,"查看详情",-1)],H=e({__name:"market",props:{type:{type:String,required:!1,default:"all"}},setup(e,{expose:k}){var b;const B=a();null==(b=l())||b.appContext.config.globalProperties.$viewerApi,t();const C=s([]),E=s({}),I=s(0),U=s(160),j=s(0),K=s(10),D=s(10),R=s([]),S=s(null),F=s(0);n((()=>B.isLogin));const J=s(30),L=s(""),W=n((()=>J.value+K.value+150));i();const H=e,T=s();o.on("newData",(e=>{T.value=e}));const _=u({page:1,size:999,rec:1,squareType:H.type});function P(){!function(){const{showName:e=0,showOther:a=0}={};I.value=15*[e,a].filter((e=>e)).length}(),function(){if(!S.value)return;const e=S.value.clientWidth;j.value=Math.floor(e/W.value);const a=e-j.value*W.value,l=(j.value-1)*K.value;a-l<0&&(j.value-=1);U.value=Math.floor((e-l)/j.value)}();const e=j.value,a=U.value,l=[];X.value.forEach(((t,s)=>{let n=200,i=300;t.fileInfo&&(n=t.fileInfo.width||n,i=t.fileInfo.height||i);const o=i*(a/n)+D.value+I.value,u=E.value[t.id];if(l.length<e)u.style.top="0px",u.style.left=(a+K.value)*s+"px",l.push(o);else{const e=Math.min.apply(null,l),a=l.findIndex((a=>a===e));u.style.top=`${e+0}px`,u.style.left=a*(U.value+K.value)+"px",l[a]+=o}})),F.value=Math.max(...l)+130}const X=n((()=>T.value?T.value.rows:L.value?C.value.filter((e=>{const{prompt:a}=e;return a.includes(L.value)})):C.value));r(J,(()=>{P()}));let Z=null;async function M(){let e=(await h(_)).data.rows;e.forEach((e=>{e.src=e.imageUrl+"?imageView2/0/w/400/q/85"})),C.value=e}r(X,(()=>{X.value.length&&(clearTimeout(Z),Z=setTimeout((()=>{P()}),300))}));const Y=n((()=>e=>{let a=200,l=300;return e.fileInfo&&(a=e.fileInfo.width,l=e.fileInfo.height),l/(a/U.value)})),$=V((function(){P()}),200);return v((async()=>{await M(),P(),window.addEventListener("resize",$)})),k({handleQuery:e=>{_.squareType=e,M(),P()}}),f((()=>{window.removeEventListener("resize",$)})),(e,a)=>(g(),d("div",q,[c("div",N,[c("div",{id:"wapper",ref_key:"wapperRef",ref:S,class:"wapper",style:p({height:`${F.value}px`})},[(g(!0),d(m,null,A(X.value,((e,a)=>(g(),d("div",{id:e.id,key:a,ref_for:!0,ref:a=>function(e,a){e&&a&&(E.value[a.id]=e)}(a,e),class:"wapper-item",style:p({width:`${U.value}px`})},[y(x,{name:"img",css:!0},{default:w((()=>[c("img",{id:e.id,class:"item-file rounded-sm",style:p({width:`${U.value}px`,height:`${Y.value(e)}px`}),src:e.src,loading:"lazy",onLoad:a=>function(e,a){R.value.push(a.id)}(0,e),onError:a=>function(e,a){R.value.push(a.id)}(0,e)},null,44,Q)])),_:2},1024),c("div",{class:"menu",onClick:a=>function(e){o.emit("Details",!0),o.emit("DetailsData",e)}(e)},G,8,z)],12,O)))),128))],4)])]))}}),T=e=>(F("data-v-c90eedfa"),e=e(),J(),e),_={style:{position:"absolute"}},P=T((()=>c("div",{class:"mask"},null,-1))),X={class:"dark:bg-[#15171A] bg-[#fff] mainBox"},Z={key:0,class:"flex justify-center"},M={style:{display:"flex","justify-content":"center","margin-top":"10px"}},Y={class:"inpBox bg-[#EBEBEB] dark:bg-[#171726]"},$=[T((()=>c("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAe1JREFUOE+dlD1oFFEUhb8DKmphKom/CBILQdHCBBQhNmJAUlkFtRFEK0Fr7aw1sQhISCWSyjSSYKGgRCyihUbsUijGQmxU8AcVjnOXN+tkdnZn3dcs7Jv3vXPfPfeINsv2WmAXsBlYB/wCPgHvJP1udy7+V3nT9kbgGDAIrK84/AN4kX3zWNL3KvgqqO0dwFlgE/AReAm8BwK0AdgJHAC2AF+BO5JWyuAm1HYcOA84UzknabHD0wwBJ1OlU5Li4uZqQG1HmVdSubclfej0ZunMNuAi8DOr7Iak+G2sHBq3HgVmJT2vA+b7tg8Bp4CnkuaaUNtrgKvAF0k3uwUWwJeBPuC6pD8Npbb3AOeAB5Ke9AAdBkayJk5LWs6hR4BRYCr5sf9/4LZ3pwbfl/Qsh4YnTwC3gOPAXuBaXkqdcttbgUvAI0kPq5QGMBo2WbZJB3tVKm2+KfA22WRZ0nSdymStyjfNu/9Z0rjt08A+YEnSTB3Ydmv30225T+8Br4AzMaqSJjpBCz5dkDRfNn8vE7UduAB8AyZaJiqp7WX2IxLfAHclRWb8G9PCdHSTUgeB/pjAlK8D2ai+BmZycK95GvkQ0xeROAbsL4JboAXVxeSPLA1AS/LbDsZqcJ1lutkvgefbKu0GVvwmgQ8DK38BXh3TaV83jK0AAAAASUVORK5CYII=",alt:""},null,-1))),T((()=>c("p",null,"搜索",-1)))],ee={key:1,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden justify-center",style:{"margin-top":"25px"}},ae={class:"relative z-40 transition-300 ease"},le=["onClick"],te={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},se={class:"flex-1 h-[82vh]",style:{padding:"0 200px","margin-bottom":"10px"}},ne=L(e({__name:"inspiration",setup(e){const{isMobile:a}=k(),l=s(),t=s(""),n=s(),i=s([]);(async()=>{const e=await j({page:1,size:100}).then((e=>e.data.rows));i.value=[{name:"全部",value:""}].concat(e)||K,l.value.handleQuery(t.value)})(),o.emit("drawRoute",b.options.history.location);const u=s(),r=s();function v(){let e={keyword:r.value,page:1,size:999};D(e).then((e=>{u.value=e.data,o.emit("newData",u.value)})),r.value=""}return(e,s)=>(g(),d(m,null,[c("div",_,[B(a)?E("",!0):(g(),C(W,{key:0}))]),P,c("div",X,[B(a)?E("",!0):(g(),d("div",Z)),c("div",M,[c("div",Y,[I(c("input",{class:"inp bg-[#f4f4f4] dark:bg-[#010102]","onUpdate:modelValue":s[0]||(s[0]=e=>r.value=e),type:"text",placeholder:"输入关键词"},null,512),[[U,r.value]]),c("div",{class:"iconBox",onClick:v},$)])]),B(a)?E("",!0):(g(),d("div",ee,[c("div",ae,[c("ul",{class:"flex justify-start items-center",ref_key:"tabListRef",ref:n},[(g(!0),d(m,null,A(i.value,(e=>(g(),d("li",{onClick:a=>{return s=e,t.value=s.value,l.value.handleQuery(s.value),void o.emit("newData","");var s},class:R(["mr-1 ml-1 w-auto select-none cursor-pointer hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7] duration-300 flex rounded-3xl",[e.value===t.value?"text-[#fff] bg-gradient-to-l from-[#2F73EC] to-[#5AA8F7]  dark:text-[#fff]":"bg-[transparent] dark:bg-[transparent]"]])},[c("div",te,S(e.name),1)],10,le)))),256))],512)])])),c("div",se,[y(H,{ref_key:"marketRef",ref:l,type:t.value},null,8,["type"])])])],64))}}),[["__scopeId","data-v-c90eedfa"]]);export{ne as default};
