import{_ as e,a as t,b as a,c as l}from"../end/end.08128031.js";import{S as i}from"../index/index.a184fda1.js";import{d as o,u as n,b as s,c,v as r,e as u,g as d,y as p,i as m,h as v,k as g,l as x,j as f,n as y,F as k,r as h,Z as b,m as C,o as I,_ as N,M as B,C as F,D as w,aC as A,H as E}from"../main-9f041486.js";import{q as T,c as j,a as L,m as U,b as _,d as D}from"./music.aabbafa0.js";import{p as S}from"../index/index.faf64f9d.js";const R=e=>(F("data-v-f18aeadb"),e=e(),w(),e),q={class:"bg-[#f4f4f4] dark:bg-[#020104] musicBody"},H={class:"mainBox"},M={key:0,class:"videoBox"},O=R((()=>f("div",{style:{width:"504px",height:"756px","border-radius":"8px",position:"relative",display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"},class:"bg-[#E5EDFE] dark:bg-[#0A182F]"},[f("div",{style:{width:"50px",height:"50px"}},[f("div",{class:"loader"})]),f("p",{style:{"margin-top":"10px"}},"视频生成中，请稍等")],-1))),z=["src"],G={class:"control"},J={class:"musicSquareTitle bg-[#fff] dark:bg-[#15171A] border-[1px] border-b dark:border-[#020104] border-[transparent]"},Z=R((()=>f("div",{style:{"margin-left":"4px"}},"音乐广场",-1))),K={style:{height:"87vh","border-radius":"0 0 12px 12px"},class:"bg-[#fff] dark:bg-[#15171A]"},P={class:"contentBox bg-[#fff] dark:bg-[#15171A]"},Q={class:"tabBox"},V=["onClick"],W={class:"itemTop bg-[#F5F8FE] dark:bg-[#0A182F]"},X=["src"],Y={class:"topTitle"},$={class:"title"},ee={class:"intro"},te={key:0,class:"itemBottomDark"},ae={class:"iconBox"},le={style:{"margin-left":"4px"}},ie={class:"iconBox"},oe={style:{"margin-left":"4px"}},ne={class:"iconBox",style:{position:"relative"}},se={key:0,class:"operationBox bg-[#fff] dark:bg-[#15171A]"},ce=["onClick"],re=R((()=>f("div",null,"下载视频",-1))),ue=["onClick"],de=R((()=>f("div",null,"下载音频",-1))),pe={key:1,class:"itemBottomLight"},me={class:"iconBox"},ve={style:{"margin-left":"4px"}},ge={class:"iconBox"},xe={style:{"margin-left":"4px"}},fe={class:"iconBox",style:{position:"relative"}},ye={key:0,class:"operationBox bg-[#fff] dark:bg-[#15171A]"},ke={class:"operationItem",style:{display:"flex"}},he=R((()=>f("div",null,"下载视频",-1))),be={class:"operationItem",style:{display:"flex"}},Ce=R((()=>f("div",null,"下载音频",-1))),Ie={class:"end text-[#A3A5A6] dark:text-[#76777A]"},Ne=["href"],Be=["href"],Fe=E(o({__name:"musicSquare",setup(o){const F=n(),w=s(),E=c((()=>w.isLogin));let R=null;r();const Fe=u(),we=c((()=>"dark"===Fe.theme)),{isMobile:Ae}=d(),Ee=p([{name:"最新歌曲",key:0},{name:"流行趋势",key:1}]),Te=p(0),je=p(1),Le=p(),Ue=p(""),_e=p("");function De(){Se.value=[];let e={size:50,page:je.value,order:_e.value};U(e).then((e=>{Le.value=e.data.count;const t=e.data.records.filter((e=>e.text)).map((e=>{const[t,a]=S(e.text);return e.title=t.title,e.image=t.image,e.agree=e.agree,e.agreeNum=e.agreeNum,e.operation=t.operation,e.intro=t.intro,e.mp3=t.mp3,e.mp4=t.mp4,e}));Se.value=t,Ye()})).catch((e=>{Ye()}))}const Se=p([]);ze(),T({modelType:"music"}).then((e=>{0!=e.data.length?localStorage.setItem("musicGroupId",e.data[0].id):0==e.data.length&&j({modelType:"music"}).then((e=>{localStorage.setItem("musicGroupId",e.data.id)}))}));const Re=p(""),qe=p(""),He=p(""),Me=p(""),Oe=p("");function ze(){R||(R=F.loading("数据加载中",{duration:0}));let e={size:50,page:je.value,order:_e.value};U(e).then((e=>{Le.value=e.data.count;const t=e.data.records.filter((e=>e.text)).map((e=>{const[t,a]=S(e.text);return e.title=t.title,e.image=t.image,e.agree=e.agree,e.agreeNum=e.agreeNum,e.operation=t.operation,e.intro=t.intro,e.mp3=t.mp3,e.mp4=t.mp4,e}));Se.value=[...Se.value,...t],Ye()})).catch((e=>{Ye()}))}L({keys:["copyrightTitle","icpNumber","policeFilingNumber","icpUrl","policeFilingUrl"]}).then((e=>{Re.value=e.data.copyrightTitle,qe.value=e.data.icpNumber,He.value=e.data.policeFilingNumber,Me.value=e.data.icpUrl,Oe.value=e.data.policeFilingUrl}));const Ge=p(1);function Je(e){let t={relateId:e.chatId,action:"agree",relateType:"suno"};0!=Ge.value&&(Ge.value=0,D(t).then((t=>{e.agree?Se.value.forEach((t=>{t.chatId==e.chatId&&(t.agree=null,t.agreeNum--)})):Se.value.forEach((t=>{t.chatId==e.chatId&&(t.agree="agree",t.agreeNum++)})),Ge.value=1})))}const Ze=p(""),Ke=p(!0);function Pe(){const e=document.getElementById("video");Ke.value?(Ke.value=!1,e.pause()):(Ke.value=!0,e.play())}function Qe(e){if(!E.value)return void w.setLoginDialog(!0);Ze.value=e.mp4;let t={recoredId:e.chatId};e.playNum++,_(t).then((e=>{}))}function Ve(e){let t=[];Se.value.forEach((e=>{t=[...t,e.mp4]}));let a=t.indexOf(Ze.value);if(0==e){if(0==a)return;a--;let e={recoredId:Se.value[a].chatId};Se.value[a].playNum++,_(e).then((e=>{})),Ze.value=t[a]}else if(1==e){if(a==t.length-1)return;a++;let e={recoredId:Se.value[a].chatId};Se.value[a].playNum++,_(e).then((e=>{})),Ze.value=t[a]}}const We=p(!1);function Xe(e){e.operation=!0,We.value=!0}function Ye(){R&&(R.destroy(),R=null)}function $e(e,t){if(!E.value)return void w.setLoginDialog(!0);let a="/api";if(R||(R=F.loading("下载中，请稍等",{duration:0})),"mp4"==t){et();let t=e.mp4.split("/").pop();A.get(a+"/proxy/down",{responseType:"blob",params:{url:e.mp4}}).then((e=>{const a=window.URL.createObjectURL(new Blob([e.data])),l=document.createElement("a");l.href=a,l.setAttribute("download",t),l.click(),Ye(),F.success("下载成功")}))}else if("mp3"==t){et();let t=e.mp3.split("/").pop();A.get(a+"/proxy/down",{responseType:"blob",params:{url:e.mp3}}).then((e=>{const a=window.URL.createObjectURL(new Blob([e.data])),l=document.createElement("a");l.href=a,l.setAttribute("download",t),l.click(),Ye(),F.success("下载成功")}))}}function et(){We.value=!1,Se.value.forEach((e=>{e.operation=!1}))}const tt=p(null);function at(){const e=tt.value;if(e.scrollTop+e.clientHeight+1>=e.scrollHeight){if(30*je.value>=Le.value)return void F.error("没有更多数据了");je.value++,ze()}}return(o,n)=>(I(),m("div",q,[v(Ae)?x("",!0):(I(),g(i,{key:0,sideType:1})),We.value?(I(),m("div",{key:1,class:"mask",onClick:et})):x("",!0),f("div",H,[Ze.value?(I(),m("div",M,[O,f("video",{class:"video",autoplay:"",id:"video",loop:"",src:Ze.value},null,8,z),y(v(N),{icon:"icon-park-solid:close-one",class:"text-xl text-[#fff] text-center icon",onClick:n[0]||(n[0]=e=>Ze.value="")}),f("div",G,[f("img",{class:"controlItem",style:{cursor:"pointer"},src:e,alt:"",onClick:n[1]||(n[1]=e=>Ve(0))}),Ke.value?(I(),m("img",{key:0,class:"controlItem",src:t,style:{margin:"0 50px",cursor:"pointer"},alt:"",onClick:Pe})):x("",!0),Ke.value?x("",!0):(I(),m("img",{key:1,class:"controlItem",src:a,style:{margin:"0 50px",cursor:"pointer"},alt:"",onClick:Pe})),f("img",{class:"controlItem",style:{cursor:"pointer"},src:l,alt:"",onClick:n[2]||(n[2]=e=>Ve(1))})])])):x("",!0),f("div",J,[y(v(N),{icon:"akar-icons:music-album",class:"text-xl text-center"}),Z]),f("div",K,[f("div",P,[f("div",Q,[(I(!0),m(k,null,h(Ee.value,((e,t)=>(I(),m("div",{class:B([Te.value==t?"bg-[#3378ED] text-[#fff]":"bg-[#F4F4F4] dark:bg-[#010102]","tabItem"]),onClick:e=>{return a=t,Te.value=a,je.value=1,void(0==a?(Ue.value="",_e.value="",De()):1==a&&(_e.value="agreeNum",De()));var a},key:e.key},C(e.name),11,V)))),128))]),f("div",{class:"content",ref_key:"container",ref:tt,onScroll:at},[(I(!0),m(k,null,h(Se.value,(e=>(I(),m("div",{class:"contentItem",key:e.chatId},[f("div",W,[f("img",{class:"topImg",src:e.image,alt:"加载失败"},null,8,X),f("div",Y,[f("div",$,C(""==e.title?"匿名":e.title),1),f("div",ee,C(e.intro),1)])]),we.value?(I(),m("div",te,[f("div",ae,[y(v(N),{icon:"gridicons:play",class:"text-xl text-center icon",onClick:t=>Qe(e)},null,8,["onClick"]),f("div",le,C(e.playNum?e.playNum:0),1)]),f("div",ie,["agree"==e.agree?(I(),g(v(N),{key:0,icon:"iconamoon:like-fill",class:"text-xl text-center icon",onClick:t=>Je(e)},null,8,["onClick"])):(I(),g(v(N),{key:1,icon:"iconamoon:like-light",class:"text-xl text-center icon",onClick:t=>Je(e)},null,8,["onClick"])),f("div",oe,C(e.agreeNum?e.agreeNum:0),1)]),f("div",ne,[y(v(N),{icon:"ri:more-line",class:"text-xl text-center icon",onClick:t=>Xe(e)},null,8,["onClick"]),e.operation?(I(),m("div",se,[f("div",{class:"operationItem",style:{display:"flex"},onClick:t=>$e(e,"mp4")},[y(v(N),{icon:"gravity-ui:video",style:{"margin-right":"5px"},class:"text-xl text-center"}),re],8,ce),f("div",{class:"operationItem",style:{display:"flex"},onClick:t=>$e(e,"mp3")},[y(v(N),{icon:"fluent:headphones-sound-wave-24-filled",style:{"margin-right":"5px"},class:"text-xl text-center"}),de],8,ue)])):x("",!0)])])):(I(),m("div",pe,[f("div",me,[y(v(N),{icon:"gridicons:play",class:"text-xl text-center icon",onClick:t=>Qe(e)},null,8,["onClick"]),f("div",ve,C(e.playNum?e.playNum:0),1)]),f("div",ge,[e.agree?(I(),g(v(N),{key:0,icon:"iconamoon:like-fill",class:"text-xl text-center icon",onClick:t=>Je(e)},null,8,["onClick"])):(I(),g(v(N),{key:1,icon:"iconamoon:like-light",class:"text-xl text-center icon",onClick:t=>Je(e)},null,8,["onClick"])),f("div",xe,C(e.agreeNum?e.agreeNum:0),1)]),f("div",fe,[y(v(N),{icon:"ri:more-line",class:"text-xl text-center icon",onClick:t=>Xe(e)},null,8,["onClick"]),e.operation?(I(),m("div",ye,[f("div",ke,[y(v(N),{icon:"gravity-ui:video",style:{"margin-right":"5px"},class:"text-xl text-center"}),he]),f("div",be,[y(v(N),{icon:"fluent:headphones-sound-wave-24-filled",style:{"margin-right":"5px"},class:"text-xl text-center"}),Ce])])):x("",!0)])]))])))),128))],544)]),f("div",Ie,[b("版权所有 © "+C(Re.value)+" ",1),f("a",{href:Me.value||"#"},[f("a",{href:Oe.value||"#"},C(He.value),9,Be),b(C(qe.value),1)],8,Ne)])])])]))}}),[["__scopeId","data-v-f18aeadb"]]);export{Fe as default};
